{"mappings":"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","sources":["node_modules/rinn/dist/src/model-constraints.js","node_modules/rinn/dist/src/alpha.js","node_modules/rinn/dist/src/model-regex.js","node_modules/rinn/dist/src/class.js","node_modules/rinn/dist/src/event.js","node_modules/rinn/dist/src/event-dispatcher.js","node_modules/rinn/dist/src/model.js","node_modules/rinn/dist/src/model-list.js","node_modules/rinn/dist/src/schema.js","node_modules/rinn/dist/src/flattenable.js","node_modules/rinn/dist/src/collection.js","node_modules/rinn/dist/src/template.js","node_modules/rinn/dist/src/main.js","node_modules/base-64/base64.js","node_modules/node-fetch/browser.js","src/router.js","src/element.js","src/api.js","src/data-source.js","src/data-list.js","src/easing.js","src/anim.js","src/elems/r-tabs.js","src/elems/r-form.js","src/elems/r-panel.js","src/elems/r-list.js","src/elems/r-item.js","src/elems/r-paginator.js","src/elems/r-table.js","src/elems/r-select.js","src/utils.js","src/elems/r-image-cropper.js","src/elements.js","src/main.js"],"sourcesContent":["/*\n**\trinn/model-constraints.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\nimport Regex from './model-regex.js';\n\n/**\n**\tMap of model constraint handlers. Each function should accept parameters (in order): the model object (model), the constraint value (ctval),\n**\tthe property name (name), the property value (value) and return the corrected value once verified or throw an exception if errors occur.\n*/\n\nexport default\n{\n\t/**\n\t**\tUtility function (not a handler) to get the real value given a reference string. If the value is not a string, the value itself will\n\t**\tbe returned, if it is a string starting with '#' the model property will be returned, if starts with '@' the object property will be\n\t**\treturned, otherwise the contents of the string will eval'd and returned.\n\t*/\n\t_getref: function (value, obj)\n\t{\n\t\tif (typeof(value) == \"string\")\n\t\t{\n\t\t\tif (value.substr(0, 1) == \"#\")\t\t\tvalue = obj.get(value.substr(1));\n\t\t\telse if (value.substr(0, 1) == \"@\")\t\tvalue = obj[value.substr(1)];\n\n\t\t\tif (typeof(value) == \"string\")\n\t\t\t\treturn eval(value);\n\n\t\t\treturn value;\n\t\t}\n\t\telse\n\t\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the new value is of the valid type before storing it on the property. When possible if the\n\t**\tinput is of compatible type it will be converted to the target type.\n\t*/\n\ttype: function (model, ctval, name, value)\n\t{\n\t\tswitch (ctval)\n\t\t{\n\t\t\tcase \"int\":\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"float\":\n\t\t\t\tvalue = parseFloat(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"string\":\n\t\t\t\tvalue = (value === null || value === undefined) ? \"\" : value.toString();\n\t\t\t\tbreak;\n\n\t\t\tcase \"bit\":\n\t\t\t\tif (value === true || value === false) {\n\t\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\n\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"array\":\n\t\t\t\tif (Rinn.typeOf(value) == \"array\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (value === null || value === undefined)\n\t\t\t\t{\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"bool\":\n\t\t\t\tif (value === \"true\" || value === true) {\n\t\t\t\t\tvalue = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified model type.\n\t*/\n\tmodel: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!mclass) throw new Error (ctval);\n\n\t\tif (!value)\n\t\t\treturn new mclass();\n\n\t\treturn mclass.ensure (value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified class.\n\t*/\n\tcls: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) return new mclass();\n\n\t\treturn Rinn.ensureTypeOf(mclass, value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are of the specified class. Returns error if the class does not exist\n\t**\tor if the field is not an array. Therefore a type:array constraint should be used before this one.\n\t*/\n\tarrayof: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) value = [];\n\n\t\tif (!mclass || Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t\tvalue[i] = Rinn.ensureTypeOf(mclass, value[i]);\n\t\t\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are not null. Returns error if the field is not an array, therefore a\n\t**\ttype:array constraint should be used before this one.\n\t*/\n\tarraynull: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are all compliant. Returns error if the field is not an array, therefore\n\t**\ta type:array constraint should be used before this one.\n\t*/\n\tarraycompliant: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (!ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t\tcontinue;\n\n\t\t\tif (!value[i].isCompliant())\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the presense of the field.\n\t*/\n\trequired: function (model, ctval, name, value)\n\t{\n\t\tif (value === null || value === undefined)\n\t\t\tthrow new Error (ctval ? \"\" : \"null\");\n\n\t\tswitch (Rinn.typeOf(value))\n\t\t{\n\t\t\tcase \"array\":\n\t\t\t\tif (value.length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (value.toString().length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum length of the field.\n\t*/\n\tminlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum length of the field.\n\t*/\n\tmaxlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum value of the field.\n\t*/\n\tminval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum value of the field.\n\t*/\n\tmaxval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum number of items in the array.\n\t*/\n\tmincount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum number of items in the array.\n\t*/\n\tmaxcount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the format of the field using a regular expression. The constraint value should be the name of\n\t**\tone of the Model.Regex regular expressions.\n\t*/\n\tpattern: function (model, ctval, name, value)\n\t{\n\t\tif (!Regex[ctval].test (value.toString()))\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is inside the specified set of options. The set can be an array or a string with\n\t**\tthe options separated by vertical bar (|). The comparison is case-sensitive.\n\t*/\n\tinset: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(ctval) != \"array\")\n\t\t{\n\t\t\tif (!new RegExp(\"^(\"+ctval.toString()+\")$\").test (value.toString()))\n\t\t\t\tthrow new Error (ctval);\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (ctval.indexOf(value.toString()) == -1)\n\t\t\tthrow new Error (ctval.join(\"|\"));\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tSets the field to upper case.\n\t*/\n\tupper: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toUpperCase() : value;\n\t},\n\n\n\t/**\n\t**\tSets the field to lower case.\n\t*/\n\tlower: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toLowerCase() : value;\n\t}\n};\n","/*\r\n**\trinn/alpha.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nlet Rinn = { };\r\nexport default Rinn;\r\n\r\n/*\r\n**\tInvokes the specified function 'fn' 10ms later.\r\n**\r\n**\t>> void invokeLater (function fn);\r\n*/\r\nRinn.invokeLater = function (fn)\r\n{\r\n\tif (fn) setTimeout (function() { fn(); }, 10);\r\n};\r\n\r\n\r\n/*\r\n**\tWaits for the specified amount of milliseconds. Returns a Promise.\r\n**\r\n**\t>> Promise wait (int millis);\r\n*/\r\nRinn.wait = function (millis)\r\n{\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tsetTimeout (resolve, millis);\r\n\t});\r\n};\r\n\r\n\r\n/*\r\n**\tReturns the type of an element 'o', properly detects arrays and null types. The return string is always in lowercase.\r\n**\r\n**\t>> string typeOf (any o);\r\n*/\r\nRinn.typeOf = function (o)\r\n{\r\n\tif (o instanceof Array)\r\n\t\treturn \"array\";\r\n\r\n\tif (o === null)\r\n\t\treturn \"null\";\r\n\r\n\treturn (typeof(o)).toString().toLowerCase();\r\n};\r\n\r\n\r\n/*\r\n**\tReturns boolean indicating if the type of the element is an array or an object.\r\n**\r\n**\t>> bool isArrayOrObject (any o);\r\n*/\r\nRinn.isArrayOrObject = function (o)\r\n{\r\n\tswitch (Rinn.typeOf(o))\r\n\t{\r\n\t\tcase \"array\": case \"object\":\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tCreates a clone (deep copy) of the specified element. The element can be an array, an object or a primitive type.\r\n**\r\n**\t>> T clone (T elem);\r\n*/\r\nRinn.clone = function (elem)\r\n{\r\n\tlet o = Rinn.typeOf(elem);\r\n\r\n\tif (o === 'array')\r\n\t{\r\n\t\to = [ ];\r\n\r\n\t\tfor (let i = 0; i < elem.length; i++)\r\n\t\t\to.push (Rinn.clone(elem[i]));\r\n\t}\r\n\telse if (o === 'object')\r\n\t{\r\n\t\tif (('clone' in elem) && typeof(elem.clone) === 'function')\r\n\t\t\treturn elem.clone();\r\n\r\n\t\to = { };\r\n\r\n\t\tfor (let i in elem)\r\n\t\t\to[i] = Rinn.clone(elem[i]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\to = elem;\r\n\t}\r\n\r\n\treturn o;\r\n};\r\n\r\n\r\n/*\r\n**\tMerges all given elements into the first one, object fields are cloned.\r\n**\r\n**\t>> T merge (T... elems)\r\n*/\r\nRinn.merge = function (output, ...objs)\r\n{\r\n\tif (Rinn.typeOf(output) == \"array\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet arr = objs[i];\r\n\r\n\t\t\tif (Rinn.typeOf(arr) != \"array\")\r\n\t\t\t{\r\n\t\t\t\toutput.push(arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (let j = 0; j < arr.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\toutput.push(Rinn.clone(arr[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if (Rinn.typeOf(output) == \"object\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet obj = objs[i];\r\n\t\t\tif (Rinn.typeOf(obj) != \"object\") continue;\r\n\r\n\t\t\tfor (let field in obj)\r\n\t\t\t{\r\n\t\t\t\tif (Rinn.isArrayOrObject(obj[field]))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (field in output)\r\n\t\t\t\t\t\tRinn.merge(output[field], obj[field]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutput[field] = Rinn.clone(obj[field]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toutput[field] = obj[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tAssigns all fields from the specified objects into the first one.\r\n**\r\n**\t>> object override (object output, object... objs)\r\n*/\r\nRinn.override = function (output, ...objs)\r\n{\r\n\tfor (let i = 0; i < objs.length; i++)\r\n\t{\r\n\t\tfor (let j in objs[i])\r\n\t\t{\r\n\t\t\toutput[j] = objs[i][j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tCompares two objects and returns `true` if all properties in \"partial\" find a match in \"full\".\r\n*/\r\nRinn.partialCompare = function (full, partial)\r\n{\r\n\tif (full == null || partial == null) return false;\r\n\r\n\tif (full === partial)\r\n\t\treturn true;\r\n\r\n\tfor (var i in partial)\r\n\t{\r\n\t\tif (full[i] != partial[i])\r\n\t\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/*\r\n**\tPerforms a partial search for an object (o) in the specified array and returns its index or `false` if the\r\n**\tobject was not found. When `getObject` is set to `true` the object will be returned instead of an index, or\r\n**\t`null` if not found.\r\n*/\r\nRinn.arrayFind = function (arr, o, getObject)\r\n{\r\n\tfor (var i = 0; arr && i < arr.length; i++)\r\n\t{\r\n\t\tif (this.partialCompare (arr[i], o))\r\n\t\t\treturn getObject ? arr[i] : i;\r\n\t}\r\n\r\n\treturn getObject ? null : false;\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, returns boolean.\r\n**\r\n**\t>> bool isTypeOf (object obj, class _class);\r\n*/\r\nRinn.isInstanceOf = function (obj, _class)\r\n{\r\n\tif (!obj || !_class || typeof(obj) !== 'object')\r\n\t\treturn false;\r\n\r\n\tif (obj instanceof _class)\r\n\t\treturn true;\r\n\r\n\tif ('isInstanceOf' in obj)\r\n\t\treturn obj.isInstanceOf(_class);\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tTraverses the given object attempting to find the index/key that does an identical match with the specified value,\r\n**\tif not found returns -1, otherwise the index/key where the value was found.\r\n**\r\n**\t>> int indexOf (array container, T value)\r\n**\t>> string indexOf (object container, T value)\r\n*/\r\nRinn.indexOf = function (container, value, forceArray=false)\r\n{\r\n\tif (forceArray)\r\n\t{\r\n\t\tfor (let i = 0; i < container.length; i++)\r\n\t\t{\r\n\t\t\tif (container[i] === value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfor (let i in container)\r\n\t{\r\n\t\tif (container[i] === value)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\n\r\n/*\r\n**\tEscapes a string using HTML entities.\r\n**\r\n**\t>> string escape (string str);\r\n*/\r\nRinn.escape = function (str)\r\n{\r\n\treturn (str+\"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, if not it will create a new instance of `m` passing `o` as parameter.\r\n**\r\n**\t>> object ensureTypeOf (class m, object o);\r\n*/\r\nRinn.ensureTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn o;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn o;\r\n\t}\r\n\r\n\treturn new m (o);\r\n};\r\n\r\n\r\n/*\r\n**\tSerializes an object and returns its JSON string representation.\r\n**\r\n**\t>> string serialize (object o);\r\n*/\r\nRinn.serialize = function (o)\r\n{\r\n\treturn JSON.stringify(o);\r\n};\r\n\r\n\r\n/*\r\n**\tDeserializes a string in JSON format and returns the result.\r\n**\r\n**\t>> any deserialize (string s);\r\n*/\r\nRinn.deserialize = function (s)\r\n{\r\n\treturn JSON.parse(s);\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookAppend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (oldFunction.apply (this, args) !== false)\r\n\t\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\toldFunction.apply (this, args);\r\n\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookPrepend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (newFunction.apply (this, args) !== false)\r\n\t\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tnewFunction.apply (this, args);\r\n\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n","/*\n**\trinn/model-regex.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCommon regular expressions for pattern validation.\n*/\n\nexport default\n{\n\temail: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i,\n\turl: /^[\\w-]+:\\/\\/[\\w-]+(\\.\\w+)+.*$/,\n\turlNoProt: /^[\\w-]+(\\.\\w+)+.*$/,\n\tname: /^[-A-Za-z0-9_.]+$/,\n\tuname: /^['\\pL\\pN ]+$/,\n\ttext: /^[^&<>{}]*$/,\n\tutext: /^([\\r\\n\\pL\\pN\\pS &!@#$%*\\[\\]()_+=;',.\\/?:\"~-]+)$/\n};\n","/*\r\n**\trinn/class.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n * \tBase class used to create other classes with complex prototype based multiple inheritance while at the\r\n * \tsame time avoiding the prototype chain for faster access. Supports calling parent class methods.\r\n */\r\n\r\n//!class Class\r\nconst Class = function ()\r\n{\r\n};\r\n\r\n/**\r\n * \tReference to the class itself.\r\n */\r\nClass._class = Class;\r\n\r\n/**\r\n * \tContains the methods of each of the super classes.\r\n */\r\nClass._super = { };\r\n\r\n/**\r\n * \tName of the class, if none specified the class will be considered \"final\" and will not be inheritable.\r\n * \t@public @type {string}\r\n * \t!string className;\r\n */\r\nClass.prototype.className = 'Class';\r\n\r\n/**\r\n * \tClass constructor, should initialize the instance. Invoked when the `new` keyword is used with the class.\r\n * \t!__ctor() : Class;\r\n */\r\nClass.prototype.__ctor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * \tClass destructor, should clear the instance and release any used resources, invoked when the global `dispose` function\r\n * \tis called with an instance as parameter.\r\n * \t!__dtor() : void;\r\n */\r\nClass.prototype.__dtor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * \tReturns true if the object is an instance of the specified class, the parameter can be a class name (string), a constructor (function) or\r\n * \ta class instance (object), in any cases the appropriate checks will be done.\r\n *\r\n * \t@param {string|function|object} className\r\n * \t@returns {boolean}\r\n *\r\n * \t!isInstanceOf (className: string|function|object) : boolean;\r\n */\r\nClass.prototype.isInstanceOf = function (className)\r\n{\r\n\tif (className === null)\r\n\t\treturn false;\r\n\r\n\tif (typeof(className) === 'function')\r\n\t{\r\n\t\tclassName = className.prototype.className;\r\n\t}\r\n\telse if (typeof(className) !== 'string')\r\n\t{\r\n\t\tclassName = className.__proto__.className;\r\n\t}\r\n\r\n\treturn this.className === className ? true : this._super.hasOwnProperty(className);\r\n};\r\n\r\n/**\r\n * \tReturns true if the given object is an instance of the specified class, the parameter can be a class name (string), a constructor (function)\r\n * \tor a class instance (object), in any cases the appropriate checks will be done.\r\n *\r\n * \t@param {Object} object\r\n * \t@param {string|function|object} className\r\n *\r\n *\t!instanceOf (object: object, className: string|function|object) : boolean;\r\n */\r\nClass.instanceOf = function (object, className)\r\n{\r\n\tif (object === null || className === null)\r\n\t\treturn false;\r\n\r\n\treturn object.isInstanceOf(className);\r\n};\r\n\r\n/**\r\n * \tInternal method to ensure the _super field of an instance has all functions properly bound to the instance.\r\n */\r\nClass.prototype._initSuperRefs = function ()\r\n{\r\n\tlet _super = this.constructor._super;\r\n\tlet _newSuper = { };\r\n\r\n\tconst self = this;\r\n\r\n\tfor (let i in _super)\r\n\t{\r\n\t\tlet o = { };\r\n\r\n\t\tlet _prot = _super[i].prototype;\r\n\t\tfor (let j in _prot)\r\n\t\t{\r\n\t\t\tif (Rinn.typeOf(_prot[j]) !== 'function')\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\to[j] = (function(fn)\r\n\t\t\t{\r\n\t\t\t\treturn function (a00, a01, a02, a03, a04, a05, a06, a07, a08, a09, a0A) {\r\n\t\t\t\t\treturn fn.call(self, a00, a01, a02, a03, a04, a05, a06, a07, a08, a09, a0A);\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t(_prot[j]);\r\n\t\t}\r\n\r\n\t\t_newSuper[i] = o;\r\n\t}\r\n\r\n\tthis._super = _newSuper;\r\n};\r\n\r\n\r\n/*\r\n**\tExtends the class with the specified prototype. The prototype can be a function (class constructor) or an object. Note that the\r\n**\tclass will be modified (and returned) instead of creating a new class. Must be called at the class-level (**not** instance level).\r\n**\tWhen a class is provided all fields starting with uppercase at the class-level will not be inherited, this is used to create constants\r\n**\ton classes without having them to be copied to derived classes.\r\n**\r\n**\t>> class inherit (constructor classConstructor);\r\n**\t>> class inherit (object obj);\r\n*/\r\nClass.inherit = function (proto)\r\n{\r\n\tlet self = this._class;\r\n\r\n\tlet _super = self._super;\r\n\tlet _class = self._class;\r\n\r\n\tif (Rinn.typeOf(proto) === 'function')\r\n\t{\r\n\t\t// Move constants (uppercased properties) to the class-level instead of prototype-level.\r\n\t\tfor (let i in proto._class)\r\n\t\t\tif (!/^[A-Z]/.test(i)) self[i] = proto._class[i];\r\n\r\n\t\t// Combine methods and properties.\r\n\t\tRinn.override (self.prototype, proto._class.prototype);\r\n\r\n\t\t// Combine super references.\r\n\t\tRinn.override (_super, proto._class._super);\r\n\r\n\t\t// Add new super reference if className specified in inherited prototypes.\r\n\t\tif (proto._class.prototype.className)\r\n\t\t\t_super[proto._class.prototype.className] = proto._class;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRinn.override (self.prototype, proto);\r\n\t}\r\n\r\n\tself._super = _super;\r\n\tself._class = _class;\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\n/*\r\n**\tInternal method used to extend a class with one or more prototypes.\r\n**\r\n**\t>> class _extend (object base, object[] protos);\r\n*/\r\nClass.prototype._extend = function (base, protos)\r\n{\r\n\tif (protos.length === 0)\r\n\t\treturn base;\r\n\r\n\t//VIOLET OPTIMIZE\r\n\tconst _class = function (...args)\r\n\t{\r\n\t\tthis._initSuperRefs();\r\n\t\tthis.__ctor.apply(this, args);\r\n\t};\r\n\r\n\t_class._class = _class;\r\n\t_class._super = { };\r\n\r\n\tClass.inherit.call (_class, base);\r\n\tdelete _class.prototype.className;\r\n\r\n\tfor (let i = 0; i < protos.length; i++)\r\n\t\t_class.inherit (protos[i]);\r\n\r\n\tdelete _class._super.Class;\r\n\r\n\tif ('classInit' in _class.prototype)\r\n\t\t_class.prototype.classInit();\r\n\r\n\t_class.isInstance = function(value) {\r\n\t\treturn Rinn.isInstanceOf(value, _class);\r\n\t};\r\n\r\n\treturn _class;\r\n};\r\n\r\n\r\n/**\r\n * \tCreates a new class with the specified prototypes each of which can be a class constructor (function) or an object.\r\n */\r\nClass.extend = function (...protos)\r\n{\r\n\treturn this._class.prototype._extend (this, protos);\r\n};\r\n\r\n\r\n/*\r\n**\tCreates a new instance of a class resulting from extending the self class with the specified prototype.\r\n**\r\n**\t>> object create (object proto);\r\n*/\r\nClass.create = function (proto)\r\n{\r\n\treturn new (this.extend(proto)) ();\r\n};\r\n\r\nexport default Class;\r\n","/*\r\n**\trinn/event.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Rinn from './alpha.js';\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tHolds the information about a triggered event. It also provides a mechanism to allow asynchronous\r\n**\tevent propagation to ensure the event chain order.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Event\",\r\n\r\n\t/**\r\n\t**\tSource of the event.\r\n\t*/\r\n\tsource: null,\r\n\r\n\t/**\r\n\t**\tName of the event.\r\n\t*/\r\n\tname: null,\r\n\r\n\t/**\r\n\t**\tArguments of the event.\r\n\t*/\r\n\targs: null,\r\n\r\n\t/**\r\n\t**\tIndicates if the last event handler wants to use async mode.\r\n\t*/\r\n\t_async: false,\r\n\r\n\t/**\r\n\t**\tQueue of all handlers to invoke.\r\n\t*/\r\n\tlist: null,\r\n\r\n\t/**\r\n\t**\tNext event to be executed in the event chain.\r\n\t*/\r\n\tnext: null,\r\n\r\n\t/**\r\n\t**\tReturn values from event handlers.\r\n\t*/\r\n\tret: null,\r\n\r\n\t/**\r\n\t**\tOriginal root event.\r\n\t*/\r\n\toriginal: null,\r\n\r\n\t/**\r\n\t**\tIndex of the current event handler.\r\n\t*/\r\n\ti: -1,\r\n\r\n\t/**\r\n\t**\tContructs an event object with the specified parameters. Source is the event-dispatcher object, list is\r\n\t**\tan array with all the listeners to invoke. The eventName and eventArgs are the event information to be\r\n\t**\tpassed to each handler and if a callback is specified (cbHandler+cbContext) it will be executed once all\r\n\t**\tthe event handlers have been processed.\r\n\t**\r\n\t**\tEvent __ctor (source: EventDispatcher, list: Array, eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t*/\r\n\t__ctor: function (source, list, eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tthis.source = source;\r\n\r\n\t\tthis.name = eventName;\r\n\t\tthis.args = eventArgs;\r\n\r\n\t\tthis.cbHandler = cbHandler;\r\n\t\tthis.cbContext = cbContext;\r\n\r\n\t\tthis.list = list;\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/**\r\n\t**\tResets the event to its initial state. An event object can be reused by resetting it and then\r\n\t**\tinvoking the resume event.\r\n\t**\r\n\t**\tEvent reset ();\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.ret = [];\r\n\r\n\t\tthis._async = false;\r\n\t\tthis.i = -1;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tChanges the source of the event.\r\n\t**\r\n\t**\tEvent setSource (object value);\r\n\t*/\r\n\tsetSource: function (value)\r\n\t{\r\n\t\tthis.source = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the internal asynchronous flag. Should be called before a handler returns. If a handler\r\n\t**\tcalls this method it should also call resume() when async operations are finished.\r\n\t**\r\n\t**\tEvent wait ();\r\n\t*/\r\n\twait: function ()\r\n\t{\r\n\t\tthis._async = true;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tResumes event propagation. Should be called manually by event handlers that also call wait().\r\n\t**\r\n\t**\tEvent resume ();\r\n\t*/\r\n\tresume: function ()\r\n\t{\r\n\t\tthis._async = false;\r\n\r\n\t\twhile (!this._async)\r\n\t\t{\r\n\t\t\tif (++this.i >= this.list.length)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tif (this.list[this.i].silent)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.typeOf(this.list[this.i].handler) == \"string\")\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].context)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!this.list[this.i].context[this.list[this.i].handler])\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (this.list[this.i].context[this.list[this.i].handler] (this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (global[this.list[this.i].handler].call (null, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].handler.call (this.list[this.i].context, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._async)\r\n\t\t\treturn this;\r\n\r\n\t\tif (this.i >= this.list.length && this.next) this.next.resume();\r\n\r\n\t\tif (this.cbHandler)\r\n\t\t\tthis.cbHandler.call (this.cbContext);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the \"original\" property of the event to indicate where the original event comes from.\r\n\t**\r\n\t**\tEvent from (event: Event);\r\n\t*/\r\n\tfrom: function (event)\r\n\t{\r\n\t\tthis.original = event;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tEnqueues the specified event to be executed upon the current event process is finished. The \"original\"\r\n\t**\tproperty of the chained event will be set to the current event.\r\n\t**\r\n\t**\tEvent enqueueEvent (event: Event);\r\n\t*/\r\n\tenqueue: function (event)\r\n\t{\r\n\t\tif (!event) return this;\r\n\r\n\t\tvar evt;\r\n\t\tfor (evt = this; evt.next != null; evt = evt.next);\r\n\r\n\t\tevt.next = event;\r\n\t\tevent.from (this);\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n","/*\r\n**\trinn/event-dispatcher.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Class from './class.js';\r\nimport Event from './event.js';\r\n\r\n/**\r\n**\tEvent dispatcher allows several event listeners to be attached, these will be invoked whenever the\r\n**\tevent that is being listened to is triggered.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"EventDispatcher\",\r\n\r\n\t/**\r\n\t**\tListeners attached to this event dispatcher. Grouped by event name.\r\n\t*/\r\n\tlisteners: null,\r\n\r\n\t/**\r\n\t**\tNamespace for event dispatching. Defaults to null. Can be modified using setNamespace().\r\n\t*/\r\n\tnamespace: null,\r\n\r\n\t/**\r\n\t**\tInitializes the event dispatcher.\r\n\t**\r\n\t**\tEventDispatcher __ctor ();\r\n\t*/\r\n\t__ctor: function ()\r\n\t{\r\n\t\tthis.listeners = { };\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the event dispatching namespace. Used to force all events dispatched to have the specified namespace.\r\n\t**\r\n\t**\tEventDispatcher setNamespace (value: string);\r\n\t*/\r\n\tsetNamespace: function (value)\r\n\t{\r\n\t\tthis.namespace = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds an event listener for a specified event to the event dispatcher. The event name can have an optional\r\n\t**\tnamespace indicator which is added to the beginning of the event name and separated using a colon (:). This\r\n\t**\tindicator can be used to later trigger or remove all handlers of an specific namespace.\r\n\t**\r\n\t**\tEventDispatcher addEventListener (eventName: string, handler: function, context: object, data: object);\r\n\t*/\r\n\taddEventListener: function (eventName, handler, context, data)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (!this.listeners[name])\r\n\t\t\tthis.listeners[name] = [];\r\n\r\n\t\tthis.listeners[name].push ({ ns: ns, handler: handler, context: context, data: data, silent: 0 });\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves an event listener from the event dispatcher. If only the name is provided all handlers with the\r\n\t**\tspecified name will be removed. If a context is provided without a handler then any handler matching the\r\n\t**\tcontext will be removed. Special event name \"*\" can be used to match all event names.\r\n\t**\r\n\t**\tEventDispatcher removeEventListener (eventName: string, handler: function, context: object);\r\n\t*/\r\n\tremoveEventListener: function (eventName, handler, context)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = true;\r\n\r\n\t\t\t\t\tif (handler)\r\n\t\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\t\tif (context)\r\n\t\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\t\tif (ns)\r\n\t\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar k = true;\r\n\r\n\t\t\t\tif (handler)\r\n\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\tif (context)\r\n\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\tif (ns)\r\n\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tPrepares an event with the specified parameters for its later usage. The event is started when\r\n\t**\tthe resume() method is called. If a callback is specified it will be executed once all event\r\n\t**\thandlers have been processed.\r\n\t**\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tprepareEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tvar list = [];\r\n\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (this.listeners[name])\r\n\t\t\tlist = list.concat (this.listeners[name]);\r\n\r\n\t\tif (this.listeners[\"*\"])\r\n\t\t\tlist = list.concat (this.listeners[\"*\"]);\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tif (list[i].silent) list.splice (i--, 1);\r\n\r\n\t\tif (ns)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\tif (list[i].ns != ns) list.splice (i--, 1);\r\n\t\t}\r\n\r\n\t\treturn new Event (this, list, name, eventArgs, cbHandler, cbContext);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSilences or unsilences all handlers attached to an event such that if the event fires the handler(s) will\r\n\t**\tnot be invoked. It is recommended to use a namespace to ensure other handlers will continue to be run.\r\n\t**\r\n\t**\tEventDispatcher silence (eventName: string);\r\n\t*/\r\n\tsilence: function (eventName, value)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tvalue = value === false ? -1 : 1;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tlist[i].silent += value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlist[i].silent += value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches an event to the respective listeners. If a callback is specified it will be executed once\r\n\t**\tall event handlers have been processed.\r\n\t**\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tdispatchEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\treturn this.prepareEvent(this.namespace ? this.namespace+':'+eventName : eventName, eventArgs, cbHandler, cbContext).resume();\r\n\t}\r\n});\r\n","/*\n**\trinn/model.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\nimport EventDispatcher from './event-dispatcher.js';\n\n/**\n**\tA model is a high-integrity data object used to store properties and more importantly to provide event support to notify of any\n**\tkind of change that occurs to the model's properties. Integrity of the model is maintained by optionally using property constraints.\n*/\n\nlet _Model = EventDispatcher.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"Model\",\n\n\t/**\n\t**\tDefault properties for the model. Can be a map with the property name and its default value or a function\n\t**\treturning a map with dynamic default values. This is used to reset the model to its initial state.\n\t*/\n\tdefaults: null,\n\n\t/**\n\t**\tModel property contraints. A map with the property name and an object specifying the constraints of the\n\t**\tproperty. This is used to determine the type, format and behavior of each property in the model.\n\t*/\n\tconstraints: null,\n\n\t/**\n\t**\tProperties of the model.\n\t*/\n\tdata: null,\n\n\t/**\n\t**\tArray with the name of the properties that have changed. Populated prior modelChanged event.\n\t*/\n\tchangedList: null,\n\n\t/**\n\t**\tSilent mode indicator. While in silent mode events will not be dispatched.\n\t*/\n\t_silent: 0,\n\n\t/**\n\t**\tCurrent nesting level of the set() method. This is used to determine when all the property\n\t**\tchanges are done.\n\t*/\n\t_level: 0,\n\n\t/**\n\t**\tInitializes the model and sets the properties to the specified data object.\n\t**\n\t**\t>> Model __ctor (object data);\n\t**\t>> Model __ctor (object data, object defaults);\n\t*/\n\t__ctor: function (data, defaults)\n\t{\n\t\tthis._super.EventDispatcher.__ctor();\n\n\t\tthis.data = { };\n\n\t\tif (defaults != null)\n\t\t{\n\t\t\tthis.reset (defaults, false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet o = null;\n\n\t\t\tif (!this.defaults && this.constraints)\n\t\t\t{\n\t\t\t\to = { };\n\n\t\t\t\tfor (let i in this.constraints)\n\t\t\t\t{\n\t\t\t\t\tlet j = this.constraints[i];\n\t\t\t\t\tif (j.def === null || j.def === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\to[i] = null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof(j.def) === 'function')\n\t\t\t\t\t\to[i] = j.def();\n\t\t\t\t\telse\n\t\t\t\t\t\to[i] = j.def;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.reset(o);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (data != null)\n\t\t\tthis.set (data, true);\n\n\t\tif (this.constraints) this.update();\n\n\t\tthis.ready();\n\t},\n\n\t/**\n\t**\tResets the model to its default state and triggers update events. If a map is provided the defaults of\n\t**\tthe model will be set to the specified map.\n\t**\n\t**\t>> Model reset (object defaults, [bool nsilent=true]);\n\t**\t>> Model reset ([bool nsilent=true]);\n\t*/\n\treset: function (defaults, nsilent)\n\t{\n\t\tif (!this.defaults)\n\t\t{\n\t\t\tif (!defaults || (Rinn.typeOf(defaults) !== 'object' && Rinn.typeOf(defaults) !== 'function'))\n\t\t\t\treturn this;\n\n\t\t\tthis.defaults = defaults;\n\t\t}\n\n\t\tif (Rinn.typeOf(this.defaults) === 'function')\n\t\t\tthis.data = this.defaults();\n\t\telse\n\t\t\tthis.data = Rinn.clone(this.defaults);\n\n\t\treturn (nsilent === false || defaults === false) ? this : this.update(null, true);\n\t},\n\n\t/**\n\t**\tInitializes the model. Called before the model properties are set.\n\t**\n\t**\t>> void init ();\n\t*/\n\tinit: function ()\n\t{\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t},\n\n\t/**\n\t**\tEnables or disables silent mode. When the model is in silent mode events will not be dispatched.\n\t**\n\t**\t>> Model silent (value: bool);\n\t*/\n\tsilent: function (value)\n\t{\n\t\tthis._silent += value ? 1 : -1;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates a property name and value against the constraints defined in the model (if any). Returns the\n\t**\tfinal value if successful or throws an empty exception if errors occur.\n\t**\n\t**\t>> T _validate (string name, T value);\n\t*/\n\t_validate: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t\treturn value;\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tthrow new Error (`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`);\n\t\t\t}\n\t\t}\n\n\t\treturn nvalue;\n\t},\n\n\t/**\n\t**\tSets the value of a property and returns the value set. This method is internally used to set properties\n\t**\tone at a time. If constraints are present in the model for the specified property all constraints will be\n\t**\tverified. When constraint errors occur the constraintError event will be raised and the property value\n\t**\twill not be changed.\n\t**\n\t**\t>> T _set (string name, T value);\n\t*/\n\t_set: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t{\n\t\t\tthis.data[name] = value;\n\t\t\treturn value;\n\t\t}\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar cvalue = this.data[name];\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (!this._silent)\n\t\t\t\t\tthis.dispatchEvent (\"constraintError\", { constraint: ctname, message: e.message, name: name, value: value });\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (this.data[name] = nvalue);\n\t},\n\n\t/**\n\t**\tTriggers property events to indicate a property is changing. First triggers \"propertyChanging\" and then\n\t**\t\"propertyChanged\". If the first event returns false the second event will not be triggered.\n\t**\n\t**\t>> void _propertyEvent (string name, T prev, T value, bool direct=false);\n\t*/\n\t_propertyEvent: function (name, prev, value, direct)\n\t{\n\t\tvar temp = { name: name, old: prev, value: value, level: this._level };\n\n\t\tvar evt = this.dispatchEvent (\"propertyChanging\", temp);\n\n\t\tif (!direct)\n\t\t\ttemp.value = this._set (name, temp.value);\n\t\telse\n\t\t\tthis.data[name] = temp.value;\n\n\t\tif (evt != null && evt.ret.length && evt.ret[0] === false)\n\t\t\treturn;\n\n\t\tthis.dispatchEvent (\"propertyChanged.\" + name, temp);\n\t\tthis.dispatchEvent (\"propertyChanged\", temp);\n\n\t\tthis.changedList.push (name);\n\t},\n\n\t/**\n\t**\tSets one or more properties of the model. Possible arguments can be two strings or a map.\n\t**\n\t**\t>> Model set (string name, T value, bool force=true);\n\t**\t>> Model set (string name, T value, bool silent=false);\n\t**\t>> Model set (string name, T value);\n\t**\t>> Model set (object data);\n\t*/\n\tset: function ()\n\t{\n\t\tvar n = arguments.length;\n\t\tvar force = false, silent = false;\n\n\t\tif ((n > 2 || (n == 2 && Rinn.typeOf(arguments[0]) == \"object\")) && Rinn.typeOf(arguments[n-1]) == \"boolean\")\n\t\t{\n\t\t\tforce = arguments[--n];\n\t\t\tif (force === false) silent = true;\n\t\t}\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (n == 2)\n\t\t{\n\t\t\tif (this.data[arguments[0]] != arguments[1] || force)\n\t\t\t{\n\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\tthis._propertyEvent (arguments[0], this.data[arguments[0]], this._validate (arguments[0], arguments[1]));\n\t\t\t\telse\n\t\t\t\t\tthis._set (arguments[0], arguments[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in arguments[0])\n\t\t\t{\n\t\t\t\tif (this.data[i] != arguments[0][i] || force)\n\t\t\t\t{\n\t\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\t\tthis._propertyEvent (i, this.data[i], this._validate (i, arguments[0][i]));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._set (i, arguments[0][i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!--this._level && this.changedList.length && !silent && !this._silent)\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns true if the given key exists in the model.\n\t**\n\t**\t>> boolean has (string name);\n\t*/\n\thas: function (name)\n\t{\n\t\treturn name in this.data;\n\t},\n\n\t/**\n\t**\tReturns the value of a property. If no name is specified the whole map of properties will be returned.\n\t**\tIf a boolean value of \"true\" is provided the properties map will be returned but first will be compacted\n\t**\tusing the default data to ensure only valid properties are present.\n\t**\n\t**\t>> T get (string name);\n\t**\t>> object get ();\n\t**\t>> object get (true);\n\t**\t>> object get (false);\n\t**\t\n\t*/\n\tget: function (name, def)\n\t{\n\t\tif (arguments.length == 0 || name === false)\n\t\t\treturn this.data;\n\n\t\tif (arguments.length == 1 && name === true)\n\t\t\treturn this.flatten ();\n\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : this.data[name];\n\n\t\treturn this.data[name];\n\t},\n\n\t/**\n\t**\tReturns the value of a property as an integer number.\n\t**\n\t**\t>> int getInt (string name, [int def]);\n\t*/\n\tgetInt: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseInt (this.data[name]);\n\n\t\treturn parseInt (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a floating point number.\n\t**\n\t**\t>> float getFloat (string name, [float def]);\n\t*/\n\tgetFloat: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseFloat (this.data[name]);\n\n\t\treturn parseFloat (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a boolean value (true or false).\n\t**\n\t**\t>> bool getBool (string name, [bool def]);\n\t**\t\n\t*/\n\tgetBool: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tname = this.data[name] === undefined ? def : this.data[name];\n\t\telse\n\t\t\tname = this.data[name];\n\n\t\tif (name === \"true\" || name === true)\n\t\t\treturn true;\n\n\t\tif (name === \"false\" || name === false)\n\t\t\treturn false;\n\n\t\treturn parseInt (name) ? true : false;\n\t},\n\n\t/**\n\t**\tReturns a reference object for a model property. The resulting object contains two methods\n\t**\tnamed \"get\" and \"set\" to modify the value of the property.\n\t**\n\t**\t>> object getReference (string name);\n\t*/\n\tgetReference: function (name)\n\t{\t\n\t\tvar m = this;\n\n\t\treturn {\n\t\t\tget: function() {\n\t\t\t\treturn m.get(name);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tm.set(name, value);\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t**\tSets or returns a constraint given the property name. \n\t**\n\t**\t>> Model constraint (string field, string constraint, T value);\n\t**\t>> Model constraint (string field, object constraint);\n\t**\t>> Model constraint (object constraints);\n\t**\t>> object constraint (string field);\n\t*/\n\tconstraint: function (field, constraint, value)\n\t{\n\t\tif (arguments.length == 3 || arguments.length == 2 || (arguments.length == 1 && Rinn.typeOf(field) == \"object\"))\n\t\t{\n\t\t\tif (this.constraints === this.constructor.prototype.constraints)\n\t\t\t\tthis.constraints = Rinn.clone (this.constraints);\n\n\t\t\tswitch (arguments.length)\n\t\t\t{\n\t\t\t\tcase 1:\n\t\t\t\t\tRinn.override (this.constraints, field);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tRinn.override (this.constraints[field], constraint);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.constraints[field][constraint] = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn !field ? this : this.constraints[field];\n\t},\n\n\t/**\n\t**\tReturns a compact version of the model properties. That is, a map only with validated properties that are\n\t**\talso present in the default data map. Returns null if the object is not compliant. If the \"safe\" parameter\n\t**\tis set one last property named \"class\" will be attached, this specifies the original classPath of the object.\n\t**\n\t**\t>> object flatten ([bool safe=false]);\n\t*/\n\tflatten: function (safe, rsafe)\n\t{\n\t\tif (safe)\n\t\t{\n\t\t\tvar data = this.flatten(false, true);\n\t\t\tif (data == null) return null;\n\n\t\t\tdata[\"class\"] = this.classPath;\n\t\t\treturn data;\n\t\t}\n\n\t\tif (!this.constraints && !this.defaults)\n\t\t\treturn this.data;\n\n\t\tif (!this.isCompliant())\n\t\t\treturn { };\n\n\t\tvar constraints = this.constraints;\n\t\tvar keys = this.defaults ? (Rinn.typeOf(this.defaults) == \"function\" ? this.defaults() : this.defaults) : this.constraints;\n\n\t\tvar data = { };\n\n\t\tfor (var i in this.data)\n\t\t{\n\t\t\tif (!(i in keys)) continue;\n\n\t\t\tif (constraints && constraints[i])\n\t\t\t{\n\t\t\t\tvar ct = constraints[i];\n\n\t\t\t\tif (ct.model)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten(rsafe) : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.arrayof)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = [];\n\n\t\t\t\t\tfor (var j = 0; j < this.data[i].length; j++)\n\t\t\t\t\t\tdata[i][j] = this.data[i][j] ? this.data[i][j].flatten(rsafe) : null;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.cls)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten() : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata[i] = this.data[i];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t/**\n\t**\tRemoves a property or a list of properties.\n\t**\n\t**\t>> void remove (string name, [bool nsilent=true]);\n\t**\t>> void remove (array name, [bool nsilent=true]);\n\t*/\n\tremove: function (name, nsilent)\n\t{\n\t\tif (Rinn.typeOf(name) == \"array\")\n\t\t{\n\t\t\tfor (var i = 0; i < name.length; i++)\n\t\t\t\tdelete this.data[name[i]];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: name });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete this.data[name];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: [name] });\n\t\t}\n\t},\n\n\t/**\n\t**\tTriggers data change events for one or more properties. Ensure that silent mode is not enabled or else\n\t**\tthis method will have no effect. If no parameters are provided a full update will be triggered on all of\n\t**\tthe model properties.\n\t**\n\t**\t>> Model update (array fields);\n\t**\t>> Model update (string name);\n\t**\t>> Model update (bool forceModelChanged);\n\t**\t>> Model update ();\n\t*/\n\tupdate: function (fields, direct)\n\t{\n\t\tif (this._silent) return this;\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (fields && Rinn.typeOf(fields) == 'string')\n\t\t{\n\t\t\tthis._propertyEvent (fields, this.data[fields], this.data[fields], direct);\n\t\t}\n\t\telse if (fields && Rinn.typeOf(fields) == 'array')\n\t\t{\n\t\t\tfor (var i of fields)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\n\t\tif (!--this._level && !this._silent && (this.changedList.length != 0 || fields === true))\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates one or mode model properties using the defined constraints. If no parameters are provided all of\n\t**\tthe properties in the model will be validated.\n\t**\n\t**\t>> Model validate (array fields);\n\t**\t>> Model validate (string name);\n\t**\t>> Model validate ();\n\t*/\n\tvalidate: function (fields)\n\t{\n\t\tif (!this.constraints) return this;\n\n\t\tif (fields && Rinn.typeOf(fields) == \"string\")\n\t\t{\n\t\t\tthis._set (fields, this.data[fields])\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t{\n\t\t\t\tif (fields && Rinn.indexOf(fields, i) == -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._set (i, this.data[i])\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates all the properties in the model and returns a boolean indicating if all of them comply with the\n\t**\tconstraints defined in the model.\n\t**\n\t**\t>> bool isCompliant ();\n\t*/\n\tisCompliant: function ()\n\t{\n\t\tif (!this.constraints) return true;\n\n\t\ttry\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._validate (i, this.data[i]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRegisters an event handler for changes in a specific property of the model.\n\t**\n\t**\t>> void observe (string property, function handler, object context);\n\t*/\n\tobserve: function (property, handler, context)\n\t{\n\t\tthis.addEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tUnregisters an event handler from changes in a specific property of the model.\n\t**\n\t**\t>> void unobserve (string property, function handler, object context);\n\t*/\n\tunobserve: function (property, handler, context)\n\t{\n\t\tthis.removeEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tAdds a propertyChanged event handler for the given property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void watch (string property, function handler);\n\t*/\n\twatch: function (property, handler)\n\t{\n\t\tproperty = property.split(':');\n\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.addEventListener (property[0]+\":propertyChanged.\"+property[1], function (evt, args) {\n\t\t\thandler (args.value, args, evt);\n\t\t});\n\t},\n\n\t/**\n\t**\tRemoves propertyChanged handlers related to the specified property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void unwatch (string property);\n\t*/\n\tunwatch: function (property)\n\t{\n\t\tproperty = property.split(':');\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.removeEventListener (property[0]+\":propertyChanged.\"+property[1]);\n\t},\n\n\t/**\n\t**\tSerializes the model into a string.\n\t**\n\t**\tstring toString ();\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn Rinn.serialize(this.get (true));\n\t}\n});\n\n\n/**\n**\tImport model constraints.\n*/\n\nimport Constraints from './model-constraints.js';\n_Model.Constraints = Constraints;\n\nexport default _Model;\n","/*\n**\trinn/model-list.js\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\nimport Model from './model.js';\n\n/**\n**\tGeneric list for models.\n*/\n\nexport default Model.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"ModelList\",\n\n\t/**\n\t**\tClass of the items in the list, can be overriden by child classes to impose a more strict constraint.\n\t*/\n\titemt: Model,\n\n\t/**\n\t**\tMirror of data.contents\n\t*/\n\tcontents: null,\n\n\t/**\n\t**\tIDs of every item in the contents.\n\t*/\n\titemId: null,\n\n\t/**\n\t**\tAutoincremental ID for the next item to be added.\n\t*/\n\tnextId: null,\n\n\t/**\n\t**\tDefault properties of the model.\n\t*/\n\tdefaults:\n\t{\n\t\tcontents: null\n\t},\n\n\t/**\n\t**\tConstraints of the model to ensure integrity.\n\t*/\n\tconstraints:\n\t{\n\t\tcontents: {\n\t\t\ttype: \"array\",\n\t\t\tarrayof: \"@itemt\"\n\t\t}\n\t},\n\n\t/**\n\t**\tConstructor.\n\t*/\n\t__ctor: function (...args)\n\t{\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis._super.Model.__ctor(...args);\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t*/\n\tready: function ()\n\t{\n\t\tthis._eventGroup = \"ModelList_\" + Date.now() + \":modelChanged\";\n\n\t\tthis.contents = this.data.contents;\n\t},\n\n\t/**\n\t**\tConnects the event handlers to the item.\n\t**\n\t**\t>> Model _bind (int iid, Model item);\n\t*/\n\t_bind: function (iid, item)\n\t{\n\t\tif (item && item.addEventListener) item.addEventListener (this._eventGroup, this._onItemEvent, this, iid);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tDisconnects the event handlers from the item.\n\t**\n\t**\t>> Model _unbind (Model item);\n\t*/\n\t_unbind: function (item)\n\t{\n\t\tif (item && item.removeEventListener) item.removeEventListener (this._eventGroup);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tHandler for item events.\n\t**\n\t**\t>> Model _onItemEvent (Event evt, object args, int iid);\n\t*/\n\t_onItemEvent: function (evt, args, iid)\n\t{\n\t\tthis.prepareEvent (\"itemChanged\", { id: iid, item: evt.source }).from (evt)\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the number of items in the list.\n\t**\n\t**\t>> int length ();\n\t*/\n\tlength: function ()\n\t{\n\t\treturn this.data.contents.length;\n\t},\n\n\t/**\n\t**\tClears the contents of the list.\n\t**\n\t**\t>> void clear ();\n\t*/\n\tclear: function ()\n\t{\n\t\tfor (var i = 0; i < this.data.contents; i++)\n\t\t\tthis._unbind (this.data.contents[i]);\n\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis.contents = this.data.contents = [];\n\n\t\tthis.prepareEvent (\"itemsCleared\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the contents of the list with the specified array. All items will be ensured to be of the same model\n\t**\ttype as the one specified in the list.\n\t**\n\t**\t>> ModelList setData (array data);\n\t*/\n\tsetData: function (data)\n\t{\n\t\tthis.clear();\n\t\tif (!data) return this;\n\n\t\tfor (var i = 0; i < data.length; i++)\n\t\t{\n\t\t\tvar item = Rinn.ensureTypeOf(this.itemt, data[i]);\n\n\t\t\tthis.itemId.push(this.nextId++);\n\t\t\tthis.data.contents.push(item);\n\n\t\t\tthis._bind(this.nextId-1, item);\n\t\t}\n\n\t\tthis.prepareEvent (\"itemsChanged\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the raw array contents of the list.\n\t**\n\t**\t>> array getData ();\n\t*/\n\tgetData: function ()\n\t{\n\t\treturn this.data.contents;\n\t},\n\n\t/**\n\t**\tReturns the item at the specified index or null if the index is out of bounds.\n\t**\n\t**\t>> Model getAt (int index);\n\t*/\n\tgetAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\treturn this.data.contents[index];\n\t},\n\n\t/**\n\t**\tRemoves and returns the item at the specified index. Returns null if the index is out of bounds.\n\t**\n\t**\t>> Model removeAt (int index);\n\t*/\n\tremoveAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\tlet item = this.data.contents.splice(index, 1)[0];\n\t\tlet id = this.itemId.splice(index, 1)[0];\n\n\t\tthis._unbind (item);\n\n\t\tthis.prepareEvent (\"itemRemoved\", { id: id, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tSets the item at the specified index. Returns false if the index is out of bounds, true otherwise. The\n\t**\titem will be ensured to be of the model defined in the list.\n\t**\n\t**\t>> bool setAt (int index, Model item);\n\t*/\n\tsetAt: function (index, item)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis._unbind(this.data.contents[index]);\n\t\tthis.data.contents[index] = item;\n\t\tthis._bind(this.itemId[index], item);\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tNotifies a change in the item at the specified index. Returns false if the index is out of bounds.\n\t**\n\t**\t>> bool updateAt (int index);\n\t*/\n\tupdateAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: this.data.contents[index] })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model push (Model item);\n\t*/\n\tpush: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.push(this.nextId++);\n\t\tthis.data.contents.push (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[this.itemId.length-1], item: item, position: 'tail' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the bottom of the list.\n\t**\n\t**\t>> Model pop ();\n\t*/\n\tpop: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.pop());\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model unshift (Model item);\n\t*/\n\tunshift: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.unshift(this.nextId++);\n\t\tthis.data.contents.unshift (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[0], item: item, position: 'head' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the top of the list.\n\t**\n\t**\t>> Model shift ();\n\t*/\n\tshift: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.shift());\n\t},\n\n\t/**\n\t**\tSearches for an item matching the specified partial definition and returns its index. Returns -1 if the\n\t**\titem was not found. If retObject is set to true the object will be returned instead of its index and null\n\t**\twill be returned when the item is not found.\n\t**\n\t**\tint|object find (object data, bool retObject=false);\n\t*/\n\tfind: function (data, retObject=false)\n\t{\n\t\tvar contents = this.data.contents;\n\n\t\tfor (var i = 0; i < contents.length; i++)\n\t\t{\n\t\t\tif (Rinn.partialCompare (contents[i].data, data))\n\t\t\t\treturn retObject ? contents[i] : i;\n\t\t}\n\n\t\treturn retObject ? null : -1;\n\t}\n});\n","/*\r\n**\trinn/schema\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n**\tThe utility functions in this module allow to create a very strict serialization/deserialization schema\r\n**\tto ensure that all values are of the specific type when stored in string format.\r\n*/\r\n\r\nlet Schema =\r\n{\r\n\tType: function (proto)\r\n    {\r\n\t\tlet tmp =\r\n\t\t{\r\n            flatten: function (value, context) {\r\n                return value;\r\n            },\r\n\r\n            unflatten: function (value, context) {\r\n                return value;\r\n            }\r\n        };\r\n\r\n        return proto ? Rinn.override(tmp, proto) : tmp;\r\n    },\r\n\r\n\tString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tInteger: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tNumber: function (precision)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_precision: precision,\r\n\t\t\t_round: false,\r\n\r\n\t\t\tprecision: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis._precision = ~~value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\t\tif (this._precision > 0)\r\n\t\t\t\t\tvalue = (~~(value*Math.pow(10, this._precision))) / Math.pow(10, this._precision);\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn parseFloat(value);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tBool: function (compact)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_compact: compact,\r\n\r\n\t\t\tcompact: function(value)\r\n\t\t\t{\r\n\t\t\t\tthis._compact = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\tvalue = ~~value;\r\n\t\t\t\treturn this._compact ? (value > 0 ? 1 : 0) : (value > 0 ? true : false);\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn (~~value) ? true : false;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tSharedString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return 0;\r\n\r\n\t\t\t\tvalue = value.toString();\r\n\r\n                if (!(\"strings\" in context))\r\n                {\r\n                    context.index = { };\r\n                    context.strings = [ ];\r\n                }\r\n\r\n                if (!(value in context.index))\r\n                {\r\n                    context.strings.push(value);\r\n                    context.index[value] = context.strings.length;\r\n                }\r\n\r\n                return context.index[value];\r\n            },\r\n\r\n\t\t\tunflatten: function (value, context)\r\n\t\t\t{\r\n                return value == null || value == 0 ? null : context.strings[~~value - 1];\r\n            }\r\n        });\r\n    },\r\n\r\n\tArray: function (type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\titemType: type,\r\n\t\t\t_debug: false,\r\n\t\t\t_filter: null,\r\n\r\n\t\t\tdebug: function(v) {\r\n\t\t\t\tthis._debug = v;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            of: function (type) {\r\n                this.itemType = type;\r\n                return this;\r\n            },\r\n\r\n\t\t\tfilter: function (callback) {\r\n\t\t\t\tthis._filter = callback;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n                for (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._filter && !this._filter(value[i], i))\r\n\t\t\t\t\t\tcontinue;\r\n\r\n                    o.push(this.itemType.flatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n\t\t\tunflatten: async function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(await this.itemType.unflatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n    },\r\n\r\n    Object: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            properties: [ ],\r\n\r\n            property: function (name, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].name in value)\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(value[this.properties[i].name], context);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = [ ];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].name in value)\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(value[this.properties[i].name], context));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(this.properties[i].defvalue, context));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n            \r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(this.properties[i].name in value ? value[this.properties[i].name] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(i in value ? value[i] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Class: function (classConstructor)\r\n    {\r\n\t\treturn Schema.Type\r\n\t\t({\r\n            _constructor: classConstructor,\r\n\r\n            constructor: function (classConstructor)\r\n            {\r\n                this._constructor = classConstructor;\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n                return value == null ? null : value.flatten(context);\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\treturn value == null ? null : await (new this._constructor()).unflatten(value, context);\r\n            }\r\n        });\r\n\t},\r\n\r\n\t/*\r\n\t**\tUsed when you want to specify just a single property.\r\n\t*/\r\n    Property: function(name, type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tproperty: name,\r\n\t\t\ttype: type,\r\n\r\n\t\t\tname: function (name)\r\n\t\t\t{\r\n\t\t\t\tthis.property = name;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tis: function (type)\r\n\t\t\t{\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\t\t\t\t\to[this.property] = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value[this.property], context);\r\n\t\t\t\telse\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value, context);\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Map: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = [ ];\r\n\r\n\t\t\t\tfor (let i in value)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(i);\r\n\t\t\t\t\to.push(value[i]);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i += 2)\r\n\t\t\t\t\to[value[i]] = value[i+1];\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Selector: function ()\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tconditions: [],\r\n\t\t\tvalue: null,\r\n\r\n\t\t\twhen: function (value, type)\r\n\t\t\t{\r\n\t\t\t\tthis.conditions.push([ (val) => val === value, type ]);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\twith: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis.value = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn i[1].flatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn await i[1].unflatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            }\r\n\r\n        });\r\n\t}\r\n};\r\n\r\nexport default Schema;\r\n","/*\r\n**\trinn/flattenable.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tClass used to add flattening and unflattening capabilities to any object. A \"flat\" object is an object composed\r\n**\tonly of native types, that is: `null,` `boolean`, `integer`, `number`, `array` or `object`.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Flattenable\",\r\n\r\n\t/**\r\n\t**\tType schema used to flatten/unflatten the contents of this class. See Schema class for more information.\r\n\t*/\r\n\ttypeSchema: null,\r\n\r\n\t/**\r\n\t**\tReturns the flattened contents of the object.\r\n\t*/\r\n\tflatten: function (context)\r\n\t{\r\n\t\treturn this.typeSchema.flatten(this, context);\r\n\t},\r\n\r\n\t/**\r\n\t**\tUnflattens the given object and overrides the local contents.\r\n\t*/\r\n\tunflatten: async function (value, context)\r\n\t{\r\n\t\tObject.assign(this, await this.typeSchema.unflatten(value, context));\r\n\t\tawait this.onUnflattened();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted when the unflatten() method is called on the object.\r\n\t*/\r\n\tonUnflattened: async function ()\r\n\t{\r\n\t}\r\n});\r\n","/*\r\n**\trinn/collection.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport Flattenable from './flattenable.js';\r\nimport Schema from './schema.js';\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n**\tFlattenable collection class, used to store items and manipulate them. The items should also be flattenable.\r\n*/\r\n\r\nexport default Flattenable.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Collection\",\r\n\r\n\t/**\r\n\t**\tDescribes the type schema of the underlying items.\r\n\t*/\r\n\titemTypeSchema: null,\r\n\r\n\t/**\r\n\t**\tArray of items.\r\n\t*/\r\n\titems: null, /* Array */\r\n\r\n\t/**\r\n\t**\tConstructs the collection.\r\n\t*/\r\n\t__ctor: function (itemTypeSchema)\r\n\t{\r\n\t\tif (!itemTypeSchema) itemTypeSchema = this.itemTypeSchema;\r\n\r\n\t\tif (itemTypeSchema)\r\n\t\t\tthis.typeSchema = Schema.Property('items').is(Schema.Array().of(itemTypeSchema));\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted after the collection has been unflattened, re-adds the items to ensure onItemAdded() is called.\r\n\t*/\r\n\tonUnflattened: function()\r\n\t{\r\n\t\tlet items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (let i of items)\r\n\t\t\tthis.add(i);\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted when the value in `items` is changed.\r\n\t */\r\n\titemsReferenceChanged: function()\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tResets the collection to empty. Note that onItemRemoved will not be called.\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.items = [];\r\n\t\tthis.itemsReferenceChanged();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tClears the contents of the collection (removes each item manually, onItemRemoved will be called).\r\n\t*/\r\n\tclear: function ()\r\n\t{\r\n\t\tvar items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (var i = 0; i < items.length; i++)\r\n\t\t\tthis.onItemRemoved (items[i], 0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSorts the collection. A comparison function should be provided, or the name of a property to sort by.\r\n\t**\r\n\t**\tObject sort (fn: Function)\r\n\t**\tObject sort (prop: string, [desc:bool=false])\r\n\t*/\r\n\tsort: function (fn, desc)\r\n\t{\r\n\t\tif (typeof(fn) != \"function\")\r\n\t\t{\r\n\t\t\tthis.items.sort(function(a, b)\r\n\t\t\t{\r\n\t\t\t\treturn (a[fn] <= b[fn] ? -1 : 1) * (desc === true ? -1 : 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.items.sort(fn);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for an item with the specified fields and returns it. The \"inc\" object is the \"inclusive\" map, meaning all fields must match\r\n\t**\tand the optional \"exc\" is the exclusive map, meaning not even one field should match.\r\n\t**\r\n\t**\tObject findItem (inc: Object, exc: Object);\r\n\t*/\t\r\n\tfindItem: function (inc, exc)\r\n\t{\r\n\t\tif (!this.items) return null;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t{\r\n\t\t\tif (exc && Rinn.partialCompare(this.items[i], exc))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.partialCompare(this.items[i], inc))\r\n\t\t\t\treturn this.items[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the container array.\r\n\t*/\r\n\tgetItems: function ()\r\n\t{\r\n\t\treturn this.items;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the number of items in the collection.\r\n\t*/\r\n\tlength: function ()\r\n\t{\r\n\t\treturn this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns true if the collection is empty.\r\n\t*/\r\n\tisEmpty: function ()\r\n\t{\r\n\t\treturn !this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the index of the specified item, or -1 if not found.\r\n\t*/\r\n\tindexOf: function (item)\r\n\t{\r\n\t\treturn this.items.indexOf(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the item at the specified index, or null if not found. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tgetAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\treturn index >= 0 && index < this.items.length ? this.items[index] : null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the first item in the collection.\r\n\t*/\r\n\tfirst: function ()\r\n\t{\r\n\t\treturn this.getAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the last item in the collection.\r\n\t*/\r\n\tlast: function ()\r\n\t{\r\n\t\treturn this.getAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item at the specified index, effectively moving the remaining items to the right.\r\n\t*/\r\n\taddAt: function (index, item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded (item))\r\n\t\t\treturn this;\r\n\r\n\t\tif (index < 0) index = 0;\r\n\t\tif (index > this.items.length) index = this.items.length;\r\n\r\n\t\tif (index == 0)\r\n\t\t{\r\n\t\t\tthis.items.unshift(item);\r\n\t\t}\r\n\t\telse if (index == this.items.length)\r\n\t\t{\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar tmp = this.items.splice(0, index);\r\n\t\t\ttmp.push(item);\r\n\r\n\t\t\tthis.items = tmp.concat(this.items);\r\n\t\t\tthis.itemsReferenceChanged();\r\n\t\t}\r\n\r\n\t\tthis.onItemAdded (item);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the start of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tunshift: function (item)\r\n\t{\r\n\t\treturn this.addAt(0, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tpush: function (item)\r\n\t{\r\n\t\treturn this.addAt(this.items.length, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tadd: function (item)\r\n\t{\r\n\t\treturn this.push(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the item at the specified index. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tremoveAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\tif (index < 0 || index >= this.items.length)\r\n\t\t\treturn null;\r\n\r\n\t\tvar item = this.items[index];\r\n\t\tthis.items.splice (index, 1);\r\n\t\tthis.onItemRemoved (item, index);\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the end of the collection.\r\n\t*/\r\n\tpop: function (item)\r\n\t{\r\n\t\treturn this.removeAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the start of the collection.\r\n\t*/\r\n\tshift: function (item)\r\n\t{\r\n\t\treturn this.removeAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified item from the collection.\r\n\t*/\r\n\tremove: function (item)\r\n\t{\r\n\t\treturn this.removeAt (this.indexOf(item));\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the specified callback for each of the items in the collection, if false is returned by the callback this function\r\n\t**\twill exit immediately. Parameters to the callback are: (item, index, collection).\r\n\t*/\r\n\tforEach: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a method call with the specified parameters on each of the items in the collection, if false is returned by the\r\n\t**\titem's method this function will exit immediately.\r\n\t*/\r\n\tforEachCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEach but in reverse order.\r\n\t*/\r\n\tforEachRev: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEachCall but in reverse order.\r\n\t*/\r\n\tforEachRevCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the beforeItemAdded event. If returns false the item will not be added.\r\n\t*/\r\n\tonBeforeItemAdded: function (item)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemAdded event.\r\n\t*/\r\n\tonItemAdded: function (item)\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemRemoved event.\r\n\t*/\r\n\tonItemRemoved: function (item)\r\n\t{\r\n\t}\r\n});\r\n","/*\n**\trinn/template\n**\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\n**\thttps://rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport Rinn from './alpha.js';\n\n/**\n**\tTemplating module. The template formats available are shown below, note that the sym-open and sym-close symbols are by\n**\tdefault the square brackets, however those can be modified since are just parameters.\n**\n**\tHTML Escaped Output:\t\t\t[data.value]\t\t\t\t\tEscapes HTML characters from the output.\n**\tRaw Output:\t\t\t\t\t\t[!data.value]\t\t\t\t\tDoes not escape HTML characters from the output (used to output direct HTML).\n**\tDouble-Quoted Escaped Output:\t[data.value]\t\t\t\t\tEscapes HTML characters and surrounds with double quotes.\n**\tImmediate Reparse:\t\t\t\t[<....] [@....] \"...\" '...'\t\tReparses the contents as if parseTemplate() was called again.\n**\tImmediate Output:\t\t\t\t[:...]\t\t\t\t\t\t\tTakes the contents and outputs exactly as-is without format and optionally surrounded by the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsym-open and sym-close symbols when the first character is not '<', sym_open or space.\n**\tFiltered Output:\t\t\t\t[functionName ... <expr> ...]\tRuns a function call, 'expr' can be any of the allowed formats shown here (nested if desired),\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunctionName should map to one of the available expression functions registered in the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRinn.Template.functions map, each of which have their own parameters.\n*/\n\nlet Template =\n{\n\t/*\n\t**\tStrict mode flag. When set, any undefined expression function will trigger an exception.\n\t*/\n\tstrict: false,\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method.\n\t**\n\t**\t>> array parseTemplate (string template, char sym_open, char sym_close, bool is_tpl=false);\n\t*/\n\tparseTemplate: function (template, sym_open, sym_close, is_tpl=false, root=1)\n\t{\n\t\tlet nflush = 'string', flush = null, state = 0, count = 0;\n\t\tlet str = '', parts = [], mparts = parts, nparts = false;\n\n\t\tif (is_tpl === true)\n\t\t{\n\t\t\ttemplate = template.trim();\n\t\t\tnflush = 'identifier';\n\t\t\tstate = 10;\n\n\t\t\tmparts.push(parts = []);\n\t\t}\n\n\t\ttemplate += \"\\0\";\n\n\t\tfunction unescape (value)\n\t\t{\n\t\t\tif (typeof(value) == 'object')\n\t\t\t{\n\t\t\t\tif (value instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t\t\tunescape(value[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.data = unescape(value.data);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tif (value[i] == '\\\\')\n\t\t\t\t{\n\t\t\t\t\tlet r = value[i+1];\n\n\t\t\t\t\tswitch (r)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'n': r = \"\\n\"; break;\n\t\t\t\t\t\tcase 'r': r = \"\\r\"; break;\n\t\t\t\t\t\tcase 'f': r = \"\\f\"; break;\n\t\t\t\t\t\tcase 'v': r = \"\\v\"; break;\n\t\t\t\t\t\tcase 't': r = \"\\t\"; break;\n\t\t\t\t\t\tcase 's': r = \"\\s\"; break;\n\t\t\t\t\t\tcase '\"': r = \"\\\"\"; break;\n\t\t\t\t\t\tcase \"'\": r = \"\\'\"; break;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.substr(0, i) + r + value.substr(i+2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction emit (type, data)\n\t\t{\n\t\t\tif (type == 'template')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, true, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t\ttype = 'base-string';\n\n\t\t\t\tif (Rinn.typeOf(data) == 'array')\n\t\t\t\t{\n\t\t\t\t\ttype = data[0].type;\n\t\t\t\t\tdata = data[0].data;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data.trim().split('\\n').map(i => i.trim()).join(\"\\n\"), sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge-alt')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, '{', '}', false, 0);\n\t\t\t}\n\n\t\t\tif (type == 'parse-merge' || type == 'parse-merge-alt' || type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\t{\n\t\t\t\t\tparts.push(data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tparts.push({ type: type, data: data });\n\n\t\t\tif (nparts)\n\t\t\t{\n\t\t\t\tmparts.push(parts = []);\n\t\t\t\tnparts = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < template.length; i++)\n\t\t{\n\t\t\tif (template[i] == '\\\\')\n\t\t\t{\n\t\t\t\tstr += '\\\\';\n\t\t\t\tstr += template[++i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-merge';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 12; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'template';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 1:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 10:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '.')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\temit ('access', '.');\n\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tnparts = true;\n\n\t\t\t\t\t\twhile (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null) i++;\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 14; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 15; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 16; count = 1; nflush = 'parse-merge-alt';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 13; count = 1; nflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) emit (nflush, str);\n\t\t\t\t\t\tstate = 11; count = 1; str = ''; nflush = 'parse';\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nflush != 'identifier')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 11:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 12:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str.length != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 13:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\n\t\t\t\t\t\t\tstate = 10;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\"');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 15:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\\'');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 16:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '`');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (flush)\n\t\t\t{\n\t\t\t\temit (flush, str);\n\t\t\t\tflush = str = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!is_tpl)\n\t\t{\n\t\t\tlet i = 0;\n\t\t\twhile (i < mparts.length)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti = mparts.length-1;\n\t\t\twhile (i > 0)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i--, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (mparts.length == 0)\n\t\t\t\tmparts.push({ type: 'string', data: '' });\n\t\t}\n\n\t\tif (root)\n\t\t\tunescape(mparts);\n\n\t\treturn mparts;\n\t},\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method. This\n\t**\tversion assumes the sym_open and sym_close chars are [ and ] respectively.\n\t**\n\t**\t>> array parse (string template);\n\t*/\n\tparse: function (template)\n\t{\n\t\treturn this.parseTemplate(template.trim(), '[', ']', false);\n\t},\n\n\t/**\n\t**\tRemoves all static parts from a parsed template.\n\t**\n\t**\t>> array clean (array parts);\n\t*/\n\tclean: function (parts)\n\t{\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].type != 'template')\n\t\t\t{\n\t\t\t\tparts.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn parts;\n\t},\n\n\t/**\n\t**\tExpands a template using the given data object, ret can be set to 'text' or 'obj' allowing to expand the template as\n\t**\ta string (text) or an array of objects (obj) respectively. If none provided it will be expanded as text.\n\t**\n\t**\t>> string/array expand (array parts, object data, string ret='text', string mode='base-string');\n\t*/\n\texpand: function (parts, data, ret='text', mode='base-string')\n\t{\n\t\tlet s = [];\n\n\t\t// Expand variable parts.\n\t\tif (mode == 'var')\n\t\t{\n\t\t\tlet escape = true;\n\t\t\tlet quote = false;\n\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tescape = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tquote = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tquote = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (str != 'this')\n\t\t\t{\n\t\t\t\tlet failed = false;\n\n\t\t\t\tif (data != null)\n\t\t\t\t{\n\t\t\t\t\tif (!(str in data))\n\t\t\t\t\t{\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tdata = data[str];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfailed = true;\n\n\t\t\t\tif (failed && parts.length == 1)\n\t\t\t\t{\n\t\t\t\t\tif (Template.strict == true)\n\t\t\t\t\t\tthrow new Error ('Expression function `'+str+'` not found.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof(data) == 'string')\n\t\t\t{\n\t\t\t\tif (escape)\n\t\t\t\t\tdata = data.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n\t\t\t\tif (quote)\n\t\t\t\t\tdata = '\"' + data + '\"';\n\t\t\t}\n\n\t\t\ts.push(data);\n\t\t}\n\n\t\t// Expand variable parts and returns a reference to it.\n\t\tif (ret == 'varref')\n\t\t{\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn str != 'this' ? [data, str] : null;\n\t\t}\n\n\t\t// Expand function parts.\n\t\tif (mode == 'fn')\n\t\t{\n\t\t\tvar args = [];\n\n\t\t\targs.push(Template.expand(parts[0], data, 'text', 'base-string'));\n\n\t\t\tif ('_'+args[0] in Template.functions)\n\t\t\t\targs[0] = '_'+args[0];\n\n\t\t\tif (!(args[0] in Template.functions))\n\t\t\t{\n\t\t\t\tif (Template.strict == true)\n\t\t\t\t\tthrow new Error ('Expression function `'+args[0]+'` not found.');\n\n\t\t\t\treturn `(Unknown: ${args[0]})`;\n\t\t\t}\n\n\t\t\tif (args[0][0] == '_')\n\t\t\t\treturn Template.functions[args[0]] (parts, data);\n\n\t\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\t\targs.push(Template.expand(parts[i], data, 'arg', 'base-string'));\n\n\t\t\ts.push(Template.functions[args[0]] (args, parts, data));\n\t\t}\n\n\t\t// Template mode.\n\t\tif (mode == 'template')\n\t\t{\n\t\t\tif (parts.length == 1)\n\t\t\t{\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'string')\n\t\t\t\t\treturn parts[0][0].data;\n\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'identifier')\n\t\t\t\t{\n\t\t\t\t\tlet name = parts[0][0].data;\n\n\t\t\t\t\tif (name in Template.functions || '_'+name in Template.functions)\n\t\t\t\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t\t\t}\n\t\n\t\t\t\treturn Template.expand(parts[0], data, ret, 'var');\n\t\t\t}\n\n\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t}\n\n\t\t// Expand parts.\n\t\tif (mode == 'base-string')\n\t\t{\n\t\t\tlet index = -1;\n\n\t\t\tfor (let i of parts)\n\t\t\t{\n\t\t\t\tlet tmp = null;\n\t\t\t\tindex++;\n\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'template');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'string': case 'identifier':\n\t\t\t\t\t\ttmp = i.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'base-string');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (ret == 'void')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (ret == 'last' && index != parts.length-1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ts.push(tmp);\n\t\t\t}\n\t\t}\n\n\t\t// Return types for direct objects.\n\t\tif (ret == 'obj') return s;\n\n\t\tif (ret == 'last')\n\t\t{\n\t\t\tif (typeOf(s) == 'Rose\\\\Arry')\n\t\t\t\ts = s[0];\n\n\t\t\treturn s;\n\t\t}\n\n\t\t// When the output is not really needed.\n\t\tif (ret == 'void') return null;\n\n\t\t// Return as argument ('object' if only one, or string if more than one), that is, the first item in the result.\n\t\tif (ret == 'arg')\n\t\t{\n\t\t\tif (Rinn.typeOf(s) == 'array')\n\t\t\t{\n\t\t\t\tif (s.length != 1)\n\t\t\t\t\treturn s.join('');\n\n\t\t\t\treturn s[0];\n\t\t\t}\n\n\t\t\treturn s;\n\t\t}\n\n\t\tif (ret == 'text' && Rinn.typeOf(s) == 'array')\n\t\t{\n\t\t\tlet f = (e => e != null && typeof(e) == 'object' ? ('map' in e ? e.map(f).join('') : ('join' in e ? e.join('') : e.toString())) : e);\n\t\t\ts = s.map(f).join('');\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tParses the given template and returns a function that when called with an object will expand the template.\n\t**\n\t**\t>> object compile (string template);\n\t*/\n\tcompile: function (template)\n\t{\n\t\ttemplate = Template.parse(template);\n\n\t\treturn function (data=null, mode='text') {\n\t\t\treturn Template.expand(template, data ? data : { }, mode);\n\t\t};\n\t},\n\n\t/**\n\t**\tParses and expands the given template immediately.\n\t**\n\t**\t>> object eval (string template, object data, string mode='text');\n\t*/\n\teval: function (template, data=null, mode='text')\n\t{\n\t\ttemplate = Template.parse(template);\n\t\treturn Template.expand(template, data ? data : { }, mode);\n\t},\n\n\t/**\n\t**\tExpands the template as 'arg' and returns the result.\n\t**\n\t**\t>> object value (string parts, object data);\n\t*/\n\tvalue: function (parts, data=null)\n\t{\n\t\treturn Rinn.typeOf(parts) != 'array' ? parts : Template.expand(parts, data ? data : { }, 'arg');\n\t},\n\n\t/**\n\t**\tRegisters an expression function.\n\t**\n\t**\t>> object register (string name, function fn);\n\t*/\n\tregister: function (name, fn)\n\t{\n\t\tTemplate.functions[name] = fn;\n\t},\n\n\t/**\n\t**\tCalls an expression function.\n\t**\n\t**\t>> object call (string name, object args, object data);\n\t*/\n\t'call': function (name, args, data=null)\n\t{\n\t\tif (name in Template.functions)\n\t\t\treturn Template.functions[name] (args, null, data);\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns a map given a 'parts' array having values of the form \"name: value\" or \":name value\".\n\t**\n\t**\t>> Map getNamedValues (array parts, object data, int i=1, bool expanded=true);\n\t*/\n\tgetNamedValues: function (parts, data, i=1, expanded=true)\n\t{\n\t\tlet s = { };\n\t\tlet mode = 0;\n\t\n\t\tfor (; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet key = Template.expand(parts[i], data, 'arg');\n\n\t\t\tif (!mode) {\n\t\t\t\tif (key.startsWith(':')) mode = 1; else mode = key.endsWith(':') ? 2 : 3;\n\t\t\t}\n\n\t\t\tif (mode == 1)\n\t\t\t\tkey = key.substr(1);\n\t\t\telse if (mode == 2)\n\t\t\t\tkey = key.substr(0, key.length-1);\n\n\t\t\tif (expanded)\n\t\t\t\ts[key] = Template.expand(parts[i+1], data, 'arg');\n\t\t\telse\n\t\t\t\ts[key] = parts[i+1];\n\t\t}\n\n\t\treturn s;\n\t}\n};\n\n\n/**\n**\tTemplate functions, functions that are used to format data. Each function takes three parameters (args, parts and data). By default the function arguments\n**\tare expanded and passed via 'args' for convenience, however if the function name starts with '_' the 'args' parameter will be skipped and only (parts, data)\n**\twill be available, each 'part' must be expanded manually by calling Template.expand.\n*/\n\nTemplate.functions =\n{\n\t/**\n\t**\tExpression functions.\n\t*/\n\t'global': function(args) { return globalThis; },\n\t'null': function(args) { return null; },\n\t'true': function(args) { return true; },\n\t'false': function(args) { return false; },\n\n\t'len': function(args) { return args[1].toString().length; },\n\t'int': function(args) { return ~~args[1]; },\n\t'str': function(args) { return args[1].toString(); },\n\t'float': function(args) { return parseFloat(args[1]); },\n\t'chr': function(args) { return String.fromCharCode(args[1]); },\n\t'ord': function(args) { return args[1].toString().charCodeAt(0); },\n\n\t'not': function(args) { return !args[1]; },\n\t'neg': function(args) { return -args[1]; },\n\t'abs': function(args) { return Math.abs(args[1]); },\n\n\t'and': function(args) { for (let i = 1; i < args.length; i++) if (!args[i]) return false; return true; },\n\t'or': function(args) { for (let i = 1; i < args.length; i++) if (~~args[i]) return true; return false; },\n\n\t'eq': function(args) { return args[1] == args[2]; },\n\t'ne': function(args) { return args[1] != args[2]; },\n\t'lt': function(args) { return args[1] < args[2]; },\n\t'le': function(args) { return args[1] <= args[2]; },\n\t'gt': function(args) { return args[1] > args[2]; },\n\t'ge': function(args) { return args[1] >= args[2]; },\n\t'isnotnull': function(args) { return !!args[1]; },\n\t'isnull': function(args) { return !args[1]; },\n\t'iszero': function(args) { return parseInt(args[1]) == 0; },\n\n\t'eq?': function(args) { return args[1] == args[2]; },\n\t'ne?': function(args) { return args[1] != args[2]; },\n\t'lt?': function(args) { return args[1] < args[2]; },\n\t'le?': function(args) { return args[1] <= args[2]; },\n\t'gt?': function(args) { return args[1] > args[2]; },\n\t'ge?': function(args) { return args[1] >= args[2]; },\n\t'notnull?': function(args) { return !!args[1]; },\n\t'null?': function(args) { return !args[1]; },\n\t'zero?': function(args) { return parseInt(args[1]) == 0; },\n\n\t'typeof': function(args) { return Rinn.typeOf(args[1]); },\n\n\t'*': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'/': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'+': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'-': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mul': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'div': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'sum': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'sub': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mod': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x %= args[i]; return x; },\n\t'pow': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\n\t/**\n\t**\tReturns the JSON representation of the expression.\n\t**\n\t**\tdump <expr>\n\t*/\n\t'dump': function (args)\n\t{\n\t\treturn JSON.stringify(args[1]);\n\t},\n\n\t/**\n\t**\tSets one or more variables in the data context.\n\t**\n\t**\tset <var-name> <expr> [<var-name> <expr>]*\n\t*/\n\t'_set': function (parts, data)\n\t{\n\t\tfor (let i = 1; i+1 < parts.length; i += 2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i+1], data);\n\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) ref[0][ref[1]] = value;\n\t\t\t}\n\t\t\telse\n\t\t\t\tdata[Template.value(parts[i], data)] = value;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tRemoves one or more variables from the data context.\n\t**\n\t**\tunset <var-name> [<var-name>]*\n\t*/\n\t'_unset': function (parts, data)\n\t{\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) delete ref[0][ref[1]];\n\t\t\t}\n\t\t\telse\n\t\t\t\tdelete data[Template.value(parts[i], data)];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\n\t/**\n\t**\tReturns the expression without white-space on the left or right. The expression can be a string or an array.\n\t**\n\t**\ttrim <expr>\n\t*/\n\t'trim': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.trim()) : args[1].trim()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in uppercase. The expression can be a string or an array.\n\t**\n\t**\tupper <expr>\n\t*/\n\t'upper': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toUpperCase()) : args[1].toUpperCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in lower. The expression can be a string or an array.\n\t**\n\t**\tlower <expr>\n\t*/\n\t'lower': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toLowerCase()) : args[1].toLowerCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns a sub-string of the given string.\n\t**\n\t**\tsubstr <start> <count> <string>\n\t**\tsubstr <start> <string>\n\t*/\n\t'substr': function (args)\n\t{\n\t\tlet s = args[args.length-1].toString();\n\n\t\tlet start = 0;\n\t\tlet count = null;\n\n\t\tif (args.length == 4)\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = ~~(args[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = null;\n\t\t}\n\n\t\tif (start < 0) start += s.length;\n\t\tif (count < 0) count += s.length;\n\n\t\tif (count === null)\n\t\t\tcount = s.length - start;\n\n\t\treturn s.substr(start, count);\n\t},\n\n\t/**\n\t**\tReplaces a matching string with the given replacement string in a given text.\n\t**\n\t**\treplace <search> <replacement> <text>\n\t*/\n\t'replace': function (args)\n\t{\n\t\treturn args[3].split(args[1]).join(args[2]);\n\t},\n\n\t/**\n\t**\tConverts all new-line chars in the expression to <br/>, the expression can be a string or an array.\n\t**\n\t**\tnl2br <expr>\n\t*/\n\t'nl2br': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.replace(/\\n/g, \"<br/>\")) : args[1].replace(/\\n/g, \"<br/>\")) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', the expression can be a string or an array.\n\t**\n\t**\t% <tag-name> <expr>\n\t*/\n\t'%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet s = '';\n\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t{\n\t\t\tif (Rinn.typeOf(args[i]) == 'array')\n\t\t\t{\n\t\t\t\ts += `<${name}>`;\n\t\t\t\t\n\t\t\t\tfor (let j = 0; j < args[i].length; j++)\n\t\t\t\t\ts += args[i][j];\n\n\t\t\t\ts += `</${name}>`;\n\t\t\t}\n\t\t\telse\n\t\t\t\ts += `<${name}>${args[i]}</${name}>`;\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', attributes are supported.\n\t**\n\t**\t%% <tag-name> [<attr> <value>]* [<content>]\n\t*/\n\t'%%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet attr = '';\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < args.length; i += 2)\n\t\t{\n\t\t\tif (i+1 < args.length)\n\t\t\t\tattr += ` ${args[i]}=\"${args[i+1]}\"`;\n\t\t\telse\n\t\t\t\ttext = args[i];\n\t\t}\n\n\t\treturn text ? `<${name}${attr}>${text}</${name}>` : `<${name}${attr}/>`;\n\t},\n\n\t/**\n\t**\tJoins the given array expression into a string. The provided string-expr will be used as separator.\n\t**\n\t**\tjoin <string-expr> <array-expr>\n\t*/\n\t'join': function (args)\n\t{\n\t\tif (args[2] && Rinn.typeOf(args[2]) == 'array')\n\t\t\treturn args[2].join(args[1]);\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tSplits the given expression by the specified string. Returns an array.\n\t**\n\t**\tsplit <string-expr> <expr>\n\t*/\n\t'split': function (args)\n\t{\n\t\tif (args[2] && typeof(args[2]) == \"string\")\n\t\t\treturn args[2].split(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the keys of the given object-expr.\n\t**\n\t**\tkeys <object-expr>\n\t*/\n\t'keys': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.keys(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the values of the given object-expr.\n\t**\n\t**\tvalues <object-expr>\n\t*/\n\t'values': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.values(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tConstructs a string obtained by concatenating the expanded template for each of the items in the list-expr, the mandatory varname\n\t**\tparameter (namely 'i') indicates the name of the variable that will contain the data of each item as the list-expr is\n\t**\ttraversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote the index/key and numeric index\n\t**\tof the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\teach <varname> <list-expr> <template>\n\t*/\n\t'_each': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet s = '';\n\t\tlet j = 0;\n\n\t\tif (!list) return s;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\ts += Template.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tExpands the given template for each of the items in the list-expr, the mandatory varname parameter (namely 'i') indicates the name of the variable\n\t**\tthat will contain the data of each item as the list-expr is traversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote\n\t**\tthe index/key and numeric index of the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\tDoes not produce any output (returns null).\n\t**\n\t**\tforeach <varname> <list-expr> <template>\n\t*/\n\t'_foreach': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet j = 0;\n\n\t\tif (!list) return null;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tTemplate.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns the valueA if the expression is true otherwise valueB, this is a short version of the 'if' function with the\n\t**\tdifference that the result is 'obj' instead of text.\n\t**\n\t**\t? <expr> <valueA> [<valueB>]\n\t*/\n\t'_?': function (parts, data)\n\t{\n\t\tif (Template.expand(parts[1], data, 'arg'))\n\t\t\treturn Template.expand(parts[2], data, 'arg');\n\n\t\tif (parts.length > 3)\n\t\t\treturn Template.expand(parts[3], data, 'arg');\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the valueA if it is not null (or empty or zero), otherwise returns valueB.\n\t**\n\t**\t?? <valueA> <valueB>\n\t*/\n\t'_??': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\t\tif (value) return value;\n\t\n\t\treturn Template.expand(parts[2], data, 'arg');\n\t},\n\n\t/**\n\t**\tReturns the value if the expression is true, supports 'elif' and 'else' as well. The result of this function is always text.\n\t**\n\t**\tif <expr> <value> [elif <expr> <value>] [else <value>]\n\t*/\n\t'_if': function (parts, data)\n\t{\n\t\tfor (let i = 0; i < parts.length; i += 3)\n\t\t{\n\t\t\tif (Template.expand(parts[i], data, 'arg') == 'else')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\n\t\t\tif (Template.expand(parts[i+1], data, 'arg'))\n\t\t\t\treturn Template.expand(parts[i+2], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tLoads the expression value and attempts to match one case.\n\t**\n\t**\tswitch <expr> <case1> <value1> ... <caseN> <valueN> default <defvalue> \n\t*/\n\t'_switch': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\n\t\tfor (let i = 2; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet case_value = Template.expand(parts[i], data, 'arg');\n\t\t\tif (case_value == value || case_value == 'default')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tExits the current inner most loop.\n\t**\n\t**\tbreak\n\t*/\n\t'_break': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_BREAK');\n\t},\n\n\t/**\n\t**\tSkips execution and continues the next cycle of the current inner most loop.\n\t**\n\t**\tcontinue\n\t*/\n\t'_continue': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_CONTINUE');\n\t},\n\n\t/**\n\t**\tConstructs an array with the results of repeating the specified template for a number of times.\n\t**\n\t**\trepeat <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_repeat': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`repeat`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0, to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\t\tlet arr = [];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn arr;\n\t},\n\n\t/**\n\t**\tRepeats the specified template for a number of times.\n\t**\n\t**\tfor <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_for': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`for`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0; to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tvalue = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRepeats the specified template infinitely until a \"break\" is found.\n\t**\n\t**\tloop <template>\n\t*/\n\t'_loop': function (parts, data)\n\t{\n\t\tif (parts.length < 2)\n\t\t\treturn '(`loop`: Wrong number of parameters)';\n\n\t\tlet tpl = parts[1];\n\n\t\twhile (true)\n\t\t{\n\t\t\ttry {\n\t\t\t\tTemplate.value(tpl, data);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tlet name = e.message;\n\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tWrites the specified arguments to the console.\n\t**\n\t**\techo <expr> [<expr>...]\n\t*/\n\t'_echo': function (parts, data)\n\t{\n\t\tlet s = '';\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts += Template.expand(parts[i], data, 'arg');\n\n\t\tconsole.log(s);\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tConstructs a list from the given arguments and returns it.\n\t**\n\t**\t# <expr> [<expr>...]\n\t*/\n\t'_#': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(Template.expand(parts[i], data, 'arg'));\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded list from the given arguments and returns it.\n\t**\n\t**\t## <expr> [<expr>...]\n\t*/\n\t'_##': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(parts[i]);\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs an associative array (dictionary) and returns it.\n\t**\n\t**\t& <name>: <expr> [<name>: <expr>...]\n\t**\t& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, true);\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded associative array (dictionary) and returns it.\n\t**\n\t**\t&& <name>: <expr> [<name>: <expr>...]\n\t**\t&& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, false);\n\t},\n\n\t/**\n\t**\tReturns true if the specified map contains all the specified keys. If it fails the global variable `err` will contain an error message.\n\t**\n\t**\tcontains <expr> <name> [<name>...]\n\t*/\n\t'contains': function (args, parts, data)\n\t{\n\t\tlet value = args[1];\n\n\t\tif (typeof(value) != 'object')\n\t\t{\n\t\t\tdata.err = 'Argument is not a Map';\n\t\t\treturn false;\n\t\t}\n\n\t\tlet s = '';\n\n\t\tfor (let i = 2; i < args.length; i++)\n\t\t{\n\t\t\tif (!(args[i] in value))\n\t\t\t\ts += ', '+args[i];\n\t\t}\n\n\t\tif (s != '')\n\t\t{\n\t\t\tdata.err = s.substr(1);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if the specified map has the specified key. Returns boolean.\n\t**\n\t**\thas <name> <expr>\n\t*/\n\t'has': function (args, parts, data)\n\t{\n\t\tlet value = args[2];\n\n\t\tif (Rinn.typeOf(value) != 'object')\n\t\t\treturn false;\n\n\t\treturn args[1] in value;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the transformed values of the array/map (evaluating the template). And just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tmap <varname> <list-expr> <template>\n\t*/\n\t'_map': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (arrayMode)\n\t\t\t\toutput.push(Template.expand(parts[3], data, 'arg'));\n\t\t\telse\n\t\t\t\toutput[i] = Template.expand(parts[3], data, 'arg');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the elements where the template evaluates to non-zero. Just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tfilter <varname> <list-expr> <template>\n\t*/\n\t'_filter': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (~~Template.expand(parts[3], data, 'arg'))\n\t\t\t{\n\t\t\t\tif (arrayMode)\n\t\t\t\t\toutput.push(list[i]);\n\t\t\t\telse\n\t\t\t\t\toutput[i] = list[i];\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tExpands the specified template string with the given data. The sym_open and sym_close will be '{' and '}' respectively.\n\t**\tIf no data is provided, current data parameter will be used.\n\t**\n\t**\texpand <template> <data>\n\t*/\n\t'expand': function (args, parts, data)\n\t{\n\t\treturn Template.expand (Template.parseTemplate (args[1], '{', '}'), args.length == 3 ? args[2] : data);\n\t},\n\n\t/**\n\t**\tCalls a function described by the given parameter.\n\t**\n\t**\tcall <function> <args...>\n\t*/\n\t'_call': function (parts, data)\n\t{\n\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\n\t\tif (!ref || typeof(ref[0][ref[1]]) != 'function')\n\t\t\tthrow new Error ('Expression is not a function: ' + Template.expand(parts[1], data, 'obj').map(i => i == null ? '.' : i).join(''));\n\n\t\tlet args = [];\n\n\t\tfor (let i = 2; i < parts.length; i++)\n\t\t\targs.push(Template.value(parts[i], data));\n\n\t\treturn ref[0][ref[1]] (...args);\n\t},\n};\n\nexport default Template;\n","/*\r\n**\trinn/main.js\r\n**\r\n**\tCopyright (c) 2013-2022, RedStar Technologies, All rights reserved.\r\n**\thttps://rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport _Rinn from './alpha.js';\r\nimport _Class from './class.js';\r\nimport _Event from './event.js';\r\nimport _EventDispatcher from './event-dispatcher.js';\r\nimport _Model from './model.js';\r\nimport _ModelList from './model-list.js';\r\nimport _Schema from './schema.js';\r\nimport _Flattenable from './flattenable.js';\r\nimport _Collection from './collection.js';\r\nimport _Template from './template.js';\r\n\r\nexport const Rinn = _Rinn;\r\nexport const Class = _Class;\r\nexport const Event = _Event;\r\nexport const EventDispatcher = _EventDispatcher;\r\nexport const Model = _Model;\r\nexport const ModelList = _ModelList;\r\nexport const Schema = _Schema;\r\nexport const Flattenable = _Flattenable;\r\nexport const Collection = _Collection;\r\nexport const Template = _Template;\r\n","/*! https://mths.be/base64 v1.0.0 by @mathias | MIT license */\n;(function(root) {\n\n\t// Detect free variables `exports`.\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`.\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code, and use\n\t// it as `root`.\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar InvalidCharacterError = function(message) {\n\t\tthis.message = message;\n\t};\n\tInvalidCharacterError.prototype = new Error;\n\tInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n\tvar error = function(message) {\n\t\t// Note: the error messages used throughout this file match those used by\n\t\t// the native `atob`/`btoa` implementation in Chromium.\n\t\tthrow new InvalidCharacterError(message);\n\t};\n\n\tvar TABLE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\t// http://whatwg.org/html/common-microsyntaxes.html#space-character\n\tvar REGEX_SPACE_CHARACTERS = /[\\t\\n\\f\\r ]/g;\n\n\t// `decode` is designed to be fully compatible with `atob` as described in the\n\t// HTML Standard. http://whatwg.org/html/webappapis.html#dom-windowbase64-atob\n\t// The optimized base64-decoding algorithm used is based on @atks excellent\n\t// implementation. https://gist.github.com/atk/1020396\n\tvar decode = function(input) {\n\t\tinput = String(input)\n\t\t\t.replace(REGEX_SPACE_CHARACTERS, '');\n\t\tvar length = input.length;\n\t\tif (length % 4 == 0) {\n\t\t\tinput = input.replace(/==?$/, '');\n\t\t\tlength = input.length;\n\t\t}\n\t\tif (\n\t\t\tlength % 4 == 1 ||\n\t\t\t// http://whatwg.org/C#alphanumeric-ascii-characters\n\t\t\t/[^+a-zA-Z0-9/]/.test(input)\n\t\t) {\n\t\t\terror(\n\t\t\t\t'Invalid character: the string to be decoded is not correctly encoded.'\n\t\t\t);\n\t\t}\n\t\tvar bitCounter = 0;\n\t\tvar bitStorage;\n\t\tvar buffer;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\twhile (++position < length) {\n\t\t\tbuffer = TABLE.indexOf(input.charAt(position));\n\t\t\tbitStorage = bitCounter % 4 ? bitStorage * 64 + buffer : buffer;\n\t\t\t// Unless this is the first of a group of 4 characters\n\t\t\tif (bitCounter++ % 4) {\n\t\t\t\t// convert the first 8 bits to a single ASCII character.\n\t\t\t\toutput += String.fromCharCode(\n\t\t\t\t\t0xFF & bitStorage >> (-2 * bitCounter & 6)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t};\n\n\t// `encode` is designed to be fully compatible with `btoa` as described in the\n\t// HTML Standard: http://whatwg.org/html/webappapis.html#dom-windowbase64-btoa\n\tvar encode = function(input) {\n\t\tinput = String(input);\n\t\tif (/[^\\0-\\xFF]/.test(input)) {\n\t\t\t// Note: no need to special-case astral symbols here, as surrogates are\n\t\t\t// matched, and the input is supposed to only contain ASCII anyway.\n\t\t\terror(\n\t\t\t\t'The string to be encoded contains characters outside of the ' +\n\t\t\t\t'Latin1 range.'\n\t\t\t);\n\t\t}\n\t\tvar padding = input.length % 3;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\tvar a;\n\t\tvar b;\n\t\tvar c;\n\t\tvar buffer;\n\t\t// Make sure any padding is handled outside of the loop.\n\t\tvar length = input.length - padding;\n\n\t\twhile (++position < length) {\n\t\t\t// Read three bytes, i.e. 24 bits.\n\t\t\ta = input.charCodeAt(position) << 16;\n\t\t\tb = input.charCodeAt(++position) << 8;\n\t\t\tc = input.charCodeAt(++position);\n\t\t\tbuffer = a + b + c;\n\t\t\t// Turn the 24 bits into four chunks of 6 bits each, and append the\n\t\t\t// matching character for each of them to the output.\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 18 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 12 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 6 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer & 0x3F)\n\t\t\t);\n\t\t}\n\n\t\tif (padding == 2) {\n\t\t\ta = input.charCodeAt(position) << 8;\n\t\t\tb = input.charCodeAt(++position);\n\t\t\tbuffer = a + b;\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 10) +\n\t\t\t\tTABLE.charAt((buffer >> 4) & 0x3F) +\n\t\t\t\tTABLE.charAt((buffer << 2) & 0x3F) +\n\t\t\t\t'='\n\t\t\t);\n\t\t} else if (padding == 1) {\n\t\t\tbuffer = input.charCodeAt(position);\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 2) +\n\t\t\t\tTABLE.charAt((buffer << 4) & 0x3F) +\n\t\t\t\t'=='\n\t\t\t);\n\t\t}\n\n\t\treturn output;\n\t};\n\n\tvar base64 = {\n\t\t'encode': encode,\n\t\t'decode': decode,\n\t\t'version': '1.0.0'\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn base64;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = base64;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (var key in base64) {\n\t\t\t\tbase64.hasOwnProperty(key) && (freeExports[key] = base64[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.base64 = base64;\n\t}\n\n}(this));\n","\"use strict\";\n\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n\t// the only reliable means to get the global object is\n\t// `Function('return this')()`\n\t// However, this causes CSP violations in Chrome apps.\n\tif (typeof self !== 'undefined') { return self; }\n\tif (typeof window !== 'undefined') { return window; }\n\tif (typeof global !== 'undefined') { return global; }\n\tthrow new Error('unable to locate global object');\n}\n\nvar global = getGlobal();\n\nmodule.exports = exports = global.fetch;\n\n// Needed for TypeScript and Webpack.\nif (global.fetch) {\n\texports.default = global.fetch.bind(global);\n}\n\nexports.Headers = global.Headers;\nexports.Request = global.Request;\nexports.Response = global.Response;","/*\r\n**\triza/router\r\n**\r\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport { EventDispatcher } from 'rinn';\r\n\r\n/*\r\n**\tThe Router is a special module that detects local URL changes (when a hash-change occurs) and\r\n**\tforwards events to the appropriate handlers.\r\n*/\r\n\r\nconst _Router =\r\n{\r\n\tRoute: EventDispatcher.extend\r\n\t({\r\n\t\t/*\r\n\t\t**\tRegular expression for the route. This is generated from a simpler expression provided\r\n\t\t**\tin the constructor.\r\n\t\t*/\r\n\t\trouteRegex: null,\r\n\r\n\t\t/*\r\n\t\t**\tOriginal route string value.\r\n\t\t*/\r\n\t\tvalue: null,\r\n\r\n\t\t/*\r\n\t\t**\tMap with the indices and the names of each paremeter obtained from the route expression.\r\n\t\t*/\r\n\t\tparams: null,\r\n\r\n\t\t/*\r\n\t\t**\tArguments obtained from the current route (uses `params` to determine name of arguments).\r\n\t\t*/\r\n\t\targs: null,\r\n\r\n\t\t/*\r\n\t\t**\tArguments string obtained from the last route dispatch. Used to check if the arguments changed.\r\n\t\t*/\r\n\t\ts_args: null,\r\n\r\n\t\t/*\r\n\t\t**\tIndicates if the route is active because of a past positive dispatch.\r\n\t\t*/\r\n\t\tactive: false,\r\n\r\n\t\t/*\r\n\t\t**\tIndicates if the params have changed since last event. Transition from inactive to active route will always set this value to true.\r\n\t\t*/\r\n\t\tchanged: false,\r\n\r\n\t\t/*\r\n\t\t**\tConstructor of the route, the specified argument is a route expression.\r\n\t\t**\r\n\t\t**\t>> void __ctor (string route);\r\n\t\t*/\r\n\t\t__ctor: function (route)\r\n\t\t{\r\n\t\t\tthis._super.EventDispatcher.__ctor();\r\n\t\t\tthis._compileRoute (this.value = route);\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tTransforms the specified route expression into a regular expression and a set of parameter\r\n\t\t**\tnames and stores them in the 'param' array.\r\n\t\t**\r\n\t\t**\t>> void _compileRoute (string route);\r\n\t\t*/\r\n\t\t_compileRoute: function (route)\r\n\t\t{\r\n\t\t\tthis.params = [];\r\n\r\n\t\t\troute = route.replace(/\\/\\*\\//g, '/.+/');\r\n\r\n\t\t\twhile (true)\r\n\t\t\t{\r\n\t\t\t\tvar m = /:([!@A-Za-z0-9_-]+)/.exec(route);\r\n\t\t\t\tif (!m) break;\r\n\t\r\n\t\t\t\troute = route.replace(m[0], '([^/]+)');\r\n\t\t\t\tthis.params.push (m[1]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.routeRegex = '^' + route.replace(/##/g, '');\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tAdds a handler to the route dispatcher. The handler can be removed later using removeHandler and\r\n\t\t**\tspecifying the same parameters. If unrouted boolean is specified the event to listen to will be\r\n\t\t**\tthe unrouted event (when the route changes and the route is not activated).\r\n\t\t**\r\n\t\t**\tvoid addHandler (handler: function, unrouted: bool, context:object=null);\r\n\t\t*/\r\n\t\taddHandler: function (handler, unrouted=false, context=null)\r\n\t\t{\r\n\t\t\tthis.addEventListener ((unrouted === true ? 'un' : '') + 'routed', handler, context);\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tRemoves a handler from the route dispatcher.\r\n\t\t**\r\n\t\t**\tvoid removeHandler (handler: function, unrouted: bool, context: object=null);\r\n\t\t*/\r\n\t\tremoveHandler: function (handler, unrouted=false, context=null)\r\n\t\t{\r\n\t\t\tthis.removeEventListener ((unrouted === true ? 'un' : '') + 'routed', handler, context);\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tVerifies if the specified route matches the internal route and if so dispatches a (depends on doUnroute parameter) \"routed\" or \"unrouted\" event with the\r\n\t\t**\tparameters obtained from the location to all attached handlers.\r\n\t\t**\r\n\t\t**\tvoid dispatch (route:string, doUnroute:bool);\r\n\t\t*/\r\n\t\tdispatch: function (route)\r\n\t\t{\r\n\t\t\tvar matches = route.match(this.routeRegex);\r\n\t\t\tif (!matches)\r\n\t\t\t{\r\n\t\t\t\tthis.s_args = null;\r\n\r\n\t\t\t\tif (this.active)\r\n\t\t\t\t\tthis.dispatchEvent ('unrouted', { route: this });\r\n\r\n\t\t\t\tthis.active = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar args = { route: this };\r\n\t\t\tvar str = '';\r\n\r\n\t\t\tfor (var i = 0; i < this.params.length; i++)\r\n\t\t\t{\r\n\t\t\t\targs[this.params[i]] = matches[i+1];\r\n\t\t\t\tstr += '_' + matches[i+1];\r\n\t\t\t}\r\n\r\n\t\t\tthis.changed = str != this.s_args;\r\n\t\t\tthis.s_args = str;\r\n\r\n\t\t\tthis.dispatchEvent ('routed', this.args = args);\r\n\t\t\tthis.active = true;\r\n\t\t}\r\n\t}),\r\n\r\n\t/*\r\n\t**\tMap with route objects. The key of the map is the route and the value a handler.\r\n\t*/\r\n\troutes: { },\r\n\r\n\t/*\r\n\t**\tSorted list of routes. Smaller routes are processed first than larger ones. This array stores\r\n\t**\tonly the keys to the Router.routes map.\r\n\t*/\r\n\tsortedRoutes: [ ],\r\n\r\n\t/*\r\n\t**\tIndicates the number of times the onLocationChanged handler should ignore the hash change event.\r\n\t*/\r\n\tignoreHashChangeEvent: 0,\r\n\r\n\t/*\r\n\t**\tCurrent relative location (everything after the location hash symbol).\r\n\t*/\r\n\tlocation: '',\r\n\r\n\t/*\r\n\t**\tCurrent relative location as an array of elements (obtained by splitting the location by slash).\r\n\t*/\r\n\targs: [],\r\n\r\n\t/*\r\n\t**\tInitializes the router module. Ensure to call `refresh` once to force a hashchange when the page loads.\r\n\t*/\r\n\tinit: function ()\r\n\t{\r\n\t\tif (this.alreadyAttached)\r\n\t\t\treturn;\r\n\r\n\t\tthis.alreadyAttached = true;\r\n\r\n\t\tif ('onhashchange' in globalThis)\r\n\t\t\tglobalThis.onhashchange = this.onLocationChanged.bind(this);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRefreshes the current route by forcing a hashchange event.\r\n\t*/\r\n\trefresh: function ()\r\n\t{\r\n\t\tthis.onLocationChanged();\r\n\t},\r\n\r\n\t/*\r\n\t**\tChanges the current location and optionally prevents a trigger of the hashchange event.\r\n\t*/\r\n\tsetRoute: function (route, silent)\r\n\t{\r\n\t\tvar location = this.realLocation (route);\r\n\t\tif (location == this.location) return;\r\n\r\n\t\tif (silent) this.ignoreHashChangeEvent++;\r\n\t\tglobalThis.location.hash = location;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds the specified route to the routing map. When the specified route is detected, the `onRoute` handler will be called, and then\r\n\t**\twhen the route exits `onUnroute` will be called.\r\n\t*/\r\n\taddRoute: function (route, onRoute, onUnroute=null)\r\n\t{\r\n\t\tif (!this.routes[route])\r\n\t\t{\r\n\t\t\tthis.routes[route] = new this.Route (route);\r\n\t\t\tthis.sortedRoutes.push (route);\r\n\r\n\t\t\tthis.sortedRoutes.sort ((a, b) => {\r\n\t\t\t\treturn this.routes[a].routeRegex.length - this.routes[b].routeRegex.length;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (onUnroute !== null)\r\n\t\t{\r\n\t\t\tthis.routes[route].addHandler (onRoute, false);\r\n\t\t\tthis.routes[route].addHandler (onUnroute, true);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.routes[route].addHandler (onRoute, false);\r\n\r\n\t\treturn this.routes[route];\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the Route object for the specified route.\r\n\t*/\r\n\tgetRoute: function (route)\r\n\t{\r\n\t\tif (!this.routes[route])\r\n\t\t{\r\n\t\t\tthis.routes[route] = new this.Route (route);\r\n\t\t\tthis.sortedRoutes.push (route);\r\n\r\n\t\t\tthis.sortedRoutes.sort ((a, b) => {\r\n\t\t\t\treturn this.routes[a].routeRegex.length - this.routes[b].routeRegex.length;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.routes[route];\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds the specified routes to the routing map. The routes map should contain the route expression\r\n\t**\tin the key of the map and a handler function in the value.\r\n\t*/\r\n\taddRoutes: function (routes)\r\n\t{\r\n\t\tfor (var i in routes)\r\n\t\t{\r\n\t\t\tif (!this.routes[i])\r\n\t\t\t{\r\n\t\t\t\tthis.routes[i] = new this.Route (i);\r\n\t\t\t\tthis.sortedRoutes.push (i);\r\n\t\t\t}\r\n\r\n\t\t\tthis.routes[i].addHandler (routes[i], false);\r\n\t\t}\r\n\r\n\t\tthis.sortedRoutes.sort ((a, b) => {\r\n\t\t\treturn this.routes[a].routeRegex.length - this.routes[b].routeRegex.length;\r\n\t\t});\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified route from the routing map.\r\n\t*/\r\n\tremoveRoute: function (route, onRoute, onUnroute)\r\n\t{\r\n\t\tif (!this.routes[route]) return;\r\n\r\n\t\tif (onUnroute !== undefined)\r\n\t\t{\r\n\t\t\tthis.routes[route].removeHandler (onRoute, false);\r\n\t\t\tthis.routes[route].removeHandler (onUnroute, true);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.routes[route].removeHandler (onRoute);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified routes from the routing map. The routes map should contain the route\r\n\t**\texpression in the key of the map and a handler function in the value.\r\n\t*/\r\n\tremoveRoutes: function (routes)\r\n\t{\r\n\t\tfor (var i in routes)\r\n\t\t{\r\n\t\t\tif (!this.routes[i]) continue;\r\n\r\n\t\t\tthis.routes[i].removeHandler (routes[i]);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t**\tGiven a formatted location and a previous one it will return the correct real location.\r\n\t*/\r\n\trealLocation: function (cLocation, pLocation)\r\n\t{\r\n\t\tif (!pLocation) pLocation = this.location;\r\n\t\tif (!pLocation) pLocation = ' ';\r\n\r\n\t\tvar state = 0, i = 0, j = 0, k;\r\n\t\tvar rLocation = '';\r\n\r\n\t\twhile (state != -1 && i < cLocation.length && j < pLocation.length)\r\n\t\t{\r\n\t\t\tswitch (state)\r\n\t\t\t{\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (cLocation.substr(i++, 1) == '*')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstate = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (cLocation.substr(i-1, 1) != pLocation.substr(j++, 1))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trLocation += cLocation.substr(i-1);\r\n\t\t\t\t\t\tstate = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trLocation += pLocation.substr(j-1, 1);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tif (cLocation.substr(i, 1) == '*')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstate = 3;\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstate = 2;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tk = pLocation.indexOf(cLocation.substr(i, 1), j);\r\n\t\t\t\t\tif (k == -1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trLocation += pLocation.substr(j) + cLocation.substr(i);\r\n\t\t\t\t\t\tstate = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trLocation += pLocation.substr(j, k-j);\r\n\r\n\t\t\t\t\tstate = 0;\r\n\t\t\t\t\tj = k;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tk = pLocation.lastIndexOf(cLocation.substr(i, 1));\r\n\t\t\t\t\tif (k == -1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trLocation += cLocation.substr(i);\r\n\t\t\t\t\t\tstate = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trLocation += pLocation.substr(j, k-j);\r\n\r\n\t\t\t\t\tstate = 0;\r\n\t\t\t\t\tj = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state != -1)\r\n\t\t\trLocation += cLocation.substr(i);\r\n\r\n\t\treturn rLocation.trim();\r\n\t},\r\n\r\n\t/*\r\n\t**\tEvent handler called when the location hash changes.\r\n\t*/\r\n\tonLocationChanged: function ()\r\n\t{\r\n\t\tvar cLocation = location.hash.substr(1);\r\n\t\tvar rLocation = this.realLocation (cLocation);\r\n\r\n\t\tif (cLocation != rLocation)\r\n\t\t{\r\n\t\t\tglobalThis.location.replace('#' + rLocation);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.location = cLocation;\r\n\t\tthis.args = this.location.split ('/');\r\n\r\n\t\tif (this.ignoreHashChangeEvent > 0)\r\n\t\t{\r\n\t\t\tthis.ignoreHashChangeEvent--;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < this.sortedRoutes.length; i++)\r\n\t\t\tthis.routes[this.sortedRoutes[i]].dispatch (this.location);\r\n\t},\r\n\r\n\t/*\r\n\t**\tNavigates to the given hash-based URL.\r\n\t*/\r\n\tnavigate: function (location, replace=false)\r\n\t{\r\n\t\tlocation = this.realLocation(location);\r\n\r\n\t\tif (globalThis.location.hash == '#'+location)\r\n\t\t{\r\n\t\t\tthis.refresh();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (replace)\r\n\t\t\tglobalThis.location.replace('#'+location);\r\n\t\telse\r\n\t\t\tglobalThis.location.hash = location;\r\n\t}\r\n};\r\n\r\n_Router.init();\r\n\r\nexport default _Router;\r\n","/*\r\n**\triza/element\r\n**\r\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport { Rinn, Model, Template } from 'rinn';\r\nimport Router from './router.js';\r\n\r\n/**\r\n * \tMap containing the original prototypes for all registered elements.\r\n */\r\nconst elementPrototypes = { };\r\n\r\n/**\r\n * \tMap containing the final classes for all registered elements.\r\n */\r\nconst elementClasses = { };\r\n\r\n/**\r\n * \tBase class for custom elements. Provides support for model-triggered events, easy definition of handlers for events originated in\r\n * \tself or child-elements, and several utility methods.\r\n */\r\n\r\nconst Element = \r\n{\r\n\t/**\r\n\t * \tInternal element ID. Added as namespace to model events. Ensures that certain model events are run locally only, not affecting other event handlers.\r\n\t */\r\n\teid: null,\r\n\r\n\t/**\r\n\t * \tIndicates if the element is a root element, that is, the target element to attach child elements having `data-ref` attribute.\r\n\t */\r\n\tisRoot: true,\r\n\r\n\t/**\r\n\t * \tRoot element to which this element is attached (when applicable).\r\n\t */\r\n\troot: null,\r\n\r\n\t/**\r\n\t * \tIndicates ready-state of the element. Possible values are: 0: \"Not ready\", 1: \"Children Initialized\", and 2: \"Parent Ready\".\r\n\t */\r\n\tisReady: 0,\r\n\treadyReenter: 0,\r\n\treadyLocked: 0,\r\n\r\n\t/**\r\n\t * \tModel type (class) for the element's model.\r\n\t */\r\n\tmodelt: Model,\r\n\r\n\t/**\r\n\t * \tData model related to the element.\r\n\t */\r\n\tmodel: null,\r\n\r\n\t/**\r\n\t * \tEvents map.\r\n\t */\r\n\tevents:\r\n\t{\r\n\t\t'click [data-action]': function(evt)\r\n\t\t{\r\n\t\t\tlet opts = evt.source.dataset.action.split(' ');\r\n\r\n\t\t\tif (opts[0] in this)\r\n\t\t\t\tthis[opts[0]] ({ ...evt.params, ...evt.source.dataset, ...opts, length: opts.length }, evt);\r\n\t\t\telse\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t},\r\n\r\n\t\t'keyup(13) input[data-enter]': function(evt)\r\n\t\t{\r\n\t\t\tlet opts = evt.source.dataset.enter.split(' ');\r\n\r\n\t\t\tif (opts[0] in this)\r\n\t\t\t\tthis[opts[0]] ({ ...evt.params, ...evt.source.dataset, ...opts, length: opts.length }, evt);\r\n\t\t\telse\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Routes map.\r\n\t */\r\n\troutes: null,\r\n\r\n\t/**\r\n\t * \tElement constructor.\r\n\t */\r\n\t__ctor: function()\r\n\t{\r\n\t\tthis._list_watch = [];\r\n\t\tthis._list_visible = [];\r\n\t\tthis._list_property = [];\r\n\r\n\t\tif ('root' in this.dataset)\r\n\t\t{\r\n\t\t\tif (this.dataset.root == 'false')\r\n\t\t\t\tthis.isRoot = false;\r\n\t\t}\r\n\r\n\t\tthis.style.display = 'block';\r\n\r\n\t\tthis.eid = Math.random().toString().substr(2);\r\n\r\n\t\tif (this.model != null)\r\n\t\t{\r\n\t\t\tlet tmp = this.model;\r\n\t\t\tthis.model = null;\r\n\t\t\tthis.setModel (tmp, false);\r\n\t\t}\r\n\r\n\t\tObject.keys(this._super).reverse().forEach(i =>\r\n\t\t{\r\n\t\t\tif ('init' in this._super[i])\r\n\t\t\t\tthis._super[i].init();\r\n\t\t});\r\n\r\n\t\tif (Element.debug)\r\n\t\t\tconsole.log('>> ' + this.tagName + ' INIT ON ' + this.parentElement.tagName);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tif (this.events)\r\n\t\t\tthis.bindEvents (this.events);\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.tagName.toLowerCase() !== 'r-dom-probe')\r\n\t\t\t\tthis.appendChild(document.createElement('r-dom-probe'));\r\n\t\t\telse\r\n\t\t\t\tthis.markReady();\r\n\t\t}, 0);\r\n\t},\r\n\r\n\t/**\r\n\t * \tInitializes the element. Called after construction of the instance.\r\n\t */\r\n\tinit: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted when the children of the element are ready.\r\n\t */\r\n\tready: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted after ready and after the root is also ready.\r\n\t */\r\n\trready: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * \tMarks the element as ready.\r\n\t */\r\n\tmarkReady: function (list=null)\r\n\t{\r\n\t\tthis.readyLocked++;\r\n\r\n\t\tif (!this.isReady)\r\n\t\t{\r\n\t\t\tthis.isReady = 1;\r\n\r\n\t\t\t// Set model is `model` property was set in the element.\r\n\t\t\tif ('model' in this.dataset)\r\n\t\t\t{\r\n\t\t\t\tlet ref = this.getFieldByPath(this.dataset.model);\r\n\t\t\t\tif (ref) this.setModel(ref);\r\n\t\t\t}\r\n\r\n\t\t\t// Run ready methods in class hierarchy.\r\n\t\t\tObject.keys(this._super).reverse().forEach(i =>\r\n\t\t\t{\r\n\t\t\t\tif ('ready' in this._super[i])\r\n\t\t\t\t\tthis._super[i].ready();\r\n\t\t\t});\r\n\r\n\t\t\tif (Element.debug)\r\n\t\t\t\tconsole.log('>> ' + this.tagName + ' READY');\r\n\r\n\t\t\tthis.ready();\r\n\t\t\tthis.collectWatchers();\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.collectWatchers();\r\n\r\n\t\tlet root = this.findCustomParent(this);\r\n\r\n\t\tif (Element.debug)\r\n\t\t\tconsole.log(this.tagName + ' ROOT IS ' + (root ? root.tagName : 'NULL'));\r\n\r\n\t\tif (root && root.isReady === 0 && this.isReady != 0)\r\n\t\t\troot.checkReady();\r\n\r\n\t\tlet rootReady = false;\r\n\r\n\t\tif (root && root.isReady === 2 && this.isReady !== 2)\r\n\t\t{\r\n\t\t\tthis.getRoot();\r\n\r\n\t\t\tif (this.root && this.dataset.ref)\r\n\t\t\t{\r\n\t\t\t\tif (Element.debug)\r\n\t\t\t\t\tconsole.log(this.tagName + ' REF AS `' + this.dataset.ref + '` ON ' + this.root.tagName);\r\n\r\n\t\t\t\tthis.root[this.dataset.ref] = this;\r\n\t\t\t\tthis.root.onRefAdded (this.dataset.ref, this);\r\n\t\t\t}\r\n\r\n\t\t\trootReady = true;\r\n\t\t}\r\n\r\n\t\tif (!root && this.isReady !== 2)\r\n\t\t{\r\n\t\t\trootReady = true;\r\n\t\t}\r\n\r\n\t\tif (rootReady)\r\n\t\t{\r\n\t\t\tthis.isReady = 2;\r\n\r\n\t\t\tif (list !== null) {\r\n\t\t\t\tfor (let elem of list)\r\n\t\t\t\t\telem.checkReady();\r\n\t\t\t}\r\n\r\n\t\t\tif (Element.debug)\r\n\t\t\t\tconsole.log('>> ' + this.tagName + ' RREADY');\r\n\r\n\t\t\tObject.keys(this._super).reverse().forEach(i =>\r\n\t\t\t{\r\n\t\t\t\tif ('rready' in this._super[i])\r\n\t\t\t\t\tthis._super[i].rready();\r\n\t\t\t});\r\n\t\t\r\n\t\t\tthis.rready();\r\n\t\t}\r\n\r\n\t\tthis.readyLocked--;\r\n\r\n\t\tif (this.readyReenter && !this.readyLocked)\r\n\t\t{\r\n\t\t\tthis.readyReenter = false;\r\n\t\t\tthis.checkReady();\r\n\t\t}\r\n\r\n\t\tif (this.tagName.toLowerCase() === 'r-dom-probe')\r\n\t\t\tthis.remove();\r\n\t},\r\n\r\n\t/**\r\n\t *\tChecks if all children are ready and fires the appropriate function (`ready` and/or `rready`).\r\n\t */\r\n\tcheckReady: function()\r\n\t{\r\n\t\tif (this.childNodes.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\tif (this.readyLocked)\r\n\t\t{\r\n\t\t\tthis.readyReenter = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet isReady = true;\r\n\t\tlet list = [];\r\n\r\n\t\tlet result = document.evaluate(\".//*[contains(name(),'-')]\", this, null, XPathResult.ANY_TYPE, null);\r\n\r\n\t\tif (Element.debug)\r\n\t\t\tconsole.log('# CHECKING ' + this.tagName);\r\n\r\n\t\twhile (true)\r\n\t\t{\r\n\t\t\tlet elem = result.iterateNext();\r\n\t\t\tif (!elem) break;\r\n\r\n\t\t\tif (elem === this)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tlet root = this.findCustomParent(elem);\r\n\t\t\tif (root !== this) continue;\r\n\r\n\t\t\tif (Element.debug)\r\n\t\t\t\tconsole.log('   ' + elem.tagName + ' = ' + elem.isReady);\r\n\r\n\t\t\tif (!elem.isReady)\r\n\t\t\t\tisReady = false;\r\n\r\n\t\t\tlist.push(elem);\r\n\t\t}\r\n\r\n\t\tif (!isReady) return;\r\n\r\n\t\tthis.markReady(list);\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the value of a field given its path. Starts from `global`, unless the first item in the path is `this`, in which case it will start from the element.\r\n\t */\r\n\tgetFieldByPath: function(path)\r\n\t{\r\n\t\tif (!path) return null;\r\n\r\n\t\tlet tmp = path.split('.');\r\n\t\tlet ref = global;\r\n\r\n\t\tif (tmp.length && tmp[0] == 'this')\r\n\t\t{\r\n\t\t\tref = this;\r\n\t\t\ttmp.shift();\r\n\t\t}\r\n\r\n\t\tif (tmp.length && tmp[0] == 'root')\r\n\t\t{\r\n\t\t\tref = this.getRoot();\r\n\t\t\ttmp.shift();\r\n\t\t}\r\n\r\n\t\twhile (ref != null && tmp.length != 0)\r\n\t\t\tref = ref[tmp.shift()];\r\n\r\n\t\treturn ref;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the root of the element (that is, the `root` property). If not set it will attempt to find the root first.\r\n\t */\r\n\tgetRoot: function()\r\n\t{\r\n\t\treturn this.root ? this.root : (this.root = this.findRoot());\r\n\t},\r\n\r\n\t/**\r\n\t * \tSets the model of the element and executes the `modelChanged` event handler (unless `update` is set to false).\r\n\t */\r\n\tsetModel: function (model, update=true)\r\n\t{\r\n\t\tif (!model) return this;\r\n\r\n\t\tmodel = Rinn.ensureTypeOf(this.modelt, model);\r\n\r\n\t\tif (this.model !== model)\r\n\t\t{\r\n\t\t\tif (this.model != null)\r\n\t\t\t{\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':modelChanged', this.onModelPreChanged, this);\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':propertyChanging', this.onModelPropertyChanging, this);\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':propertyChanged', this.onModelPropertyPreChanged, this);\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':propertyRemoved', this.onModelPropertyRemoved, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis.model = model;\r\n\r\n\t\t\tthis.model.addEventListener (this.eid+':modelChanged', this.onModelPreChanged, this);\r\n\t\t\tthis.model.addEventListener (this.eid+':propertyChanging', this.onModelPropertyChanging, this);\r\n\t\t\tthis.model.addEventListener (this.eid+':propertyChanged', this.onModelPropertyPreChanged, this);\r\n\t\t\tthis.model.addEventListener (this.eid+':propertyRemoved', this.onModelPropertyRemoved, this);\r\n\t\t}\r\n\r\n\t\tif (update !== false)\r\n\t\t\tthis.model.setNamespace(this.eid).update(true).setNamespace(null);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the model of the element. Added for symmetry only, exactly the same as accesing public property `model` of this class.\r\n\t */\r\n\tgetModel: function ()\r\n\t{\r\n\t\treturn this.model;\r\n\t},\r\n\r\n\t/**\r\n\t * \tAdds one or more CSS classes (separated by space) to the element.\r\n\t */\r\n\taddClass: function (classString)\r\n\t{\r\n\t\tif (!classString) return this;\r\n\r\n\t\tclassString.split(' ').forEach(i =>\r\n\t\t{\r\n\t\t\ti = i.trim();\r\n\t\t\tif (!i) return;\r\n\r\n\t\t\tif (i[0] == '-' || i[0] == '+')\r\n\t\t\t\tthis.classList[i[0] == '-' ? 'remove' : 'add'](i.substr(1));\r\n\t\t\telse\r\n\t\t\t\tthis.classList.add(i);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tRemoves one or more CSS classes (separated by space) from the element.\r\n\t */\r\n\tremoveClass: function (classString)\r\n\t{\r\n\t\tif (!classString) return this;\r\n\r\n\t\tclassString.split(' ').forEach(i =>\r\n\t\t{\r\n\t\t\ti = i.trim();\r\n\t\t\tif (!i) return;\r\n\r\n\t\t\tif (i[0] == '-' || i[0] == '+')\r\n\t\t\t\tthis.classList[i[0] == '-' ? 'remove' : 'add'](i.substr(1));\r\n\t\t\telse\r\n\t\t\t\tthis.classList.remove(i);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tSets one or more style properties to the element (separated by semi-colon).\r\n\t */\r\n\tsetStyle: function (styleString)\r\n\t{\r\n\t\tif (!styleString) return this;\r\n\r\n\t\tstyleString.split(';').forEach(i => {\r\n\t\t\tlet j = (i = i.trim()).indexOf(':');\r\n\t\t\tif (j == -1) return;\r\n\r\n\t\t\tlet name = i.substr(0, j).trim();\r\n\t\t\tfor (let k = name.indexOf('-'); k != -1; k = name.indexOf('-')) {\r\n\t\t\t\tname = name.substr(0, k) + name.substr(k+1, 1).toUpperCase() + name.substr(k+2);\r\n\t\t\t}\r\n\r\n\t\t\tthis.style[name] = i.substr(j+1).trim();\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the width of the specified element (or of itself it none provided), uses `getBoundingClientRect`.\r\n\t */\r\n\tgetWidth: function (elem=null)\r\n\t{\r\n\t\treturn (elem || this).getBoundingClientRect().width;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the height of the specified element (or of itself it none provided), uses `getBoundingClientRect`.\r\n\t */\r\n\tgetHeight: function (elem=null)\r\n\t{\r\n\t\treturn (elem || this).getBoundingClientRect().height;\r\n\t},\r\n\r\n\t/**\r\n\t**\tBinds all events in the specified map to the element, the events map can have one of the following forms:\r\n\t**\r\n\t**\t\t\"click .button\": \"doSomething\",\t\t(Delegated Event)\r\n\t**\t\t\"click .button\": function() { },\t(Delegated Event)\r\n\t**\t\t\"myevt &this\": \"...\",\t\t\t\t(Self Event)\r\n\t**\t\t\"myevt\": \"...\",\t\t\t\t\t\t(Element Event)\r\n\t**\t\t\"myevt @objName\": \"...\",\t\t\t(EventDispatcher Event)\r\n\t**\t\t\"#propname\": \"...\",\t\t\t\t\t(Property Changed Event)\r\n\t**\t\t\"keyup(10) .input\": \"...\"\t\t\t(Delegated Event with Parameters)\r\n\t**\r\n\t**\t>> Element bindEvents (object events);\r\n\t*/\r\n\tbindEvents: function (events)\r\n\t{\r\n\t\tfor (let evtstr in events)\r\n\t\t{\r\n\t\t\tlet hdl = events[evtstr];\r\n\r\n\t\t\tif (Rinn.typeOf(hdl) == 'string')\r\n\t\t\t\thdl = this[hdl];\r\n\r\n\t\t\thdl = hdl.bind(this);\r\n\r\n\t\t\tvar i = evtstr.indexOf(' ');\r\n\r\n\t\t\tvar name = i == -1 ? evtstr : evtstr.substr(0, i);\r\n\t\t\tvar selector = i == -1 ? '' : evtstr.substr(i + 1);\r\n\r\n\t\t\tlet args = null;\r\n\r\n\t\t\tvar j = name.indexOf('(');\r\n\t\t\tif (j != -1)\r\n\t\t\t{\r\n\t\t\t\targs = name.substr(j+1, name.length-j-2).split(',');\r\n\t\t\t\tname = name.substr(0, j);\r\n\t\t\t}\r\n\r\n\t\t\tif (selector[0] == '@')\r\n\t\t\t{\r\n\t\t\t\tif (selector != '@this')\r\n\t\t\t\t{\r\n\t\t\t\t\tthis[selector.substr(1)].addEventListener(name, hdl);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselector = this;\r\n\t\t\t}\r\n\t\t\telse if (selector[0] == '&')\r\n\t\t\t{\r\n\t\t\t\tif (selector != '&this')\r\n\t\t\t\t\tselector = \"[data-ref='\"+selector.substr(1)+\"']\";\r\n\t\t\t\telse\r\n\t\t\t\t\tselector = this;\r\n\t\t\t}\r\n\r\n\t\t\tif (name.substr(0, 1) == '#')\r\n\t\t\t{\r\n\t\t\t\tthis.listen('propertyChanged.'+name.substr(1), this, hdl);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (args != null)\r\n\t\t\t{\r\n\t\t\t\tswitch (name)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'keyup': case 'keydown':\r\n\t\t\t\t\t\tthis.listen (name, selector, function (evt)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (Rinn.indexOf(args, evt.keyCode.toString()) != -1)\r\n\t\t\t\t\t\t\t\treturn hdl (evt, args);\r\n\r\n\t\t\t\t\t\t\tevt.continuePropagation = true;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.listen (name, selector, hdl);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tBinds all routes in the specified map to the Router object.\r\n\t**\r\n\t**\t\t\"route-path\": \"doSomething\"\t\t\t\t\t\tOn-Route\r\n\t**\t\t\"route-path\": function (evt, args) { }\t\t\tOn-Route\r\n\t**\t\t\"!route-path\": \"doSomething\"\t\t\t\t\tOn-UnRoute\r\n\t**\t\t\"!route-path\": function (evt, args) { }\t\t\tOn-UnRoute\r\n\t**\r\n\t**\t>> Element bindRoutes ();\r\n\t*/\r\n\tbindRoutes: function ()\r\n\t{\r\n\t\tif (!this.routes)\r\n\t\t\treturn;\r\n\r\n\t\tfor (let routeStr in this.routes)\r\n\t\t{\r\n\t\t\tlet route = routeStr[0] === '!' ? Router.getRoute(routeStr.substr(1)) : Router.getRoute(routeStr);\r\n\t\t\tlet handler = this.routes[routeStr];\r\n\r\n\t\t\tif (Rinn.typeOf(handler) == 'string')\r\n\t\t\t\thandler = this[handler];\r\n\r\n\t\t\tif (routeStr[0] === '!')\r\n\t\t\t\troute.addHandler(handler, true, this);\r\n\t\t\telse\r\n\t\t\t\troute.addHandler(handler, false, this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Unbinds all routes added by bindRoutes.\r\n\t */\r\n\tunbindRoutes: function (routes)\r\n\t{\r\n\t\tfor (let routeStr in routes)\r\n\t\t{\r\n\t\t\tlet route = routeStr[0] === '!' ? Router.getRoute(routeStr.substr(1)) : Router.getRoute(routeStr);\r\n\t\t\tlet handler = routes[routeStr];\r\n\r\n\t\t\tif (Rinn.typeOf(handler) == 'string')\r\n\t\t\t\thandler = this[handler];\r\n\r\n\t\t\tif (routeStr[0] === '!')\r\n\t\t\t\troute.removeHandler(handler, true, this);\r\n\t\t\telse\r\n\t\t\t\troute.removeHandler(handler, false, this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecutes the underlying event handler given an event and a selector. Called internally by listen().\r\n\t**\r\n\t**\t>> void _eventHandler (event evt, string selector, function handler);\r\n\t*/\r\n\t_eventHandler: function (evt, selector, handler)\r\n\t{\r\n\t\tif (evt.continuePropagation === false)\r\n\t\t\treturn;\r\n\r\n\t\tevt.continuePropagation = true;\r\n\t\tevt.source = evt.target;\r\n\r\n\t\tif (selector && selector instanceof HTMLElement)\r\n\t\t{\r\n\t\t\tif (evt.source === selector)\r\n\t\t\t{\r\n\t\t\t\tevt.continuePropagation = false;\r\n\r\n\t\t\t\tif (handler.call (this, evt, evt.detail) === true)\r\n\t\t\t\t\tevt.continuePropagation = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (selector && selector != '*')\r\n\t\t{\r\n\t\t\tlet elems = this.querySelectorAll(selector);\r\n\r\n\t\t\twhile (evt.source !== this)\r\n\t\t\t{\r\n\t\t\t\tlet i = Rinn.indexOf (elems, evt.source, true);\r\n\t\t\t\tif (i !== -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tevt.continuePropagation = false;\r\n\r\n\t\t\t\t\tif (handler.call (this, evt, evt.detail) === true)\r\n\t\t\t\t\t\tevt.continuePropagation = true;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tevt.source = evt.source.parentElement;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tevt.continuePropagation = false;\r\n\r\n\t\t\tif (handler.call (this, evt, evt.detail) === true)\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t}\r\n\r\n\t\tif (evt.continuePropagation === false)\r\n\t\t{\r\n\t\t\tevt.preventDefault();\r\n\t\t\tevt.stopPropagation();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\tListens for an event on elements matching the specified selector, returns an object with a single method `remove` used\r\n\t**\tto remove the listener when it is no longer needed.\r\n\t**\r\n\t**\t>> object listen (string eventName, string selector, function handler);\r\n\t**\t>> object listen (string eventName, function handler);\r\n\t*/\r\n\tlisten: function (eventName, selector, handler)\r\n\t{\r\n\t\tlet eventCatcher = false;\r\n\t\tlet eventImmediate = false;\r\n\r\n\t\tif (Rinn.typeOf(selector) == 'function')\r\n\t\t{\r\n\t\t\thandler = selector;\r\n\t\t\tselector = null;\r\n\t\t}\r\n\r\n\t\tif (eventName[eventName.length-1] == '!')\r\n\t\t{\r\n\t\t\teventName = eventName.substr(0, eventName.length-1);\r\n\t\t\teventCatcher = true;\r\n\t\t}\r\n\r\n\t\tif (eventName[0] == '!')\r\n\t\t{\r\n\t\t\teventName = eventName.substr(1);\r\n\t\t\teventImmediate = true;\r\n\t\t}\r\n\r\n\t\tlet callback0 = null;\r\n\t\tlet callback1 = null;\r\n\t\tlet self = this;\r\n\r\n\t\tthis.addEventListener (eventName, callback0 = (evt) =>\r\n\t\t{\r\n\t\t\tif (evt.continuePropagation === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!evt.firstCapture)\r\n\t\t\t{\r\n\t\t\t\tevt.firstCapture = this;\r\n\t\t\t\tevt.firstCaptureCount = 0;\r\n\t\t\t\tevt.queue = [];\r\n\t\t\t}\r\n\r\n\t\t\tif (evt.firstCapture === this)\r\n\t\t\t\tevt.firstCaptureCount++;\r\n\r\n\t\t\tif (eventCatcher == true)\r\n\t\t\t\tevt.queue.push([this, selector, handler]);\r\n\r\n\t\t\tif (eventImmediate == true)\r\n\t\t\t\tthis._eventHandler(evt, selector, handler);\r\n\t\t},\r\n\t\ttrue);\r\n\r\n\t\tthis.addEventListener (eventName, callback1 = (evt) =>\r\n\t\t{\r\n\t\t\tif (evt.continuePropagation === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (eventCatcher != true && eventImmediate != true)\r\n\t\t\t\tthis._eventHandler(evt, selector, handler);\r\n\r\n\t\t\tif (evt.firstCapture === this && evt.continuePropagation !== false)\r\n\t\t\t{\r\n\t\t\t\tif (--evt.firstCaptureCount == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\twhile (evt.queue.length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet q = evt.queue.pop();\r\n\t\t\t\t\t\tq[0]._eventHandler(evt, q[1], q[2]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tevt.continuePropagation = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfalse);\r\n\r\n\t\treturn {\r\n\t\t\tremoved: false,\r\n\t\t\tremove: function() {\r\n\t\t\t\tif (this.removed) return;\r\n\t\t\t\tthis.removed = true;\r\n\t\t\t\tself.removeEventListener(eventName, callback0, true);\r\n\t\t\t\tself.removeEventListener(eventName, callback1, false);\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t**\tCreates an event object for later dispatch.\r\n\t*/\r\n\tcreateEventObject: function(eventName, args, bubbles)\r\n\t{\r\n\t\tlet evt;\r\n\r\n\t\tif (eventName == 'click')\r\n\t\t\tevt = new MouseEvent(eventName, { bubbles: bubbles, detail: args });\r\n\t\telse\r\n\t\t\tevt = new CustomEvent (eventName, { bubbles: bubbles, detail: args });\r\n\r\n\t\treturn evt;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches a new event with the specified name and the given arguments.\r\n\t*/\r\n\tdispatch: function (eventName, args=null, bubbles=true)\r\n\t{\r\n\t\tthis.dispatchEvent (this.createEventObject(eventName, args, bubbles));\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches a new event on the specified element with the given name and arguments (uses `CustomEvent`).\r\n\t*/\r\n\tdispatchOn: function (elem, eventName, args=null, bubbles=true)\r\n\t{\r\n\t\telem.dispatchEvent (this.createEventObject(eventName, args, bubbles));\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the innerHTML property of the element and runs some post set-content tasks.\r\n\t**\r\n\t**\t>> void setInnerHTML (value);\r\n\t*/\r\n\tsetInnerHTML: function (value)\r\n\t{\r\n\t\tthis.readyLocked++;\r\n\t\tthis.innerHTML = value;\r\n\t\tthis.readyLocked--;\r\n\t},\r\n\r\n\t/**\r\n\t**\tCollects all watchers (data-watch, data-visible, data-property), that depend on the model, should be invoked when the structure\r\n\t**\tof the element changed (added/removed children). This is automatically called when the setInnerHTML method is called.\r\n\t**\r\n\t**\tNote that for 3rd party libs that add children to this element (which could probably have a watcher) will possibly result in\r\n\t**\tduplication of the added elements when compiling the innerHTML template. To prevent this add the 'pseudo' CSS class to any\r\n\t**\telement that should not be added to the HTML template.\r\n\t**\r\n\t**\t>> void collectWatchers ();\r\n\t*/\r\n\tcollectWatchers: function ()\r\n\t{\r\n\t\tlet self = this;\r\n\t\tlet modified = false;\r\n\t\tlet list;\r\n\r\n\t\tif (!this.isRoot) return;\r\n\r\n\t\tlet _list_watch_length = this._list_watch.length;\r\n\t\tlet _list_visible_length = this._list_visible.length;\r\n\t\tlet _list_property_length = this._list_property.length;\r\n\r\n\t\t/* *** */\r\n\t\tlist = this.querySelectorAll('[data-watch]');\r\n\t\tfor (let i = 0; i < list.length; i++)\r\n\t\t{\r\n\t\t\tfor (let j of list[i].querySelectorAll('.pseudo'))\r\n\t\t\t\tj.remove();\r\n\r\n\t\t\tlist[i]._template = Template.compile(list[i].innerHTML);\r\n\t\t\tlist[i]._watch = new RegExp('^(' + list[i].dataset.watch + ')$');\r\n\t\t\tlist[i].innerHTML = '';\r\n\r\n\t\t\tlist[i].removeAttribute('data-watch');\r\n\t\t\tthis._list_watch.push(list[i]);\r\n\t\t}\r\n\r\n\t\tif ('selfWatch' in this.dataset)\r\n\t\t{\r\n\t\t\tfor (let j of this.querySelectorAll('.pseudo'))\r\n\t\t\t\tj.remove();\r\n\r\n\t\t\tthis._template = Template.compile(this.innerHTML);\r\n\t\t\tthis._watch = new RegExp('^(' + this.dataset.selfWatch + ')$');\r\n\t\t\tthis.innerHTML = '';\r\n\r\n\t\t\tthis.removeAttribute('data-self-watch');\r\n\t\t\tthis._list_watch.push(this);\r\n\t\t}\r\n\r\n\t\t/* *** */\r\n\t\tlist = this.querySelectorAll('[data-visible]');\r\n\t\tfor (let i = 0; i < list.length; i++)\r\n\t\t{\r\n\t\t\tlist[i]._visible = Template.compile(list[i].dataset.visible);\r\n\r\n\t\t\tlist[i].removeAttribute('data-visible');\r\n\t\t\tthis._list_visible.push(list[i]);\r\n\t\t}\r\n\r\n\t\tif ('selfVisible' in this.dataset)\r\n\t\t{\r\n\t\t\tthis._visible = Template.compile(this.dataset.selfVisible);\r\n\r\n\t\t\tthis.removeAttribute('data-self-visible');\r\n\t\t\tthis._list_visible.push(this);\r\n\t\t}\r\n\r\n\t\t/* *** */\r\n\t\tlist = this.querySelectorAll('[data-property]');\r\n\t\tfor (let i = 0; i < list.length; i++)\r\n\t\t{\r\n\t\t\tlist[i].onchange = list[i].onblur = function()\r\n\t\t\t{\r\n\t\t\t\tswitch (this.type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (this.checked) self.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.checked ? '1' : '0');\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'field':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.getValue());\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (list[i].tagName == 'SELECT')\r\n\t\t\t{\r\n\t\t\t\tlist[i].onmouseup = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tlist[i].name = list[i].dataset.property;\r\n\r\n\t\t\tlist[i].removeAttribute('data-property');\r\n\t\t\tthis._list_property.push(list[i]);\r\n\t\t}\r\n\r\n\t\tif ('selfProperty' in this.dataset)\r\n\t\t{\r\n\t\t\tthis.onchange = this.onblur = function()\r\n\t\t\t{\r\n\t\t\t\tswitch (this.type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (this.checked) self.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.checked ? '1' : '0');\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'field':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.getValue());\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (this.tagName == 'SELECT')\r\n\t\t\t{\r\n\t\t\t\tthis.onmouseup = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tthis.name = this.dataset.selfProperty;\r\n\r\n\t\t\tthis.removeAttribute('data-self-property');\r\n\t\t\tthis._list_property.push(this);\r\n\t\t}\r\n\r\n\t\t/* *** */\r\n\t\tthis._list_watch = this._list_watch.filter(i => i.parentElement != null);\r\n\t\tif (_list_watch_length != this._list_watch.length) modified = true;\r\n\r\n\t\tthis._list_visible = this._list_visible.filter(i => i.parentElement != null);\r\n\t\tif (_list_visible_length != this._list_visible.length) modified = true;\r\n\r\n\t\tthis._list_property = this._list_property.filter(i => i.parentElement != null);\r\n\t\tif (_list_property_length != this._list_property.length) modified = true;\r\n\r\n\t\tif (this.model != null && modified)\r\n\t\t\tthis.model.setNamespace(this.eid).update(true).setNamespace(null);\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted when the element is created and yet not attached to the DOM tree.\r\n\t*/\r\n\tonCreated: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * Executed when the element is attached to the DOM tree.\r\n\t */\r\n\telementConnected: function()\r\n\t{\r\n\t\tthis.bindRoutes();\r\n\t\tthis.onConnected();\r\n\t},\r\n\r\n\t/**\r\n\t * Executed when the element is no longer a part of the DOM tree.\r\n\t */\r\n\telementDisconnected: function()\r\n\t{\r\n\t\tthis.unbindRoutes();\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted when the element is attached to the DOM tree.\r\n\t*/\r\n\tonConnected: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted when the element is no longer a part of the DOM tree.\r\n\t*/\r\n\tonDisconnected: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted on the root element when a child element has `data-ref` attribute and it was added to it.\r\n\t*/\r\n\tonRefAdded: function (name, element)\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted on the root element when a child element has `data-ref` attribute and it was removed from it.\r\n\t*/\r\n\tonRefRemoved: function (name, element)\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when the model has changed, executed before onModelChanged() to update internal dependencies,\r\n\t**\tshould not be overriden or elements watching the model will not be updated.\r\n\t**\r\n\t**\t>> void onModelPreChanged (evt, args);\r\n\t*/\r\n\tonModelPreChanged: function (evt, args)\r\n\t{\r\n\t\tlet data = this.getModel().get();\r\n\r\n\t\tfor (let i = 0; i < this._list_watch.length; i++)\r\n\t\t{\r\n\t\t\tfor (let j of args.fields)\r\n\t\t\t{\r\n\t\t\t\tif (!this._list_watch[i]._watch.test(j))\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tthis._list_watch[i].innerHTML = this._list_watch[i]._template(data);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this._list_visible.length; i++)\r\n\t\t{\r\n\t\t\tif (!!this._list_visible[i]._visible(data, 'arg'))\r\n\t\t\t\tthis._list_visible[i].style.removeProperty('display');\r\n\t\t\telse\r\n\t\t\t\tthis._list_visible[i].style.setProperty('display', 'none', 'important');\r\n\t\t}\r\n\r\n\t\tthis.onModelChanged(evt, args);\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when the model has changed.\r\n\t*/\r\n\tonModelChanged: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model is changing. Fields `name` and `value` can be found in the `args` object.\r\n\t*/\r\n\tonModelPropertyChanging: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model has changed, executed before onModelPropertyChanged() to update internal\r\n\t**\tdependencies. Automatically triggers internal events named `propertyChanged.<propertyName>` and `propertyChanged`.\r\n\t**\tShould not be overriden or elements depending on the property will not be updated.\r\n\t*/\r\n\tonModelPropertyPreChanged: function (evt, args)\r\n\t{\r\n\t\tfor (let i = 0; i < this._list_property.length; i++)\r\n\t\t{\r\n\t\t\tif (this._list_property[i].name == args.name)\r\n\t\t\t{\r\n\t\t\t\tlet trigger = true;\r\n\r\n\t\t\t\tswitch (this._list_property[i].type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (this._list_property[i].value != args.value)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._list_property[i].parentElement.classList.remove('active');\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis._list_property[i].checked = true;\r\n\t\t\t\t\t\tthis._list_property[i].parentElement.classList.add('active');\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\tif (~~args.value)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._list_property[i].checked = true;\r\n\t\t\t\t\t\t\tthis._list_property[i].parentElement.classList.add('active');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._list_property[i].checked = false;\r\n\t\t\t\t\t\t\tthis._list_property[i].parentElement.classList.remove('active');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'field':\r\n\t\t\t\t\t\tthis._list_property[i].val = this._list_property[i].dataset.value = args.value;\t\r\n\t\t\t\t\t\tthis._list_property[i].setValue (args.value);\r\n\t\t\t\t\t\ttrigger = false;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis._list_property[i].value = args.value;\r\n\t\t\t\t\t\tthis._list_property[i].val = this._list_property[i].dataset.value = args.value;\t\r\n\r\n\t\t\t\t\t\tif (this._list_property[i].value != args.value)\r\n\t\t\t\t\t\t\ttrigger = false;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (trigger && this._list_property[i].onchange)\r\n\t\t\t\t\tthis._list_property[i].onchange();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.dispatch ('propertyChanged.' + args.name, args, false);\r\n\t\tthis.dispatch ('propertyChanged', args, false);\r\n\r\n\t\tthis.onModelPropertyChanged(evt, args);\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model has changed.\r\n\t*/\r\n\tonModelPropertyChanged: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model is removed. Field `name` can be found in the `args` object.\r\n\t*/\r\n\tonModelPropertyRemoved: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the following preparation procedures on the specified prototype:\r\n\t**\t\t- All functions named 'event <event-name> [event-selector]' will be moved to the 'events' map.\r\n\t**\t\t- All functions named 'route <route-path>' will be moved to the 'routes' map.\r\n\t**\r\n\t**\t>> void preparePrototype (object proto);\r\n\t*/\r\n\tpreparePrototype: function (proto)\r\n\t{\r\n\t\tif (proto.__prototypePrepared === true)\r\n\t\t\treturn;\r\n\r\n\t\tproto.__prototypePrepared = true;\r\n\r\n\t\tif (!proto.hasOwnProperty('events') || !proto.events)\r\n\t\t\tproto.events = { };\r\n\r\n\t\tif (!proto.hasOwnProperty('routes') || !proto.routes)\r\n\t\t\tproto.routes = { };\r\n\r\n\t\tfor (let i in proto)\r\n\t\t{\r\n\t\t\tif (i.startsWith('event '))\r\n\t\t\t{\r\n\t\t\t\tproto.events[i.substr(6)] = proto[i];\r\n\t\t\t\tdelete proto[i];\r\n\t\t\t}\r\n\t\t\telse if (i.startsWith('route '))\r\n\t\t\t{\r\n\t\t\t\tproto.routes[i.substr(6)] = proto[i];\r\n\t\t\t\tdelete proto[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t**\tRegisters a new custom element with the specified name. Extra functionality can be added with one or more prototypes, by default\r\n\t**\tall elements also get the `Element` prototype. Note that the final prototypes of all registered elements are stored, and if you want\r\n\t**\tto inherit another element's prototype just provide its name (string) in the protos argument list.\r\n\t**\r\n\t**\t>> class register (string name, ...(object|string) protos);\r\n\t*/\r\n\tregister: function (name, ...protos)\r\n\t{\r\n\t\tconst newElement = class extends HTMLElement\r\n\t\t{\r\n\t\t\tconstructor()\r\n\t\t\t{\r\n\t\t\t\tsuper();\r\n\t\t\t\tthis.invokeConstructor = true;\r\n\r\n\t\t\t\tif (Element.debug)\r\n\t\t\t\t\tconsole.log('CREATED ' + this.tagName);\r\n\r\n\t\t\t\tthis._super = { };\r\n\r\n\t\t\t\tfor (let i of Object.entries(this.constructor.prototype._super))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._super[i[0]] = { };\r\n\r\n\t\t\t\t\tfor (let j of Object.entries(i[1])) {\r\n\t\t\t\t\t\tthis._super[i[0]][j[0]] = j[1].bind(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.onCreated();\r\n\t\t\t}\r\n\r\n\t\t\tfindRoot (srcElement)\r\n\t\t\t{\r\n\t\t\t\tlet elem = srcElement ? srcElement : this.parentElement;\r\n\r\n\t\t\t\twhile (elem != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ('isRoot' in elem && elem.isRoot === true)\r\n\t\t\t\t\t\treturn elem;\r\n\r\n\t\t\t\t\telem = elem.parentElement;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfindCustomParent (srcElement)\r\n\t\t\t{\r\n\t\t\t\tlet elem = srcElement ? srcElement.parentElement : this.parentElement;\r\n\r\n\t\t\t\twhile (elem != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (elem.tagName.indexOf('-') !== -1)\r\n\t\t\t\t\t\treturn elem;\r\n\r\n\t\t\t\t\telem = elem.parentElement;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconnectReference (root=null, flags=255)\r\n\t\t\t{\r\n\t\t\t\tif (!this.root && (flags & 1) == 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (root == null) root = this.findRoot();\r\n\t\t\t\t\tif (root != null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.dataset.ref)\r\n\t\t\t\t\t\t\troot[this.dataset.ref] = this;\r\n\r\n\t\t\t\t\t\tthis.root = root;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconnectedCallback ()\r\n\t\t\t{\r\n\t\t\t\tthis.connectReference(null, 1);\r\n\r\n\t\t\t\tif (this.invokeConstructor)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.invokeConstructor = false;\r\n\t\t\t\t\tthis.__ctor();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.connectReference(null, 2);\r\n\t\t\t\tthis.elementConnected();\r\n\r\n\t\t\t\tif (this.dataset.xref)\r\n\t\t\t\t\tglobalThis[this.dataset.xref] = this;\r\n\t\t\t}\r\n\r\n\t\t\tdisconnectedCallback()\r\n\t\t\t{\r\n\t\t\t\tif (this.root)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.dataset.ref)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.root.onRefRemoved (this.dataset.ref, this);\r\n\r\n\t\t\t\t\t\tdelete this.root[this.dataset.ref];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.root = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.elementDisconnected();\r\n\r\n\t\t\t\tif (this.dataset.xref)\r\n\t\t\t\t\tdelete globalThis[this.dataset.xref];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tRinn.override (newElement.prototype, Element);\r\n\r\n\t\tconst proto = { };\r\n\t\tconst _super = { };\r\n\t\tconst events = Rinn.clone(Element.events);\r\n\r\n\t\tlet __init = true;\r\n\t\tlet __ready = true;\r\n\t\tlet __rready = true;\r\n\t\tlet __check;\r\n\r\n\t\tfor (let i = 0; i < protos.length; i++)\r\n\t\t{\r\n\t\t\tif (!protos[i]) continue;\r\n\r\n\t\t\tif (Rinn.typeOf(protos[i]) == 'string')\r\n\t\t\t{\r\n\t\t\t\tconst name = protos[i];\r\n\r\n\t\t\t\tprotos[i] = elementPrototypes[name];\r\n\t\t\t\tif (!protos[i]) continue;\r\n\r\n\t\t\t\t_super[name] = { };\r\n\r\n\t\t\t\tfor (let f in protos[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tif (Rinn.typeOf(protos[i][f]) != 'function')\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t_super[name][f] = protos[i][f];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t__init = false;\r\n\t\t\t\t__ready = false;\r\n\t\t\t\t__rready = false;\r\n\t\t\t\t__check = false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tElement.preparePrototype(protos[i]);\r\n\t\t\t\t__check = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ('_super' in protos[i])\r\n\t\t\t\tRinn.override (_super, protos[i]._super);\r\n\r\n\t\t\tif ('events' in protos[i])\r\n\t\t\t\tRinn.override (events, protos[i].events);\r\n\r\n\t\t\tRinn.override (newElement.prototype, protos[i]);\r\n\t\t\tRinn.override (proto, protos[i]);\r\n\r\n\t\t\tif (__check)\r\n\t\t\t{\r\n\t\t\t\tif (!__init && 'init' in protos[i]) __init = true;\r\n\t\t\t\tif (!__ready && 'ready' in protos[i]) __ready = true;\r\n\t\t\t\tif (!__rready && 'rready' in protos[i]) __rready = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet dummy = function(){};\r\n\r\n\t\tif (!__init)\r\n\t\t{\r\n\t\t\tnewElement.prototype.init = dummy;\r\n\t\t\tproto.init = dummy;\r\n\t\t}\r\n\r\n\t\tif (!__ready)\r\n\t\t{\r\n\t\t\tnewElement.prototype.ready = dummy;\r\n\t\t\tproto.ready = dummy;\r\n\t\t}\r\n\r\n\t\tif (!__rready)\r\n\t\t{\r\n\t\t\tnewElement.prototype.rready = dummy;\r\n\t\t\tproto.rready = dummy;\r\n\t\t}\r\n\r\n\t\tnewElement.prototype._super = _super;\r\n\t\tnewElement.prototype.events = events;\r\n\r\n\t\tproto._super = _super;\r\n\t\tproto.events = events;\r\n\r\n\t\tcustomElements.define (name, newElement);\r\n\r\n\t\telementPrototypes[name] = proto;\r\n\t\telementClasses[name] = newElement;\r\n\r\n\t\treturn newElement;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExpands an already created custom element with the specified prototype(s).\r\n\t**\r\n\t**\t>> void expand (string elementName, ...object protos);\r\n\t*/\r\n\texpand: function (name, ...protos)\r\n\t{\r\n\t\tif (!(name in elementPrototypes))\r\n\t\t\treturn;\r\n\r\n\t\tconst self = elementPrototypes[name];\r\n\t\tconst elem = elementClasses[name];\r\n\r\n\t\tconst _super = self._super;\r\n\t\tconst events = self.events;\r\n\r\n\t\tfor (let proto of protos)\r\n\t\t{\r\n\t\t\tElement.preparePrototype(proto);\r\n\r\n\t\t\tif ('_super' in proto)\r\n\t\t\t\tRinn.override (_super, proto._super);\r\n\r\n\t\t\tif ('events' in proto)\r\n\t\t\t\tRinn.override (events, proto.events);\r\n\r\n\t\t\tRinn.override (elem.prototype, proto);\r\n\t\t\tRinn.override (self, proto);\r\n\t\t}\r\n\r\n\t\telem.prototype._super = _super;\r\n\t\telem.prototype.events = events;\r\n\r\n\t\tself._super = _super;\r\n\t\tself.events = events;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAppends a hook to a function of a custom element.\r\n\t*/\r\n\thookAppend: function (name, functionName, newFunction)\r\n\t{\r\n\t\tif (!(name in elementPrototypes))\r\n\t\t\treturn;\r\n\r\n\t\tlet hook1 = Rinn.hookAppend(elementPrototypes[name], functionName, newFunction);\r\n\t\tlet hook2 = Rinn.hookAppend(elementClasses[name].prototype, functionName, newFunction);\r\n\r\n\t\treturn { \r\n\t\t\tunhook: function() {\r\n\t\t\t\thook1.unhook();\r\n\t\t\t\thook2.unhook();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/*\r\n\t**\tPrepends a hook to a function of a custom element.\r\n\t*/\r\n\thookPrepend: function (name, functionName, newFunction)\r\n\t{\r\n\t\tif (!(name in elementPrototypes))\r\n\t\t\treturn;\r\n\r\n\t\tlet hook1 = Rinn.hookPrepend(elementPrototypes[name], functionName, newFunction);\r\n\t\tlet hook2 = Rinn.hookPrepend(elementClasses[name].prototype, functionName, newFunction);\r\n\r\n\t\treturn { \r\n\t\t\tunhook: function() {\r\n\t\t\t\thook1.unhook();\r\n\t\t\t\thook2.unhook();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t**\tBuilt-in action handlers.\r\n\t*/\r\n\r\n\t/**\r\n\t**\t:toggleClass <className> [<selector>]\r\n\t**\r\n\t**\tToggles a CSS class on the element.\r\n\t*/\r\n\t':toggleClass': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\r\n\t\tif ('2' in args)\r\n\t\t\telem = document.querySelector(args[2]);\r\n\r\n\t\tif (!elem) return;\r\n\r\n\t\tif (elem.classList.contains(args[1]))\r\n\t\t\telem.classList.remove(args[1]);\r\n\t\telse\r\n\t\t\telem.classList.add(args[1]);\r\n\t},\r\n\r\n\t/**\r\n\t**\t:setClass <className> [<selector>]\r\n\t**\r\n\t**\tSets a CSS class on the element.\r\n\t*/\r\n\t':setClass': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\r\n\t\tif ('2' in args)\r\n\t\t\telem = document.querySelector(args[2]);\r\n\r\n\t\tif (!elem) return;\r\n\r\n\t\telem.classList.add(args[1]);\r\n\t},\r\n\r\n\t/**\r\n\t**\t:volatileClass <className> [<selector>]\r\n\t**\r\n\t**\tAdds the CSS class to the element and any click outside will cause it to be removed.\r\n\t*/\r\n\t':volatileClass': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\r\n\t\tif ('2' in args)\r\n\t\t\telem = document.querySelector(args[2]);\r\n\r\n\t\tif (!elem) return;\r\n\r\n\t\telem.classList.add(args[1]);\r\n\r\n\t\tlet fn = () => {\r\n\t\t\twindow.removeEventListener('click', fn, true);\r\n\t\t\telem.classList.remove(args[1]);\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('click', fn, true);\r\n\t},\r\n\r\n\t/**\r\n\t**\t:toggleClassUnique <className> <parentSelector> <childSelector>\r\n\t**\r\n\t**\tToggles a CSS class on the element and only one element in the selected parent can have the class.\r\n\t*/\r\n\t':toggleClassUnique': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\t\tif (!elem) return;\r\n\r\n\t\tif (elem.classList.contains(args[1]))\r\n\t\t{\r\n\t\t\telem.classList.remove(args[1]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\telem.querySelectorParent(args[2]).querySelectorAll(args[3]).forEach(elem => elem.classList.remove(args[1]));\r\n\t\t\telem.classList.add(args[1]);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\t:setClassUnique <className> <parentSelector> <childSelector>\r\n\t**\r\n\t**\tSets a CSS class on the element and only that element in the selected parent can have the class.\r\n\t*/\r\n\t':setClassUnique': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\t\tif (!elem) return;\r\n\r\n\t\telem.querySelectorParent(args[2]).querySelectorAll(args[3]).forEach(elem => elem.classList.remove(args[1]));\r\n\t\telem.classList.add(args[1]);\r\n\t}\r\n};\r\n\r\nElement.debug = false;\r\n\r\nElement.register('r-elem', {\r\n});\r\n\r\nElement.register ('r-dom-probe', {\r\n});\r\n\r\n/* ****************************************** */\r\n\r\n/**\r\n**\tFinds the parent element given a selector.\r\n*/\r\nHTMLElement.prototype.querySelectorParent = function (selector)\r\n{\r\n\tlet elem = this;\r\n\r\n\twhile (elem != null)\r\n\t{\r\n\t\tif (elem.matches(selector))\r\n\t\t\tbreak;\r\n\r\n\t\telem = elem.parentElement;\r\n\t}\r\n\r\n\treturn elem;\r\n};\r\n\r\nexport default Element;\r\n","/*\r\n**\triza/api\r\n**\r\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport base64 from 'base-64';\r\nimport _fetch from 'node-fetch';\r\n\r\nif (!('fetch' in global))\r\n\tglobal.fetch = _fetch;\r\n\r\n/**\r\n**\tAPI interface utility functions.\r\n*/\r\n\r\nconst Api =\r\n{\r\n\t/**\r\n\t**\tFlags constants.\r\n\t*/\r\n\tREQUEST_PACKAGE_SUPPORTED:\t0x01,\r\n\tREQ64_SUPPORTED: \t\t\t0x02,\r\n\tJSON_RESPONSE_SUPPORTED: \t0x04,\r\n\tXML_RESPONSE_SUPPORTED: \t0x08,\r\n\tINCLUDE_CREDENTIALS:\t\t0x10,\r\n\tUNIQUE_STAMP:\t\t\t\t0x20,\r\n\r\n\t/**\r\n\t**\tTarget URL for all the API requests. Set by calling `setEndPoint`.\r\n\t*/\r\n\tapiUrl: \"/api\",\r\n\r\n\t/**\r\n\t**\tCapabilities flag.\r\n\t*/\r\n\tflags: 0,\r\n\r\n\t/**\r\n\t**\tIndicates if all request data will be packed into a req64 parameter instead of individual fields.\r\n\t*/\r\n\tuseReq64: false,\r\n\r\n\t/**\r\n\t**\tNumber of retries to execute each API call before giving up and invoking error handlers.\r\n\t*/\r\n\tretries: 0,\r\n\r\n\t/**\r\n\t**\tHeaders for the request.\r\n\t*/\r\n\theaders: { },\r\n\r\n\t/**\r\n\t**\tLevel of the current request. Used to detect nested requests.\r\n\t*/\r\n\t_requestLevel: 0,\r\n\r\n\t/**\r\n\t**\tIndicates if all API calls should be bundled in a request package. Activated by calling the packageBegin() function and finished with packageEnd().\r\n\t*/\r\n\t_requestPackage: 0,\r\n\r\n\t/**\r\n\t**\tWhen in package-mode, this contains the package data to be sent upon a call to packageEnd().\r\n\t*/\r\n\t_packageData: [],\r\n\r\n\t/**\r\n\t**\tSets the API end-point URL address.\r\n\t*/\r\n\tsetEndPoint: function (apiUrl, flags=null)\r\n\t{\r\n\t\tif (flags === null)\r\n\t\t\tflags = Api.REQUEST_PACKAGE_SUPPORTED | Api.REQ64_SUPPORTED | Api.JSON_RESPONSE_SUPPORTED | Api.XML_RESPONSE_SUPPORTED | Api.INCLUDE_CREDENTIALS | Api.UNIQUE_STAMP;\r\n\r\n\t\tthis.apiUrl = apiUrl;\r\n\t\tthis.flags = flags;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tOverridable filter that processes the response from the server and returns true if it was successful. The `res` parameter indicates the response data, and `req` the request data.\r\n\t*/\r\n\tresponseFilter: function (res, req)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t**\tStarts \"package-mode\" (using the `rpkg` field). Any API calls after this will be bundled together.\r\n\t*/\r\n\tpackageBegin: function ()\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t\treturn;\r\n\r\n\t\tthis._requestPackage++;\r\n\t},\r\n\r\n\t/**\r\n\t**\tFinishes \"package-mode\" and a single API request with the currently constructed package will be sent.\r\n\t*/\r\n\tpackageEnd: function (callback)\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t\treturn;\r\n\r\n\t\tif (!this._requestPackage)\r\n\t\t\treturn;\r\n\r\n\t\tif (--this._requestPackage)\r\n\t\t\treturn;\r\n\r\n\t\tthis.packageSend(callback);\r\n\t},\r\n\r\n\t/**\r\n\t**\tStarts package-mode, executes the callback and finishes package-mode. Therefore any requests made by the callback will be packed together.\r\n\t*/\r\n\tpackRequests: function (callback, responseCallback=null)\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.packageBegin();\r\n\t\tcallback();\r\n\t\tthis.packageEnd(responseCallback);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSends a single API request with the currently constructed package and maintains package-mode.\r\n\t*/\r\n\tpackageSend: function (callback)\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t\treturn;\r\n\r\n\t\tif (!this._packageData.length)\r\n\t\t\treturn;\r\n\r\n\t\tlet _packageData = this._packageData;\r\n\t\tthis._packageData = [];\r\n\r\n\t\tvar rpkg = \"\";\r\n\r\n\t\tfor (var i = 0; i < _packageData.length; i++)\r\n\t\t\trpkg += \"r\"+i+\",\"+base64.encode(this.encodeParams(_packageData[i][2]))+\";\";\r\n\r\n\t\tthis._showProgress();\r\n\r\n\t\tthis.apiCall (\r\n\t\t\t{ rpkg: rpkg },\r\n\r\n\t\t\t(res, req) =>\r\n\t\t\t{\r\n\t\t\t\tthis._hideProgress();\r\n\r\n\t\t\t\tfor (let i = 0; i < _packageData.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar response = res[\"r\"+i];\r\n\t\t\t\t\t\tif (!response)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (_packageData[i][1] != null) _packageData[i][1] (_packageData[i][2]);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (_packageData[i][0] != null)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (this.responseFilter (response, _packageData[i][2]))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t_packageData[i][0] (response, _packageData[i][2]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e) {\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) callback();\r\n\t\t\t},\r\n\r\n\t\t\t(req) =>\r\n\t\t\t{\r\n\t\t\t\tthis._hideProgress();\r\n\r\n\t\t\t\tfor (let i = 0; i < _packageData.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (_packageData[i][1] != null) _packageData[i][1] (_packageData[i][2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds CSS class 'busy' to the HTML root element, works only if running inside a browser.\r\n\t*/\r\n\t_showProgress: function ()\r\n\t{\r\n\t\tif ('document' in global) {\r\n\t\t\tthis._requestLevel++;\r\n\t\t\tif (this._requestLevel > 0) global.document.documentElement.classList.add('busy');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves the 'busy' CSS class from the HTML element.\r\n\t*/\r\n\t_hideProgress: function ()\r\n\t{\r\n\t\tif ('document' in global)\r\n\t\t{\r\n\t\t\tthis._requestLevel--;\r\n\t\t\tif (this._requestLevel) return;\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (this._requestLevel === 0)\r\n\t\t\t\t\tglobal.document.documentElement.classList.remove('busy');\r\n\t\t\t}, 250);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * \tSets an HTTP header.\r\n\t */\r\n\theader: function (name, value)\r\n\t{\r\n\t\tif (value === null)\r\n\t\t\tdelete this.headers[name];\r\n\t\telse\r\n\t\t\tthis.headers[name] = value;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tReturns a parameter string for a GET request given an object with fields.\r\n\t*/\r\n\tencodeParams: function (obj)\r\n\t{\r\n\t\tlet s = [];\r\n\r\n\t\tif (obj instanceof FormData)\r\n\t\t{\r\n\t\t\tfor (let i of obj.entries())\r\n\t\t\t\ts.push(encodeURIComponent(i[0]) + '=' + encodeURIComponent(i[1]));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor (let i in obj)\r\n\t\t\t\ts.push(encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\r\n\t\treturn s.join('&');\r\n\t},\r\n\r\n\t/**\r\n\t * Returns a URL given a relative or absolute URL.\r\n\t */\r\n\tgetUrl: function (url)\r\n\t{\r\n\t\tif (url.indexOf('//') !== -1)\r\n\t\t\treturn url;\r\n\r\n\t\treturn this.apiUrl + url;\r\n\t},\r\n\r\n\t/**\r\n\t * Appends a parameter to the URL.\r\n\t */\r\n\tappendParam: function (url, param)\r\n\t{\r\n\t\treturn url + (url.indexOf('?') == -1 ? '?' : '&') + param;\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecutes an API call to the URL stored in the `apiUrl` property. By default `httpMethod` is \"auto\", which will determine the best depending on the data to\r\n\t**\tbe sent. Any connection error will be reported to the `failure` callback, and similarly any success to the `success` callback. The `params` object can be\r\n\t**\ta FormData object or just a regular object.\r\n\t*/\r\n\tapiCall: function (params, success, failure, httpMethod=null, retries=null, relativeUrl='')\r\n\t{\r\n\t\tlet url = this.getUrl(relativeUrl);\r\n\r\n\t\tif (this.flags & Api.UNIQUE_STAMP)\r\n\t\t\turl = this.appendParam(url, '_='+Date.now());\r\n\r\n\t\thttpMethod = httpMethod ? httpMethod.toUpperCase() : null;\r\n\t\tif (httpMethod != 'GET' && httpMethod != 'POST')\r\n\t\t\thttpMethod = 'auto';\r\n\r\n\t\tif (retries === null)\r\n\t\t\tretries = this.retries;\r\n\r\n\t\tif (this._requestPackage && (this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t{\r\n\t\t\tif (!(params instanceof FormData))\r\n\t\t\t\tparams = {...params};\r\n\r\n\t\t\tthis._packageData.push([success, failure, params]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._showProgress();\r\n\r\n\t\tlet data = params;\r\n\r\n\t\tlet options =\r\n\t\t{\r\n\t\t\tmode: 'cors',\r\n\t\t\theaders: {\r\n\t\t\t\t'Accept': 'text/html,application/xhtml+xml,application/xml,application/json;q=0.9',\r\n\t\t\t\t...this.headers\r\n\t\t\t},\r\n\t\t\tmethod: httpMethod,\r\n\t\t\tbody: null,\r\n\t\t\tmultipart: false\r\n\t\t};\r\n\r\n\t\tif (this.flags & Api.INCLUDE_CREDENTIALS)\r\n\t\t\toptions.credentials = 'include';\r\n\r\n\t\tif (typeof(data) !== 'string' && !(data instanceof Blob))\r\n\t\t{\r\n\t\t\tif (!(data instanceof FormData))\r\n\t\t\t{\r\n\t\t\t\tdata = new FormData();\r\n\r\n\t\t\t\tfor (let i in params)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ((params[i] instanceof File) || (params[i] instanceof Blob))\r\n\t\t\t\t\t\tdata.append(i, params[i], params[i].name);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdata.append(i, params[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i of data.entries())\r\n\t\t\t{\r\n\t\t\t\tif ((i[1] instanceof File) || (i[1] instanceof Blob))\r\n\t\t\t\t{\r\n\t\t\t\t\toptions.method = 'POST';\r\n\t\t\t\t\toptions.multipart = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.useReq64 && (this.flags & Api.REQ64_SUPPORTED) && !options.multipart)\r\n\t\t\t{\r\n\t\t\t\tlet tmp = new FormData();\r\n\t\t\t\ttmp.append('req64', base64.encode(this.encodeParams(data)));\r\n\t\t\t\tdata = tmp;\r\n\t\t\t}\r\n\r\n\t\t\tif (options.method == 'auto')\r\n\t\t\t{\r\n\t\t\t\tlet l = 0;\r\n\r\n\t\t\t\toptions.method = 'GET';\r\n\r\n\t\t\t\tfor (let i of data.entries())\r\n\t\t\t\t{\r\n\t\t\t\t\tl += i[0].length + i[1].length + 2;\r\n\r\n\t\t\t\t\tif (l > 960)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toptions.method = 'POST';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\r\n\t\t\tif (options.method == 'GET')\r\n\t\t\t{\r\n\t\t\t\turl += '&' + this.encodeParams(data);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (!options.multipart)\r\n\t\t\t\t{\r\n\t\t\t\t\toptions.headers['Content-Type'] = 'application/x-www-form-urlencoded';\r\n\t\t\t\t\toptions.body = this.encodeParams(data);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toptions.body = data;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (typeof(data) === 'string')\r\n\t\t\t{\r\n\t\t\t\tif (data[0] === '<')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (data.endsWith('</soap:Envelope>'))\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/soap+xml';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/xml';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (data[0] === '{')\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/json';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/octet-stream';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\toptions.headers['Content-Type'] = data.type;\r\n\r\n\t\t\toptions.method = 'POST';\r\n\t\t\toptions.body = data;\r\n\t\t}\r\n\r\n\t\tglobal.fetch(url, options)\r\n\t\t.then(result => this.decodeResult(result))\r\n\t\t.then(result =>\r\n\t\t{\r\n\t\t\tthis._hideProgress();\r\n\t\t\tif (!success) return\r\n\r\n\t\t\tif (this.responseFilter(result, params)) {\r\n\t\t\t\ttry { success(result, params); } catch(e) { }\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(err =>\r\n\t\t{\r\n\t\t\tthis._hideProgress();\r\n\r\n\t\t\tif (retries == 0) {\r\n\t\t\t\tif (failure) failure(params);\r\n\t\t\t} else {\r\n\t\t\t\tthis.apiCall (data, success, failure, httpMethod, retries-1, relativeUrl);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t**\tDecodes a result obtained using fetch into a usable object.\r\n\t*/\r\n\tdecodeResult: function (result)\r\n\t{\r\n\t\tlet type = result.headers.get('content-type').split(';')[0].toLowerCase();\r\n\r\n\t\tif ((this.flags & Api.JSON_RESPONSE_SUPPORTED) && type.indexOf('json') !== -1)\r\n\t\t\treturn result.json();\r\n\r\n\t\tif ((this.flags & Api.XML_RESPONSE_SUPPORTED) && type.indexOf('xml') !== -1)\r\n\t\t{\r\n\t\t\treturn new Promise((resolve, reject) =>\r\n\t\t\t{\r\n\t\t\t\tresult.text().then(data =>\r\n\t\t\t\t{\r\n\t\t\t\t\tdata = (new DOMParser).parseFromString(data, 'text/xml');\r\n\t\t\t\t\tresolve(data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(reject);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result.blob();\r\n\t},\r\n\r\n\t/**\r\n\t**\tMakes a blob with the specified data and type.\r\n\t*/\r\n\tgetBlob: function (data, type)\r\n\t{\r\n\t\treturn new Blob ([data], { type: type });\r\n\t},\r\n\r\n\t/**\r\n\t**\tProvided access to the base64 module to encode/decode data.\r\n\t*/\r\n\tbase64:\r\n\t{\r\n\t\tencode: function (value)\r\n\t\t{\r\n\t\t\treturn base64.encode(value);\r\n\t\t},\r\n\r\n\t\tdecode: function (value)\r\n\t\t{\r\n\t\t\treturn base64.decode(value);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecutes a POST API call.\r\n\t*/\r\n\tpost: function (params, success=null, failure=null)\r\n\t{\r\n\t\treturn this.apiCall(params, success, failure, 'POST');\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecutes a GET API call.\r\n\t*/\r\n\tget: function (params, success=null, failure=null)\r\n\t{\r\n\t\treturn this.apiCall(params, success, failure, 'GET');\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecutes an automatic API call, returns a promise.\r\n\t*/\r\n\tfetch: function (url, params=null)\r\n\t{\r\n\t\tif (params === null)\r\n\t\t{\r\n\t\t\tif (typeof(url) !== 'string')\r\n\t\t\t{\r\n\t\t\t\tparams = url;\r\n\t\t\t\turl = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.apiCall(params, resolve, reject, null, null, url);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t**\tBuilds a URL from the given data.\r\n\t*/\r\n\tmakeUrl: function (url, params=null)\r\n\t{\r\n\t\tif (params === null)\r\n\t\t{\r\n\t\t\tif (typeof(url) !== 'string')\r\n\t\t\t{\r\n\t\t\t\tparams = url;\r\n\t\t\t\turl = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.appendParam(this.getUrl(url), this.encodeParams(params));\r\n\t}\r\n};\r\n\r\nexport default Api;\r\n","/*\r\n**\triza/data-source\r\n**\r\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport { Model, ModelList, EventDispatcher } from 'rinn';\r\nimport Api from './api.js';\r\n\r\n/*\r\n**\tProvides several methods to quickly interface with a remote data-source as defined by Wind.\r\n*/\r\n\r\nexport default EventDispatcher.extend\r\n({\r\n\tclassName: 'DataSource',\r\n\tdebounceDelay: 250,\r\n\r\n\trequest: null,\r\n\r\n\tincludeCount: false,\r\n\tincludeEnum: false,\r\n\tincludeList: true,\r\n\r\n\teid: null,\r\n\tcount: 0,\r\n\tlist: null,\r\n\tenum: null,\r\n\r\n\t/*\r\n\t**\tConstructs the data source with the specified optional `config` parameters, any of the properties of this object can be specified\r\n\t**\tin the config. Uses the given basePath as prefix for the `f` parameter for subsequent API operations, a basePath of `candies` will\r\n\t**\tresult in calls to `candies.list`, `candies.count`, etc.\r\n\t*/\r\n\t__ctor: function (basePath, config)\r\n\t{\r\n\t\tthis._super.EventDispatcher.__ctor();\r\n\r\n\t\tthis.basePath = basePath;\r\n\r\n\t\tif (config) Object.assign(this, config);\r\n\r\n\t\tthis.request = new Model(this.request);\r\n\r\n\t\tthis.eid = Math.random().toString().substr(2);\r\n\t\tthis.count = 0;\r\n\r\n\t\tthis.list = new ModelList();\r\n\t\tthis.list.dataSource = this;\r\n\r\n\t\tthis.enum = new ModelList();\r\n\t\tthis.enum.dataSource = this;\r\n\r\n\t\tthis.request.addEventListener (this.eid+':propertyChanged', this.forwardRequestEvent, this);\r\n\r\n\t\tthis.list.addEventListener (this.eid+':itemsCleared', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemsChanged', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemRemoved', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemChanged', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemAdded', this.forwardListEvent, this);\r\n\r\n\t\tthis.enum.addEventListener (this.eid+':itemsCleared', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemsChanged', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemRemoved', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemChanged', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemAdded', this.forwardEnumEvent, this);\r\n\t},\r\n\r\n\tforwardRequestEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('request' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\tforwardListEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('list' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\tforwardEnumEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('enum' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes one or more API functions (depending on `includeCount`, `includeEnum` and `includeList` properties) to retrieve the\r\n\t**\trequired data (uses debounce to prevent too-quick refreshes).\r\n\t**\r\n\t**\tRefresh mode can be: order, filter, range or full. Setting `mode` to `true` will cause a full refresh without debouncing.\r\n\t*/\r\n\trefresh: function (mode='full', callback=null)\r\n\t{\r\n\t\tif (typeof(mode) == 'function')\r\n\t\t{\r\n\t\t\tcallback = mode;\r\n\t\t\tmode = 'full';\r\n\t\t}\r\n\r\n\t\tif (this._timeout)\r\n\t\t{\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = null;\r\n\t\t}\r\n\r\n\t\tconst fn = () =>\r\n\t\t{\r\n\t\t\tthis._timeout = null;\r\n\r\n\t\t\tApi.packageBegin();\r\n\r\n\t\t\tif (this.includeCount && (mode == 'full' || mode == 'filter')) this.fetchCount();\r\n\t\t\tif (this.includeEnum && (mode == 'full')) this.fetchEnum();\r\n\t\t\tif (this.includeList) this.fetchList();\r\n\r\n\t\t\tApi.packageEnd(callback);\r\n\t\t};\r\n\r\n\t\tif (mode === true)\r\n\t\t{\r\n\t\t\tmode = 'full';\r\n\t\t\tfn();\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis._timeout = setTimeout(fn, this.debounceDelay);\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for the item in `list` that matches the specified `fields` and sends it to the callback. If no item is found (or if `forced` is true),\r\n\t**\ta call to API function `.get` will be executed with the fields as request parameters. Returns a promise.\r\n\t*/\r\n\tfetch: function (fields, forced=false)\r\n\t{\r\n\t\treturn new Promise((resolve, reject) =>\r\n\t\t{\r\n\t\t\tlet item = forced == true ? null : this.list.find(fields, true);\r\n\t\t\tif (!item)\r\n\t\t\t{\r\n\t\t\t\tthis.fetchOne(fields, (r) =>\r\n\t\t\t\t{\r\n\t\t\t\t\tif (r && r.response == 200)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (r.data.length > 0)\r\n\t\t\t\t\t\t\tresolve(r.data[0]);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject(r);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treject(r);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tresolve(item.get());\r\n\t\t});\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the remote data source by executing the `.delete` API function, passes the given `fields` as request\r\n\t**\tparameters. Returns a promise.\r\n\t*/\r\n\tdelete: function (params)\r\n\t{\r\n\t\treturn new Promise((resolve, reject) =>\r\n\t\t{\r\n\t\t\tthis.fetchDelete(params, (r) =>\r\n\t\t\t{\r\n\t\t\t\tif (r.response == 200)\r\n\t\t\t\t\tresolve(r);\r\n\t\t\t\telse\r\n\t\t\t\t\treject(r.error);\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tfetchList: function ()\r\n\t{\r\n\t\tlet data = {...this.request.get()};\r\n\r\n\t\tdata.f = this.basePath + '.list';\r\n\r\n\t\tthis.dispatchEvent('listLoading');\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tthis.list.setData(r.response == 200 ? r.data : null);\r\n\t\t\tthis.dispatchEvent('listLoaded');\r\n\t\t\tthis.dispatchEvent('listChanged');\r\n\t\t});\r\n\t},\r\n\r\n\tfetchEnum: function ()\r\n\t{\r\n\t\tlet data = {...this.request.get()};\r\n\r\n\t\tdata.f = this.basePath + '.enum';\r\n\r\n\t\tthis.dispatchEvent('enumLoading');\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tthis.enum.setData(r.response == 200 ? r.data : null);\r\n\t\t\tthis.dispatchEvent('enumLoaded');\r\n\t\t\tthis.dispatchEvent('enumChanged');\r\n\t\t});\r\n\t},\r\n\r\n\tfetchCount: function ()\r\n\t{\r\n\t\tlet data = {...this.request.get()};\r\n\r\n\t\tdata.f = this.basePath + '.count';\r\n\r\n\t\tthis.dispatchEvent('countLoading');\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tthis.count = r.response == 200 ? r.count : 0;\r\n\t\t\tthis.dispatchEvent('countLoaded');\r\n\t\t\tthis.dispatchEvent('countChanged');\r\n\t\t});\r\n\t},\r\n\r\n\tfetchOne: function (params, callback)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tdata.f = this.basePath + '.get';\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tcallback(r);\r\n\t\t});\r\n\t},\r\n\r\n\tfetchDelete: function (params, callback)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tdata.f = this.basePath + '.delete';\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tcallback(r);\r\n\t\t});\r\n\t},\r\n\r\n\tfetchData: function (params)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tif (data.f[0] == '.')\r\n\t\t\tdata.f = this.basePath + data.f;\r\n\r\n\t\treturn Api.fetch(data);\r\n\t},\r\n\r\n\tmakeUrl: function (params)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tif (data.f[0] == '.')\r\n\t\t\tdata.f = this.basePath + data.f;\r\n\r\n\t\treturn Api.makeUrl(data);\r\n\t}\r\n});\r\n","/*\r\n**\triza/data-list\r\n**\r\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport { Model, ModelList } from 'rinn';\r\nimport Api from './api.js';\r\n\r\n/*\r\n**\tProvides an interface to connect with a listing API function.\r\n*/\r\n\r\nexport default ModelList.extend\r\n({\r\n\tclassName: 'DataList',\r\n\tdebounceDelay: 250,\r\n\r\n\trequest: null,\r\n\r\n\teid: null,\r\n\r\n\t/*\r\n\t**\tConstructs the data list with the specified optional `config` parameters, any of the properties of this object can be specified\r\n\t**\tin the config. The given `f` parameter is passed directly as a request parameter to the API.\r\n\t*/\r\n\t__ctor: function (f, config=null)\r\n\t{\r\n\t\tthis._super.ModelList.__ctor();\r\n\r\n\t\tif (config !==  null)\r\n\t\t\tObject.assign(this, config);\r\n\r\n\t\tif (!this.request)\r\n\t\t\tthis.request = { };\r\n\r\n\t\tthis.request.f = f;\r\n\t\tthis.request = new Model(this.request);\r\n\r\n\t\tthis.eid = Math.random().toString().substr(2);\r\n\t\tthis.dataList = this;\r\n\r\n\t\tthis.request.addEventListener (this.eid+':propertyChanged', this.forwardRequestEvent, this);\r\n\t},\r\n\r\n\tforwardRequestEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('request' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a request to retrieve the data for the list (uses debounce to prevent too-quick refreshes).\r\n\t*/\r\n\trefresh: function (callback=null, _callback=null)\r\n\t{\r\n\t\tif (this._timeout)\r\n\t\t{\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = null;\r\n\t\t}\r\n\r\n\t\tif (callback === true)\r\n\t\t{\r\n\t\t\tthis.dispatchEvent('listLoading');\r\n\r\n\t\t\tApi.fetch(this.request.get()).then(r =>\r\n\t\t\t{\r\n\t\t\t\tthis.setData(r.response == 200 ? r.data : null);\r\n\t\t\t\tthis.dispatchEvent('listLoaded');\r\n\t\t\t\tthis.dispatchEvent('listChanged');\r\n\r\n\t\t\t\tif (_callback !== null)\r\n\t\t\t\t\t_callback();\r\n\t\t\t});\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fn = () => {\r\n\t\t\tthis.refresh(true, callback);\r\n\t\t};\r\n\r\n\t\tthis._timeout = setTimeout(fn, this.debounceDelay);\r\n\t}\r\n});\r\n","/*\n**\triza/easing\n**\n**\tCopyright (c) 2016-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n**\tCollection of useful easing functions (imported from Cherry source code).\n*/\n\nconst Easing =\n{\n\t/**\n\t**\tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` (in seconds) and `easing` function. Note that all four parameters\n\t**\t`src`, `dst`, `duration` and `easing` must be objects having the same number of values.\n\t*/\n\tinterpolate: function (src, dst, duration, easing, callback/* function(data, isFinished) */)\n\t{\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet lastTime = Date.now()/1000;\n\t\tlet dt = 0;\n\n\t\tlet interpolator = function()\n\t\t{\n\t\t\tlet curTime = Date.now()/1000;\n\t\t\tdt = curTime - lastTime;\n\t\t\tlastTime = curTime;\n\n\t\t\tfor (let x in time)\n\t\t\t{\n\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\tcontinue;\n\n\t\t\t\ttime[x] += dt;\n\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t{\n\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\n\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t}\n\n\t\t\tcallback (data, count == 0);\n\n\t\t\tif (count != 0)\n\t\t\t\trequestAnimationFrame(interpolator);\n\t\t};\n\n\t\tinterpolator();\n\t},\n\n\t/* ******************************************** */\n\tLinear:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\tIN: function (t, k)\n\t\t{\n\t\t\tif (k === undefined) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\tOUT: function (t, k)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\tIN_OUT: function (t, k)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCirc:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCubic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tExpo:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tPower:\n\t{\n\t\tp: 12,\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(t, Easing.Power.p);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuad:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuartic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuintic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tSine:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tStep:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","/*\n**\triza/anim\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { Rinn, Class } from 'rinn';\n\n/**\n**\tClass to animate properties using rules (imported from Cherry source code).\n*/\n\nconst Anim = Class.extend\n({\n\tlist: null,\n\n\tinitialData: null,\n\tdata: null,\n\n\tstack: null,\n\tblock: null,\n\n\ttimeScale: 1, time: 0, blockTime: 0,\n\tindex: 0,\n\n\tpaused: false,\n\tfinished: false,\n\n\tonFinishedCallback: null,\n\tonUpdatedCallback: null,\n\n\t__ctor: function ()\n\t{\n\t\tthis.list = [ ];\n\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.stack = [ ];\n\t\tthis.block = this.list;\n\n\t\tthis.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t},\n\n\tclone: function ()\n\t{\n\t\tlet a = new Anim();\n\n\t\ta.list = this.list;\n\t\ta.initialData = this.initialData;\n\n\t\treturn a.reset();\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.onFinishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tonUpdated: function (callback)\n\t{\n\t\tthis.onUpdatedCallback = callback;\n\t\treturn this;\n\t},\n\n\t// Resets the animation to its initial state.\n\treset: function ()\n\t{\n\t\tthis.stack.length = 0;\n\t\tthis.blockTime = 0;\n\n\t\tthis.time = 0;\n\t\tthis.index = 0;\n\n\t\tthis.block = this.list;\n\n\t\tthis.paused = true;\n\t\tthis.finished = false;\n\t\tthis.handle = null;\n\n\t\tfor (let i in this.initialData)\n\t\t\tthis.data[i] = this.initialData[i];\n\n\t\treturn this;\n\t},\n\n\t// Sets the initial data.\n\tinitial: function (data)\n\t{\n\t\tthis.initialData = data;\n\t\treturn this.reset();\n\t},\n\n\t// Sets the time scale (animation speed).\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t// Sets the output data object.\n\tsetOutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t// Pauses the animation.\n\tpause: function ()\n\t{\n\t\tif (this.paused) return;\n\n\t\tclearInterval(this.handle);\n\t\tthis.paused = true;\n\t},\n\n\t// Resumes the animation.\n\tresume: function ()\n\t{\n\t\tif (!this.paused) return;\n\n\t\tlet lastTime = Date.now()/1000;\n\n\t\tthis.handle = setInterval(() =>\n\t\t{\n\t\t\tlet curTime = Date.now()/1000;\n\t\t\tlet dt = curTime - lastTime;\n\t\t\tlastTime = curTime;\n\n\t\t\tthis.update(dt);\n\n\t\t\tif (this.onUpdatedCallback)\n\t\t\t\tthis.onUpdatedCallback (this.data, this);\n\t\t},\n\t\t16);\n\n\t\tif (this.onUpdatedCallback)\n\t\t\tthis.onUpdatedCallback (this.data, this);\n\n\t\tthis.paused = false;\n\t},\n\n\t// Updates the animation by the specified delta time (seconds).\n\tupdate: function (dt)\n\t{\n\t\tif (this.paused) return false;\n\n\t\tif (this.index >= this.block.length)\n\t\t\treturn true;\n\n\t\tlet i = 0;\n\n\t\tlet _block;\n\t\tlet _index;\n\t\tlet _blockTime;\n\n\t\tthis.time += dt*this.timeScale;\n\n\t\twhile (this.index < this.block.length)\n\t\t{\n\t\t\tlet cmd = this.block[this.index];\n\t\t\tlet duration;\n\n\t\t\tswitch (cmd.op)\n\t\t\t{\n\t\t\t\tcase \"parallel\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.blocks.length = 0;\n\t\t\t\t\t\tcmd.started = true;\n\n\t\t\t\t\t\tfor (i = 0; i < cmd.block.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmd.blocks.push([cmd.block[i]]);\n\t\t\t\t\t\t\tcmd.indices[i] = 0;\n\t\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tlet n = 0;\n\t\t\t\t\tlet blockTime = _blockTime;\n\n\t\t\t\t\tfor (i = 0; i < cmd.blocks.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block = cmd.blocks[i];\n\t\t\t\t\t\tthis.index = cmd.indices[i];\n\t\t\t\t\t\tthis.blockTime = cmd.blockTimes[i];\n\n\t\t\t\t\t\tif (this.update(0) === true)\n\t\t\t\t\t\t\tn++;\n\n\t\t\t\t\t\tif (this.blockTime > blockTime)\n\t\t\t\t\t\t\tblockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\tcmd.blocks[i] = this.block;\n\t\t\t\t\t\tcmd.indices[i] = this.index;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (n != cmd.blocks.length)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"serial\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"repeat\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\t\t\t\t\t\tcmd._count = cmd.count;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tif (cmd._count <= 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\t\tthis.index++;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._count--;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"set\":\n\t\t\t\t\tthis.data[cmd.field] = cmd.value;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"restart\":\n\t\t\t\t\tthis.index = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"wait\":\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"range\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (cmd.startValue === null)\n\t\t\t\t\t\t\tcmd._startValue = this.data[cmd.field];\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tcmd._startValue = cmd.startValue;\n\n\t\t\t\t\t\tcmd._endValue = cmd.endValue;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1.0)\n\t\t\t\t\t\tthis.data[cmd.field] = cmd.easing(dt)*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.data[cmd.field] = dt*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"rand\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t\tcmd.last = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\tcmd.cur = ~~(cmd.easing(dt)*cmd.count);\n\t\t\t\t\telse\n\t\t\t\t\t\tcmd.cur = ~~(dt*cmd.count);\n\n\t\t\t\t\tif (cmd.cur != cmd.last)\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\ti = ~~(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\t\t\t\tif (i != this.data[cmd.field]) break;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.data[cmd.field] = i;\n\t\t\t\t\t\tcmd.last = cmd.cur;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"randt\":\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\ti = cmd.easing(dt)*(cmd.count-1);\n\t\t\t\t\telse\n\t\t\t\t\t\ti = dt*(cmd.count-1);\n\n\t\t\t\t\tthis.data[cmd.field] = cmd.table[~~((i + cmd.count) % cmd.count)];\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"play\":\n\t\t\t\t\tcmd.snd.play();\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"exec\":\n\t\t\t\t\tcmd.fn.call(this, this);\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this.block == this.list)\n\t\t{\n\t\t\tif (!this.finished && this.onFinishedCallback != null)\n\t\t\t\tthis.onFinishedCallback();\n\n\t\t\tthis.pause();\n\t\t\tthis.finished = true;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t// Runs the subsequent commands in parallel. Should end the parallel block by calling end().\n\tparallel: function ()\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"parallel\", started: false, block: block, blocks: [ ], indices: [ ], blockTimes: [ ] });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Runs the subsequent commands in series. Should end the serial block by calling end().\n\tserial: function ()\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"serial\", started: false, block: block });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Repeats a block the specified number of times.\n\trepeat: function (count)\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"repeat\", started: false, block: block, count: count });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Sets the callback of the current block.\n\tcallback: function (fn)\n\t{\n\t\tlet block = this.stack[this.stack.length-1];\n\t\tblock[block.length-1].fn = fn;\n\n\t\treturn this;\n\t},\n\n\t// Ends a parallel(), serial() or repeat() block.\n\tend: function ()\n\t{\n\t\tthis.block = this.stack.pop();\n\t\treturn this;\n\t},\n\n\t// Sets the value of a variable.\n\tset: function (field, value)\n\t{\n\t\tthis.block.push({ op: \"set\", field: field, value: value });\n\t\treturn this;\n\t},\n\n\t// Restarts the current block.\n\trestart: function (duration)\n\t{\n\t\tthis.block.push({ op: \"restart\" });\n\t\treturn this;\n\t},\n\n\t// Waits for the specified duration.\n\twait: function (duration)\n\t{\n\t\tthis.block.push({ op: \"wait\", duration: duration });\n\t\treturn this;\n\t},\n\n\t// Sets the range of a variable.\n\trange: function (field, duration, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"range\", started: false, field: field, duration: duration, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive).\n\trand: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"rand\", started: false, field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < count; i++)\n\t\t\ttable.push ((i % (endValue - startValue + 1)) + startValue);\n\n\t\tfor (let i = count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = ~~(Math.random() * count);\n\t\t\tlet b = ~~(Math.random() * count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tthis.block.push({ op: \"randt\", field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, table: table, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Plays a sound.\n\tplay: function (snd)\n\t{\n\t\tthis.block.push({ op: \"play\", snd: snd });\n\t\treturn this;\n\t},\n\n\t// Executes a function.\n\texec: function (fn)\n\t{\n\t\tthis.block.push({ op: \"exec\", fn: fn });\n\t\treturn this;\n\t}\n});\n\nexport default Anim;\n","/*\n**\telems/r-tabs\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-tabs data-container=\"div.tab-container\" data-base-route=\"@\" data-initial=\"tab1\">\n\t\t<a data-name=\"tab1\">Tab-1</a>\n\t\t<a data-name=\"tab2\">Tab-2</a>\n\t\t<a data-name=\"tab3\">Tab-3</a>\n\t</r-tabs>\n\n\t<div class=\"tab-container\">\n\t\t<div data-name=\"tab1\">\n\t\t\tThis is tab-1.\n\t\t</div>\n\n\t\t<div data-name=\"tab2\">\n\t\t\tThis is tab-2.\n\t\t</div>\n\n\t\t<div data-name=\"tab3\">\n\t\t\tThis is tab-3.\n\t\t</div>\n\t</div>\n\n\t.x-hidden {\n\t\tdisplay: none;\n\t}\n\n\tr-tabs [data-name].active {\n\t\tfont-weight: bold;\n\t}\n*/\n\nimport Element from '../element.js';\nimport Router from '../router.js';\n\nexport default Element.register ('r-tabs',\n{\n\t/*\n\t**\tContainer element for tab content.\n\t*/\n\tcontainer: null,\n\n\t/**\n\t**\tElement events.\n\t*/\n\t'event click [data-name]': function (evt)\n\t{\n\t\tevt.continuePropagation = true;\n\n\t\tif (this.dataset.baseRoute)\n\t\t{\n\t\t\tlocation = \"#\" + Router.realLocation(this.dataset.baseRoute.replace('@', evt.source.dataset.name));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectTab (evt.source.dataset.name);\n\t},\n\n\t/**\n\t**\tInitializes the Tabs element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis._routeHandler = (evt, args) =>\n\t\t{\n\t\t\tif (Router.location != '')\n\t\t\t{\n\t\t\t\tthis.querySelectorAll(\"[href]\").forEach(link =>\n\t\t\t\t{\n\t\t\t\t\tif (!link.href) return;\n\n\t\t\t\t\tif (Router.location.startsWith(link.href.substr(link.href.indexOf('#')+1)))\n\t\t\t\t\t\tlink.classList.add('active');\n\t\t\t\t\telse\n\t\t\t\t\t\tlink.classList.remove('active');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!args.route.changed)\n\t\t\t\treturn;\n\n\t\t\tthis.showTab (args.tabName);\n\t\t};\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tif (\"container\" in this.dataset)\n\t\t{\n\t\t\tif (this.dataset.container == ':previousElement')\n\t\t\t\tthis.container = this.previousElementSibling;\n\t\t\telse if (this.dataset.container == ':nextElement')\n\t\t\t\tthis.container = this.nextElementSibling;\n\t\t\telse if (this.dataset.container == ':none')\n\t\t\t\tthis.container = null;\n\t\t\telse\n\t\t\t\tthis.container = document.querySelector(this.dataset.container);\n\t\t}\n\t\telse\n\t\t\tthis.container = this.nextElementSibling;\n\n\t\tthis._hideTabsExcept(this.dataset.initial);\n\t},\n\n\t/**\n\t**\tAdds a handler to Router if the data-base-route attribute was set.\n\t*/\n\tonConnected: function()\n\t{\n\t\tif (this.dataset.baseRoute)\n\t\t\tRouter.addRoute (this.dataset.baseRoute.replace('@', ':tabName'), this._routeHandler);\n\t},\n\n\t/**\n\t**\tRemoves a handler previously added to Router if the data-base-route attribute was set.\n\t*/\n\tonDisconnected: function()\n\t{\n\t\tif (this.dataset.baseRoute)\n\t\t\tRouter.removeRoute(this.dataset.baseRoute.replace('@', ':tabName'), this._routeHandler);\n\t},\n\n\t/**\n\t**\tHides all tabs except the one with the specified exceptName, if none specified then all tabs will be hidden (adds `.x-hidden` CSS class),\n\t**\tadditionally the respective link item in the tab definition will have class `.active`.\n\t*/\n\t_hideTabsExcept: function (exceptName)\n\t{\n\t\tif (!exceptName) exceptName = '';\n\n\t\tif (this.container != null)\n\t\t{\n\t\t\tthis.container.querySelectorAll(':scope > [data-name]').forEach(i =>\n\t\t\t{\n\t\t\t\tif (i.dataset.name == exceptName)\n\t\t\t\t{\n\t\t\t\t\ti.classList.remove('x-hidden');\n\t\t\t\t\tthis.dispatch('tabShown', { name: i.dataset.name, el: i });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ti.classList.add('x-hidden');\n\t\t\t\t\tthis.dispatch('tabHidden', { name: i.dataset.name, el: i });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.querySelectorAll(\"[data-name]\").forEach(link =>\n\t\t{\n\t\t\tif (link.dataset.name == exceptName)\n\t\t\t\tlink.classList.add('active');\n\t\t\telse\n\t\t\t\tlink.classList.remove('active');\n\t\t});\n\n\t\tthis.dispatch('tabChanged', { name: exceptName });\n\t},\n\n\t/**\n\t**\tShows the tab with the specified name, ignores `data-base-route` and current route as well.\n\t*/\n\tshowTab: function (name)\n\t{\n\t\treturn this._hideTabsExcept (name);\n\t},\n\n\t/**\n\t**\tShows a tab given its name. The route will be changed automatically if `data-base-route` is enabled.\n\t*/\n\tselectTab: function (name)\n\t{\n\t\tif (this.dataset.baseRoute)\n\t\t{\n\t\t\tconst hash = \"#\" + Router.realLocation(this.dataset.baseRoute.replace('@', name));\n\n\t\t\tif (location.hash != hash)\n\t\t\t{\n\t\t\t\tlocation = hash;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.showTab (name);\n\t}\n});\n","/*\n**\telems/r-form\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n<r-form data-form-action=\"api-function-name\" [data-strict=\"true|false\"] [data-errors-at=\"\"] [data-method=\"post\"]>\n\t<input type=\"text\" data-field=\"username\"/>\n</r-form>\n\nr-form .message.x-hidden {\n    display: none;\n}\n\nr-form span.field-error {\n    display: block;\n    color: red;\n}\n*/\n\nimport { Template } from 'rinn';\nimport Element from '../element.js';\nimport Api from '../api.js';\n\nexport default Element.register ('r-form',\n{\n\t/**\n\t**\tElement events.\n\t*/\n\tevents:\n\t{\n\t\t'change [data-field]': '_fieldChanged',\n\n\t\t'click input[type=reset]': 'reset',\n\t\t'click .reset': 'reset',\n\n\t\t'click input[type=submit]': 'submit',\n\t\t'click button[type=submit]': 'submit',\n\t\t'click .submit': 'submit',\n\t\t'submit form': 'submit'\n\t},\n\n\t/*\n\t**\tInitial form model.\n\t*/\n\tmodel: { },\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tlet formElement = document.createElement('form');\n\t\tformElement.append(...this.childNodes);\n\t\tthis.append(formElement);\n\n\t\tlet def = { };\n\t\tlet names = this.model.get();\n\n\t\tthis.querySelectorAll('[data-field]').forEach((i) =>\n\t\t{\n\t\t\ti.name = i.dataset.field;\n\t\t\tnames[i.name] = i.type;\n\n\t\t\tlet val = i.dataset.default;\n\t\t\tif (val == undefined)\n\t\t\t{\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'radio':\n\t\t\t\t\t\tif (!i.checked) return;\n\t\t\t\t\t\tval = i.value;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'checkbox':\n\t\t\t\t\t\tval = i.checked ? '1' : '0';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'field':\n\t\t\t\t\t\tval = i.getValue();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'file':\n\t\t\t\t\t\tval = '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tval = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdef[i.dataset.field] = val;\n\t\t});\n\n\t\tfor (let name in names)\n\t\t{\n\t\t\tif (name in def)\n\t\t\t\tnames[name] = def[name];\n\t\t\telse\n\t\t\t\tnames[name] = '';\n\t\t}\n\n\t\tdef = names;\n\n\t\tthis.model.defaults = def;\n\t\tthis.model.reset();\n\n\t\tthis.clearMarkers();\n\t},\n\n\t/*\n\t**\tTransforms an string returned by the server to a local representation.\n\t*/\n\tfilterString: function (str, r)\n\t{\n\t\tif (!str || !('messages' in global))\n\t\t\treturn str;\n\n\t\tif (str.startsWith('@messages.'))\n\t\t{\n\t\t\tif (str.substr(10) in global.messages)\n\t\t\t\tstr = Template.eval(global.messages[str.substr(10)], r);\n\t\t}\n\n\t\treturn str;\n\t},\n\n\t_change: function(elem)\n\t{\n\t\tif ('createEvent' in document)\n\t\t{\n\t\t\tlet evt = document.createEvent('HTMLEvents');\n\t\t\tevt.initEvent('change', false, true);\n\t\t\telem.dispatchEvent(evt);\n\t\t}\n\t\telse\n\t\t\telem.fireEvent('onchange');\n\t},\n\n\t_setField: function (f, value, silent)\n\t{\n\t\tif (!f) return;\n\n\t\tfor (f of this.querySelectorAll('[data-field=\"'+f+'\"]'))\n\t\t{\n\t\t\tswitch (f.type || f.tagName.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'select':\n\t\t\t\t\tf.val = f.dataset.value = f.multiple ? (value ? value.split(',') : value) : value;\n\t\t\t\t\tf.value = f.val = f.dataset.value;\n\n\t\t\t\t\tif (silent !== true) this._change(f);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'checkbox':\n\t\t\t\t\tf.checked = parseInt(value) ? true : false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'radio':\n\t\t\t\t\tf.checked = value == f.value;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'field':\n\t\t\t\t\tf.val = f.dataset.value = value;\n\t\t\t\t\tf.setValue(value);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'file':\n\t\t\t\t\tif ((value instanceof File) || (value instanceof Blob))\n\t\t\t\t\t{\n\t\t\t\t\t\tf.val = value;\n\t\t\t\t\t\tf.dataset.value = value;\n\t\t\t\t\t}\n\t\t\t\t\telse if (value instanceof FileList)\n\t\t\t\t\t{\n\t\t\t\t\t\tf.val = value;\n\t\t\t\t\t\tf.dataset.value = value;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tf.val = f.dataset.value = '';\n\t\t\t\t\t\tf.value = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tf.val = f.dataset.value = value;\n\t\t\t\t\tf.value = value;\n\n\t\t\t\t\tif (silent !== true) this._change(f);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\t_getField: function (f, _value=null, fromFileFields=false)\n\t{\n\t\tif (!f) return null;\n\n\t\tif (typeof(f) != 'string')\n\t\t{\n\t\t\tlet value = f.value == null ? f.val : f.value;\n\t\t\tif (value === null) value = _value;\n\n\t\t\tswitch (f.type || f.tagName.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'select':\n\t\t\t\t\t_value = f.multiple ? (value ? value.join(',') : value) : value;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'checkbox':\n\t\t\t\t\t_value = f.checked ? '1' : '0';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'radio':\n\t\t\t\t\tif (f.checked) _value = f.value;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'field':\n\t\t\t\t\t_value = f.getValue();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'file':\n\t\t\t\t\t_value = fromFileFields ? (f.files && f.files.length ? (f.multiple ? f.files : f.files[0]) : null) : f.val;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t_value = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn _value === null ? '' : _value;\n\t\t}\n\n\t\t_value = null;\n\n\t\tfor (f of this.querySelectorAll('[data-field=\"'+f+'\"]'))\n\t\t\t_value = this._getField(f, _value);\n\n\t\treturn _value === null ? '' : _value;\n\t},\n\n\tgetField: function (name)\n\t{\n\t\treturn this._getField(name);\n\t},\n\n\tclearMarkers: function ()\n\t{\n\t\tthis.classList.remove('busy');\n\n\t\tthis.querySelectorAll('.message').forEach(i => i.classList.add('x-hidden') );\n\t\tthis.querySelectorAll('span.field-error').forEach(i => i.remove());\n\n\t\tthis.querySelectorAll('.field-error').forEach(i => { i.classList.remove('field-error'); i.classList.remove('is-invalid'); });\n\t\tthis.querySelectorAll('.field-passed').forEach(i => i.classList.remove('field-passed'));\n\t},\n\n\t_fieldChanged: function (evt)\n\t{\n\t\tlet f = evt.source;\n\n\t\tif (f.type == 'file')\n\t\t\tthis.model.set (f.dataset.field, this._getField(f, null, true), true);\n\t\telse\n\t\t\tthis.model.set (f.dataset.field, this._getField(f));\n\n\t\tevt.continuePropagation = true;\n\t},\n\n\tonModelPropertyChanged: function (evt, args)\n\t{\n\t\tthis._setField (args.name, args.value);\n\t},\n\n\t_onSuccess: function(r)\n\t{\n\t\tthis.classList.remove('busy');\n\t\tlet tmp;\n\n\t\tthis.dispatch ('formSuccess', r);\n\n\t\tif (r.message && (tmp = this.querySelector('.message.success')) != null)\n\t\t{\n\t\t\ttmp.innerHTML = this.filterString(r.message, r).replace(/\\n/g, '<br/>');\n\t\t\ttmp.classList.remove('x-hidden');\n\t\t\ttmp.onanimationend = () => tmp.classList.add('x-hidden');\n\t\t}\n\t},\n\n\t_onFailure: function(r)\n\t{\n\t\tthis.classList.remove('busy');\n\t\tlet tmp;\n\n\t\tthis.dispatch ('formError', r);\n\n\t\tif (r.fields)\n\t\t{\n\t\t\tfor (let i in r.fields)\n\t\t\t{\n\t\t\t\tlet f = this.querySelector('[data-field-container=\"'+i+'\"]');\n\t\t\t\tif (!f)\n\t\t\t\t{\n\t\t\t\t\tf = this.querySelector('[data-field=\"'+i+'\"]');\n\t\t\t\t\tif (!f) continue;\n\t\t\t\t}\n\n\t\t\t\tlet tmp = document.createElement('span');\n\t\t\t\ttmp.classList.add('field-error');\n\t\t\t\ttmp.innerHTML = this.filterString(r.fields[i], r).replace(/\\n/g, '<br/>');\n\n\t\t\t\tf.classList.add('field-error');\n\t\t\t\tf.classList.add('is-invalid');\n\n\t\t\t\tif (this.dataset.errorsAt == 'bottom')\n\t\t\t\t\tf.parentElement.append(tmp);\n\t\t\t\telse if (this.dataset.errorsAt == 'top')\n\t\t\t\t\tf.parentElement.prepend(tmp);\n\t\t\t\telse\n\t\t\t\t\tf.parentElement.insertBefore(tmp, f.nextElementSibling);\n\n\t\t\t\tsetTimeout((function (tmp) { return function() { tmp.classList.add('active'); } })(tmp), 25);\n\t\t\t}\n\n\t\t\tif (r.error && (tmp = this.querySelector('.message.error')) != null)\n\t\t\t{\n\t\t\t\ttmp.innerHTML = this.filterString(r.error, r).replace(/\\n/g, '<br/>');\n\t\t\t\ttmp.classList.remove('x-hidden');\n\t\t\t\ttmp.onanimationend = () => tmp.classList.add('x-hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ((tmp = this.querySelector('.message.error')) != null)\n\t\t\t{\n\t\t\t\ttmp.innerHTML = this.filterString(r.error, r).replace(/\\n/g, '<br/>') || ('Error: ' + r.response);\n\t\t\t\ttmp.classList.remove('x-hidden');\n\t\t\t\ttmp.onanimationend = () => tmp.classList.add('x-hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\treset: function (nsilent)\n\t{\n\t\tthis.model.reset (nsilent);\n\t\tthis.clearMarkers();\n\n\t\tif (nsilent === false)\n\t\t{\n\t\t\tfor (var i in this.model.data)\n\t\t\t\tthis._setField (i, this.model.data[i], true);\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tsubmit: function ()\n\t{\n\t\tif (this.classList.contains('busy'))\n\t\t\treturn;\n\n\t\tlet data = { };\n\n\t\tif (this.dataset.strict == 'false')\n\t\t\tObject.assign(data, this.model.get());\n\n\t\tlet list = { };\n\t\tthis.querySelectorAll('[data-field]').forEach(e => list[e.dataset.field] = true);\n\t\tObject.keys(list).forEach(f => data[f] = this._getField(f));\n\n\t\tthis.model.set(data);\n\n\t\tlet f = this.dataset.formAction || this.formAction;\n\t\tif (!f) return;\n\n\t\tthis.clearMarkers();\n\n\t\tthis.classList.add('busy');\n\n\t\tif (typeof(f) != 'function')\n\t\t{\n\t\t\tdata.f = f;\n\t\t\tApi.apiCall(data, (r) => this[r.response == 200 ? '_onSuccess' : '_onFailure'](r), (r) => this._onFailure({ error: 'Unable to execute request.' }), this.dataset.method ?? 'POST');\n\t\t}\n\t\telse\n\t\t\tf(data, (r) => this[r.response == 200 ? '_onSuccess' : '_onFailure'](r));\n\t}\n});\n","/*\n**\telems/r-panel\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-panel data-route=\"name\">\n\t</r-panel>\n\n\tr-panel {\n\t\tdisplay: block;\n\t}\n\n\tr-panel:not(.active) {\n\t\tdisplay: none;\n\t}\n\n*/\n\nimport Element from '../element.js';\nimport Router from '../router.js';\n\nexport default Element.register ('r-panel',\n{\n\t/**\n\t**\tRoute object used by this element.\n\t*/\n\troute: null,\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.style.display = '';\n\n\t\t// Executed then the panel route is activated.\n\t\tthis._onActivate = (evt, args) =>\n\t\t{\n\t\t\tif (!args.route.changed)\n\t\t\t\treturn;\n\n\t\t\tthis.show(true);\n\t\t};\n\n\t\t// Executed then the panel route is deactivated.\n\t\tthis._onDeactivate = (evt, args) =>\n\t\t{\n\t\t\tthis.hide();\n\t\t};\n\n\t\tthis.hide();\n\t},\n\n\t/**\n\t**\tAdds a handler to Router if the data-route attribute was set.\n\t*/\n\tonConnected: function()\n\t{\n\t\tif (this.dataset.route)\n\t\t{\n\t\t\tthis.route = Router.addRoute (this.dataset.route, this._onActivate, this._onDeactivate);\n\t\t\tthis.classList.remove('active');\n\t\t}\n\t\telse\n\t\t\tthis.classList.add('active');\n\t},\n\n\t/**\n\t**\tRemoves a handler previously added to Router if the data-route attribute was set.\n\t*/\n\tonDisconnected: function()\n\t{\n\t\tif (this.dataset.route)\n\t\t\tRouter.removeRoute(this.dataset.route, this._onActivate, this._onDeactivate);\n\t},\n\n\t/**\n\t**\tHides the panel by removing the `active` class from the element. Fires `panelHidden` event.\n\t*/\n\thide: function ()\n\t{\n\t\tthis.classList.remove('active');\n\t\tthis.dispatch('panelHidden', this.route ? this.route.args : { });\n\t},\n\n\t/**\n\t**\tShows the panel visible by adding `active` class to the element. If `silent` is true and `data-route` enabled, the current route\n\t**\twill not be updated. Fires `panelShown` event.\n\t*/\n\tshow: function (silent=false)\n\t{\n\t\tif (this.dataset.route && !silent)\n\t\t{\n\t\t\tlet hash = \"#\" + this.dataset.route;\n\n\t\t\tif (window.location.hash.substr(0, hash.length) != hash)\n\t\t\t{\n\t\t\t\twindow.location = hash;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.classList.add('active');\n\t\tthis.dispatch('panelShown', this.route ? this.route.args : { });\n\t}\n});\n","/*\n**\telems/r-list\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-list data-list=\"window.dataList1\" data-container=\".x-data\" data-wrap=\"true|false\">\n\n\t\t<template data-mode=\"static|dynamic\">\n\t\t</template>\n\n\t\t<div class=\"x-empty\">\n\t\t\tNothing to show.\n\t\t</div>\n\n\t\t<div class=\"x-data\">\n\t\t</div>\n\n\t</r-list>\n\n\tCSS:\n\t\t.x-hidden {\n\t\t\tdisplay: none;\n\t\t}\n\n\tModifiers:\n\t\t.x-empty-null\t\tVisible when the list is in undefined state (before first load).\n\t\t.x-empty\t\t\tVisible when there is no data in the list.\n\t\t.x-not-empty \t\tVisible when there is data in the list.\n\t\t.x-loading \t\t\tVisible when the list is loading.\n*/\n\nimport { Rinn, ModelList, Template } from 'rinn';\nimport Element from '../element.js';\n\n/*\n**\tConnects to a ModelList and renders its contents using a template. When using \"dynamic\" template, the contents can be other custom elements, and\n**\tthe model of each item can be accessed by using data-model=\":list-item\", which will cause the item model to be added to the element.\n**\n**\tAdditionally root attribute data-wrap can be set to 'true' to wrap the template contents inside a div with a data-iid representing the ID of the\n**\titem, this will cause any changes to items to affect only the specific item in question.\n*/\n\nexport default Element.register ('r-list',\n{\n\tlist: null,\n\n\tcontainer: null,\n\ttemplate: null,\n\tisEmpty: false,\n\tisDynamicTemplate: false,\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tthis.container = this.querySelector(this.dataset.container || '.x-data');\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.container = document.createElement('div');\n\t\t\tthis.container.className = 'x-data';\n\t\t\tthis.appendChild(this.container);\n\t\t}\n\n\t\tlet tmp = this.template_elem = this.querySelector('template');\n\t\tif (tmp)\n\t\t{\n\t\t\tif (tmp.dataset.mode != 'dynamic')\n\t\t\t{\n\t\t\t\tthis.template = Template.compile(tmp.innerHTML);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.template = () => tmp.innerHTML;\n\t\t\t\tthis.isDynamicTemplate = true;\n\t\t\t}\n\n\t\t\ttmp.remove();\n\t\t}\n\t\telse\n\t\t\tthis.template = () => '';\n\n\t\tthis.container.textContent = ' ';\n\n\t\tthis.setEmpty(null);\n\t\tthis.setLoading(null);\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet list = this.getFieldByPath(this.dataset.list);\n\t\tif (!list)\n\t\t{\n\t\t\tconsole.error('List not found: ' + this.dataset.list);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setList (list);\n\t},\n\n\t/*\n\t**\tIndicates if the list is empty. Elements having x-empty, x-not-empty and x-empty-null will be updated.\n\t*/\n\tsetEmpty: function (value)\n\t{\n\t\tif (this.isEmpty === value)\n\t\t\treturn;\n\n\t\tif (value === true)\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-empty-null').forEach(i => i.classList.add('x-hidden'));\n\t\t}\n\t\telse if (value === false)\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-empty-null').forEach(i => i.classList.add('x-hidden'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-empty-null').forEach(i => i.classList.remove('x-hidden'));\n\t\t}\n\n\t\tthis.isEmpty = value;\n\t},\n\n\t/*\n\t**\tIndicates if the list is loading. Elements having x-loading will be updated.\n\t*/\n\tsetLoading: function (value)\n\t{\n\t\tif (value === true)\n\t\t\tthis.querySelectorAll('.x-loading').forEach(i => i.classList.remove('x-hidden'));\n\t\telse\n\t\t\tthis.querySelectorAll('.x-loading').forEach(i => i.classList.add('x-hidden'));\n\t},\n\n\t/**\n\t**\tSets the list model-list of the element.\n\t*/\n\tsetList: function (list)\n\t{\n\t\tif (!list || !Rinn.isInstanceOf(list, ModelList) || this.list === list)\n\t\t\treturn;\n\n\t\tif (this.list != null)\n\t\t{\n\t\t\tif (this.list.dataSource)\n\t\t\t\tthis.list.dataSource.removeEventListener (this.eid+':*');\n\n\t\t\tif (this.list.dataList)\n\t\t\t\tthis.list.dataList.removeEventListener (this.eid+':*');\n\n\t\t\tthis.list.removeEventListener (this.eid+':*');\n\t\t}\n\n\t\tthis.list = list;\n\n\t\tif (this.list.dataSource)\n\t\t{\n\t\t\tthis.list.dataSource.addEventListener (this.eid+':listLoading', this.onLoading, this);\n\t\t\tthis.list.dataSource.addEventListener (this.eid+':listLoaded', this.onLoaded, this);\n\t\t}\n\n\t\tif (this.list.dataList)\n\t\t{\n\t\t\tthis.list.dataList.addEventListener (this.eid+':listLoading', this.onLoading, this);\n\t\t\tthis.list.dataList.addEventListener (this.eid+':listLoaded', this.onLoaded, this);\n\t\t}\n\n\t\tthis.list.addEventListener (this.eid+':itemsCleared', this.onItemsCleared, this);\n\t\tthis.list.addEventListener (this.eid+':itemsChanged', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemRemoved', this.onItemRemoved, this);\n\t\tthis.list.addEventListener (this.eid+':itemChanged', this.onItemChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemAdded', this.onItemAdded, this);\n\t},\n\n\t/*\n\t**\tBuilds an item (inside a div) to be added to the container.\n\t*/\n\tbuildItem: function (iid, data, asHtml=false)\n\t{\n\t\tlet html = this.template(data.get());\n\t\tif (asHtml) return html;\n\n\t\tlet elem = document.createElement('div');\n\t\t\n\t\telem.dataset.iid = iid;\n\t\telem.innerHTML = html;\n\n\t\telem.querySelectorAll('[data-model=\":list-item\"]').forEach(i => {\n\t\t\ti.model = data;\n\t\t\ti.dataset.model = \"this.model\";\n\t\t});\n\n\t\tfor (let attr of this.template_elem.attributes)\n\t\t{\n\t\t\tif (attr.nodeName.startsWith('data-_') || attr.nodeName == 'data-mode')\n\t\t\t\tcontinue;\n\n\t\t\telem.setAttribute(attr.nodeName, attr.nodeValue);\n\t\t}\n\n\t\treturn elem;\n\t},\n\n\t/*\n\t**\tExecuted when the list is loading.\n\t*/\n\tonLoading: function()\n\t{\n\t\tthis.setLoading(true);\n\t},\n\n\t/*\n\t**\tExecuted when the list finished loading.\n\t*/\n\tonLoaded: function()\n\t{\n\t\tthis.setLoading(false);\n\t},\n\n\t/*\n\t**\tExecuted when the list is cleared.\n\t*/\n\tonItemsCleared: function()\n\t{\n\t\tthis.container._timeout = setTimeout(() => {\n\t\t\tthis.setEmpty(true);\n\t\t\tthis.container._timeout = null;\n\t\t\tthis.container.textContent = '';\n\t\t}, 300);\n\t},\n\n\t/*\n\t**\tExecuted when the items of the list changed.\n\t*/\n\tonItemsChanged: function()\n\t{\n\t\tif (this.list.length() == 0)\n\t\t\treturn;\n\n\t\tif (this.container._timeout)\n\t\t\tclearTimeout(this.container._timeout);\n\n\t\tthis.container._timeout = null;\n\t\tthis.container.textContent = '';\n\n\t\tlet i = 0;\n\n\t\tfor (let data of this.list.getData())\n\t\t{\n\t\t\tif (this.dataset.wrap != 'false')\n\t\t\t\tthis.container.append(this.buildItem(this.list.itemId[i++], data));\n\t\t\telse\n\t\t\t\tthis.container.innerHTML += this.buildItem(this.list.itemId[i++], data, true);\n\t\t}\n\n\t\tthis.setEmpty(i == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item is removed from the list.\n\t*/\n\tonItemRemoved: function(evt, args)\n\t{\n\t\tif (this.dataset.wrap == 'false')\n\t\t{\n\t\t\tthis.onItemsChanged();\n\t\t\treturn;\n\t\t}\n\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\telem.remove();\n\t\tthis.setEmpty(this.list.length() == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item changes.\n\t*/\n\tonItemChanged: function(evt, args)\n\t{\n\t\tif (this.isDynamicTemplate) return;\n\n\t\tif (this.dataset.wrap == 'false')\n\t\t{\n\t\t\tthis.onItemsChanged();\n\t\t\treturn;\n\t\t}\n\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\telem.innerHTML = this.template(args.item);\n\t},\n\n\t/*\n\t**\tExecuted when an item is added to the list.\n\t*/\n\tonItemAdded: function(evt, args)\n\t{\n\t\tif (args.position == 'head')\n\t\t{\n\t\t\tif (this.dataset.wrap != 'false')\n\t\t\t\tthis.container.prepend(this.buildItem(args.id, args.item));\n\t\t\telse\n\t\t\t\tthis.container.innerHTML = this.buildItem(args.id, args.item, true) + this.container.innerHTML;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.dataset.wrap != 'false')\n\t\t\t\tthis.container.append(this.buildItem(args.id, args.item));\n\t\t\telse\n\t\t\t\tthis.container.innerHTML += this.buildItem(args.id, args.item, true);\n\t\t}\n\n\t\tthis.setEmpty(false);\n\t},\n\n\t/**\n\t * \tForces re-rendering of the element.\n\t */\n\trefresh: function()\n\t{\n\t\tthis.onItemsChanged();\n\t}\n});\n","/*\n**\telems/r-item\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-item data-model=\"window.model1\">\n\t</r-item>\n*/\n\nimport Element from '../element.js';\n\nexport default Element.register ('r-item',\n{\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t},\n\n\t/**\n\t**\tExecuted when the children and root are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet model = this.getFieldByPath(this.dataset.model);\n\t\tif (!model) model = { };\n\n\t\tthis.setModel (model);\n\t}\n});\n","/*\n**\telems/r-paginator\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-paginator data-source=\"window.dataSource1\" data-page-size=\"25\">\n\t\t<span data-watch=\"count\">Showing [offsetStart] to [offsetEnd] out of [count]</span>\n\n\t\t<button data-action=\"firstPage\">First</button>\n\t\t<button data-action=\"prevPage\">&laquo;</button>\n\t\t<button data-action=\"nextPage\">&raquo;</button>\n\t\t<button data-action=\"lastPage\">Last</button>\n\t\t<button data-action=\"refresh\">Refresh</button>\n\n\t\t<input type=\"text\" data-property=\"pageSize\" />\n\t</r-paginator>\n*/\n\nimport { Rinn } from 'rinn';\nimport Element from '../element.js';\nimport DataSource from '../data-source.js';\n\n/*\n**\tConnects to a data source to provide pagination features.\n*/\n\nexport default Element.register ('r-paginator',\n{\n\tsource: null,\n\ttemplate: null,\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.setModel({\n\t\t\toffsetStart: 0,\n\t\t\toffsetEnd: 0,\n\t\t\tcount: 0, offset: 0,\n\t\t\tcurrentPageSize: this.dataset.pageSize || 25,\n\t\t\tpageSize: this.dataset.pageSize || 25\n\t\t});\n\n\t\tthis.listen('propertyChanged.pageSize', (evt, args) =>\n\t\t{\n\t\t\tif (this.model.get('currentPageSize') == args.value)\n\t\t\t\treturn;\n\n\t\t\tthis.model.set('currentPageSize', args.value);\n\t\t\tthis.updateOffset('range');\n\t\t});\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet source = this.getFieldByPath(this.dataset.source);\n\t\tif (!source)\n\t\t{\n\t\t\tconsole.error('data-source not found: ' + this.dataset.source);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setSource(source);\n\t},\n\n\t/**\n\t**\tSets the source model-list of the paginator.\n\t*/\n\tsetSource: function (source)\n\t{\n\t\tif (!source || !Rinn.isInstanceOf(source, DataSource) || this.source === source)\n\t\t\treturn;\n\n\t\tif (this.source != null)\n\t\t{\n\t\t\tthis.source.removeEventListener (this.eid+':*');\n\t\t\tthis.source.includeCount = false;\n\t\t}\n\n\t\tthis.source = source;\n\n\t\tthis.source.includeCount = true;\n\t\tthis.updateOffset();\n\n\t\tthis.source.addEventListener (this.eid+':requestPropertyChanged', this.onRequestPropertyChanged, this);\n\t\tthis.source.addEventListener (this.eid+':countChanged', this.onCountChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemRemoved', this.onItemRemoved, this);\n\t\tthis.source.addEventListener (this.eid+':listItemAdded', this.onItemAdded, this);\n\n\t\tthis.source.setNamespace(this.eid);\n\t\tthis.source.request.update(true);\n\t\tthis.source.setNamespace(null);\n\t},\n\n\t/*\n\t**\tUpdates several offset related fields in the paginator model. Optionally refreshes the data source with the specified mode.\n\t*/\n\tupdateOffset: function(mode=null)\n\t{\n\t\tthis.model.set('offsetStart', this.model.get('count') != 0 ? this.model.get('offset') + 1 : 0);\n\t\tthis.model.set('offsetEnd', Math.min(this.model.get('count'), this.model.get('offsetStart') + this.model.getInt('pageSize') - 1));\n\t\tthis.model.update('count');\n\n\t\tlet _count = this.source.request.get('count');\n\t\tlet _offset = this.source.request.get('offset');\n\n\t\tthis.source.request.set('count', this.model.getInt('pageSize'));\n\t\tthis.source.request.set('offset', this.model.get('offset'));\n\n\t\tif (mode && (_count != this.source.request.get('count') || _offset != this.source.request.get('offset')))\n\t\t\tthis.source.refresh(mode);\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the source request changes. The property is copied to the local model.\n\t*/\n\tonRequestPropertyChanged: function(evt, args)\n\t{\n\t\tif (args.name == 'count' || args.name == 'offset')\n\t\t\treturn;\n\n\t\tthis.model.set(args.name, args.value);\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the model has changed. The property is copied to the data source request model.\n\t*/\n\tonModelPropertyChanged: function (evt, args)\n\t{\n\t\tlet ignored = [\n\t\t\t'offsetStart',\n\t\t\t'offsetEnd',\n\t\t\t'count',\n\t\t\t'offset',\n\t\t\t'currentPageSize',\n\t\t\t'pageSize'\n\t\t];\n\n\t\tif (ignored.indexOf(args.name) != -1)\n\t\t\treturn;\n\n\t\tif (this.source.request.get(args.name) == args.value)\n\t\t\treturn;\n\n\t\tthis.source.request.set(args.name, args.value);\n\t\tthis.source.refresh('filter');\n\t},\n\n\t/*\n\t**\tExecuted when the remote count changes.\n\t*/\n\tonCountChanged: function(evt, args)\n\t{\n\t\tthis.model.set('count', evt.source.count, false);\n\t\tthis.updateOffset();\n\t},\n\n\t/*\n\t**\tExecuted when an item is removed from the list.\n\t*/\n\tonItemRemoved: function(evt, args)\n\t{\n\t\tthis.model.set('count', this.model.getInt('count') - 1, false);\n\t\tthis.updateOffset();\n\t},\n\n\t/*\n\t**\tExecuted when an item is added to the list.\n\t*/\n\tonItemAdded: function(evt, args)\n\t{\n\t\tthis.model.set('count', this.model.getInt('count') + 1, false);\n\t\tthis.updateOffset();\n\t},\n\n\t/*\n\t**\tMoves to the previous page.\n\t*/\n\tprevPage: function()\n\t{\n\t\tif (this.model.get('offset') <= 0)\n\t\t\treturn;\n\n\t\tlet offs = this.model.get('offset') - this.model.getInt('pageSize');\n\t\tif (offs < 0) offs = 0;\n\n\t\tthis.model.set('offset', offs);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tMoves to the next page.\n\t*/\n\tnextPage: function()\n\t{\n\t\tlet offs = this.model.get('offset') + this.model.getInt('pageSize');\n\t\tif (offs >= this.model.get('count')) return;\n\n\t\tthis.model.set('offset', offs);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tMoves to the first page.\n\t*/\n\tfirstPage: function()\n\t{\n\t\tthis.model.set('offset', 0);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tMoves to the last page.\n\t*/\n\tlastPage: function()\n\t{\n\t\tlet offs = this.model.get('count') - this.model.getInt('pageSize');\n\t\tif (offs < 0) offs = 0;\n\n\t\tthis.model.set('offset', offs);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tRefreshes the data source.\n\t*/\n\trefresh: function()\n\t{\n\t\tthis.source.refresh('full');\n\t},\n\n\t/*\n\t**\tClears (set to empty) the specified fields from the data source's request parameters.\n\t*/\n\tclear: function(args)\n\t{\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t\tthis.model.set(args[i], '');\n\t}\n});\n","/*\n**\telems/r-table\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-table data-source=\"window.dataSource1\">\n\t\t<table>\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>A</th>\n\t\t\t\t\t<th>B</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\n\t\t\t<tbody class=\"x-data\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>[a]</td>\n\t\t\t\t\t<td>[b]</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</r-table>\n\n\tCSS:\n\t\t.x-hidden {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\tth[data-sort] {\n\t\t\tpointer: cursor; text-decoration: underline;\n\t\t}\n\n\t\tth[data-sort][data-order=\"asc\"]:after {\n\t\t\tcontent: \"ASC\";\n\t\t}\n\n\t\tth[data-sort][data-order=\"desc\"]:after {\n\t\t\tcontent: \"DESC\";\n\t\t}\n\n\tModifiers:\n\t\t.x-empty\t\t\tAdd to elements that should be shown only when there is no data in the data source.\n\t\t.x-not-empty \t\tAdd to elements that should be shown only when there is data in the data source.\n\t\t[data-sort]\t\t\tAdded to th/td elements in thead, marks the column as sortable.\n*/\n\nimport { Rinn, Template } from 'rinn';\nimport Element from '../element.js';\nimport DataSource from '../data-source.js';\n\n/*\n**\tConnects to a DataSource and renders its contents as a table.\n*/\n\nexport default Element.register ('r-table',\n{\n\tsource: null,\n\ttemplate: null,\n\tcontainer: null,\n\tisEmpty: null,\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.setModel({ });\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tthis.container = this.querySelector(this.dataset.container || 'tbody.x-data');\n\t\tif (!this.container) throw new Error ('r-table requires a container');\n\n\t\tif (this.container.dataset.mode != 'dynamic')\n\t\t\tthis.template = Template.compile(this.container.innerHTML);\n\t\telse\n\t\t\tthis.template = () => this.container.innerHTML;\n\n\t\tthis.temporalBody = document.createElement('tbody');\n\t\tthis.container.textContent = ' ';\n\n\t\tthis.setEmpty(true);\n\t},\n\n\t/**\n\t**\tExecuted when the children and root elements are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet source = this.getFieldByPath(this.dataset.source);\n\t\tif (!source)\n\t\t{\n\t\t\tconsole.error('data-source not found: ' + this.dataset.source);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setSource (source);\n\t},\n\n\t/*\n\t**\tIndicates if the table is empty. Elements having .x-not-empty will be hidden.\n\t*/\n\tsetEmpty: function (value)\n\t{\n\t\tif (this.isEmpty === value)\n\t\t\treturn;\n\n\t\tif (value)\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t}\n\n\t\tthis.isEmpty = value;\n\t},\n\n\t/**\n\t**\tSets the data source of the element.\n\t*/\n\tsetSource: function (source)\n\t{\n\t\tif (!source || !Rinn.isInstanceOf(source, DataSource) || this.source === source)\n\t\t\treturn;\n\n\t\tif (this.source != null)\n\t\t\tthis.source.removeEventListener (this.eid+':*');\n\n\t\tthis.source = source;\n\n\t\tthis.source.addEventListener (this.eid+':requestPropertyChanged', this.onRequestPropertyChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemsCleared', this.onItemsCleared, this);\n\t\tthis.source.addEventListener (this.eid+':listItemsChanged', this.onItemsChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemRemoved', this.onItemRemoved, this);\n\t\tthis.source.addEventListener (this.eid+':listItemChanged', this.onItemChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemAdded', this.onItemAdded, this);\n\n\t\tthis.source.setNamespace(this.eid);\n\t\tthis.source.request.update(true);\n\t\tthis.source.setNamespace(null);\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the source request changes. The property is copied to the local model.\n\t*/\n\tonRequestPropertyChanged: function(evt, args)\n\t{\n\t\tthis.model.set(args.name, args.value);\n\n\t\tif (args.name == 'sort')\n\t\t{\n\t\t\tthis.querySelectorAll('thead [data-sort]').forEach(i => i.dataset.order = '');\n\t\t}\n\t\telse if (args.name == 'order')\n\t\t{\n\t\t\tlet elem = this.querySelector('thead [data-sort=\"'+evt.source.get('sort')+'\"]');\n\t\t\tif (elem) elem.dataset.order = args.value;\n\t\t}\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the model has changed. The property is copied to the data source request model.\n\t*/\n\tonModelPropertyChanged: function (evt, args)\n\t{\n\t\tif (this.source.request.get(args.name) == args.value)\n\t\t\treturn;\n\n\t\tthis.source.request.set(args.name, args.value);\n\n\t\tlet ignored = [\n\t\t\t'count',\n\t\t\t'offset'\n\t\t];\n\n\t\tif (ignored.indexOf(args.name) != -1)\n\t\t\treturn;\n\n\t\tthis.source.refresh('filter');\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the model is removed.\n\t*/\n\tonModelPropertyRemoved: function (evt, args)\n\t{\n\t\tif (typeof(args.fields) == 'string')\n\t\t\tthis.source.request.remove(i);\n\t\telse\n\t\t\targs.fields.forEach(i => this.source.request.remove(i));\n\n\t\tthis.source.refresh('filter');\n\t},\n\n\t/*\n\t**\tBuilds an item to be added to the container.\n\t*/\n\tbuildItem: function (iid, data)\n\t{\n\t\tlet elem = this.temporalBody;\n\n\t\telem.innerHTML = this.template(data.get());\n\n\t\telem.querySelectorAll('[data-model=\":list-item\"]').forEach(i => {\n\t\t\ti.model = data;\n\t\t\ti.dataset.model = \"this.model\";\n\t\t});\n\n\t\telem = elem.firstElementChild;\n\t\telem.dataset.iid = iid;\n\n\t\treturn elem;\n\t},\n\n\t/*\n\t**\tExecuted when the list is cleared.\n\t*/\n\tonItemsCleared: function(evt, args)\n\t{\n\t\tthis.container._timeout = setTimeout(() => {\n\t\t\tthis.setEmpty(true);\n\t\t\tthis.container._timeout = null;\n\t\t\tthis.container.textContent = '';\n\t\t}, 300);\n\t},\n\n\t/*\n\t**\tExecuted when the items of the list changed.\n\t*/\n\tonItemsChanged: function(evt, args)\n\t{\n\t\tif (this.source.list.length() == 0)\n\t\t\treturn;\n\n\t\tif (this.container._timeout)\n\t\t\tclearTimeout(this.container._timeout);\n\n\t\tthis.container._timeout = null;\n\t\tthis.container.textContent = '';\n\n\t\tlet i = 0;\n\n\t\tfor (let data of this.source.list.getData())\n\t\t\tthis.container.append(this.buildItem(this.source.list.itemId[i++], data));\n\n\t\tthis.setEmpty(i == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item is removed from the list.\n\t*/\n\tonItemRemoved: function(evt, args)\n\t{\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\telem.remove();\n\t\tthis.setEmpty(this.source.list.length() == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item changes.\n\t*/\n\tonItemChanged: function(evt, args)\n\t{\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\tlet _elem = this.buildItem(args.id, args.item);\n\t\tthis.container.replaceChild(_elem, elem);\n\t},\n\n\t/*\n\t**\tExecuted when an item is added to the list.\n\t*/\n\tonItemAdded: function(evt, args)\n\t{\n\t\tif (args.position == 'head')\n\t\t\tthis.container.prepend(this.buildItem(args.id, args.item));\n\t\telse\n\t\t\tthis.container.append(this.buildItem(args.id, args.item));\n\n\t\tthis.setEmpty(false);\n\t},\n\n\t/*\n\t**\tHandles clicks to data-sort elements.\n\t*/\n\t\"event click thead [data-sort]\": function(evt, args)\n\t{\n\t\tif (this.source.request.get('sort') == evt.source.dataset.sort)\n\t\t{\n\t\t\tthis.source.request.set('order', this.source.request.get('order') == 'asc' ? 'desc' : 'asc');\n\t\t\tthis.source.refresh('order');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.source.request.set('sort', evt.source.dataset.sort);\n\t\t\tthis.source.request.set('order', 'asc', true);\n\t\t\tthis.source.refresh('order');\n\t\t}\n\t},\n\n\t/*\n\t**\tRefreshes the data source.\n\t*/\n\trefresh: function()\n\t{\n\t\tthis.source.refresh('full');\n\t},\n\n\t/*\n\t**\tClears (set to empty) the specified fields from the data source's request parameters.\n\t*/\n\tclear: function(args)\n\t{\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t\tthis.model.set(args[i], '');\n\t}\n});\n","/*\n**\telems/r-select\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-select data-list=\"window.dataList1\" data-blank=\"\"></r-select>\n*/\n\nimport { Rinn, ModelList } from 'rinn';\nimport Element from '../element.js';\n\n/*\n**\tConnects to a ModelList and renders its contents as a <select> element.\n*/\n\nexport default Element.register ('r-select',\n{\n\tlist: null,\n\tcontainer: null,\n\n\tvalue: '',\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.container = document.createElement('select');\n\t\tthis.parentElement.insertBefore(this.container, this);\n\n\t\tlet list = [];\n\n\t\tfor (let attr of this.attributes)\n\t\t{\n\t\t\tif (attr.nodeName.startsWith('data-_') || attr.nodeName == 'data-list' || attr.nodeName == 'data-blank')\n\t\t\t\tcontinue;\n\n\t\t\tthis.container.setAttribute(attr.nodeName, attr.nodeValue);\n\t\t\tlist.push(attr.nodeName);\n\t\t}\n\n\t\tlist.forEach(i => this.removeAttribute(i));\n\n\t\tthis.textContent = ' ';\n\t\tthis.style.display = 'none';\n\t},\n\n\t/**\n\t**\tExecuted when the children and parent of the element are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet list = this.getFieldByPath(this.dataset.list);\n\t\tif (!list)\n\t\t{\n\t\t\tconsole.error('List not found: ' + this.dataset.list);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setList(list);\n\n\t\tif (this.parentElement.lastElementChild !== this)\n\t\t\tthis.parentElement.append(this);\n\t},\n\n\t/**\n\t**\tSets the list model-list of the element.\n\t*/\n\tsetList: function (list)\n\t{\n\t\tif (!list || !Rinn.isInstanceOf(list, ModelList) || this.list === list)\n\t\t\treturn;\n\n\t\tif (this.list != null)\n\t\t\tthis.list.removeEventListener (this.eid+':*');\n\n\t\tthis.list = list;\n\n\t\tif (this.list.dataSource)\n\t\t\tthis.list.dataSource.includeEnum = true;\n\n\t\tthis.list.addEventListener (this.eid+':itemsCleared', this.onItemsCleared, this);\n\t\tthis.list.addEventListener (this.eid+':itemsChanged', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemRemoved', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemChanged', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemAdded', this.onItemsChanged, this);\n\n\t\tthis.onItemsChanged();\n\t},\n\n\t/*\n\t**\tExecuted when the list is cleared.\n\t*/\n\tonItemsCleared: function(evt, args)\n\t{\n\t\tthis.container.textContent = '';\n\t},\n\n\t/*\n\t**\tExecuted when the items of the list changed.\n\t*/\n\tonItemsChanged: function(evt, args)\n\t{\n\t\tif (this.list.length() == 0)\n\t\t\treturn;\n\n\t\tlet list = this.list.getData();\n\t\tlet value, label, s = '';\n\n\t\tif (list[0].has('value')) value = 'value';\n\t\telse if (list[0].has('id')) value = 'id';\n\n\t\tif (list[0].has('label')) label = 'label';\n\t\telse if (list[0].has('name')) label = 'name';\n\n\t\tif ('blank' in this.dataset)\n\t\t\ts += '<option value=\"\">'+this.dataset.blank+'</option>';\n\n\t\tif (list[0].has('group'))\n\t\t{\n\t\t\tlet groups = { };\n\t\t\tlist.forEach(i => groups[i.get('group')] = null);\n\n\t\t\tfor (let i in groups)\n\t\t\t\tgroups[i] = { name: i, list: [] };\n\n\t\t\tlist.forEach(i => groups[i.get('group')].list.push(i));\n\n\t\t\tgroups = Object.values(groups);\n\t\t\tgroups.forEach(g => {\n\t\t\t\ts += '<optgroup label=\"'+g.name+'\">';\n\t\t\t\tg.list.forEach(i => s += '<option value=\"'+i.get(value)+'\">'+i.get(label)+'</option>');\n\t\t\t\ts += '</optgroup>';\n\t\t\t});\n\t\t}\n\t\telse\n\t\t\tlist.forEach(i => s += '<option value=\"'+i.get(value)+'\">'+i.get(label)+'</option>');\n\n\t\tthis.container.innerHTML = s;\n\t\tthis.container.value = this.container.dataset.value;\n\t},\n\n\t/**\n\t * \tForces re-rendering of the element.\n\t */\n\trefresh: function()\n\t{\n\t\tthis.onItemsChanged();\n\t}\n});\n","/*\n**\triza/utils\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nconst Utils =\n{\n\t/**\n\t**\tForces the browser to show a download dialog.\n\t*/\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t**\tForces the browser to show a file selection dialog.\n\t*/\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function () {\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as a dataURL.\n\t*/\n\tloadAsDataUrl: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result, null);\n\t\t};\n\n\t\treader.onerror = function(e) {\n\t\t\tcallback (null, e);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as text.\n\t*/\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as an array buffer.\n\t*/\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t**\tLoads an array of URLs using FileReader and returns them as data url.\n\t*/\n\tloadAllAsDataUrl: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tUtils.loadAsDataUrl (fileList[i], function(url, err) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\t}\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t},\n\n\t/*\n\t**\tLoads a URL as an image.\n\t*/\n\tloadImageFromUrl: function (url, callback)\n\t{\n\t\tlet image = new Image();\n\t\timage.onload = () => callback(image);\n\t\timage.onerror = () => callback(null);\n\t\timage.src = url;\n\t}\n};\n\nexport default Utils;\n","/*\n**\telems/r-image-cropper\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-image-cropper>\n\t</r-image-cropper>\n*/\n\nimport Element from '../element.js';\nimport Utils from '../utils.js';\n\nexport default Element.register ('r-image-cropper',\n{\n\t/*\n\t**\tDefault aspect ratio.\n\t*/\n\taspectRatio: 1,\n\n\t/*\n\t**\tCurrent image scale.\n\t*/\n\timageScale0: 0, imageScale: 1,\n\n\t/*\n\t**\tImage translation offsets.\n\t*/\n\timageOffsX: 0, imageOffsY: 0,\n\n\t/*\n\t**\tPointer contexts.\n\t*/\n\tpointerA: null, pointerB: null,\n\n\t/*\n\t**\tClient bounding box.\n\t*/\n\tbounds: null,\n\n\t/*\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.canvas = document.createElement('canvas');\n\t\tthis.appendChild(this.canvas);\n\n\t\tthis.g = this.canvas.getContext('2d');\n\n\t\tthis.pointerA = { id: null, active: false, sx: 0, sy: 0, cx: 0, cy: 0, ix: 0, iy: 0 };\n\t\tthis.pointerB = { id: null, active: false, sx: 0, sy: 0, cx: 0, cy: 0, ix: 0, iy: 0 };\n\n\t\tthis.log = document.createElement('div');\n\t\tthis.appendChild(this.log);\n\t},\n\n\t/*\n\t**\tSets the image for the cropper from an image URL.\n\t*/\n\tsetImageUrl: function(url)\n\t{\n\t\tUtils.loadImageFromUrl(url, (image) => {\n\t\t\tthis.setImage(image);\n\t\t});\n\t},\n\n\t/*\n\t**\tSets the image for the cropper from an HTML File object.\n\t*/\n\tsetImageFile: function(file)\n\t{\n\t\tUtils.loadAsDataUrl(file, (url) => {\n\t\t\tUtils.loadImageFromUrl(url, (image) => {\n\t\t\t\tthis.setImage(image);\n\t\t\t});\n\t\t});\n\t},\n\n\t/*\n\t**\tSets the cropper image from an HTML Image element.\n\t*/\n\tsetImage: function(image)\n\t{\n\t\tthis.image = image;\n\n\t\tthis.reset();\n\n\t\tthis.imageScale = Math.max(this.canvas.width / this.image.width, this.canvas.height / this.image.height);\n\n\t\tthis.imageOffsX = (this.canvas.width - this.imageScale*this.image.width)*0.5;\n\t\tthis.imageOffsY = (this.canvas.height - this.imageScale*this.image.height)*0.5;\n\n\t\tthis.render();\n\t},\n\n\t/*\n\t**\tReturns the blob and URL representing the current canvas state.\n\t*/\n\tgetBlobAndUrl: function(callback, type='image/png', quality=0.9)\n\t{\n\t\tthis.canvas.toBlob((blob) => {\n\t\t\tcallback(blob, URL.createObjectURL(blob));\n\t\t},\n\t\ttype, quality);\n\t},\n\n\t/*\n\t**\tAuto-resizes the canvas to ensure the aspect ratio is maintained.\n\t*/\n\treset: function()\n\t{\n\t\tthis.bounds = this.getBoundingClientRect();\n\n\t\tthis.canvas.width = this.bounds.width;\n\t\tthis.canvas.height = this.bounds.width/this.aspectRatio;\n\t},\n\n\t/*\n\t**\tAuto-resizes the canvas to ensure the aspect ratio is maintained and renders the image.\n\t*/\n\trender: function()\n\t{\n\t\tthis.canvas.width = this.canvas.width;\n\n\t\tthis.g.fillStyle = '#000';\n\t\tthis.g.beginPath();\n\t\tthis.g.rect(0, 0, this.canvas.width, this.canvas.height);\n\t\tthis.g.fill();\n\n\t\tthis.g.translate(this.imageOffsX, this.imageOffsY);\n\t\tthis.g.scale(this.imageScale, this.imageScale);\n\t\tthis.g.drawImage(this.image, 0, 0);\n\t},\n\n\t/*\n\t**\tTranslates the image by the given offsets.\n\t*/\n\ttranslateImage: function(offsX, offsY)\n\t{\n\t\tthis.imageOffsX += offsX;\n\t\tthis.imageOffsY += offsY;\n\n\t\tthis.render(true);\n\t},\n\n\t/*\n\t**\tHandle mouse events on the canvas.\n\t*/\n\t\"event mousemove canvas\": function(evt)\n\t{\n\t\tif (this.pointerA.active)\n\t\t{\n\t\t\tthis.pointerA.cx = evt.clientX;\n\t\t\tthis.pointerA.cy = evt.clientY;\n\n\t\t\tthis.translateImage(this.pointerA.cx - this.pointerA.sx, this.pointerA.cy - this.pointerA.sy);\n\n\t\t\tthis.pointerA.sx = this.pointerA.cx;\n\t\t\tthis.pointerA.sy = this.pointerA.cy;\n\t\t}\n\n\t\tthis.pointerA.ix = ((evt.clientX-this.bounds.left) - this.imageOffsX) / this.imageScale;\n\t\tthis.pointerA.iy = ((evt.clientY-this.bounds.top) - this.imageOffsY) / this.imageScale;\n\t},\n\n\t\"event mousedown canvas\": function(evt)\n\t{\n\t\tthis.pointerA.active = true;\n\t\tthis.pointerA.sx = evt.clientX;\n\t\tthis.pointerA.sy = evt.clientY;\n\t},\n\n\t\"event mouseup canvas\": function(evt)\n\t{\n\t\tthis.pointerA.active = false;\n\t},\n\n\t\"event wheel canvas\": function(evt)\n\t{\n\t\tif (evt.deltaY > 0)\n\t\t\tthis.imageScale -= 0.045;\n\t\telse\n\t\t\tthis.imageScale += 0.045;\n\n\t\tif (this.imageScale < 0.1) this.imageScale = 0.1;\n\n\t\tthis.imageOffsX += -this.pointerA.ix*this.imageScale + (evt.clientX-this.bounds.left) - this.imageOffsX;\n\t\tthis.imageOffsY += -this.pointerA.iy*this.imageScale + (evt.clientY-this.bounds.top) - this.imageOffsY;\n\n\t\tthis.render();\n\t},\n\n\t/*\n\t**\tHandle touch events on the canvas.\n\t*/\n\t\"event touchmove canvas\": function(evt)\n\t{\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerA.cx = i.clientX;\n\t\t\t\tthis.pointerA.cy = i.clientY;\n\t\t\t}\n\t\t\telse if (this.pointerB.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerB.cx = i.clientX;\n\t\t\t\tthis.pointerB.cy = i.clientY;\n\t\t\t}\n\t\t}\n\n\t\tif (this.pointerA.active && this.pointerB.active)\n\t\t{\n\t\t\tlet d0 = Math.sqrt(Math.pow(this.pointerA.sx-this.pointerB.sx, 2) + Math.pow(this.pointerA.sy-this.pointerB.sy, 2));\n\t\t\tlet d1 = Math.sqrt(Math.pow(this.pointerA.cx-this.pointerB.cx, 2) + Math.pow(this.pointerA.cy-this.pointerB.cy, 2));\n\n\t\t\tlet d = d1 - d0;\n\t\t\tthis.imageScale += (d/10)*0.025;\n\t\t\tif (this.imageScale < 0.1) this.imageScale = 0.1;\n\n\t\t\tthis.imageOffsX += -this.pointerA.ix*this.imageScale + (this.pointerA.cx-this.bounds.left) - this.imageOffsX;\n\t\t\tthis.imageOffsY += -this.pointerA.iy*this.imageScale + (this.pointerA.cy-this.bounds.top) - this.imageOffsY;\n\n\t\t\tthis.pointerA.sx = this.pointerA.cx;\n\t\t\tthis.pointerA.sy = this.pointerA.cy;\n\n\t\t\tthis.pointerB.sx = this.pointerB.cx;\n\t\t\tthis.pointerB.sy = this.pointerB.cy;\n\n\t\t\tthis.render();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet p = this.pointerA.active ? this.pointerA : (this.pointerB.active ? this.pointerB : null);\n\t\t\tif (!p) return;\n\n\t\t\tthis.translateImage(p.cx - p.sx, p.cy - p.sy);\n\n\t\t\tp.sx = p.cx;\n\t\t\tp.sy = p.cy;\n\t\t}\n\t},\n\n\t\"event touchstart canvas\": function(evt)\n\t{\n\t\tthis.imageScale0 = this.imageScale;\n\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id === null)\n\t\t\t{\n\t\t\t\tthis.pointerA.id = i.identifier;\n\t\t\t\tthis.pointerA.active = true;\n\t\t\t\tthis.pointerA.sx = i.clientX;\n\t\t\t\tthis.pointerA.sy = i.clientY;\n\t\t\t\tthis.pointerA.ix = ((i.clientX-this.bounds.left) - this.imageOffsX) / this.imageScale;\n\t\t\t\tthis.pointerA.iy = ((i.clientY-this.bounds.top) - this.imageOffsY) / this.imageScale;\n\t\t\t}\n\t\t\telse if (this.pointerB.id === null)\n\t\t\t{\n\t\t\t\tthis.pointerB.id = i.identifier;\n\t\t\t\tthis.pointerB.active = true;\n\t\t\t\tthis.pointerB.sx = i.clientX;\n\t\t\t\tthis.pointerB.sy = i.clientY;\n\t\t\t\tthis.pointerB.ix = ((i.clientX-this.bounds.left) - this.imageOffsX) / this.imageScale;\n\t\t\t\tthis.pointerB.iy = ((i.clientY-this.bounds.top) - this.imageOffsY) / this.imageScale;\n\t\t\t}\n\t\t}\n\t},\n\n\t\"event touchend canvas\": function(evt)\n\t{\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerA.id = null;\n\t\t\t\tthis.pointerA.active = false;\n\t\t\t}\n\t\t\telse if (this.pointerB.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerB.id = null;\n\t\t\t\tthis.pointerB.active = false;\n\t\t\t}\n\t\t}\n\t},\n\n\t\"event touchcancel canvas\": function(evt)\n\t{\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerA.id = null;\n\t\t\t\tthis.pointerA.active = false;\n\t\t\t}\n\t\t\telse if (this.pointerB.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerB.id = null;\n\t\t\t\tthis.pointerB.active = false;\n\t\t\t}\n\t\t}\n\t}\n});\n","/*\r\n**\triza/elements\r\n**\r\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\r\n**\thttps://www.rsthn.com/\r\n**\r\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\r\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \r\n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\r\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \r\n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \r\n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \r\n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\r\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n*/\r\n\r\nimport _Tabs from './elems/r-tabs.js';\r\nimport _Form from './elems/r-form.js';\r\nimport _Panel from './elems/r-panel.js';\r\nimport _List from './elems/r-list.js';\r\nimport _Item from './elems/r-item.js';\r\nimport _Paginator from './elems/r-paginator.js';\r\nimport _Table from './elems/r-table.js';\r\nimport _Select from './elems/r-select.js';\r\nimport _ImageCropper from './elems/r-image-cropper.js';\r\n\r\nexport default {\r\n\tTabs: _Tabs,\r\n\tForm: _Form,\r\n\tPanel: _Panel,\r\n\tList: _List,\r\n\tItem: _Item,\r\n\tPaginator: _Paginator,\r\n\tTable: _Table,\r\n\tSelect: _Select,\r\n\tImageCropper: _ImageCropper\r\n};\r\n","/*\n**\triza/main\n**\n**\tCopyright (c) 2013-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport _Router from './router.js'; export const Router = _Router;\nimport _Element from './element.js'; export const Element = _Element; export const CElement = _Element;\nimport _Api from './api.js'; export const Api = _Api;\nimport _DataSource from './data-source.js'; export const DataSource = _DataSource;\nimport _DataList from './data-list.js'; export const DataList = _DataList;\nimport _Easing from './easing.js'; export const Easing = _Easing;\nimport _Anim from './anim.js'; export const Anim = _Anim;\nimport _Elements from './elements.js'; export const Elements = _Elements;\nimport _Utils from './utils.js'; export const Utils = _Utils;\n\nimport * as _Rinn from 'rinn';\nexport const Rinn = _Rinn.Rinn;\nexport const Class = _Rinn.Class;\nexport const Event = _Rinn.Event;\nexport const EventDispatcher = _Rinn.EventDispatcher;\nexport const Model = _Rinn.Model;\nexport const ModelList = _Rinn.ModelList;\nexport const Schema = _Rinn.Schema;\nexport const Flattenable = _Rinn.Flattenable;\nexport const Collection = _Rinn.Collection;\nexport const Template = _Rinn.Template;\n"],"names":["$e7a70fea451c1d66$export$2e2bcd8739ae039","_getref","value","obj","substr","get","eval","type","model","ctval","name","parseInt","isNaN","Error","parseFloat","toString","$0523981e283b00ea$export$2e2bcd8739ae039","typeOf","mclass","this","ensure","cls","ensureTypeOf","arrayof","i","length","arraynull","remove","splice","arraycompliant","isCompliant","required","minlen","maxlen","minval","maxval","mincount","maxcount","pattern","$dWhFJ","default","test","inset","RegExp","indexOf","join","upper","toUpperCase","lower","toLowerCase","$0523981e283b00ea$var$Rinn","invokeLater","fn","setTimeout","wait","millis","Promise","resolve","reject","o","Array","isArrayOrObject","clone","elem","push","merge","output","objs","arr","j","i1","field","override","partialCompare","full","partial","arrayFind","getObject","isInstanceOf","_class","$a25e6679217b277b$export$2e2bcd8739ae039","email","url","urlNoProt","uname","text","utext","$f7ca18717c214cf2$var$Class","_super","prototype","className","__ctor","__dtor","__proto__","hasOwnProperty","instanceOf","object","_initSuperRefs","constructor","_newSuper","self","_prot","a00","a01","a02","a03","a04","a05","a06","a07","a08","a09","a0A","call","$f7ca18717c214cf2$export$2e2bcd8739ae039","extend","source","args","_async","list","next","ret","original","eventName","eventArgs","cbHandler","cbContext","listeners","namespace","setNamespace","handler","context","data","split","ns","removeEventListener","k","e","s","a","concat","l","silent","$2c6c6d67abdc2b7f$export$2e2bcd8739ae039","t","n","r","silence","dispatchEvent","prepareEvent","resume","$jT52r","parcelRequire","$a8b14ab12911b661$var$_Model","$764fa7261ccc826a$export$2e2bcd8739ae039","defaults","constraints","changedList","_silent","_level","EventDispatcher","reset","def","init","set","update","ready","nsilent","_validate","nvalue","ctname","Constraints","message","_set","constraint","_propertyEvent","prev","direct","temp","old","level","evt","arguments","force","fields","has","flatten","getInt","getFloat","getBool","getReference","m","safe","rsafe","class","classPath","keys","ct","validate","observe","property","addEventListener","unobserve","watch","unwatch","serialize","$a8b14ab12911b661$export$2e2bcd8739ae039","$7468b7763b89e914$export$2e2bcd8739ae039","itemt","contents","itemId","nextId","Model","_eventGroup","Date","now","_bind","iid","item","_onItemEvent","_unbind","id","from","enqueue","clear","setData","getData","getAt","index","removeAt","setAt","updateAt","position","pop","unshift","shift","find","retObject","$2dc29f9b761160bd$var$Schema","Type","proto","unflatten","tmp","Integer","precision","_precision","Math","pow","compact","_compact","strings","type1","itemType","_filter","debug","v","_debug","callback","async","properties","defvalue","symbolic","classConstructor1","_constructor","classConstructor","name1","type2","conditions","when","val","$2dc29f9b761160bd$export$2e2bcd8739ae039","$bf08d17deb8143a2$export$2e2bcd8739ae039","typeSchema","itemTypeSchema","items","Property","is","of","add","itemsReferenceChanged","onItemRemoved","desc","sort","b","inc","exc","getItems","isEmpty","relative","first","last","addAt","onBeforeItemAdded","onItemAdded","$826d32eb9d4eff74$var$Template","strict","parseTemplate","template","sym_open","sym_close","is_tpl","root","nflush","flush","state","count","str","parts","mparts","nparts","emit","trim","map","i2","match","unescape","parse","clean","expand","mode","escape","quote","functions","failed","replace","f","compile","register","getNamedValues","expanded","key","startsWith","endsWith","global","globalThis","null","true","false","len","int","float","chr","String","fromCharCode","ord","charCodeAt","not","neg","abs","and","or","eq","ne","lt","le","gt","ge","isnotnull","isnull","iszero","typeof","x","mul","div","sum","sub","mod","dump","JSON","stringify","ref","_unset","start","nl2br","attr","Object","values","_each","var_name","_foreach","_if","_switch","case_value","_break","_continue","_repeat","to","step","tpl","_for","_loop","_echo","console","log","contains","err","_map","arrayMode","_call","i3","$826d32eb9d4eff74$export$2e2bcd8739ae039","$bb627624112967de$export$eefcfe56efaaa57d","$bb627624112967de$export$4c85e640eb41c31b","$bb627624112967de$export$d61e24a684f9e51","$bb627624112967de$export$ec8b666c5fe2c75a","$bb627624112967de$export$a1edc412be3e1841","$bb627624112967de$export$59eced47f477f85a","$bb627624112967de$export$19342e026b58ebb7","$bb627624112967de$export$3a9581c9ade29768","$bb627624112967de$export$fb8073518f34e6ec","$17304fb0bb8e3d4f$export$2e2bcd8739ae039","$bb627624112967de$export$14416b8d99d47caa","freeExports","exports","freeModule","module","freeGlobal","$parcel$global","window","InvalidCharacterError","error","TABLE","REGEX_SPACE_CHARACTERS","base64","encode","input","c","buffer","padding","charAt","decode","bitStorage","bitCounter","version","define","amd","nodeType","getGlobal","fetch","bind","Headers","Request","Response","$blBFb","$d84d8d45806dc16b$var$_Router","route","_compileRoute","params","exec","routeRegex","addHandler","unrouted","removeHandler","dispatch","matches","s_args","active","changed","alreadyAttached","onhashchange","onLocationChanged","location","realLocation","ignoreHashChangeEvent","hash","onRoute","onUnroute","routes","Route","sortedRoutes","undefined","cLocation","pLocation","rLocation","$ca3fcf8e000550f3$var$elementPrototypes","$ca3fcf8e000550f3$var$elementClasses","$ca3fcf8e000550f3$var$Element","events","opts","dataset","action","continuePropagation","enter","_list_watch","_list_visible","_list_property","isRoot","style","display","eid","random","setModel","reverse","forEach","tagName","parentElement","bindEvents","appendChild","document","createElement","markReady","readyLocked","isReady","collectWatchers","getFieldByPath","findCustomParent","checkReady","rootReady","getRoot","onRefAdded","rready","readyReenter","childNodes","result","evaluate","XPathResult","ANY_TYPE","iterateNext","path","findRoot","Rinn","modelt","onModelPreChanged","onModelPropertyChanging","onModelPropertyPreChanged","onModelPropertyRemoved","classString","classList","styleString","getBoundingClientRect","width","getHeight","height","evtstr","hdl","selector","listen","keyCode","routeStr","$d84d8d45806dc16b$export$2e2bcd8739ae039","getRoute","target","HTMLElement","detail","elems","querySelectorAll","preventDefault","stopPropagation","eventCatcher","eventImmediate","callback0","callback1","firstCapture","firstCaptureCount","queue","_eventHandler","q","removed","bubbles","MouseEvent","createEventObject","innerHTML","modified","_list_watch_length","_list_visible_length","_list_property_length","_template","Template","_watch","removeAttribute","selfWatch","_visible","visible","selfVisible","onchange","onblur","checked","getModel","getValue","onmouseup","selfProperty","filter","unbindRoutes","element","i4","removeProperty","setProperty","onModelChanged","trigger","setValue","onModelPropertyChanged","__prototypePrepared","protos","newElement","srcElement","connectReference","flags","connectedCallback","invokeConstructor","elementConnected","xref","disconnectedCallback","onRefRemoved","elementDisconnected","super","entries","onCreated","__init","$bvbjP","$parcel$interopDefault","$fEYYN","$8466926f6ae41387$var$Api","REQUEST_PACKAGE_SUPPORTED","REQ64_SUPPORTED","JSON_RESPONSE_SUPPORTED","XML_RESPONSE_SUPPORTED","INCLUDE_CREDENTIALS","UNIQUE_STAMP","apiUrl","_requestLevel","_packageData","res","req","_requestPackage","responseCallback","packageBegin","packageEnd","rpkg","encodeParams","apiCall","_hideProgress","response","responseFilter","documentElement","headers","FormData","encodeURIComponent","param","success","failure","httpMethod","retries","relativeUrl","getUrl","appendParam","Accept","method","body","multipart","options","credentials","Blob","File","append","useReq64","then","decodeResult","catch","json","debounceDelay","request","includeCount","includeEnum","includeList","basePath","config","assign","ModelList","dataSource","enum","forwardRequestEvent","forwardListEvent","forwardEnumEvent","setSource","_timeout","clearTimeout","$8466926f6ae41387$export$2e2bcd8739ae039","fetchCount","fetchEnum","fetchList","forced","fetchOne","fetchDelete","dataList","_callback","$f73c217df96b851c$var$Easing","interpolate","src","dst","duration","easing","time","x1","lastTime","dt","interpolator","curTime","requestAnimationFrame","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","sqrt","Cubic","Expo","Power","p","Quad","Quartic","Quintic","Sine","sin","cos","Step","$f73c217df96b851c$export$2e2bcd8739ae039","$d4a126a252834dad$var$Anim","Class","initialData","stack","block","timeScale","blockTime","paused","finished","onFinishedCallback","onUpdatedCallback","onFinished","onUpdated","handle","initial","speed","setOutput","pause","clearInterval","setInterval","_block","_index","_blockTime","cmd","op","started","blocks","indices","blockTimes","_count","startValue","_startValue","_endValue","endValue","cur","table","snd","play","parallel","serial","repeat","end","restart","range","rand","randt","$d4a126a252834dad$export$2e2bcd8739ae039","$b27015373240b597$export$2e2bcd8739ae039","$ca3fcf8e000550f3$export$2e2bcd8739ae039","container","baseRoute","selectTab","_routeHandler","link","href","showTab","tabName","previousElementSibling","nextElementSibling","querySelector","_hideTabsExcept","onConnected","addRoute","onDisconnected","removeRoute","exceptName","el","$d21f2928f1260214$export$2e2bcd8739ae039","formElement","names","clearMarkers","filterString","messages","_change","createEvent","initEvent","fireEvent","_setField","multiple","FileList","_getField","_value","fromFileFields","files","getField","_fieldChanged","_onSuccess","onanimationend","_onFailure","tmp1","errorsAt","prepend","insertBefore","submit","f1","formAction","_method","$48c22bd84c716956$export$2e2bcd8739ae039","_onActivate","show","_onDeactivate","hide","$4b069e6254998e3c$export$2e2bcd8739ae039","isDynamicTemplate","template_elem","textContent","setEmpty","setLoading","setList","onLoading","onLoaded","onItemsCleared","onItemsChanged","onItemChanged","buildItem","asHtml","html","attributes","nodeName","setAttribute","nodeValue","wrap","refresh","$192d490f83a3be8c$export$2e2bcd8739ae039","$3d4634cf8bfde3d6$export$2e2bcd8739ae039","offsetStart","offsetEnd","offset","currentPageSize","pageSize","updateOffset","$c53c5384dd6de168$export$2e2bcd8739ae039","onRequestPropertyChanged","onCountChanged","min","_offset","prevPage","offs","nextPage","firstPage","lastPage","$0affc23ca0ae1514$export$2e2bcd8739ae039","temporalBody","order","firstElementChild","_elem","replaceChild","$5dc0eb9351d003a7$export$2e2bcd8739ae039","lastElementChild","label","blank","groups","g","$da689da779f40f07$var$Utils","showDownload","filename","dataUrl","download","click","removeChild","showFilePicker","allowMultiple","accept","onfocus","loadAsDataUrl","file","reader","FileReader","onload","onerror","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataUrl","fileList","loadNext","size","loadImageFromUrl","image","Image","$da689da779f40f07$export$2e2bcd8739ae039","$7196355e72c99736$export$2e2bcd8739ae039","aspectRatio","imageScale0","imageScale","imageOffsX","imageOffsY","pointerA","pointerB","bounds","canvas","getContext","sx","sy","cx","cy","ix","iy","setImageUrl","setImage","setImageFile","max","render","getBlobAndUrl","quality","toBlob","blob","URL","createObjectURL","fillStyle","beginPath","rect","fill","translate","scale","drawImage","translateImage","offsX","offsY","clientX","clientY","left","top","deltaY","changedTouches","identifier","d0","d","$15d2bad297cfde1d$export$2e2bcd8739ae039","Tabs","Form","Panel","List","Item","Paginator","Table","Select","ImageCropper","$07eb01cb16db42c1$export$55185c17a0fcbe46","$07eb01cb16db42c1$export$db77ccec0bb4ccac","$07eb01cb16db42c1$export$9864de54bd63ed8a","$07eb01cb16db42c1$export$bf71da7aebe9ddc1","$07eb01cb16db42c1$export$accd73d198d77d2f","$07eb01cb16db42c1$export$d3568da47c78d35c","$3f8a6b6ee686e940$export$2e2bcd8739ae039","$07eb01cb16db42c1$export$cea96571ebbff9dd","$07eb01cb16db42c1$export$deefd61317ad2797","$07eb01cb16db42c1$export$3abb4be70fa2c84e","$07eb01cb16db42c1$export$d2ca453b913dcdea","$07eb01cb16db42c1$export$eefcfe56efaaa57d","$07eb01cb16db42c1$export$4c85e640eb41c31b","$07eb01cb16db42c1$export$d61e24a684f9e51","Event","$07eb01cb16db42c1$export$ec8b666c5fe2c75a","$07eb01cb16db42c1$export$a1edc412be3e1841","$07eb01cb16db42c1$export$59eced47f477f85a","$07eb01cb16db42c1$export$19342e026b58ebb7","Schema","$07eb01cb16db42c1$export$3a9581c9ade29768","Flattenable","$07eb01cb16db42c1$export$fb8073518f34e6ec","Collection","$07eb01cb16db42c1$export$14416b8d99d47caa"],"version":3,"file":"riza.js.map"}