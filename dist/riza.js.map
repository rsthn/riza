{"mappings":"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","sources":["node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model-constraints.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/alpha.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model-regex.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/main.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/class.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/event.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/event-dispatcher.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/model-list.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/schema.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/flattenable.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/collection.js","node_modules/.pnpm/rinn@2.0.47/node_modules/rinn/dist/src/template.js","node_modules/.pnpm/base-64@1.0.0/node_modules/base-64/base64.js","node_modules/.pnpm/node-fetch@2.6.7/node_modules/node-fetch/browser.js","src/router.js","src/element.js","src/api.js","src/data-source.js","src/data-list.js","src/easing.js","src/anim.js","src/elems/r-tabs.js","src/elems/r-form.js","src/elems/r-panel.js","src/elems/r-list.js","src/elems/r-item.js","src/elems/r-paginator.js","src/elems/r-table.js","src/elems/r-select.js","src/utils.js","src/elems/r-image-cropper.js","src/elements.js","src/db.js","src/_main.js"],"sourcesContent":["\nimport Rinn from './alpha.js';\nimport Regex from './model-regex.js';\n\n/**\n**\tMap of model constraint handlers. Each function should accept parameters (in order): the model object (model), the constraint value (ctval),\n**\tthe property name (name), the property value (value) and return the corrected value once verified or throw an exception if errors occur.\n*/\n\nexport default\n{\n\t/**\n\t**\tUtility function (not a handler) to get the real value given a reference string. If the value is not a string, the value itself will\n\t**\tbe returned, if it is a string starting with '#' the model property will be returned, if starts with '@' the object property will be\n\t**\treturned, otherwise the contents of the string will eval'd and returned.\n\t*/\n\t_getref: function (value, obj)\n\t{\n\t\tif (typeof(value) == \"string\")\n\t\t{\n\t\t\tif (value.substr(0, 1) == \"#\")\t\t\tvalue = obj.get(value.substr(1));\n\t\t\telse if (value.substr(0, 1) == \"@\")\t\tvalue = obj[value.substr(1)];\n\n\t\t\tif (typeof(value) == \"string\")\n\t\t\t\treturn eval(value);\n\n\t\t\treturn value;\n\t\t}\n\t\telse\n\t\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the new value is of the valid type before storing it on the property. When possible if the\n\t**\tinput is of compatible type it will be converted to the target type.\n\t*/\n\ttype: function (model, ctval, name, value)\n\t{\n\t\tswitch (ctval)\n\t\t{\n\t\t\tcase \"int\":\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"float\":\n\t\t\t\tvalue = parseFloat(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"string\":\n\t\t\t\tvalue = (value === null || value === undefined) ? \"\" : value.toString();\n\t\t\t\tbreak;\n\n\t\t\tcase \"bit\":\n\t\t\t\tif (value === true || value === false) {\n\t\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tvalue = parseInt(value);\n\t\t\t\tif (isNaN(value)) throw new Error (ctval);\n\n\t\t\t\tvalue = value ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tcase \"array\":\n\t\t\t\tif (Rinn.typeOf(value) == \"array\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (value === null || value === undefined)\n\t\t\t\t{\n\t\t\t\t\tvalue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\n\t\t\tcase \"bool\":\n\t\t\t\tif (value === \"true\" || value === true) {\n\t\t\t\t\tvalue = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (value === \"false\" || value === false) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthrow new Error (ctval);\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified model type.\n\t*/\n\tmodel: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!mclass) throw new Error (ctval);\n\n\t\tif (!value)\n\t\t\treturn new mclass();\n\n\t\treturn mclass.ensure (value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is of the specified class.\n\t*/\n\tcls: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) return new mclass();\n\n\t\treturn Rinn.ensureTypeOf(mclass, value);\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are of the specified class. Returns error if the class does not exist\n\t**\tor if the field is not an array. Therefore a type:array constraint should be used before this one.\n\t*/\n\tarrayof: function (model, ctval, name, value)\n\t{\n\t\tvar mclass = this._getref(ctval, model);\n\t\tif (!value) value = [];\n\n\t\tif (!mclass || Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t\tvalue[i] = Rinn.ensureTypeOf(mclass, value[i]);\n\t\t\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are not null. Returns error if the field is not an array, therefore a\n\t**\ttype:array constraint should be used before this one.\n\t*/\n\tarraynull: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the array contents are all compliant. Returns error if the field is not an array, therefore\n\t**\ta type:array constraint should be used before this one.\n\t*/\n\tarraycompliant: function (model, ctval, name, value)\n\t{\n\t\tvar remove = false;\n\n\t\tif (Rinn.typeOf(ctval) == \"object\")\n\t\t{\n\t\t\tif (ctval.remove) remove = ctval.remove;\n\t\t\tctval = ctval.value;\n\t\t}\n\n\t\tif (!ctval) return value;\n\n\t\tif (Rinn.typeOf(value) != \"array\")\n\t\t\tthrow new Error (ctval);\n\n\t\tfor (var i = 0; i < value.length; i++)\n\t\t{\n\t\t\tif (value[i] == null)\n\t\t\t\tcontinue;\n\n\t\t\tif (!value[i].isCompliant())\n\t\t\t{\n\t\t\t\tif (remove)\n\t\t\t\t\tvalue.splice (i--, 1);\n\t\t\t\telse\n\t\t\t\t\tthrow new Error (ctval);\n\t\t\t}\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the presense of the field.\n\t*/\n\trequired: function (model, ctval, name, value)\n\t{\n\t\tif (value === null || value === undefined)\n\t\t\tthrow new Error (ctval ? \"\" : \"null\");\n\n\t\tswitch (Rinn.typeOf(value))\n\t\t{\n\t\t\tcase \"array\":\n\t\t\t\tif (value.length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (value.toString().length == 0) throw new Error (ctval ? \"\" : \"null\");\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum length of the field.\n\t*/\n\tminlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum length of the field.\n\t*/\n\tmaxlen: function (model, ctval, name, value)\n\t{\n\t\tif (value.toString().length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum value of the field.\n\t*/\n\tminval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum value of the field.\n\t*/\n\tmaxval: function (model, ctval, name, value)\n\t{\n\t\tif (parseFloat(value) > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the minimum number of items in the array.\n\t*/\n\tmincount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length < ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the maximum number of items in the array.\n\t*/\n\tmaxcount: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(value) != \"array\" || value.length > ctval)\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies the format of the field using a regular expression. The constraint value should be the name of\n\t**\tone of the Model.Regex regular expressions.\n\t*/\n\tpattern: function (model, ctval, name, value)\n\t{\n\t\tif (!Regex[ctval].test (value.toString()))\n\t\t\tthrow new Error (ctval);\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tVerifies that the field is inside the specified set of options. The set can be an array or a string with\n\t**\tthe options separated by vertical bar (|). The comparison is case-sensitive.\n\t*/\n\tinset: function (model, ctval, name, value)\n\t{\n\t\tif (Rinn.typeOf(ctval) != \"array\")\n\t\t{\n\t\t\tif (!new RegExp(\"^(\"+ctval.toString()+\")$\").test (value.toString()))\n\t\t\t\tthrow new Error (ctval);\n\n\t\t\treturn value;\n\t\t}\n\n\t\tif (ctval.indexOf(value.toString()) == -1)\n\t\t\tthrow new Error (ctval.join(\"|\"));\n\n\t\treturn value;\n\t},\n\n\n\t/**\n\t**\tSets the field to upper case.\n\t*/\n\tupper: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toUpperCase() : value;\n\t},\n\n\n\t/**\n\t**\tSets the field to lower case.\n\t*/\n\tlower: function (model, ctval, name, value)\n\t{\n\t\treturn ctval ? value.toString().toLowerCase() : value;\n\t}\n};\n","\r\nconst Rinn = { };\r\nexport default Rinn;\r\n\r\n/*\r\n**\tInvokes the specified function 'fn' 10ms later.\r\n**\r\n**\t>> void invokeLater (function fn);\r\n*/\r\nRinn.invokeLater = function (fn)\r\n{\r\n\tif (fn) setTimeout (function() { fn(); }, 10);\r\n};\r\n\r\n\r\n/*\r\n**\tWaits for the specified amount of milliseconds. Returns a Promise.\r\n**\r\n**\t>> Promise wait (int millis);\r\n*/\r\nRinn.wait = function (millis)\r\n{\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tsetTimeout (resolve, millis);\r\n\t});\r\n};\r\n\r\n\r\n/*\r\n**\tReturns the type of an element 'o', properly detects arrays and null types. The return string is always in lowercase.\r\n**\r\n**\t>> string typeOf (any o);\r\n*/\r\nRinn.typeOf = function (o)\r\n{\r\n\tif (o instanceof Array)\r\n\t\treturn \"array\";\r\n\r\n\tif (o === null)\r\n\t\treturn \"null\";\r\n\r\n\treturn (typeof(o)).toString().toLowerCase();\r\n};\r\n\r\n\r\n/*\r\n**\tReturns boolean indicating if the type of the element is an array or an object.\r\n**\r\n**\t>> bool isArrayOrObject (any o);\r\n*/\r\nRinn.isArrayOrObject = function (o)\r\n{\r\n\tswitch (Rinn.typeOf(o))\r\n\t{\r\n\t\tcase \"array\": case \"object\":\r\n\t\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tCreates a clone (deep copy) of the specified element. The element can be an array, an object or a primitive type.\r\n**\r\n**\t>> T clone (T elem);\r\n*/\r\nRinn.clone = function (elem)\r\n{\r\n\tlet o = Rinn.typeOf(elem);\r\n\r\n\tif (o === 'array')\r\n\t{\r\n\t\to = [ ];\r\n\r\n\t\tfor (let i = 0; i < elem.length; i++)\r\n\t\t\to.push (Rinn.clone(elem[i]));\r\n\t}\r\n\telse if (o === 'object')\r\n\t{\r\n\t\tif (('clone' in elem) && typeof(elem.clone) === 'function')\r\n\t\t\treturn elem.clone();\r\n\r\n\t\to = { };\r\n\r\n\t\tfor (let i in elem)\r\n\t\t\to[i] = Rinn.clone(elem[i]);\r\n\t}\r\n\telse\r\n\t{\r\n\t\to = elem;\r\n\t}\r\n\r\n\treturn o;\r\n};\r\n\r\n\r\n/*\r\n**\tMerges all given elements into the first one, object fields are cloned.\r\n**\r\n**\t>> T merge (T... elems)\r\n*/\r\nRinn.merge = function (output, ...objs)\r\n{\r\n\tif (Rinn.typeOf(output) == \"array\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet arr = objs[i];\r\n\r\n\t\t\tif (Rinn.typeOf(arr) != \"array\")\r\n\t\t\t{\r\n\t\t\t\toutput.push(arr);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tfor (let j = 0; j < arr.length; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\toutput.push(Rinn.clone(arr[j]));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\telse if (Rinn.typeOf(output) == \"object\")\r\n\t{\r\n\t\tfor (let i = 0; i < objs.length; i++)\r\n\t\t{\r\n\t\t\tlet obj = objs[i];\r\n\t\t\tif (Rinn.typeOf(obj) != \"object\") continue;\r\n\r\n\t\t\tfor (let field in obj)\r\n\t\t\t{\r\n\t\t\t\tif (Rinn.isArrayOrObject(obj[field]))\r\n\t\t\t\t{\r\n\t\t\t\t\tif (field in output)\r\n\t\t\t\t\t\tRinn.merge(output[field], obj[field]);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutput[field] = Rinn.clone(obj[field]);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toutput[field] = obj[field];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tAssigns all fields from the specified objects into the first one.\r\n**\r\n**\t>> object override (object output, object... objs)\r\n*/\r\nRinn.override = function (output, ...objs)\r\n{\r\n\tfor (let i = 0; i < objs.length; i++)\r\n\t{\r\n\t\tfor (let j in objs[i])\r\n\t\t{\r\n\t\t\toutput[j] = objs[i][j];\r\n\t\t}\r\n\t}\r\n\r\n\treturn output;\r\n};\r\n\r\n\r\n/*\r\n**\tCompares two objects and returns `true` if all properties in \"partial\" find a match in \"full\".\r\n*/\r\nRinn.partialCompare = function (full, partial)\r\n{\r\n\tif (full == null || partial == null) return false;\r\n\r\n\tif (full === partial)\r\n\t\treturn true;\r\n\r\n\tfor (var i in partial)\r\n\t{\r\n\t\tif (full[i] != partial[i])\r\n\t\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\n\r\n/*\r\n**\tPerforms a partial search for an object (o) in the specified array and returns its index or `false` if the\r\n**\tobject was not found. When `getObject` is set to `true` the object will be returned instead of an index, or\r\n**\t`null` if not found.\r\n*/\r\nRinn.arrayFind = function (arr, o, getObject)\r\n{\r\n\tfor (var i = 0; arr && i < arr.length; i++)\r\n\t{\r\n\t\tif (this.partialCompare (arr[i], o))\r\n\t\t\treturn getObject ? arr[i] : i;\r\n\t}\r\n\r\n\treturn getObject ? null : false;\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, returns boolean.\r\n**\r\n**\t>> bool isTypeOf (object obj, class _class);\r\n*/\r\nRinn.isInstanceOf = function (obj, _class)\r\n{\r\n\tif (!obj || !_class || typeof(obj) !== 'object')\r\n\t\treturn false;\r\n\r\n\tif (obj instanceof _class)\r\n\t\treturn true;\r\n\r\n\tif ('isInstanceOf' in obj)\r\n\t\treturn obj.isInstanceOf(_class);\r\n\r\n\treturn false;\r\n};\r\n\r\n\r\n/*\r\n**\tTraverses the given object attempting to find the index/key that does an identical match with the specified value,\r\n**\tif not found returns -1, otherwise the index/key where the value was found.\r\n**\r\n**\t>> int indexOf (array container, T value)\r\n**\t>> string indexOf (object container, T value)\r\n*/\r\nRinn.indexOf = function (container, value, forceArray=false)\r\n{\r\n\tif (forceArray)\r\n\t{\r\n\t\tfor (let i = 0; i < container.length; i++)\r\n\t\t{\r\n\t\t\tif (container[i] === value)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\t\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tfor (let i in container)\r\n\t{\r\n\t\tif (container[i] === value)\r\n\t\t\treturn i;\r\n\t}\r\n\r\n\treturn -1;\r\n};\r\n\r\n\r\n/*\r\n**\tEscapes a string using HTML entities.\r\n**\r\n**\t>> string escape (string str);\r\n*/\r\nRinn.escape = function (str)\r\n{\r\n\treturn (str+\"\").replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\r\n};\r\n\r\n\r\n/*\r\n**\tVerifies if the specified object is of class `m`, if not it will create a new instance of `m` passing `o` as parameter.\r\n**\r\n**\t>> object ensureTypeOf (class m, object o);\r\n*/\r\nRinn.ensureTypeOf = function (m, o)\r\n{\r\n\tif (!o || !m || o instanceof m)\r\n\t\treturn o;\r\n\r\n\tif (o.isInstanceOf && m.prototype.className)\r\n\t{\r\n\t\tif (o.isInstanceOf (m.prototype.className))\r\n\t\t\treturn o;\r\n\t}\r\n\r\n\treturn new m (o);\r\n};\r\n\r\n\r\n/*\r\n**\tSerializes an object and returns its JSON string representation.\r\n**\r\n**\t>> string serialize (object o);\r\n*/\r\nRinn.serialize = function (o)\r\n{\r\n\treturn JSON.stringify(o);\r\n};\r\n\r\n\r\n/*\r\n**\tDeserializes a string in JSON format and returns the result.\r\n**\r\n**\t>> any deserialize (string s);\r\n*/\r\nRinn.deserialize = function (s)\r\n{\r\n\treturn JSON.parse(s);\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookAppend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (oldFunction.apply (this, args) !== false)\r\n\t\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\toldFunction.apply (this, args);\r\n\t\t\treturn newFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n\r\n\r\n/*\r\n**\tChains a new function to an existing one on some object, such that invoking the function on the object will cause\r\n**\tboth functions to run (order would be oldFunction then newFunction).\r\n**\r\n**\tIf the `conditional` flag is set to `true`, the second function will be run only if the first one returns non-false.\r\n**\tReturns an object with a single method 'unhook' which will revert the changes to leave only the original function.\r\n**\r\n**\t>> object{function unhook} hook (Object object, String functionName, function newFunction, bool conditional=false);\r\n*/\r\nRinn.hookPrepend = function (object, functionName, newFunction, conditional=true)\r\n{\r\n\tconst oldFunction = object[functionName];\r\n\r\n\tif (conditional)\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tif (newFunction.apply (this, args) !== false)\r\n\t\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\telse\r\n\t{\r\n\t\tobject[functionName] = function (...args) {\r\n\t\t\tnewFunction.apply (this, args);\r\n\t\t\treturn oldFunction.apply (this, args);\r\n\t\t};\r\n\t}\r\n\r\n\treturn { \r\n\t\tunhook: function() {\r\n\t\t\tobject[functionName] = oldFunction;\r\n\t\t}\r\n\t};\r\n};\r\n","\n/**\n**\tCommon regular expressions for pattern validation.\n*/\n\nexport default\n{\n\temail: /^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)+$/i,\n\turl: /^[\\w-]+:\\/\\/[\\w-]+(\\.\\w+)+.*$/,\n\turlNoProt: /^[\\w-]+(\\.\\w+)+.*$/,\n\tname: /^[-A-Za-z0-9_.]+$/,\n\tuname: /^['\\pL\\pN ]+$/,\n\ttext: /^[^&<>{}]*$/,\n\tutext: /^([\\r\\n\\pL\\pN\\pS &!@#$%*\\[\\]()_+=;',.\\/?:\"~-]+)$/\n};\n","\r\nimport _Rinn from './alpha.js';\r\nimport _Class from './class.js';\r\nimport _Event from './event.js';\r\nimport _EventDispatcher from './event-dispatcher.js';\r\nimport _Model from './model.js';\r\nimport _ModelList from './model-list.js';\r\nimport _Schema from './schema.js';\r\nimport _Flattenable from './flattenable.js';\r\nimport _Collection from './collection.js';\r\nimport _Template from './template.js';\r\n\r\nexport const Rinn = _Rinn;\r\nexport const Class = _Class;\r\nexport const Event = _Event;\r\nexport const EventDispatcher = _EventDispatcher;\r\nexport const Model = _Model;\r\nexport const ModelList = _ModelList;\r\nexport const Schema = _Schema;\r\nexport const Flattenable = _Flattenable;\r\nexport const Collection = _Collection;\r\nexport const Template = _Template;\r\n","\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n * Base class used to create other classes with complex prototype based multiple inheritance while at the\r\n * same time avoiding the prototype chain for faster access. Supports calling parent class methods.\r\n */\r\n\r\n//!class Class\r\nconst Class = function ()\r\n{\r\n};\r\n\r\n/**\r\n * Reference to the class itself.\r\n */\r\nClass._class = Class;\r\n\r\n/**\r\n * Contains the methods of each of the super classes.\r\n */\r\nClass._super = { };\r\n\r\n/**\r\n * Name of the class, if none specified the class will be considered \"final\" and will not be inheritable.\r\n * !readonly string className;\r\n */\r\nClass.prototype.className = 'Class';\r\n\r\n/**\r\n * Class constructor, should initialize the instance. Invoked when the `new` keyword is used with the class.\r\n * !constructor();\r\n */\r\nClass.prototype.__ctor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * Class destructor, should clear the instance and release any used resources, invoked when the global `dispose` function is called with an instance as parameter.\r\n * !__dtor() : void;\r\n */\r\nClass.prototype.__dtor = function ()\r\n{\r\n};\r\n\r\n/**\r\n * Returns true if the object is an instance of the specified class, the parameter can be a class name (string), a constructor (function) or\r\n * a class instance (object), in any cases the appropriate checks will be done.\r\n * !isInstanceOf (className: string|function|object) : boolean;\r\n */\r\nClass.prototype.isInstanceOf = function (className)\r\n{\r\n\tif (className === null)\r\n\t\treturn false;\r\n\r\n\tif (typeof(className) === 'function')\r\n\t{\r\n\t\tclassName = className.prototype.className;\r\n\t}\r\n\telse if (typeof(className) !== 'string')\r\n\t{\r\n\t\tclassName = className.__proto__.className;\r\n\t}\r\n\r\n\treturn this.className === className ? true : this._super.hasOwnProperty(className);\r\n};\r\n\r\n/**\r\n * Returns true if the given object is an instance of the specified class, the parameter can be a class name (string), a constructor (function)\r\n * or a class instance (object), in any cases the appropriate checks will be done.\r\n * !instanceOf (object: object, className: string|function|object) : boolean;\r\n */\r\nClass.instanceOf = function (object, className)\r\n{\r\n\tif (object === null || className === null)\r\n\t\treturn false;\r\n\r\n\treturn object.isInstanceOf(className);\r\n};\r\n\r\n/**\r\n * Internal method to ensure the _super field of an instance has all functions properly bound to the instance.\r\n */\r\nClass.prototype._initSuperRefs = function ()\r\n{\r\n\tlet _super = this.constructor._super;\r\n\tlet _newSuper = { };\r\n\r\n\tconst self = this;\r\n\r\n\tfor (let i in _super)\r\n\t{\r\n\t\tlet o = { };\r\n\r\n\t\tlet _prot = _super[i].prototype;\r\n\t\tfor (let j in _prot)\r\n\t\t{\r\n\t\t\tif (Rinn.typeOf(_prot[j]) !== 'function')\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\to[j] = (function(fn)\r\n\t\t\t{\r\n\t\t\t\treturn function (a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10) {\r\n\t\t\t\t\treturn fn.call(self, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10);\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t(_prot[j]);\r\n\t\t}\r\n\r\n\t\t_newSuper[i] = o;\r\n\t}\r\n\r\n\tthis._super = _newSuper;\r\n};\r\n\r\n\r\n/*\r\n**\tExtends the class with the specified prototype. The prototype can be a function (class constructor) or an object. Note that the\r\n**\tclass will be modified (and returned) instead of creating a new class. Must be called at the class-level (**not** instance level).\r\n**\tWhen a class is provided all fields starting with uppercase at the class-level will not be inherited, this is used to create constants\r\n**\ton classes without having them to be copied to derived classes.\r\n**\r\n**\t>> class inherit (constructor classConstructor);\r\n**\t>> class inherit (object obj);\r\n*/\r\nClass.inherit = function (proto)\r\n{\r\n\tlet self = this._class;\r\n\r\n\tlet _super = self._super;\r\n\tlet _class = self._class;\r\n\r\n\tif (Rinn.typeOf(proto) === 'function')\r\n\t{\r\n\t\t// Move constants (uppercased properties) to the class-level instead of prototype-level.\r\n\t\tfor (let i in proto._class)\r\n\t\t\tif (!/^[A-Z]/.test(i)) self[i] = proto._class[i];\r\n\r\n\t\t// Combine methods and properties.\r\n\t\tRinn.override (self.prototype, proto._class.prototype);\r\n\r\n\t\t// Combine super references.\r\n\t\tRinn.override (_super, proto._class._super);\r\n\r\n\t\t// Add new super reference if className specified in inherited prototypes.\r\n\t\tif (proto._class.prototype.className)\r\n\t\t\t_super[proto._class.prototype.className] = proto._class;\r\n\t}\r\n\telse\r\n\t{\r\n\t\tRinn.override (self.prototype, proto);\r\n\t}\r\n\r\n\tself._super = _super;\r\n\tself._class = _class;\r\n\r\n\treturn self;\r\n};\r\n\r\n\r\n/**\r\n * Internal method used to extend a class with one or more prototypes.\r\n */\r\nClass.prototype._extend = function (base, protos)\r\n{\r\n\tif (protos.length === 0)\r\n\t\treturn base;\r\n\r\n\t//VIOLET OPTIMIZE\r\n\tconst _class = function (...args)\r\n\t{\r\n\t\tthis._initSuperRefs();\r\n\t\tthis.__ctor.apply(this, args);\r\n\t};\r\n\r\n\t_class._class = _class;\r\n\t_class._super = { };\r\n\r\n\tClass.inherit.call (_class, base);\r\n\tdelete _class.prototype.className;\r\n\r\n\tfor (let i = 0; i < protos.length; i++)\r\n\t\t_class.inherit (protos[i]);\r\n\r\n\tdelete _class._super.Class;\r\n\r\n\tif ('classInit' in _class.prototype)\r\n\t\t_class.prototype.classInit();\r\n\r\n\t_class.isInstance = function(value) {\r\n\t\treturn Rinn.isInstanceOf(value, _class);\r\n\t};\r\n\r\n\treturn _class;\r\n};\r\n\r\n\r\n/**\r\n * Creates a new class with the specified prototypes each of which can be a class constructor (function) or an object.\r\n */\r\nClass.extend = function (...protos)\r\n{\r\n\treturn this._class.prototype._extend (this, protos);\r\n};\r\n\r\n\r\n/**\r\n * Creates a new instance of a class resulting from extending the self class with the specified prototype.\r\n */\r\nClass.create = function (proto)\r\n{\r\n\treturn new (this.extend(proto)) ();\r\n};\r\n\r\n/**\r\n * Mutates the host object to be an instance of the specified class.\r\n * !static mutate (classConstructor: object, host: object, override?: object) : object;\r\n */\r\nClass.mutate = function (classConstructor, host, override=null)\r\n{\r\n\tlet zombie = new classConstructor ();\r\n\r\n\t// Copy all members from the class prototype.\r\n\tfor (let i in classConstructor.prototype)\r\n\t{\r\n\t\tif (host.hasOwnProperty(i))\r\n\t\t\tcontinue;\r\n\t\r\n\t\thost[i] = classConstructor.prototype[i];\r\n\t}\r\n\t\r\n\t// Copy all members from the zombie class instance.\r\n\tfor (let i in zombie)\r\n\t{\r\n\t\tif (host.hasOwnProperty(i))\r\n\t\t\tcontinue;\r\n\t\r\n\t\thost[i] = zombie[i];\r\n\t}\r\n\r\n\t// Rebind the super references.\r\n\tif (host._super)\r\n\t{\r\n\t\tfor (let i in host._super)\r\n\t\t{\r\n\t\t\tfor (let j in host._super[i]) {\r\n\t\t\t\thost._super[i][j] = classConstructor.prototype.constructor._super[i].prototype[j].bind(host);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Copy override members.\r\n\tif (override !== null) {\r\n\t\tfor (let i in override)\r\n\t\t\thost[i] = override[i];\r\n\t}\r\n\r\n\treturn host;\r\n};\r\n\r\nexport default Class;\r\n","\r\nimport Rinn from './alpha.js';\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tHolds the information about a triggered event. It also provides a mechanism to allow asynchronous\r\n**\tevent propagation to ensure the event chain order.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Event\",\r\n\r\n\t/**\r\n\t**\tSource of the event.\r\n\t*/\r\n\tsource: null,\r\n\r\n\t/**\r\n\t**\tName of the event.\r\n\t*/\r\n\tname: null,\r\n\r\n\t/**\r\n\t**\tArguments of the event.\r\n\t*/\r\n\targs: null,\r\n\r\n\t/**\r\n\t**\tIndicates if the last event handler wants to use async mode.\r\n\t*/\r\n\t_async: false,\r\n\r\n\t/**\r\n\t**\tQueue of all handlers to invoke.\r\n\t*/\r\n\tlist: null,\r\n\r\n\t/**\r\n\t**\tNext event to be executed in the event chain.\r\n\t*/\r\n\tnext: null,\r\n\r\n\t/**\r\n\t**\tReturn values from event handlers.\r\n\t*/\r\n\tret: null,\r\n\r\n\t/**\r\n\t**\tOriginal root event.\r\n\t*/\r\n\toriginal: null,\r\n\r\n\t/**\r\n\t**\tIndex of the current event handler.\r\n\t*/\r\n\ti: -1,\r\n\r\n\t/**\r\n\t**\tContructs an event object with the specified parameters. Source is the event-dispatcher object, list is\r\n\t**\tan array with all the listeners to invoke. The eventName and eventArgs are the event information to be\r\n\t**\tpassed to each handler and if a callback is specified (cbHandler+cbContext) it will be executed once all\r\n\t**\tthe event handlers have been processed.\r\n\t**\r\n\t**\tEvent __ctor (source: EventDispatcher, list: Array, eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t*/\r\n\t__ctor: function (source, list, eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tthis.source = source;\r\n\r\n\t\tthis.name = eventName;\r\n\t\tthis.args = eventArgs;\r\n\r\n\t\tthis.cbHandler = cbHandler;\r\n\t\tthis.cbContext = cbContext;\r\n\r\n\t\tthis.list = list;\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/**\r\n\t**\tResets the event to its initial state. An event object can be reused by resetting it and then\r\n\t**\tinvoking the resume event.\r\n\t**\r\n\t**\tEvent reset ();\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.next = null;\r\n\t\tthis.ret = [];\r\n\r\n\t\tthis._async = false;\r\n\t\tthis.i = -1;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tChanges the source of the event.\r\n\t**\r\n\t**\tEvent setSource (object value);\r\n\t*/\r\n\tsetSource: function (value)\r\n\t{\r\n\t\tthis.source = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the internal asynchronous flag. Should be called before a handler returns. If a handler\r\n\t**\tcalls this method it should also call resume() when async operations are finished.\r\n\t**\r\n\t**\tEvent wait ();\r\n\t*/\r\n\twait: function ()\r\n\t{\r\n\t\tthis._async = true;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tResumes event propagation. Should be called manually by event handlers that also call wait().\r\n\t**\r\n\t**\tEvent resume ();\r\n\t*/\r\n\tresume: function ()\r\n\t{\r\n\t\tthis._async = false;\r\n\r\n\t\twhile (!this._async)\r\n\t\t{\r\n\t\t\tif (++this.i >= this.list.length)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tif (this.list[this.i].silent)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.typeOf(this.list[this.i].handler) == \"string\")\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].context)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!this.list[this.i].context[this.list[this.i].handler])\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tif (this.list[this.i].context[this.list[this.i].handler] (this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (global[this.list[this.i].handler].call (null, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (this.list[this.i].handler.call (this.list[this.i].context, this, this.args, this.list[this.i].data) === false)\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._async)\r\n\t\t\treturn this;\r\n\r\n\t\tif (this.i >= this.list.length && this.next) this.next.resume();\r\n\r\n\t\tif (this.cbHandler)\r\n\t\t\tthis.cbHandler.call (this.cbContext);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the \"original\" property of the event to indicate where the original event comes from.\r\n\t**\r\n\t**\tEvent from (event: Event);\r\n\t*/\r\n\tfrom: function (event)\r\n\t{\r\n\t\tthis.original = event;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tEnqueues the specified event to be executed upon the current event process is finished. The \"original\"\r\n\t**\tproperty of the chained event will be set to the current event.\r\n\t**\r\n\t**\tEvent enqueueEvent (event: Event);\r\n\t*/\r\n\tenqueue: function (event)\r\n\t{\r\n\t\tif (!event) return this;\r\n\r\n\t\tvar evt;\r\n\t\tfor (evt = this; evt.next != null; evt = evt.next);\r\n\r\n\t\tevt.next = event;\r\n\t\tevent.from (this);\r\n\r\n\t\treturn this;\r\n\t}\r\n});\r\n","\r\nimport Class from './class.js';\r\nimport Event from './event.js';\r\n\r\n/**\r\n**\tEvent dispatcher allows several event listeners to be attached, these will be invoked whenever the\r\n**\tevent that is being listened to is triggered.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"EventDispatcher\",\r\n\r\n\t/**\r\n\t**\tListeners attached to this event dispatcher. Grouped by event name.\r\n\t*/\r\n\tlisteners: null,\r\n\r\n\t/**\r\n\t**\tNamespace for event dispatching. Defaults to null. Can be modified using setNamespace().\r\n\t*/\r\n\tnamespace: null,\r\n\r\n\t/**\r\n\t**\tInitializes the event dispatcher.\r\n\t**\r\n\t**\tEventDispatcher __ctor ();\r\n\t*/\r\n\t__ctor: function ()\r\n\t{\r\n\t\tthis.listeners = { };\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the event dispatching namespace. Used to force all events dispatched to have the specified namespace.\r\n\t**\r\n\t**\tEventDispatcher setNamespace (value: string);\r\n\t*/\r\n\tsetNamespace: function (value)\r\n\t{\r\n\t\tthis.namespace = value;\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tAdds an event listener for a specified event to the event dispatcher. The event name can have an optional\r\n\t**\tnamespace indicator which is added to the beginning of the event name and separated using a colon (:). This\r\n\t**\tindicator can be used to later trigger or remove all handlers of an specific namespace.\r\n\t**\r\n\t**\tEventDispatcher addEventListener (eventName: string, handler: function, context: object, data: object);\r\n\t*/\r\n\taddEventListener: function (eventName, handler, context, data)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (!this.listeners[name])\r\n\t\t\tthis.listeners[name] = [];\r\n\r\n\t\tthis.listeners[name].push ({ ns: ns, handler: handler, context: context, data: data, silent: 0 });\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tRemoves an event listener from the event dispatcher. If only the name is provided all handlers with the\r\n\t**\tspecified name will be removed. If a context is provided without a handler then any handler matching the\r\n\t**\tcontext will be removed. Special event name \"*\" can be used to match all event names.\r\n\t**\r\n\t**\tEventDispatcher removeEventListener (eventName: string, handler: function, context: object);\r\n\t*/\r\n\tremoveEventListener: function (eventName, handler, context)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar k = true;\r\n\r\n\t\t\t\t\tif (handler)\r\n\t\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\t\tif (context)\r\n\t\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\t\tif (ns)\r\n\t\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tvar k = true;\r\n\r\n\t\t\t\tif (handler)\r\n\t\t\t\t\tk = k && list[i].handler === handler;\r\n\r\n\t\t\t\tif (context)\r\n\t\t\t\t\tk = k && list[i].context === context;\r\n\r\n\t\t\t\tif (ns)\r\n\t\t\t\t\tk = k && list[i].ns == ns;\r\n\r\n\t\t\t\tif (k) list.splice(i--, 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tPrepares an event with the specified parameters for its later usage. The event is started when\r\n\t**\tthe resume() method is called. If a callback is specified it will be executed once all event\r\n\t**\thandlers have been processed.\r\n\t**\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent prepareEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tprepareEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\tvar list = [];\r\n\r\n\t\teventName = eventName.split(\":\");\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tif (this.listeners[name])\r\n\t\t\tlist = list.concat (this.listeners[name]);\r\n\r\n\t\tif (this.listeners[\"*\"])\r\n\t\t\tlist = list.concat (this.listeners[\"*\"]);\r\n\r\n\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\tif (list[i].silent) list.splice (i--, 1);\r\n\r\n\t\tif (ns)\r\n\t\t{\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\tif (list[i].ns != ns) list.splice (i--, 1);\r\n\t\t}\r\n\r\n\t\treturn new Event (this, list, name, eventArgs, cbHandler, cbContext);\r\n\t},\r\n\r\n\t/**\r\n\t**\tSilences or unsilences all handlers attached to an event such that if the event fires the handler(s) will\r\n\t**\tnot be invoked. It is recommended to use a namespace to ensure other handlers will continue to be run.\r\n\t**\r\n\t**\tEventDispatcher silence (eventName: string);\r\n\t*/\r\n\tsilence: function (eventName, value)\r\n\t{\r\n\t\teventName = eventName.split(\":\");\r\n\r\n\t\tvar name = eventName[eventName.length-1];\r\n\t\tvar ns = eventName.length > 1 ? eventName[0] : null;\r\n\r\n\t\tvalue = value === false ? -1 : 1;\r\n\r\n\t\tif (name == \"*\")\r\n\t\t{\r\n\t\t\tfor (var j in this.listeners)\r\n\t\t\t{\r\n\t\t\t\tvar list = this.listeners[j];\r\n\r\n\t\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tlist[i].silent += value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (!this.listeners[name])\r\n\t\t\t\treturn this;\r\n\r\n\t\t\tvar list = this.listeners[name];\r\n\r\n\t\t\tfor (var i = 0; i < list.length; i++)\r\n\t\t\t{\r\n\t\t\t\tif (ns && list[i].ns != ns)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tlist[i].silent += value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches an event to the respective listeners. If a callback is specified it will be executed once\r\n\t**\tall event handlers have been processed.\r\n\t**\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map, cbHandler: function, cbContext: object);\r\n\t**\tEvent dispatchEvent (eventName: string, eventArgs: map);\r\n\t*/\r\n\tdispatchEvent: function (eventName, eventArgs, cbHandler, cbContext)\r\n\t{\r\n\t\treturn this.prepareEvent(this.namespace ? this.namespace+':'+eventName : eventName, eventArgs, cbHandler, cbContext).resume();\r\n\t}\r\n});\r\n","\nimport Rinn from './alpha.js';\nimport EventDispatcher from './event-dispatcher.js';\n\n/**\n**\tA model is a high-integrity data object used to store properties and more importantly to provide event support to notify of any\n**\tkind of change that occurs to the model's properties. Integrity of the model is maintained by optionally using property constraints.\n*/\n\nlet _Model = EventDispatcher.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"Model\",\n\n\t/**\n\t**\tDefault properties for the model. Can be a map with the property name and its default value or a function\n\t**\treturning a map with dynamic default values. This is used to reset the model to its initial state.\n\t*/\n\tdefaults: null,\n\n\t/**\n\t**\tModel property contraints. A map with the property name and an object specifying the constraints of the\n\t**\tproperty. This is used to determine the type, format and behavior of each property in the model.\n\t*/\n\tconstraints: null,\n\n\t/**\n\t**\tProperties of the model.\n\t*/\n\tdata: null,\n\n\t/**\n\t**\tArray with the name of the properties that have changed. Populated prior modelChanged event.\n\t*/\n\tchangedList: null,\n\n\t/**\n\t**\tSilent mode indicator. While in silent mode events will not be dispatched.\n\t*/\n\t_silent: 0,\n\n\t/**\n\t**\tCurrent nesting level of the set() method. This is used to determine when all the property\n\t**\tchanges are done.\n\t*/\n\t_level: 0,\n\n\t/**\n\t**\tInitializes the model and sets the properties to the specified data object.\n\t**\n\t**\t>> Model __ctor (object data);\n\t**\t>> Model __ctor (object data, object defaults);\n\t*/\n\t__ctor: function (data, defaults)\n\t{\n\t\tthis._super.EventDispatcher.__ctor();\n\n\t\tthis.data = { };\n\n\t\tif (defaults != null)\n\t\t{\n\t\t\tthis.reset (defaults, false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet o = null;\n\n\t\t\tif (!this.defaults && this.constraints)\n\t\t\t{\n\t\t\t\to = { };\n\n\t\t\t\tfor (let i in this.constraints)\n\t\t\t\t{\n\t\t\t\t\tlet j = this.constraints[i];\n\t\t\t\t\tif (j.def === null || j.def === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\to[i] = null;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof(j.def) === 'function')\n\t\t\t\t\t\to[i] = j.def();\n\t\t\t\t\telse\n\t\t\t\t\t\to[i] = j.def;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.reset(o);\n\t\t}\n\n\t\tthis.init();\n\n\t\tif (data != null)\n\t\t\tthis.set (data, true);\n\n\t\tif (this.constraints) this.update();\n\n\t\tthis.ready();\n\t},\n\n\t/**\n\t**\tResets the model to its default state and triggers update events. If a map is provided the defaults of\n\t**\tthe model will be set to the specified map.\n\t**\n\t**\t>> Model reset (object defaults, [bool nsilent=true]);\n\t**\t>> Model reset ([bool nsilent=true]);\n\t*/\n\treset: function (defaults, nsilent)\n\t{\n\t\tif (!this.defaults)\n\t\t{\n\t\t\tif (!defaults || (Rinn.typeOf(defaults) !== 'object' && Rinn.typeOf(defaults) !== 'function'))\n\t\t\t\treturn this;\n\n\t\t\tthis.defaults = defaults;\n\t\t}\n\n\t\tif (Rinn.typeOf(this.defaults) === 'function')\n\t\t\tthis.data = this.defaults();\n\t\telse\n\t\t\tthis.data = Rinn.clone(this.defaults);\n\n\t\treturn (nsilent === false || defaults === false) ? this : this.update(null, true);\n\t},\n\n\t/**\n\t**\tInitializes the model. Called before the model properties are set.\n\t**\n\t**\t>> void init ();\n\t*/\n\tinit: function ()\n\t{\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t**\n\t**\t>> void ready ();\n\t*/\n\tready: function ()\n\t{\n\t},\n\n\t/**\n\t**\tEnables or disables silent mode. When the model is in silent mode events will not be dispatched.\n\t**\n\t**\t>> Model silent (value: bool);\n\t*/\n\tsilent: function (value)\n\t{\n\t\tthis._silent += value ? 1 : -1;\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates a property name and value against the constraints defined in the model (if any). Returns the\n\t**\tfinal value if successful or throws an empty exception if errors occur.\n\t**\n\t**\t>> T _validate (string name, T value);\n\t*/\n\t_validate: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t\treturn value;\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tthrow new Error (`Constraint [${ctname}:${constraints[ctname]}] failed on property '${name}'.`);\n\t\t\t}\n\t\t}\n\n\t\treturn nvalue;\n\t},\n\n\t/**\n\t**\tSets the value of a property and returns the value set. This method is internally used to set properties\n\t**\tone at a time. If constraints are present in the model for the specified property all constraints will be\n\t**\tverified. When constraint errors occur the constraintError event will be raised and the property value\n\t**\twill not be changed.\n\t**\n\t**\t>> T _set (string name, T value);\n\t*/\n\t_set: function (name, value)\n\t{\n\t\tif (!this.constraints || !this.constraints[name])\n\t\t{\n\t\t\tthis.data[name] = value;\n\t\t\treturn value;\n\t\t}\n\n\t\tvar constraints = this.constraints[name];\n\n\t\tvar cvalue = this.data[name];\n\t\tvar nvalue = value;\n\n\t\tfor (var ctname in constraints)\n\t\t{\n\t\t\tif (!_Model.Constraints[ctname])\n\t\t\t\tcontinue;\n\n\t\t\ttry {\n\t\t\t\tnvalue = _Model.Constraints[ctname] (this, constraints[ctname], name, nvalue);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.message == \"null\")\n\t\t\t\t\tbreak;\n\n\t\t\t\tif (!this._silent)\n\t\t\t\t\tthis.dispatchEvent (\"constraintError\", { constraint: ctname, message: e.message, name: name, value: value });\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (this.data[name] = nvalue);\n\t},\n\n\t/**\n\t**\tTriggers property events to indicate a property is changing. First triggers \"propertyChanging\" and then\n\t**\t\"propertyChanged\". If the first event returns false the second event will not be triggered.\n\t**\n\t**\t>> void _propertyEvent (string name, T prev, T value, bool direct=false);\n\t*/\n\t_propertyEvent: function (name, prev, value, direct)\n\t{\n\t\tvar temp = { name: name, old: prev, value: value, level: this._level };\n\n\t\tvar evt = this.dispatchEvent (\"propertyChanging\", temp);\n\n\t\tif (!direct)\n\t\t\ttemp.value = this._set (name, temp.value);\n\t\telse\n\t\t\tthis.data[name] = temp.value;\n\n\t\tif (evt != null && evt.ret.length && evt.ret[0] === false)\n\t\t\treturn;\n\n\t\tthis.dispatchEvent (\"propertyChanged.\" + name, temp);\n\t\tthis.dispatchEvent (\"propertyChanged\", temp);\n\n\t\tthis.changedList.push (name);\n\t},\n\n\t/**\n\t**\tSets one or more properties of the model. Possible arguments can be two strings or a map.\n\t**\n\t**\t>> Model set (string name, T value, bool force=true);\n\t**\t>> Model set (string name, T value, bool silent=false);\n\t**\t>> Model set (string name, T value);\n\t**\t>> Model set (object data);\n\t*/\n\tset: function ()\n\t{\n\t\tvar n = arguments.length;\n\t\tvar force = false, silent = false;\n\n\t\tif ((n > 2 || (n == 2 && Rinn.typeOf(arguments[0]) == \"object\")) && Rinn.typeOf(arguments[n-1]) == \"boolean\")\n\t\t{\n\t\t\tforce = arguments[--n];\n\t\t\tif (force === false) silent = true;\n\t\t}\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (n == 2)\n\t\t{\n\t\t\tif (this.data[arguments[0]] !== arguments[1] || force)\n\t\t\t{\n\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\tthis._propertyEvent (arguments[0], this.data[arguments[0]], this._validate (arguments[0], arguments[1]));\n\t\t\t\telse\n\t\t\t\t\tthis._set (arguments[0], arguments[1]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in arguments[0])\n\t\t\t{\n\t\t\t\tif (this.data[i] !== arguments[0][i] || force)\n\t\t\t\t{\n\t\t\t\t\tif (!this._silent && !silent)\n\t\t\t\t\t\tthis._propertyEvent (i, this.data[i], this._validate (i, arguments[0][i]));\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._set (i, arguments[0][i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!--this._level && this.changedList.length && !silent && !this._silent)\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns true if the given key exists in the model.\n\t**\n\t**\t>> boolean has (string name);\n\t*/\n\thas: function (name)\n\t{\n\t\treturn name in this.data;\n\t},\n\n\t/**\n\t**\tReturns the value of a property. If no name is specified the whole map of properties will be returned.\n\t**\tIf a boolean value of \"true\" is provided the properties map will be returned but first will be compacted\n\t**\tusing the default data to ensure only valid properties are present.\n\t**\n\t**\t>> T get (string name);\n\t**\t>> object get ();\n\t**\t>> object get (true);\n\t**\t>> object get (false);\n\t**\t\n\t*/\n\tget: function (name, def)\n\t{\n\t\tif (arguments.length == 0 || name === false)\n\t\t\treturn this.data;\n\n\t\tif (arguments.length == 1 && name === true)\n\t\t\treturn this.flatten ();\n\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : this.data[name];\n\n\t\treturn this.data[name];\n\t},\n\n\t/**\n\t**\tReturns the value of a property as an integer number.\n\t**\n\t**\t>> int getInt (string name, [int def]);\n\t*/\n\tgetInt: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseInt (this.data[name]);\n\n\t\treturn parseInt (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a floating point number.\n\t**\n\t**\t>> float getFloat (string name, [float def]);\n\t*/\n\tgetFloat: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\treturn this.data[name] === undefined ? def : parseFloat (this.data[name]);\n\n\t\treturn parseFloat (this.data[name]);\n\t},\n\n\t/**\n\t**\tReturns the value of a property as a boolean value (true or false).\n\t**\n\t**\t>> bool getBool (string name, [bool def]);\n\t**\t\n\t*/\n\tgetBool: function (name, def)\n\t{\n\t\tif (arguments.length == 2)\n\t\t\tname = this.data[name] === undefined ? def : this.data[name];\n\t\telse\n\t\t\tname = this.data[name];\n\n\t\tif (name === \"true\" || name === true)\n\t\t\treturn true;\n\n\t\tif (name === \"false\" || name === false)\n\t\t\treturn false;\n\n\t\treturn parseInt (name) ? true : false;\n\t},\n\n\t/**\n\t**\tReturns a reference object for a model property. The resulting object contains two methods\n\t**\tnamed \"get\" and \"set\" to modify the value of the property.\n\t**\n\t**\t>> object getReference (string name);\n\t*/\n\tgetReference: function (name)\n\t{\t\n\t\tvar m = this;\n\n\t\treturn {\n\t\t\tget: function() {\n\t\t\t\treturn m.get(name);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tm.set(name, value);\n\t\t\t}\n\t\t};\n\t},\n\n\t/**\n\t**\tSets or returns a constraint given the property name. \n\t**\n\t**\t>> Model constraint (string field, string constraint, T value);\n\t**\t>> Model constraint (string field, object constraint);\n\t**\t>> Model constraint (object constraints);\n\t**\t>> object constraint (string field);\n\t*/\n\tconstraint: function (field, constraint, value)\n\t{\n\t\tif (arguments.length == 3 || arguments.length == 2 || (arguments.length == 1 && Rinn.typeOf(field) == \"object\"))\n\t\t{\n\t\t\tif (this.constraints === this.constructor.prototype.constraints)\n\t\t\t\tthis.constraints = Rinn.clone (this.constraints);\n\n\t\t\tswitch (arguments.length)\n\t\t\t{\n\t\t\t\tcase 1:\n\t\t\t\t\tRinn.override (this.constraints, field);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 2:\n\t\t\t\t\tRinn.override (this.constraints[field], constraint);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 3:\n\t\t\t\t\tthis.constraints[field][constraint] = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t}\n\n\t\treturn !field ? this : this.constraints[field];\n\t},\n\n\t/**\n\t**\tReturns a compact version of the model properties. That is, a map only with validated properties that are\n\t**\talso present in the default data map. Returns null if the object is not compliant. If the \"safe\" parameter\n\t**\tis set one last property named \"class\" will be attached, this specifies the original classPath of the object.\n\t**\n\t**\t>> object flatten ([bool safe=false]);\n\t*/\n\tflatten: function (safe, rsafe)\n\t{\n\t\tif (safe)\n\t\t{\n\t\t\tvar data = this.flatten(false, true);\n\t\t\tif (data == null) return null;\n\n\t\t\tdata[\"class\"] = this.classPath;\n\t\t\treturn data;\n\t\t}\n\n\t\tif (!this.constraints && !this.defaults)\n\t\t\treturn this.data;\n\n\t\tif (!this.isCompliant())\n\t\t\treturn { };\n\n\t\tvar constraints = this.constraints;\n\t\tvar keys = this.defaults ? (Rinn.typeOf(this.defaults) == \"function\" ? this.defaults() : this.defaults) : this.constraints;\n\n\t\tvar data = { };\n\n\t\tfor (var i in this.data)\n\t\t{\n\t\t\tif (!(i in keys)) continue;\n\n\t\t\tif (constraints && constraints[i])\n\t\t\t{\n\t\t\t\tvar ct = constraints[i];\n\n\t\t\t\tif (ct.model)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten(rsafe) : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.arrayof)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = [];\n\n\t\t\t\t\tfor (var j = 0; j < this.data[i].length; j++)\n\t\t\t\t\t\tdata[i][j] = this.data[i][j] ? this.data[i][j].flatten(rsafe) : null;\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (ct.cls)\n\t\t\t\t{\n\t\t\t\t\tdata[i] = this.data[i] ? this.data[i].flatten() : null;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdata[i] = this.data[i];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t/**\n\t**\tRemoves a property or a list of properties.\n\t**\n\t**\t>> void remove (string name, [bool nsilent=true]);\n\t**\t>> void remove (array name, [bool nsilent=true]);\n\t*/\n\tremove: function (name, nsilent)\n\t{\n\t\tif (Rinn.typeOf(name) == \"array\")\n\t\t{\n\t\t\tfor (var i = 0; i < name.length; i++)\n\t\t\t\tdelete this.data[name[i]];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: name });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete this.data[name];\n\n\t\t\tif (nsilent !== false && !this._silent)\n\t\t\t\tthis.dispatchEvent (\"propertyRemoved\", { fields: [name] });\n\t\t}\n\t},\n\n\t/**\n\t**\tTriggers data change events for one or more properties. Ensure that silent mode is not enabled or else\n\t**\tthis method will have no effect. If no parameters are provided a full update will be triggered on all of\n\t**\tthe model properties.\n\t**\n\t**\t>> Model update (array fields);\n\t**\t>> Model update (string name);\n\t**\t>> Model update (bool forceModelChanged);\n\t**\t>> Model update ();\n\t*/\n\tupdate: function (fields, direct)\n\t{\n\t\tif (this._silent) return this;\n\n\t\tif (this._level == 0)\n\t\t{\n\t\t\tthis.changedList = [];\n\t\t}\n\n\t\tthis._level++;\n\n\t\tif (fields && Rinn.typeOf(fields) == 'string')\n\t\t{\n\t\t\tthis._propertyEvent (fields, this.data[fields], this.data[fields], direct);\n\t\t}\n\t\telse if (fields && Rinn.typeOf(fields) == 'array')\n\t\t{\n\t\t\tfor (var i of fields)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._propertyEvent (i, this.data[i], this.data[i], direct);\n\t\t}\n\n\t\tif (!--this._level && !this._silent && (this.changedList.length != 0 || fields === true))\n\t\t\tthis.dispatchEvent (\"modelChanged\", { fields: this.changedList });\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates one or mode model properties using the defined constraints. If no parameters are provided all of\n\t**\tthe properties in the model will be validated.\n\t**\n\t**\t>> Model validate (array fields);\n\t**\t>> Model validate (string name);\n\t**\t>> Model validate ();\n\t*/\n\tvalidate: function (fields)\n\t{\n\t\tif (!this.constraints) return this;\n\n\t\tif (fields && Rinn.typeOf(fields) == \"string\")\n\t\t{\n\t\t\tthis._set (fields, this.data[fields])\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t{\n\t\t\t\tif (fields && Rinn.indexOf(fields, i) == -1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tthis._set (i, this.data[i])\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tValidates all the properties in the model and returns a boolean indicating if all of them comply with the\n\t**\tconstraints defined in the model.\n\t**\n\t**\t>> bool isCompliant ();\n\t*/\n\tisCompliant: function ()\n\t{\n\t\tif (!this.constraints) return true;\n\n\t\ttry\n\t\t{\n\t\t\tfor (var i in this.data)\n\t\t\t\tthis._validate (i, this.data[i]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t/**\n\t**\tRegisters an event handler for changes in a specific property of the model.\n\t**\n\t**\t>> void observe (string property, function handler, object context);\n\t*/\n\tobserve: function (property, handler, context)\n\t{\n\t\tthis.addEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tUnregisters an event handler from changes in a specific property of the model.\n\t**\n\t**\t>> void unobserve (string property, function handler, object context);\n\t*/\n\tunobserve: function (property, handler, context)\n\t{\n\t\tthis.removeEventListener (\"propertyChanged.\" + property, handler, context);\n\t},\n\n\t/**\n\t**\tAdds a propertyChanged event handler for the given property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void watch (string property, function handler);\n\t*/\n\twatch: function (property, handler)\n\t{\n\t\tproperty = property.split(':');\n\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.addEventListener (property[0]+\":propertyChanged.\"+property[1], function (evt, args) {\n\t\t\thandler (args.value, args, evt);\n\t\t});\n\t},\n\n\t/**\n\t**\tRemoves propertyChanged handlers related to the specified property. The property name can have an event namespace prepended and separated by colon.\n\t**\n\t**\t>> void unwatch (string property);\n\t*/\n\tunwatch: function (property)\n\t{\n\t\tproperty = property.split(':');\n\t\tif (property.length == 1)\n\t\t{\n\t\t\tproperty[1] = property[0];\n\t\t\tproperty[0] = 'watch';\n\t\t}\n\n\t\tthis.removeEventListener (property[0]+\":propertyChanged.\"+property[1]);\n\t},\n\n\t/**\n\t * Triggers a field change event. Even if the value of the field is the same as the model's, the event will still be triggered.\n\t */\n\ttrigger: function (name, value=null)\n\t{\n\t\treturn this.set(name, value, true);\n\t},\n\n\t/**\n\t**\tSerializes the model into a string.\n\t**\n\t**\tstring toString ();\n\t*/\n\ttoString: function ()\n\t{\n\t\treturn Rinn.serialize(this.get (true));\n\t}\n});\n\n\n/**\n**\tImport model constraints.\n*/\n\nimport Constraints from './model-constraints.js';\n_Model.Constraints = Constraints;\n\nexport default _Model;\n","\nimport Rinn from './alpha.js';\nimport Model from './model.js';\n\n/**\n**\tGeneric list for models.\n*/\n\nexport default Model.extend\n({\n\t/**\n\t**\tName of the class.\n\t*/\n\tclassName: \"ModelList\",\n\n\t/**\n\t**\tClass of the items in the list, can be overriden by child classes to impose a more strict constraint.\n\t*/\n\titemt: Model,\n\n\t/**\n\t**\tMirror of data.contents\n\t*/\n\tcontents: null,\n\n\t/**\n\t**\tIDs of every item in the contents.\n\t*/\n\titemId: null,\n\n\t/**\n\t**\tAutoincremental ID for the next item to be added.\n\t*/\n\tnextId: null,\n\n\t/**\n\t**\tDefault properties of the model.\n\t*/\n\tdefaults:\n\t{\n\t\tcontents: null\n\t},\n\n\t/**\n\t**\tConstraints of the model to ensure integrity.\n\t*/\n\tconstraints:\n\t{\n\t\tcontents: {\n\t\t\ttype: \"array\",\n\t\t\tarrayof: \"@itemt\"\n\t\t}\n\t},\n\n\t/**\n\t**\tConstructor.\n\t*/\n\t__ctor: function (...args)\n\t{\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis._super.Model.__ctor(...args);\n\t},\n\n\t/**\n\t**\tInitialization epilogue. Called after initialization and after model properties are set.\n\t*/\n\tready: function ()\n\t{\n\t\tthis._eventGroup = \"ModelList_\" + Date.now() + \":modelChanged\";\n\n\t\tthis.contents = this.data.contents;\n\t},\n\n\t/**\n\t**\tConnects the event handlers to the item.\n\t**\n\t**\t>> Model _bind (int iid, Model item);\n\t*/\n\t_bind: function (iid, item)\n\t{\n\t\tif (item && item.addEventListener) item.addEventListener (this._eventGroup, this._onItemEvent, this, iid);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tDisconnects the event handlers from the item.\n\t**\n\t**\t>> Model _unbind (Model item);\n\t*/\n\t_unbind: function (item)\n\t{\n\t\tif (item && item.removeEventListener) item.removeEventListener (this._eventGroup);\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tHandler for item events.\n\t**\n\t**\t>> Model _onItemEvent (Event evt, object args, int iid);\n\t*/\n\t_onItemEvent: function (evt, args, iid)\n\t{\n\t\tthis.prepareEvent (\"itemChanged\", { id: iid, item: evt.source }).from (evt)\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\t},\n\n\t/**\n\t**\tReturns the number of items in the list.\n\t**\n\t**\t>> int length ();\n\t*/\n\tlength: function ()\n\t{\n\t\treturn this.data.contents.length;\n\t},\n\n\t/**\n\t**\tClears the contents of the list.\n\t**\n\t**\t>> void clear ();\n\t*/\n\tclear: function ()\n\t{\n\t\tfor (var i = 0; i < this.data.contents; i++)\n\t\t\tthis._unbind (this.data.contents[i]);\n\n\t\tthis.itemId = [];\n\t\tthis.nextId = 0;\n\n\t\tthis.contents = this.data.contents = [];\n\n\t\tthis.prepareEvent (\"itemsCleared\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tSets the contents of the list with the specified array. All items will be ensured to be of the same model\n\t**\ttype as the one specified in the list.\n\t**\n\t**\t>> ModelList setData (array data);\n\t*/\n\tsetData: function (data)\n\t{\n\t\tthis.clear();\n\t\tif (!data) return this;\n\n\t\tfor (var i = 0; i < data.length; i++)\n\t\t{\n\t\t\tvar item = Rinn.ensureTypeOf(this.itemt, data[i]);\n\n\t\t\tthis.itemId.push(this.nextId++);\n\t\t\tthis.data.contents.push(item);\n\n\t\t\tthis._bind(this.nextId-1, item);\n\t\t}\n\n\t\tthis.prepareEvent (\"itemsChanged\")\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn this;\n\t},\n\n\t/**\n\t**\tReturns the raw array contents of the list.\n\t**\n\t**\t>> array getData ();\n\t*/\n\tgetData: function ()\n\t{\n\t\treturn this.data.contents;\n\t},\n\n\t/**\n\t**\tReturns the item at the specified index or null if the index is out of bounds.\n\t**\n\t**\t>> Model getAt (int index);\n\t*/\n\tgetAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\treturn this.data.contents[index];\n\t},\n\n\t/**\n\t**\tRemoves and returns the item at the specified index. Returns null if the index is out of bounds.\n\t**\n\t**\t>> Model removeAt (int index);\n\t*/\n\tremoveAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn null;\n\n\t\tlet item = this.data.contents.splice(index, 1)[0];\n\t\tlet id = this.itemId.splice(index, 1)[0];\n\n\t\tthis._unbind (item);\n\n\t\tthis.prepareEvent (\"itemRemoved\", { id: id, item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tSets the item at the specified index. Returns false if the index is out of bounds, true otherwise. The\n\t**\titem will be ensured to be of the model defined in the list.\n\t**\n\t**\t>> bool setAt (int index, Model item);\n\t*/\n\tsetAt: function (index, item)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis._unbind(this.data.contents[index]);\n\t\tthis.data.contents[index] = item;\n\t\tthis._bind(this.itemId[index], item);\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: item })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tNotifies a change in the item at the specified index. Returns false if the index is out of bounds.\n\t**\n\t**\t>> bool updateAt (int index);\n\t*/\n\tupdateAt: function (index)\n\t{\n\t\tif (index < 0 || index >= this.data.contents.length)\n\t\t\treturn false;\n\n\t\tthis.prepareEvent (\"itemChanged\", { id: this.itemId[index], item: this.data.contents[index] })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tAdds an item to the bottom of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model push (Model item);\n\t*/\n\tpush: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.push(this.nextId++);\n\t\tthis.data.contents.push (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[this.itemId.length-1], item: item, position: 'tail' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the bottom of the list.\n\t**\n\t**\t>> Model pop ();\n\t*/\n\tpop: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.pop());\n\t},\n\n\t/**\n\t**\tAdds an item to the top of the list. Returns null if the item is not an object or a model. The item\n\t**\twill be ensured to be of the model specified in the list.\n\t**\n\t**\t>> Model unshift (Model item);\n\t*/\n\tunshift: function (item)\n\t{\n\t\tif (item && Rinn.typeOf(item) != \"object\")\n\t\t\treturn null;\n\n\t\titem = Rinn.ensureTypeOf(this.itemt, item);\n\n\t\tthis.itemId.unshift(this.nextId++);\n\t\tthis.data.contents.unshift (item);\n\t\tthis._bind(this.nextId-1, item);\n\n\t\tthis.prepareEvent (\"itemAdded\", { id: this.itemId[0], item: item, position: 'head' })\n\t\t.enqueue (this.prepareEvent (\"modelChanged\", { fields: [\"contents\"] })).resume ();\n\n\t\treturn item;\n\t},\n\n\t/**\n\t**\tRemoves and returns an item from the top of the list.\n\t**\n\t**\t>> Model shift ();\n\t*/\n\tshift: function ()\n\t{\n\t\treturn this._unbind(this.data.contents.shift());\n\t},\n\n\t/**\n\t**\tSearches for an item matching the specified partial definition and returns its index. Returns -1 if the\n\t**\titem was not found. If retObject is set to true the object will be returned instead of its index and null\n\t**\twill be returned when the item is not found.\n\t**\n\t**\tint|object find (object data, bool retObject=false);\n\t*/\n\tfind: function (data, retObject=false)\n\t{\n\t\tvar contents = this.data.contents;\n\n\t\tfor (var i = 0; i < contents.length; i++)\n\t\t{\n\t\t\tif (Rinn.partialCompare (contents[i].data, data))\n\t\t\t\treturn retObject ? contents[i] : i;\n\t\t}\n\n\t\treturn retObject ? null : -1;\n\t}\n});\n","\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n * The utility functions in this module allow to create a very strict serialization/deserialization schema\r\n * to ensure that all values are of the specific type when stored in string format.\r\n */\r\n\r\nlet Schema =\r\n{\r\n\tType: function (proto)\r\n    {\r\n\t\tlet tmp =\r\n\t\t{\r\n            flatten: function (value, context) {\r\n                return value;\r\n            },\r\n\r\n            unflatten: function (value, context) {\r\n                return value;\r\n            }\r\n        };\r\n\r\n        return proto ? Rinn.override(tmp, proto) : tmp;\r\n    },\r\n\r\n\tString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn value != null ? value.toString() : null;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tInteger: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn ~~value;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tNumber: function (precision)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_precision: precision,\r\n\t\t\t_round: false,\r\n\r\n\t\t\tprecision: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis._precision = ~~value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tvalue = parseFloat(value);\r\n\r\n\t\t\t\tif (this._precision > 0)\r\n\t\t\t\t\tvalue = (~~(value*Math.pow(10, this._precision))) / Math.pow(10, this._precision);\r\n\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn parseFloat(value);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tBool: function (compact)\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\t_compact: compact,\r\n\r\n\t\t\tcompact: function(value)\r\n\t\t\t{\r\n\t\t\t\tthis._compact = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context) {\r\n\t\t\t\tvalue = ~~value;\r\n\t\t\t\treturn this._compact ? (value > 0 ? 1 : 0) : (value > 0 ? true : false);\r\n\t\t\t},\r\n\r\n\t\t\tunflatten: function (value, context) {\r\n\t\t\t\treturn (~~value) ? true : false;\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\tSharedString: function()\r\n\t{\r\n\t\treturn Schema.Type\r\n\t\t({\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return 0;\r\n\r\n\t\t\t\tvalue = value.toString();\r\n\r\n                if (!(\"strings\" in context))\r\n                {\r\n                    context.index = { };\r\n                    context.strings = [ ];\r\n                }\r\n\r\n                if (!(value in context.index))\r\n                {\r\n                    context.strings.push(value);\r\n                    context.index[value] = context.strings.length;\r\n                }\r\n\r\n                return context.index[value];\r\n            },\r\n\r\n\t\t\tunflatten: function (value, context)\r\n\t\t\t{\r\n                return value == null || value == 0 ? null : context.strings[~~value - 1];\r\n            }\r\n        });\r\n    },\r\n\r\n\tArray: function (type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\titemType: type,\r\n\t\t\t_debug: false,\r\n\t\t\t_filter: null,\r\n\r\n\t\t\tdebug: function(v) {\r\n\t\t\t\tthis._debug = v;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            of: function (type) {\r\n                this.itemType = type;\r\n                return this;\r\n            },\r\n\r\n\t\t\tfilter: function (callback) {\r\n\t\t\t\tthis._filter = callback;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tflatten: function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n                for (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this._filter && !this._filter(value[i], i))\r\n\t\t\t\t\t\tcontinue;\r\n\r\n                    o.push(this.itemType.flatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n\t\t\tunflatten: async function (value, context)\r\n\t\t\t{\r\n\t\t\t\tif (value == null) return null;\r\n\r\n                let o = [ ];\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(await this.itemType.unflatten(value[i], context));\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n    },\r\n\r\n    Object: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            properties: [ ],\r\n\r\n            property: function (name, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, source: name, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            propertyAlias: function (name, source, type, defvalue=null)\r\n            {\r\n                this.properties.push({ name: name, source: source, type: type, defvalue: defvalue });\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].source in value)\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(value[this.properties[i].source], context);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to[this.properties[i].name] = this.properties[i].type.flatten(this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = [ ];\r\n\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.properties[i].source in value)\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(value[this.properties[i].source], context));\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\to.push(this.properties[i].type.flatten(this.properties[i].defvalue, context));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(this.properties[i].name in value ? value[this.properties[i].name] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i = 0; i < this.properties.length; i++)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\to[this.properties[i].name] = await this.properties[i].type.unflatten(i in value ? value[i] : this.properties[i].defvalue, context);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Class: function (classConstructor)\r\n    {\r\n\t\treturn Schema.Type\r\n\t\t({\r\n            _constructor: classConstructor,\r\n\r\n            constructor: function (classConstructor)\r\n            {\r\n                this._constructor = classConstructor;\r\n                return this;\r\n            },\r\n\r\n            flatten: function (value, context)\r\n            {\r\n                return value == null ? null : value.flatten(context);\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\treturn value == null ? null : await (new this._constructor()).unflatten(value, context);\r\n            }\r\n        });\r\n\t},\r\n\r\n\t/*\r\n\t**\tUsed when you want to specify just a single property.\r\n\t*/\r\n    Property: function(name, type)\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tproperty: name,\r\n\t\t\ttype: type,\r\n\r\n\t\t\tname: function (name)\r\n\t\t\t{\r\n\t\t\t\tthis.property = name;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\tis: function (type)\r\n\t\t\t{\r\n\t\t\t\tthis.type = type;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t{\r\n\t\t\t\t\to = { };\r\n\t\t\t\t\to[this.property] = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\to = this.type.flatten(value[this.property], context);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value[this.property], context);\r\n\t\t\t\telse\r\n\t\t\t\t\to[this.property] = await this.type.unflatten(value, context);\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Map: function()\r\n    {\r\n        return Schema.Type({\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = [ ];\r\n\r\n\t\t\t\tfor (let i in value)\r\n\t\t\t\t{\r\n\t\t\t\t\to.push(i);\r\n\t\t\t\t\to.push(value[i]);\r\n\t\t\t\t}\r\n\r\n                return o;\r\n            },\r\n\r\n            unflatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tif (context.symbolic === true)\r\n\t\t\t\t\treturn value;\r\n\r\n\t\t\t\tlet o = { };\r\n\r\n\t\t\t\tfor (let i = 0; i < value.length; i += 2)\r\n\t\t\t\t\to[value[i]] = value[i+1];\r\n\r\n                return o;\r\n            }\r\n        });\r\n\t},\r\n\r\n    Selector: function ()\r\n    {\r\n        return Schema.Type({\r\n\r\n\t\t\tconditions: [],\r\n\t\t\tvalue: null,\r\n\r\n\t\t\twhen: function (value, type)\r\n\t\t\t{\r\n\t\t\t\tthis.conditions.push([ (val) => val === value, type ]);\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n\t\t\twith: function (value)\r\n\t\t\t{\r\n\t\t\t\tthis.value = value;\r\n\t\t\t\treturn this;\r\n\t\t\t},\r\n\r\n            flatten: function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn i[1].flatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            },\r\n\r\n            unflatten: async function (value, context)\r\n            {\r\n\t\t\t\tif (value == null) return null;\r\n\r\n\t\t\t\tfor (let i of this.conditions)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (i[0](this.value) === true)\r\n\t\t\t\t\t\treturn await i[1].unflatten(value, context);\r\n\t\t\t\t}\r\n\r\n                return null;\r\n            }\r\n\r\n        });\r\n\t}\r\n};\r\n\r\nexport default Schema;\r\n","\r\nimport Class from './class.js';\r\n\r\n/**\r\n**\tClass used to add flattening and unflattening capabilities to any object. A \"flat\" object is an object composed\r\n**\tonly of native types, that is: `null,` `boolean`, `integer`, `number`, `array` or `object`.\r\n*/\r\n\r\nexport default Class.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Flattenable\",\r\n\r\n\t/**\r\n\t**\tType schema used to flatten/unflatten the contents of this class. See Schema class for more information.\r\n\t*/\r\n\ttypeSchema: null,\r\n\r\n\t/**\r\n\t**\tReturns the flattened contents of the object.\r\n\t*/\r\n\tflatten: function (context)\r\n\t{\r\n\t\treturn this.typeSchema.flatten(this, context);\r\n\t},\r\n\r\n\t/**\r\n\t**\tUnflattens the given object and overrides the local contents.\r\n\t*/\r\n\tunflatten: async function (value, context)\r\n\t{\r\n\t\tObject.assign(this, await this.typeSchema.unflatten(value, context));\r\n\t\tawait this.onUnflattened();\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted when the unflatten() method is called on the object.\r\n\t*/\r\n\tonUnflattened: async function ()\r\n\t{\r\n\t}\r\n});\r\n","\r\nimport Flattenable from './flattenable.js';\r\nimport Schema from './schema.js';\r\nimport Rinn from './alpha.js';\r\n\r\n/**\r\n**\tFlattenable collection class, used to store items and manipulate them. The items should also be flattenable.\r\n*/\r\n\r\nexport default Flattenable.extend\r\n({\r\n\t/**\r\n\t**\tName of the class.\r\n\t*/\r\n\tclassName: \"Collection\",\r\n\r\n\t/**\r\n\t**\tDescribes the type schema of the underlying items.\r\n\t*/\r\n\titemTypeSchema: null,\r\n\r\n\t/**\r\n\t**\tArray of items.\r\n\t*/\r\n\titems: null, /* Array */\r\n\r\n\t/**\r\n\t**\tConstructs the collection.\r\n\t*/\r\n\t__ctor: function (itemTypeSchema)\r\n\t{\r\n\t\tif (!itemTypeSchema) itemTypeSchema = this.itemTypeSchema;\r\n\r\n\t\tif (itemTypeSchema)\r\n\t\t\tthis.typeSchema = Schema.Property('items').is(Schema.Array().of(itemTypeSchema));\r\n\r\n\t\tthis.reset();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecuted after the collection has been unflattened, re-adds the items to ensure onItemAdded() is called.\r\n\t*/\r\n\tonUnflattened: function()\r\n\t{\r\n\t\tlet items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (let i of items)\r\n\t\t\tthis.add(i);\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted when the value in `items` is changed.\r\n\t */\r\n\titemsReferenceChanged: function()\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tResets the collection to empty. Note that onItemRemoved will not be called.\r\n\t*/\r\n\treset: function ()\r\n\t{\r\n\t\tthis.items = [];\r\n\t\tthis.itemsReferenceChanged();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tClears the contents of the collection (removes each item manually, onItemRemoved will be called).\r\n\t*/\r\n\tclear: function ()\r\n\t{\r\n\t\tvar items = this.items;\r\n\t\tthis.reset();\r\n\r\n\t\tfor (var i = 0; i < items.length; i++)\r\n\t\t\tthis.onItemRemoved (items[i], 0);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSorts the collection. A comparison function should be provided, or the name of a property to sort by.\r\n\t**\r\n\t**\tObject sort (fn: Function)\r\n\t**\tObject sort (prop: string, [desc:bool=false])\r\n\t*/\r\n\tsort: function (fn, desc)\r\n\t{\r\n\t\tif (typeof(fn) != \"function\")\r\n\t\t{\r\n\t\t\tthis.items.sort(function(a, b)\r\n\t\t\t{\r\n\t\t\t\treturn (a[fn] <= b[fn] ? -1 : 1) * (desc === true ? -1 : 1);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.items.sort(fn);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for an item with the specified fields and returns it. The \"inc\" object is the \"inclusive\" map, meaning all fields must match\r\n\t**\tand the optional \"exc\" is the exclusive map, meaning not even one field should match.\r\n\t**\r\n\t**\tObject findItem (inc: Object, exc: Object);\r\n\t*/\t\r\n\tfindItem: function (inc, exc)\r\n\t{\r\n\t\tif (!this.items) return null;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t{\r\n\t\t\tif (exc && Rinn.partialCompare(this.items[i], exc))\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif (Rinn.partialCompare(this.items[i], inc))\r\n\t\t\t\treturn this.items[i];\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the container array.\r\n\t*/\r\n\tgetItems: function ()\r\n\t{\r\n\t\treturn this.items;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the number of items in the collection.\r\n\t*/\r\n\tlength: function ()\r\n\t{\r\n\t\treturn this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns true if the collection is empty.\r\n\t*/\r\n\tisEmpty: function ()\r\n\t{\r\n\t\treturn !this.items.length;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the index of the specified item, or -1 if not found.\r\n\t*/\r\n\tindexOf: function (item)\r\n\t{\r\n\t\treturn this.items.indexOf(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the item at the specified index, or null if not found. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tgetAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\treturn index >= 0 && index < this.items.length ? this.items[index] : null;\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the first item in the collection.\r\n\t*/\r\n\tfirst: function ()\r\n\t{\r\n\t\treturn this.getAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the last item in the collection.\r\n\t*/\r\n\tlast: function ()\r\n\t{\r\n\t\treturn this.getAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item at the specified index, effectively moving the remaining items to the right.\r\n\t*/\r\n\taddAt: function (index, item)\r\n\t{\r\n\t\tif (!item || !this.onBeforeItemAdded (item))\r\n\t\t\treturn this;\r\n\r\n\t\tif (index < 0) index = 0;\r\n\t\tif (index > this.items.length) index = this.items.length;\r\n\r\n\t\tif (index == 0)\r\n\t\t{\r\n\t\t\tthis.items.unshift(item);\r\n\t\t}\r\n\t\telse if (index == this.items.length)\r\n\t\t{\r\n\t\t\tthis.items.push(item);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tvar tmp = this.items.splice(0, index);\r\n\t\t\ttmp.push(item);\r\n\r\n\t\t\tthis.items = tmp.concat(this.items);\r\n\t\t\tthis.itemsReferenceChanged();\r\n\t\t}\r\n\r\n\t\tthis.onItemAdded (item);\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the start of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tunshift: function (item)\r\n\t{\r\n\t\treturn this.addAt(0, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tpush: function (item)\r\n\t{\r\n\t\treturn this.addAt(this.items.length, item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds an item to the end of the collection, onBeforeItemAdded and onItemAdded will be triggered.\r\n\t*/\r\n\tadd: function (item)\r\n\t{\r\n\t\treturn this.push(item);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the item at the specified index. When `relative` is true, negative offsets are allowed such that -1 refers to the last item.\r\n\t*/\r\n\tremoveAt: function (index, relative=false)\r\n\t{\r\n\t\tif (index < 0 && relative == true)\r\n\t\t\tindex += this.items.length;\r\n\r\n\t\tif (index < 0 || index >= this.items.length)\r\n\t\t\treturn null;\r\n\r\n\t\tvar item = this.items[index];\r\n\t\tthis.items.splice (index, 1);\r\n\t\tthis.onItemRemoved (item, index);\r\n\r\n\t\treturn item;\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the end of the collection.\r\n\t*/\r\n\tpop: function (item)\r\n\t{\r\n\t\treturn this.removeAt(-1, true);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the start of the collection.\r\n\t*/\r\n\tshift: function (item)\r\n\t{\r\n\t\treturn this.removeAt(0);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified item from the collection.\r\n\t*/\r\n\tremove: function (item)\r\n\t{\r\n\t\treturn this.removeAt (this.indexOf(item));\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the specified callback for each of the items in the collection, if false is returned by the callback this function\r\n\t**\twill exit immediately. Parameters to the callback are: (item, index, collection).\r\n\t*/\r\n\tforEach: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a method call with the specified parameters on each of the items in the collection, if false is returned by the\r\n\t**\titem's method this function will exit immediately.\r\n\t*/\r\n\tforEachCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = 0; i < this.items.length; i++)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEach but in reverse order.\r\n\t*/\r\n\tforEachRev: function (callback)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (callback (this.items[i], i, this) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExactly the same as forEachCall but in reverse order.\r\n\t*/\r\n\tforEachRevCall: function (method, ...args)\r\n\t{\r\n\t\tif (this.isEmpty())\r\n\t\t\treturn this;\r\n\r\n\t\tfor (var i = this.items.length-1; i >= 0; i--)\r\n\t\t\tif (this.items[i][method] (...args) === false) break;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the beforeItemAdded event. If returns false the item will not be added.\r\n\t*/\r\n\tonBeforeItemAdded: function (item)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemAdded event.\r\n\t*/\r\n\tonItemAdded: function (item)\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tHandler for the itemRemoved event.\r\n\t*/\r\n\tonItemRemoved: function (item)\r\n\t{\r\n\t}\r\n});\r\n","\nimport Rinn from './alpha.js';\n\n/**\n**\tTemplating module. The template formats available are shown below, note that the sym-open and sym-close symbols are by\n**\tdefault the square brackets, however those can be modified since are just parameters.\n**\n**\tHTML Escaped Output:\t\t\t[data.value]\t\t\t\t\tEscapes HTML characters from the output.\n**\tRaw Output:\t\t\t\t\t\t[!data.value]\t\t\t\t\tDoes not escape HTML characters from the output (used to output direct HTML).\n**\tDouble-Quoted Escaped Output:\t[data.value]\t\t\t\t\tEscapes HTML characters and surrounds with double quotes.\n**\tImmediate Reparse:\t\t\t\t[<....] [@....] \"...\" '...'\t\tReparses the contents as if parseTemplate() was called again.\n**\tImmediate Output:\t\t\t\t[:...]\t\t\t\t\t\t\tTakes the contents and outputs exactly as-is without format and optionally surrounded by the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsym-open and sym-close symbols when the first character is not '<', sym_open or space.\n**\tFiltered Output:\t\t\t\t[functionName ... <expr> ...]\tRuns a function call, 'expr' can be any of the allowed formats shown here (nested if desired),\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunctionName should map to one of the available expression functions registered in the\n**\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tRinn.Template.functions map, each of which have their own parameters.\n*/\n\nlet Template =\n{\n\t/*\n\t**\tStrict mode flag. When set, any undefined expression function will trigger an exception.\n\t*/\n\tstrict: false,\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method.\n\t**\n\t**\t>> array parseTemplate (string template, char sym_open, char sym_close, bool is_tpl=false);\n\t*/\n\tparseTemplate: function (template, sym_open, sym_close, is_tpl=false, root=1)\n\t{\n\t\tlet nflush = 'string', flush = null, state = 0, count = 0;\n\t\tlet str = '', parts = [], mparts = parts, nparts = false;\n\n\t\tif (is_tpl === true)\n\t\t{\n\t\t\ttemplate = template.trim();\n\t\t\tnflush = 'identifier';\n\t\t\tstate = 10;\n\n\t\t\tmparts.push(parts = []);\n\t\t}\n\n\t\ttemplate += \"\\0\";\n\n\t\tfunction unescape (value)\n\t\t{\n\t\t\tif (typeof(value) == 'object')\n\t\t\t{\n\t\t\t\tif (value instanceof Array)\n\t\t\t\t{\n\t\t\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t\t\t\tunescape(value[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvalue.data = unescape(value.data);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < value.length; i++)\n\t\t\t{\n\t\t\t\tif (value[i] == '\\\\')\n\t\t\t\t{\n\t\t\t\t\tlet r = value[i+1];\n\n\t\t\t\t\tswitch (r)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'n': r = \"\\n\"; break;\n\t\t\t\t\t\tcase 'r': r = \"\\r\"; break;\n\t\t\t\t\t\tcase 'f': r = \"\\f\"; break;\n\t\t\t\t\t\tcase 'v': r = \"\\v\"; break;\n\t\t\t\t\t\tcase 't': r = \"\\t\"; break;\n\t\t\t\t\t\tcase 's': r = \"\\s\"; break;\n\t\t\t\t\t\tcase '\"': r = \"\\\"\"; break;\n\t\t\t\t\t\tcase \"'\": r = \"\\'\"; break;\n\t\t\t\t\t}\n\n\t\t\t\t\tvalue = value.substr(0, i) + r + value.substr(i+2);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn value;\n\t\t}\n\n\t\tfunction emit (type, data)\n\t\t{\n\t\t\tif (type == 'template')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, true, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t\ttype = 'base-string';\n\n\t\t\t\tif (Rinn.typeOf(data) == 'array')\n\t\t\t\t{\n\t\t\t\t\ttype = data[0].type;\n\t\t\t\t\tdata = data[0].data;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data.trim().split('\\n').map(i => i.trim()).join(\"\\n\"), sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, sym_open, sym_close, false, 0);\n\t\t\t}\n\t\t\telse if (type == 'parse-merge-alt')\n\t\t\t{\n\t\t\t\tdata = Template.parseTemplate (data, '{', '}', false, 0);\n\t\t\t}\n\n\t\t\tif (type == 'parse-merge' || type == 'parse-merge-alt' || type == 'parse-trim-merge')\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\t{\n\t\t\t\t\tparts.push(data[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t\tparts.push({ type: type, data: data });\n\n\t\t\tif (nparts)\n\t\t\t{\n\t\t\t\tmparts.push(parts = []);\n\t\t\t\tnparts = false;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < template.length; i++)\n\t\t{\n\t\t\tif (template[i] == '\\\\')\n\t\t\t{\n\t\t\t\tstr += '\\\\';\n\t\t\t\tstr += template[++i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase 0:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-merge';\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 12; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate = 1; count = 1;\n\t\t\t\t\t\tflush = 'string';\n\t\t\t\t\t\tnflush = 'template';\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 1:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 10:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '.')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\temit ('access', '.');\n\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t\tnparts = true;\n\n\t\t\t\t\t\twhile (template[i].match(/[\\t\\n\\r\\f\\v ]/) != null) i++;\n\t\t\t\t\t\ti--;\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '<')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == '@')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 11; count = 1; nflush = 'parse-trim-merge';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 14; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 15; count = 1; nflush = 'parse-merge';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 16; count = 1; nflush = 'parse-merge-alt';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open && template[i+1] == ':')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) flush = nflush;\n\t\t\t\t\t\tstate = 13; count = 1; nflush = 'string';\n\t\t\t\t\t\ti++;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (str) emit (nflush, str);\n\t\t\t\t\t\tstate = 11; count = 1; str = ''; nflush = 'parse';\n\t\t\t\t\t\tstr += template[i];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nflush != 'identifier')\n\t\t\t\t\t{\n\t\t\t\t\t\temit (nflush, str);\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tnflush = 'identifier';\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\n\t\t\t\tcase 11:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 12:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str.length != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tstate = 0;\n\t\t\t\t\t\t\tflush = nflush;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 13:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\n\t\t\t\t\tif (template[i] == sym_close)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + sym_close);\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!(str[0] == '<' || str[0] == '[' || str[0] == ' '))\n\t\t\t\t\t\t\t\tstr = sym_open + str + sym_close;\n\n\t\t\t\t\t\t\tstate = 10;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (template[i] == sym_open)\n\t\t\t\t\t{\n\t\t\t\t\t\tcount++;\n\t\t\t\t\t}\n\t\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 14:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\"')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\"');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 15:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '\\'')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '\\'');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 16:\n\t\t\t\t\tif (template[i] == '\\0')\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error (\"Parse error: Unexpected end of template\");\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (template[i] == '`')\n\t\t\t\t\t{\n\t\t\t\t\t\tcount--;\n\t\n\t\t\t\t\t\tif (count < 0)\n\t\t\t\t\t\t\tthrow new Error (\"Parse error: Unmatched \" + '`');\n\n\t\t\t\t\t\tif (count == 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstate = 10;\n\t\n\t\t\t\t\t\t\tif (nflush == 'parse-merge' || nflush == 'parse-merge-alt' || nflush == 'parse-trim-merge')\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstr += template[i];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (flush)\n\t\t\t{\n\t\t\t\temit (flush, str);\n\t\t\t\tflush = str = '';\n\t\t\t}\n\t\t}\n\n\t\tif (!is_tpl)\n\t\t{\n\t\t\tlet i = 0;\n\t\t\twhile (i < mparts.length)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\ti = mparts.length-1;\n\t\t\twhile (i > 0)\n\t\t\t{\n\t\t\t\tif (mparts[i].type == 'string' && mparts[i].data == '')\n\t\t\t\t\tmparts.splice(i--, 1);\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (mparts.length == 0)\n\t\t\t\tmparts.push({ type: 'string', data: '' });\n\t\t}\n\n\t\tif (root)\n\t\t\tunescape(mparts);\n\n\t\treturn mparts;\n\t},\n\n\t/**\n\t**\tParses a template and returns the compiled 'parts' structure to be used by the 'expand' method. This\n\t**\tversion assumes the sym_open and sym_close chars are [ and ] respectively.\n\t**\n\t**\t>> array parse (string template);\n\t*/\n\tparse: function (template)\n\t{\n\t\treturn this.parseTemplate(template.trim(), '[', ']', false);\n\t},\n\n\t/**\n\t**\tRemoves all static parts from a parsed template.\n\t**\n\t**\t>> array clean (array parts);\n\t*/\n\tclean: function (parts)\n\t{\n\t\tfor (let i = 0; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].type != 'template')\n\t\t\t{\n\t\t\t\tparts.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\n\t\treturn parts;\n\t},\n\n\t/**\n\t**\tExpands a template using the given data object, ret can be set to 'text' or 'obj' allowing to expand the template as\n\t**\ta string (text) or an array of objects (obj) respectively. If none provided it will be expanded as text.\n\t**\n\t**\t>> string/array expand (array parts, object data, string ret='text', string mode='base-string');\n\t*/\n\texpand: function (parts, data, ret='text', mode='base-string')\n\t{\n\t\tlet s = [];\n\n\t\t// Expand variable parts.\n\t\tif (mode == 'var')\n\t\t{\n\t\t\tlet escape = true;\n\t\t\tlet quote = false;\n\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tescape = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t\tquote = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tescape = false;\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\tquote = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (str != 'this')\n\t\t\t{\n\t\t\t\tlet failed = false;\n\n\t\t\t\tif (data != null)\n\t\t\t\t{\n\t\t\t\t\tif (!(str in data))\n\t\t\t\t\t{\n\t\t\t\t\t\tfailed = true;\n\t\t\t\t\t\tdata = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tdata = data[str];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfailed = true;\n\n\t\t\t\tif (failed && parts.length == 1)\n\t\t\t\t{\n\t\t\t\t\tif (Template.strict == true)\n\t\t\t\t\t\tthrow new Error ('Expression function `'+str+'` not found.');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof(data) == 'string')\n\t\t\t{\n\t\t\t\tif (escape)\n\t\t\t\t\tdata = data.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n\t\t\t\tif (quote)\n\t\t\t\t\tdata = '\"' + data + '\"';\n\t\t\t}\n\n\t\t\ts.push(data);\n\t\t}\n\n\t\t// Expand variable parts and returns a reference to it.\n\t\tif (ret == 'varref')\n\t\t{\n\t\t\tlet root = data;\n\t\t\tlet last = null;\n\t\t\tlet first = true;\n\t\t\tlet str = '';\n\n\t\t\tfor (let i = 0; i < parts.length && data != null; i++)\n\t\t\t{\n\t\t\t\tswitch (parts[i].type)\n\t\t\t\t{\n\t\t\t\t\tcase 'identifier':\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tstr += parts[i].data;\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\tlast = this.expand(parts[i].data, root, 'arg', 'template');\n\t\t\t\t\t\tstr += typeof(last) != 'object' ? last : '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\tstr += this.expand(parts[i].data, root, 'arg', 'base-string');\n\t\t\t\t\t\tlast = null;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'access':\n\t\t\t\t\t\tif (!last || typeof(last) != 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (str == '') str = 'this';\n\n\t\t\t\t\t\t\twhile (true)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (str[0] == '!')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (str[0] == '$')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (str != 'this' && data != null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet tmp = data;\n\t\t\t\t\t\t\t\tdata = (str in data) ? data[str] : null;\n\n\t\t\t\t\t\t\t\tif (data === null && first)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (str in Template.functions)\n\t\t\t\t\t\t\t\t\t\tdata = Template.functions[str] (null, null, tmp);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfirst = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdata = last;\n\n\t\t\t\t\t\tstr = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twhile (str != '')\n\t\t\t{\n\t\t\t\tif (str[0] == '!')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse if (str[0] == '$')\n\t\t\t\t{\n\t\t\t\t\tstr = str.substr(1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn str != 'this' ? [data, str] : null;\n\t\t}\n\n\t\t// Expand function parts.\n\t\tif (mode == 'fn')\n\t\t{\n\t\t\tvar args = [];\n\n\t\t\targs.push(Template.expand(parts[0], data, 'text', 'base-string'));\n\n\t\t\tif ('_'+args[0] in Template.functions)\n\t\t\t\targs[0] = '_'+args[0];\n\n\t\t\tif (!(args[0] in Template.functions))\n\t\t\t{\n\t\t\t\tif (Template.strict == true)\n\t\t\t\t\tthrow new Error ('Expression function `'+args[0]+'` not found.');\n\n\t\t\t\treturn `(Unknown: ${args[0]})`;\n\t\t\t}\n\n\t\t\tif (args[0][0] == '_')\n\t\t\t\treturn Template.functions[args[0]] (parts, data);\n\n\t\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\t\targs.push(Template.expand(parts[i], data, 'arg', 'base-string'));\n\n\t\t\ts.push(Template.functions[args[0]] (args, parts, data));\n\t\t}\n\n\t\t// Template mode.\n\t\tif (mode == 'template')\n\t\t{\n\t\t\tif (parts.length == 1)\n\t\t\t{\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'string')\n\t\t\t\t\treturn parts[0][0].data;\n\n\t\t\t\tif (parts[0].length == 1 && parts[0][0].type == 'identifier')\n\t\t\t\t{\n\t\t\t\t\tlet name = parts[0][0].data;\n\n\t\t\t\t\tif (name in Template.functions || '_'+name in Template.functions)\n\t\t\t\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t\t\t}\n\t\n\t\t\t\treturn Template.expand(parts[0], data, ret, 'var');\n\t\t\t}\n\n\t\t\treturn Template.expand(parts, data, ret, 'fn');\n\t\t}\n\n\t\t// Expand parts.\n\t\tif (mode == 'base-string')\n\t\t{\n\t\t\tlet index = -1;\n\n\t\t\tfor (let i of parts)\n\t\t\t{\n\t\t\t\tlet tmp = null;\n\t\t\t\tindex++;\n\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'template':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'template');\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'string': case 'identifier':\n\t\t\t\t\t\ttmp = i.data;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'base-string':\n\t\t\t\t\t\ttmp = Template.expand(i.data, data, ret, 'base-string');\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (ret == 'void')\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (ret == 'last' && index != parts.length-1)\n\t\t\t\t\tcontinue;\n\n\t\t\t\ts.push(tmp);\n\t\t\t}\n\t\t}\n\n\t\t// Return types for direct objects.\n\t\tif (ret == 'obj') return s;\n\n\t\tif (ret == 'last')\n\t\t{\n\t\t\tif (typeOf(s) == 'Rose\\\\Arry')\n\t\t\t\ts = s[0];\n\n\t\t\treturn s;\n\t\t}\n\n\t\t// When the output is not really needed.\n\t\tif (ret == 'void') return null;\n\n\t\t// Return as argument ('object' if only one, or string if more than one), that is, the first item in the result.\n\t\tif (ret == 'arg')\n\t\t{\n\t\t\tif (Rinn.typeOf(s) == 'array')\n\t\t\t{\n\t\t\t\tif (s.length != 1)\n\t\t\t\t\treturn s.join('');\n\n\t\t\t\treturn s[0];\n\t\t\t}\n\n\t\t\treturn s;\n\t\t}\n\n\t\tif (ret == 'text' && Rinn.typeOf(s) == 'array')\n\t\t{\n\t\t\tlet f = (e => e != null && typeof(e) == 'object' ? ('map' in e ? e.map(f).join('') : ('join' in e ? e.join('') : e.toString())) : e);\n\t\t\ts = s.map(f).join('');\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tParses the given template and returns a function that when called with an object will expand the template.\n\t**\n\t**\t>> object compile (string template);\n\t*/\n\tcompile: function (template)\n\t{\n\t\ttemplate = Template.parse(template);\n\n\t\treturn function (data=null, mode='text') {\n\t\t\treturn Template.expand(template, data ? data : { }, mode);\n\t\t};\n\t},\n\n\t/**\n\t**\tParses and expands the given template immediately.\n\t**\n\t**\t>> object eval (string template, object data, string mode='text');\n\t*/\n\teval: function (template, data=null, mode='text')\n\t{\n\t\ttemplate = Template.parse(template);\n\t\treturn Template.expand(template, data ? data : { }, mode);\n\t},\n\n\t/**\n\t**\tExpands the template as 'arg' and returns the result.\n\t**\n\t**\t>> object value (string parts, object data);\n\t*/\n\tvalue: function (parts, data=null)\n\t{\n\t\treturn Rinn.typeOf(parts) != 'array' ? parts : Template.expand(parts, data ? data : { }, 'arg');\n\t},\n\n\t/**\n\t**\tRegisters an expression function.\n\t**\n\t**\t>> object register (string name, function fn);\n\t*/\n\tregister: function (name, fn)\n\t{\n\t\tTemplate.functions[name] = fn;\n\t},\n\n\t/**\n\t**\tCalls an expression function.\n\t**\n\t**\t>> object call (string name, object args, object data);\n\t*/\n\t'call': function (name, args, data=null)\n\t{\n\t\tif (name in Template.functions)\n\t\t\treturn Template.functions[name] (args, null, data);\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns a map given a 'parts' array having values of the form \"name: value\" or \":name value\".\n\t**\n\t**\t>> Map getNamedValues (array parts, object data, int i=1, bool expanded=true);\n\t*/\n\tgetNamedValues: function (parts, data, i=1, expanded=true)\n\t{\n\t\tlet s = { };\n\t\tlet mode = 0;\n\t\n\t\tfor (; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet key = Template.expand(parts[i], data, 'arg');\n\n\t\t\tif (!mode) {\n\t\t\t\tif (key.startsWith(':')) mode = 1; else mode = key.endsWith(':') ? 2 : 3;\n\t\t\t}\n\n\t\t\tif (mode == 1)\n\t\t\t\tkey = key.substr(1);\n\t\t\telse if (mode == 2)\n\t\t\t\tkey = key.substr(0, key.length-1);\n\n\t\t\tif (expanded)\n\t\t\t\ts[key] = Template.expand(parts[i+1], data, 'arg');\n\t\t\telse\n\t\t\t\ts[key] = parts[i+1];\n\t\t}\n\n\t\treturn s;\n\t}\n};\n\n\n/**\n**\tTemplate functions, functions that are used to format data. Each function takes three parameters (args, parts and data). By default the function arguments\n**\tare expanded and passed via 'args' for convenience, however if the function name starts with '_' the 'args' parameter will be skipped and only (parts, data)\n**\twill be available, each 'part' must be expanded manually by calling Template.expand.\n*/\n\nTemplate.functions =\n{\n\t/**\n\t**\tExpression functions.\n\t*/\n\t'global': function(args) { return globalThis; },\n\t'null': function(args) { return null; },\n\t'true': function(args) { return true; },\n\t'false': function(args) { return false; },\n\n\t'len': function(args) { return args[1].toString().length; },\n\t'int': function(args) { return ~~args[1]; },\n\t'str': function(args) { return args[1].toString(); },\n\t'float': function(args) { return parseFloat(args[1]); },\n\t'chr': function(args) { return String.fromCharCode(args[1]); },\n\t'ord': function(args) { return args[1].toString().charCodeAt(0); },\n\n\t'not': function(args) { return !args[1]; },\n\t'neg': function(args) { return -args[1]; },\n\t'abs': function(args) { return Math.abs(args[1]); },\n\n\t'and': function(args) { for (let i = 1; i < args.length; i++) if (!args[i]) return false; return true; },\n\t'or': function(args) { for (let i = 1; i < args.length; i++) if (~~args[i]) return true; return false; },\n\n\t'eq': function(args) { return args[1] == args[2]; },\n\t'ne': function(args) { return args[1] != args[2]; },\n\t'lt': function(args) { return args[1] < args[2]; },\n\t'le': function(args) { return args[1] <= args[2]; },\n\t'gt': function(args) { return args[1] > args[2]; },\n\t'ge': function(args) { return args[1] >= args[2]; },\n\t'isnotnull': function(args) { return !!args[1]; },\n\t'isnull': function(args) { return !args[1]; },\n\t'iszero': function(args) { return parseInt(args[1]) == 0; },\n\n\t'eq?': function(args) { return args[1] == args[2]; },\n\t'ne?': function(args) { return args[1] != args[2]; },\n\t'lt?': function(args) { return args[1] < args[2]; },\n\t'le?': function(args) { return args[1] <= args[2]; },\n\t'gt?': function(args) { return args[1] > args[2]; },\n\t'ge?': function(args) { return args[1] >= args[2]; },\n\t'notnull?': function(args) { return !!args[1]; },\n\t'null?': function(args) { return !args[1]; },\n\t'zero?': function(args) { return parseInt(args[1]) == 0; },\n\n\t'typeof': function(args) { return Rinn.typeOf(args[1]); },\n\n\t'*': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'/': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'+': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'-': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mul': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x *= args[i]; return x; },\n\t'div': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x /= args[i]; return x; },\n\t'sum': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= -args[i]; return x; },\n\t'sub': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x -= args[i]; return x; },\n\t'mod': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x %= args[i]; return x; },\n\t'pow': function(args) { let x = args[1]; for (let i = 2; i < args.length; i++) x = Math.pow(x, args[i]); return x; },\n\n\t/**\n\t**\tReturns the JSON representation of the expression.\n\t**\n\t**\tdump <expr>\n\t*/\n\t'dump': function (args)\n\t{\n\t\treturn JSON.stringify(args[1]);\n\t},\n\n\t/**\n\t**\tSets one or more variables in the data context.\n\t**\n\t**\tset <var-name> <expr> [<var-name> <expr>]*\n\t*/\n\t'_set': function (parts, data)\n\t{\n\t\tfor (let i = 1; i+1 < parts.length; i += 2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i+1], data);\n\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) ref[0][ref[1]] = value;\n\t\t\t}\n\t\t\telse\n\t\t\t\tdata[Template.value(parts[i], data)] = value;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tRemoves one or more variables from the data context.\n\t**\n\t**\tunset <var-name> [<var-name>]*\n\t*/\n\t'_unset': function (parts, data)\n\t{\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t{\n\t\t\tif (parts[i].length > 1)\n\t\t\t{\n\t\t\t\tlet ref = Template.expand(parts[i], data, 'varref');\n\t\t\t\tif (ref != null) delete ref[0][ref[1]];\n\t\t\t}\n\t\t\telse\n\t\t\t\tdelete data[Template.value(parts[i], data)];\n\t\t}\n\n\t\treturn null;\n\t},\n\n\n\t/**\n\t**\tReturns the expression without white-space on the left or right. The expression can be a string or an array.\n\t**\n\t**\ttrim <expr>\n\t*/\n\t'trim': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.trim()) : args[1].trim()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in uppercase. The expression can be a string or an array.\n\t**\n\t**\tupper <expr>\n\t*/\n\t'upper': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toUpperCase()) : args[1].toUpperCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression in lower. The expression can be a string or an array.\n\t**\n\t**\tlower <expr>\n\t*/\n\t'lower': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.toLowerCase()) : args[1].toLowerCase()) : '';\n\t},\n\n\t/**\n\t**\tReturns a sub-string of the given string.\n\t**\n\t**\tsubstr <start> <count> <string>\n\t**\tsubstr <start> <string>\n\t*/\n\t'substr': function (args)\n\t{\n\t\tlet s = args[args.length-1].toString();\n\n\t\tlet start = 0;\n\t\tlet count = null;\n\n\t\tif (args.length == 4)\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = ~~(args[2]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstart = ~~(args[1]);\n\t\t\tcount = null;\n\t\t}\n\n\t\tif (start < 0) start += s.length;\n\t\tif (count < 0) count += s.length;\n\n\t\tif (count === null)\n\t\t\tcount = s.length - start;\n\n\t\treturn s.substr(start, count);\n\t},\n\n\t/**\n\t**\tReplaces a matching string with the given replacement string in a given text.\n\t**\n\t**\treplace <search> <replacement> <text>\n\t*/\n\t'replace': function (args)\n\t{\n\t\treturn args[3].split(args[1]).join(args[2]);\n\t},\n\n\t/**\n\t**\tConverts all new-line chars in the expression to <br/>, the expression can be a string or an array.\n\t**\n\t**\tnl2br <expr>\n\t*/\n\t'nl2br': function (args)\n\t{\n\t\treturn args[1] ? (typeof(args[1]) == \"object\" ? args[1].map(e => e.replace(/\\n/g, \"<br/>\")) : args[1].replace(/\\n/g, \"<br/>\")) : '';\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', the expression can be a string or an array.\n\t**\n\t**\t% <tag-name> <expr>\n\t*/\n\t'%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet s = '';\n\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t{\n\t\t\tif (Rinn.typeOf(args[i]) == 'array')\n\t\t\t{\n\t\t\t\ts += `<${name}>`;\n\t\t\t\t\n\t\t\t\tfor (let j = 0; j < args[i].length; j++)\n\t\t\t\t\ts += args[i][j];\n\n\t\t\t\ts += `</${name}>`;\n\t\t\t}\n\t\t\telse\n\t\t\t\ts += `<${name}>${args[i]}</${name}>`;\n\t\t}\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tReturns the expression inside an XML tag named 'tag-name', attributes are supported.\n\t**\n\t**\t%% <tag-name> [<attr> <value>]* [<content>]\n\t*/\n\t'%%': function (args)\n\t{\n\t\targs.shift();\n\t\tvar name = args.shift();\n\n\t\tlet attr = '';\n\t\tlet text = '';\n\n\t\tfor (let i = 0; i < args.length; i += 2)\n\t\t{\n\t\t\tif (i+1 < args.length)\n\t\t\t\tattr += ` ${args[i]}=\"${args[i+1]}\"`;\n\t\t\telse\n\t\t\t\ttext = args[i];\n\t\t}\n\n\t\treturn text ? `<${name}${attr}>${text}</${name}>` : `<${name}${attr}/>`;\n\t},\n\n\t/**\n\t**\tJoins the given array expression into a string. The provided string-expr will be used as separator.\n\t**\n\t**\tjoin <string-expr> <array-expr>\n\t*/\n\t'join': function (args)\n\t{\n\t\tif (args[2] && Rinn.typeOf(args[2]) == 'array')\n\t\t\treturn args[2].join(args[1]);\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tSplits the given expression by the specified string. Returns an array.\n\t**\n\t**\tsplit <string-expr> <expr>\n\t*/\n\t'split': function (args)\n\t{\n\t\tif (args[2] && typeof(args[2]) == \"string\")\n\t\t\treturn args[2].split(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the keys of the given object-expr.\n\t**\n\t**\tkeys <object-expr>\n\t*/\n\t'keys': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.keys(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tReturns an array with the values of the given object-expr.\n\t**\n\t**\tvalues <object-expr>\n\t*/\n\t'values': function (args)\n\t{\n\t\tif (args[1] && typeof(args[1]) == \"object\")\n\t\t\treturn Object.values(args[1]);\n\n\t\treturn [];\n\t},\n\n\t/**\n\t**\tConstructs a string obtained by concatenating the expanded template for each of the items in the list-expr, the mandatory varname\n\t**\tparameter (namely 'i') indicates the name of the variable that will contain the data of each item as the list-expr is\n\t**\ttraversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote the index/key and numeric index\n\t**\tof the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\teach <varname> <list-expr> <template>\n\t*/\n\t'_each': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet s = '';\n\t\tlet j = 0;\n\n\t\tif (!list) return s;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\ts += Template.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tExpands the given template for each of the items in the list-expr, the mandatory varname parameter (namely 'i') indicates the name of the variable\n\t**\tthat will contain the data of each item as the list-expr is traversed. Extra variables i# and i## (suffix '#' and '##') are introduced to denote\n\t**\tthe index/key and numeric index of the current item respectively, note that the later will always have a numeric value.\n\t**\n\t**\tDoes not produce any output (returns null).\n\t**\n\t**\tforeach <varname> <list-expr> <template>\n\t*/\n\t'_foreach': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\n\t\tlet j = 0;\n\n\t\tif (!list) return null;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tTemplate.expand(parts[3], data, 'text');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tReturns the valueA if the expression is true otherwise valueB, this is a short version of the 'if' function with the\n\t**\tdifference that the result is 'obj' instead of text.\n\t**\n\t**\t? <expr> <valueA> [<valueB>]\n\t*/\n\t'_?': function (parts, data)\n\t{\n\t\tif (Template.expand(parts[1], data, 'arg'))\n\t\t\treturn Template.expand(parts[2], data, 'arg');\n\n\t\tif (parts.length > 3)\n\t\t\treturn Template.expand(parts[3], data, 'arg');\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tReturns the valueA if it is not null (or empty or zero), otherwise returns valueB.\n\t**\n\t**\t?? <valueA> <valueB>\n\t*/\n\t'_??': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\t\tif (value) return value;\n\t\n\t\treturn Template.expand(parts[2], data, 'arg');\n\t},\n\n\t/**\n\t**\tReturns the value if the expression is true, supports 'elif' and 'else' as well. The result of this function is always text.\n\t**\n\t**\tif <expr> <value> [elif <expr> <value>] [else <value>]\n\t*/\n\t'_if': function (parts, data)\n\t{\n\t\tfor (let i = 0; i < parts.length; i += 3)\n\t\t{\n\t\t\tif (Template.expand(parts[i], data, 'arg') == 'else')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\n\t\t\tif (Template.expand(parts[i+1], data, 'arg'))\n\t\t\t\treturn Template.expand(parts[i+2], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tLoads the expression value and attempts to match one case.\n\t**\n\t**\tswitch <expr> <case1> <value1> ... <caseN> <valueN> default <defvalue> \n\t*/\n\t'_switch': function (parts, data)\n\t{\n\t\tlet value = Template.expand(parts[1], data, 'arg');\n\n\t\tfor (let i = 2; i < parts.length; i += 2)\n\t\t{\n\t\t\tlet case_value = Template.expand(parts[i], data, 'arg');\n\t\t\tif (case_value == value || case_value == 'default')\n\t\t\t\treturn Template.expand(parts[i+1], data, 'text');\n\t\t}\n\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tExits the current inner most loop.\n\t**\n\t**\tbreak\n\t*/\n\t'_break': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_BREAK');\n\t},\n\n\t/**\n\t**\tSkips execution and continues the next cycle of the current inner most loop.\n\t**\n\t**\tcontinue\n\t*/\n\t'_continue': function (parts, data)\n\t{\n\t\tthrow new Error('EXC_CONTINUE');\n\t},\n\n\t/**\n\t**\tConstructs an array with the results of repeating the specified template for a number of times.\n\t**\n\t**\trepeat <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_repeat': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`repeat`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0, to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tlet value = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\t\tlet arr = [];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tarr.push(Template.value(tpl, data));\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn arr;\n\t},\n\n\t/**\n\t**\tRepeats the specified template for a number of times.\n\t**\n\t**\tfor <varname:i> [from <number>] [to <number>] [count <number>] [step <number>] <template>\n\t*/\n\t'_for': function (parts, data)\n\t{\n\t\tif (parts.length < 3 || (parts.length & 1) != 1)\n\t\t\treturn '(`for`: Wrong number of parameters)';\n\n\t\tlet var_name = Template.value(parts[1], data);\n\t\tlet count = null;\n\t\tlet from = 0; to = null;\n\t\tlet step = null;\n\n\t\tfor (let i = 2; i < parts.length-1; i+=2)\n\t\t{\n\t\t\tvalue = Template.value(parts[i], data);\n\n\t\t\tswitch (value.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'from':\n\t\t\t\t\tfrom = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'to':\n\t\t\t\t\tto = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'count':\n\t\t\t\t\tcount = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'step':\n\t\t\t\t\tstep = parseFloat(Template.value(parts[i+1], data));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet tpl = parts[parts.length-1];\n\n\t\tif (to !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = from > to ? -1 : 1;\n\n\t\t\tif (step < 0)\n\t\t\t{\n\t\t\t\tfor (let i = from; i >= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfor (let i = from; i <= to; i += step)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tlet name = e.message;\n\t\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (count !== null)\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\n\t\t\tfor (let i = from; count > 0; count--, i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (step === null)\n\t\t\t\tstep = 1;\n\t\n\t\t\tfor (let i = from; ; i += step)\n\t\t\t{\n\t\t\t\ttry {\n\t\t\t\t\tdata[var_name] = i;\n\t\t\t\t\tTemplate.value(tpl, data);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tlet name = e.message;\n\t\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tRepeats the specified template infinitely until a \"break\" is found.\n\t**\n\t**\tloop <template>\n\t*/\n\t'_loop': function (parts, data)\n\t{\n\t\tif (parts.length < 2)\n\t\t\treturn '(`loop`: Wrong number of parameters)';\n\n\t\tlet tpl = parts[1];\n\n\t\twhile (true)\n\t\t{\n\t\t\ttry {\n\t\t\t\tTemplate.value(tpl, data);\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\tlet name = e.message;\n\t\t\t\tif (name == 'EXC_BREAK') break;\n\t\t\t\tif (name == 'EXC_CONTINUE') continue;\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t/**\n\t**\tWrites the specified arguments to the console.\n\t**\n\t**\techo <expr> [<expr>...]\n\t*/\n\t'_echo': function (parts, data)\n\t{\n\t\tlet s = '';\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts += Template.expand(parts[i], data, 'arg');\n\n\t\tconsole.log(s);\n\t\treturn '';\n\t},\n\n\t/**\n\t**\tConstructs a list from the given arguments and returns it.\n\t**\n\t**\t# <expr> [<expr>...]\n\t*/\n\t'_#': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(Template.expand(parts[i], data, 'arg'));\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded list from the given arguments and returns it.\n\t**\n\t**\t## <expr> [<expr>...]\n\t*/\n\t'_##': function (parts, data)\n\t{\n\t\tlet s = [];\n\n\t\tfor (let i = 1; i < parts.length; i++)\n\t\t\ts.push(parts[i]);\n\n\t\treturn s;\n\t},\n\n\t/**\n\t**\tConstructs an associative array (dictionary) and returns it.\n\t**\n\t**\t& <name>: <expr> [<name>: <expr>...]\n\t**\t& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, true);\n\t},\n\n\t/**\n\t**\tConstructs a non-expanded associative array (dictionary) and returns it.\n\t**\n\t**\t&& <name>: <expr> [<name>: <expr>...]\n\t**\t&& :<name> <expr> [:<name> <expr>...]\n\t*/\n\t'_&&': function (parts, data)\n\t{\n\t\treturn Template.getNamedValues (parts, data, 1, false);\n\t},\n\n\t/**\n\t**\tReturns true if the specified map contains all the specified keys. If it fails the global variable `err` will contain an error message.\n\t**\n\t**\tcontains <expr> <name> [<name>...]\n\t*/\n\t'contains': function (args, parts, data)\n\t{\n\t\tlet value = args[1];\n\n\t\tif (typeof(value) != 'object')\n\t\t{\n\t\t\tdata.err = 'Argument is not a Map';\n\t\t\treturn false;\n\t\t}\n\n\t\tlet s = '';\n\n\t\tfor (let i = 2; i < args.length; i++)\n\t\t{\n\t\t\tif (!(args[i] in value))\n\t\t\t\ts += ', '+args[i];\n\t\t}\n\n\t\tif (s != '')\n\t\t{\n\t\t\tdata.err = s.substr(1);\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t/**\n\t**\tReturns true if the specified map has the specified key. Returns boolean.\n\t**\n\t**\thas <name> <expr>\n\t*/\n\t'has': function (args, parts, data)\n\t{\n\t\tlet value = args[2];\n\n\t\tif (Rinn.typeOf(value) != 'object')\n\t\t\treturn false;\n\n\t\treturn args[1] in value;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the transformed values of the array/map (evaluating the template). And just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tmap <varname> <list-expr> <template>\n\t*/\n\t'_map': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (arrayMode)\n\t\t\t\toutput.push(Template.expand(parts[3], data, 'arg'));\n\t\t\telse\n\t\t\t\toutput[i] = Template.expand(parts[3], data, 'arg');\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tReturns a new array/map contaning the elements where the template evaluates to non-zero. Just as in 'each', the i# and i## variables be available.\n\t**\n\t**\tfilter <varname> <list-expr> <template>\n\t*/\n\t'_filter': function (parts, data)\n\t{\n\t\tlet var_name = Template.expand(parts[1], data, 'arg');\n\n\t\tlet list = Template.expand(parts[2], data, 'arg');\n\t\tif (!list) return list;\n\n\t\tlet arrayMode = Rinn.typeOf(list) == 'array' ? true : false;\n\t\tlet output = arrayMode ? [] : {};\n\t\tlet j = 0;\n\n\t\tfor (let i in list)\n\t\t{\n\t\t\tdata[var_name] = list[i];\n\t\t\tdata[var_name + '##'] = j++;\n\t\t\tdata[var_name + '#'] = i;\n\n\t\t\tif (~~Template.expand(parts[3], data, 'arg'))\n\t\t\t{\n\t\t\t\tif (arrayMode)\n\t\t\t\t\toutput.push(list[i]);\n\t\t\t\telse\n\t\t\t\t\toutput[i] = list[i];\n\t\t\t}\n\t\t}\n\n\t\tdelete data[var_name];\n\t\tdelete data[var_name + '##'];\n\t\tdelete data[var_name + '#'];\n\n\t\treturn output;\n\t},\n\n\t/**\n\t**\tExpands the specified template string with the given data. The sym_open and sym_close will be '{' and '}' respectively.\n\t**\tIf no data is provided, current data parameter will be used.\n\t**\n\t**\texpand <template> <data>\n\t*/\n\t'expand': function (args, parts, data)\n\t{\n\t\treturn Template.expand (Template.parseTemplate (args[1], '{', '}'), args.length == 3 ? args[2] : data);\n\t},\n\n\t/**\n\t**\tCalls a function described by the given parameter.\n\t**\n\t**\tcall <function> <args...>\n\t*/\n\t'_call': function (parts, data)\n\t{\n\t\tlet ref = Template.expand(parts[1], data, 'varref');\n\n\t\tif (!ref || typeof(ref[0][ref[1]]) != 'function')\n\t\t\tthrow new Error ('Expression is not a function: ' + Template.expand(parts[1], data, 'obj').map(i => i == null ? '.' : i).join(''));\n\n\t\tlet args = [];\n\n\t\tfor (let i = 2; i < parts.length; i++)\n\t\t\targs.push(Template.value(parts[i], data));\n\n\t\treturn ref[0][ref[1]] (...args);\n\t},\n};\n\nexport default Template;\n","/*! https://mths.be/base64 v1.0.0 by @mathias | MIT license */\n;(function(root) {\n\n\t// Detect free variables `exports`.\n\tvar freeExports = typeof exports == 'object' && exports;\n\n\t// Detect free variable `module`.\n\tvar freeModule = typeof module == 'object' && module &&\n\t\tmodule.exports == freeExports && module;\n\n\t// Detect free variable `global`, from Node.js or Browserified code, and use\n\t// it as `root`.\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (freeGlobal.global === freeGlobal || freeGlobal.window === freeGlobal) {\n\t\troot = freeGlobal;\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\tvar InvalidCharacterError = function(message) {\n\t\tthis.message = message;\n\t};\n\tInvalidCharacterError.prototype = new Error;\n\tInvalidCharacterError.prototype.name = 'InvalidCharacterError';\n\n\tvar error = function(message) {\n\t\t// Note: the error messages used throughout this file match those used by\n\t\t// the native `atob`/`btoa` implementation in Chromium.\n\t\tthrow new InvalidCharacterError(message);\n\t};\n\n\tvar TABLE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\t// http://whatwg.org/html/common-microsyntaxes.html#space-character\n\tvar REGEX_SPACE_CHARACTERS = /[\\t\\n\\f\\r ]/g;\n\n\t// `decode` is designed to be fully compatible with `atob` as described in the\n\t// HTML Standard. http://whatwg.org/html/webappapis.html#dom-windowbase64-atob\n\t// The optimized base64-decoding algorithm used is based on @atks excellent\n\t// implementation. https://gist.github.com/atk/1020396\n\tvar decode = function(input) {\n\t\tinput = String(input)\n\t\t\t.replace(REGEX_SPACE_CHARACTERS, '');\n\t\tvar length = input.length;\n\t\tif (length % 4 == 0) {\n\t\t\tinput = input.replace(/==?$/, '');\n\t\t\tlength = input.length;\n\t\t}\n\t\tif (\n\t\t\tlength % 4 == 1 ||\n\t\t\t// http://whatwg.org/C#alphanumeric-ascii-characters\n\t\t\t/[^+a-zA-Z0-9/]/.test(input)\n\t\t) {\n\t\t\terror(\n\t\t\t\t'Invalid character: the string to be decoded is not correctly encoded.'\n\t\t\t);\n\t\t}\n\t\tvar bitCounter = 0;\n\t\tvar bitStorage;\n\t\tvar buffer;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\twhile (++position < length) {\n\t\t\tbuffer = TABLE.indexOf(input.charAt(position));\n\t\t\tbitStorage = bitCounter % 4 ? bitStorage * 64 + buffer : buffer;\n\t\t\t// Unless this is the first of a group of 4 characters\n\t\t\tif (bitCounter++ % 4) {\n\t\t\t\t// convert the first 8 bits to a single ASCII character.\n\t\t\t\toutput += String.fromCharCode(\n\t\t\t\t\t0xFF & bitStorage >> (-2 * bitCounter & 6)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t};\n\n\t// `encode` is designed to be fully compatible with `btoa` as described in the\n\t// HTML Standard: http://whatwg.org/html/webappapis.html#dom-windowbase64-btoa\n\tvar encode = function(input) {\n\t\tinput = String(input);\n\t\tif (/[^\\0-\\xFF]/.test(input)) {\n\t\t\t// Note: no need to special-case astral symbols here, as surrogates are\n\t\t\t// matched, and the input is supposed to only contain ASCII anyway.\n\t\t\terror(\n\t\t\t\t'The string to be encoded contains characters outside of the ' +\n\t\t\t\t'Latin1 range.'\n\t\t\t);\n\t\t}\n\t\tvar padding = input.length % 3;\n\t\tvar output = '';\n\t\tvar position = -1;\n\t\tvar a;\n\t\tvar b;\n\t\tvar c;\n\t\tvar buffer;\n\t\t// Make sure any padding is handled outside of the loop.\n\t\tvar length = input.length - padding;\n\n\t\twhile (++position < length) {\n\t\t\t// Read three bytes, i.e. 24 bits.\n\t\t\ta = input.charCodeAt(position) << 16;\n\t\t\tb = input.charCodeAt(++position) << 8;\n\t\t\tc = input.charCodeAt(++position);\n\t\t\tbuffer = a + b + c;\n\t\t\t// Turn the 24 bits into four chunks of 6 bits each, and append the\n\t\t\t// matching character for each of them to the output.\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 18 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 12 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer >> 6 & 0x3F) +\n\t\t\t\tTABLE.charAt(buffer & 0x3F)\n\t\t\t);\n\t\t}\n\n\t\tif (padding == 2) {\n\t\t\ta = input.charCodeAt(position) << 8;\n\t\t\tb = input.charCodeAt(++position);\n\t\t\tbuffer = a + b;\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 10) +\n\t\t\t\tTABLE.charAt((buffer >> 4) & 0x3F) +\n\t\t\t\tTABLE.charAt((buffer << 2) & 0x3F) +\n\t\t\t\t'='\n\t\t\t);\n\t\t} else if (padding == 1) {\n\t\t\tbuffer = input.charCodeAt(position);\n\t\t\toutput += (\n\t\t\t\tTABLE.charAt(buffer >> 2) +\n\t\t\t\tTABLE.charAt((buffer << 4) & 0x3F) +\n\t\t\t\t'=='\n\t\t\t);\n\t\t}\n\n\t\treturn output;\n\t};\n\n\tvar base64 = {\n\t\t'encode': encode,\n\t\t'decode': decode,\n\t\t'version': '1.0.0'\n\t};\n\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine(function() {\n\t\t\treturn base64;\n\t\t});\n\t}\telse if (freeExports && !freeExports.nodeType) {\n\t\tif (freeModule) { // in Node.js or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = base64;\n\t\t} else { // in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (var key in base64) {\n\t\t\t\tbase64.hasOwnProperty(key) && (freeExports[key] = base64[key]);\n\t\t\t}\n\t\t}\n\t} else { // in Rhino or a web browser\n\t\troot.base64 = base64;\n\t}\n\n}(this));\n","\"use strict\";\n\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n\t// the only reliable means to get the global object is\n\t// `Function('return this')()`\n\t// However, this causes CSP violations in Chrome apps.\n\tif (typeof self !== 'undefined') { return self; }\n\tif (typeof window !== 'undefined') { return window; }\n\tif (typeof global !== 'undefined') { return global; }\n\tthrow new Error('unable to locate global object');\n}\n\nvar global = getGlobal();\n\nmodule.exports = exports = global.fetch;\n\n// Needed for TypeScript and Webpack.\nif (global.fetch) {\n\texports.default = global.fetch.bind(global);\n}\n\nexports.Headers = global.Headers;\nexports.Request = global.Request;\nexports.Response = global.Response;","\r\nimport { EventDispatcher } from 'rinn';\r\n\r\n/*\r\n**\tThe Router is a special module that detects local URL changes (when a hash-change occurs) and\r\n**\tforwards events to the appropriate handlers.\r\n*/\r\n\r\nconst _Router =\r\n{\r\n\tRoute: EventDispatcher.extend\r\n\t({\r\n\t\t/*\r\n\t\t**\tRegular expression for the route. This is generated from a simpler expression provided\r\n\t\t**\tin the constructor.\r\n\t\t*/\r\n\t\trouteRegex: null,\r\n\r\n\t\t/*\r\n\t\t**\tOriginal route string value.\r\n\t\t*/\r\n\t\tvalue: null,\r\n\r\n\t\t/*\r\n\t\t**\tMap with the indices and the names of each paremeter obtained from the route expression.\r\n\t\t*/\r\n\t\tparams: null,\r\n\r\n\t\t/*\r\n\t\t**\tArguments obtained from the current route (uses `params` to determine name of arguments).\r\n\t\t*/\r\n\t\targs: null,\r\n\r\n\t\t/*\r\n\t\t**\tArguments string obtained from the last route dispatch. Used to check if the arguments changed.\r\n\t\t*/\r\n\t\ts_args: null,\r\n\r\n\t\t/*\r\n\t\t**\tIndicates if the route is active because of a past positive dispatch.\r\n\t\t*/\r\n\t\tactive: false,\r\n\r\n\t\t/*\r\n\t\t**\tIndicates if the params have changed since last event. Transition from inactive to active route will always set this value to true.\r\n\t\t*/\r\n\t\tchanged: false,\r\n\r\n\t\t/*\r\n\t\t**\tConstructor of the route, the specified argument is a route expression.\r\n\t\t**\r\n\t\t**\t>> void __ctor (string route);\r\n\t\t*/\r\n\t\t__ctor: function (route)\r\n\t\t{\r\n\t\t\tthis._super.EventDispatcher.__ctor();\r\n\t\t\tthis._compileRoute (this.value = route);\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tTransforms the specified route expression into a regular expression and a set of parameter\r\n\t\t**\tnames and stores them in the 'param' array.\r\n\t\t**\r\n\t\t**\t>> void _compileRoute (string route);\r\n\t\t*/\r\n\t\t_compileRoute: function (route)\r\n\t\t{\r\n\t\t\tthis.params = [];\r\n\r\n\t\t\troute = route.replace(/\\/\\*\\//g, '/.+/');\r\n\r\n\t\t\twhile (true)\r\n\t\t\t{\r\n\t\t\t\tvar m = /:([!@A-Za-z0-9_-]+)/.exec(route);\r\n\t\t\t\tif (!m) break;\r\n\t\r\n\t\t\t\troute = route.replace(m[0], '([^/]+)');\r\n\t\t\t\tthis.params.push (m[1]);\r\n\t\t\t}\r\n\r\n\t\t\tthis.routeRegex = '^' + route.replace(/##/g, '');\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tAdds a handler to the route dispatcher. The handler can be removed later using removeHandler and\r\n\t\t**\tspecifying the same parameters. If unrouted boolean is specified the event to listen to will be\r\n\t\t**\tthe unrouted event (when the route changes and the route is not activated).\r\n\t\t**\r\n\t\t**\tvoid addHandler (handler: function, unrouted: bool, context:object=null);\r\n\t\t*/\r\n\t\taddHandler: function (handler, unrouted=false, context=null)\r\n\t\t{\r\n\t\t\tthis.addEventListener ((unrouted === true ? 'un' : '') + 'routed', handler, context);\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tRemoves a handler from the route dispatcher.\r\n\t\t**\r\n\t\t**\tvoid removeHandler (handler: function, unrouted: bool, context: object=null);\r\n\t\t*/\r\n\t\tremoveHandler: function (handler, unrouted=false, context=null)\r\n\t\t{\r\n\t\t\tthis.removeEventListener ((unrouted === true ? 'un' : '') + 'routed', handler, context);\r\n\t\t},\r\n\r\n\t\t/*\r\n\t\t**\tVerifies if the specified route matches the internal route and if so dispatches a (depends on doUnroute parameter) \"routed\" or \"unrouted\" event with the\r\n\t\t**\tparameters obtained from the location to all attached handlers.\r\n\t\t**\r\n\t\t**\tvoid dispatch (route:string, doUnroute:bool);\r\n\t\t*/\r\n\t\tdispatch: function (route)\r\n\t\t{\r\n\t\t\tvar matches = route.match(this.routeRegex);\r\n\t\t\tif (!matches)\r\n\t\t\t{\r\n\t\t\t\tthis.s_args = null;\r\n\r\n\t\t\t\tif (this.active)\r\n\t\t\t\t\tthis.dispatchEvent ('unrouted', { route: this });\r\n\r\n\t\t\t\tthis.active = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar args = { route: this };\r\n\t\t\tvar str = '';\r\n\r\n\t\t\tfor (var i = 0; i < this.params.length; i++)\r\n\t\t\t{\r\n\t\t\t\targs[this.params[i]] = matches[i+1];\r\n\t\t\t\tstr += '_' + matches[i+1];\r\n\t\t\t}\r\n\r\n\t\t\tthis.changed = str != this.s_args;\r\n\t\t\tthis.s_args = str;\r\n\r\n\t\t\tthis.dispatchEvent ('routed', this.args = args);\r\n\t\t\tthis.active = true;\r\n\t\t}\r\n\t}),\r\n\r\n\t/*\r\n\t**\tMap with route objects. The key of the map is the route and the value a handler.\r\n\t*/\r\n\troutes: { },\r\n\r\n\t/*\r\n\t**\tSorted list of routes. Smaller routes are processed first than larger ones. This array stores\r\n\t**\tonly the keys to the Router.routes map.\r\n\t*/\r\n\tsortedRoutes: [ ],\r\n\r\n\t/*\r\n\t**\tIndicates the number of times the onLocationChanged handler should ignore the hash change event.\r\n\t*/\r\n\tignoreHashChangeEvent: 0,\r\n\r\n\t/*\r\n\t**\tCurrent relative location (everything after the location hash symbol).\r\n\t*/\r\n\tlocation: '',\r\n\r\n\t/*\r\n\t**\tCurrent relative location as an array of elements (obtained by splitting the location by slash).\r\n\t*/\r\n\targs: [],\r\n\r\n\t/*\r\n\t**\tInitializes the router module. Ensure to call `refresh` once to force a hashchange when the page loads.\r\n\t*/\r\n\tinit: function ()\r\n\t{\r\n\t\tif (this.alreadyAttached)\r\n\t\t\treturn;\r\n\r\n\t\tthis.alreadyAttached = true;\r\n\r\n\t\tif ('onhashchange' in globalThis)\r\n\t\t\tglobalThis.onhashchange = this.onLocationChanged.bind(this);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRefreshes the current route by forcing a hashchange event.\r\n\t*/\r\n\trefresh: function ()\r\n\t{\r\n\t\tthis.onLocationChanged();\r\n\t},\r\n\r\n\t/*\r\n\t**\tChanges the current location and optionally prevents a trigger of the hashchange event.\r\n\t*/\r\n\tsetRoute: function (route, silent)\r\n\t{\r\n\t\tvar location = this.realLocation (route);\r\n\t\tif (location == this.location) return;\r\n\r\n\t\tif (silent) this.ignoreHashChangeEvent++;\r\n\t\tglobalThis.location.hash = location;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds the specified route to the routing map. When the specified route is detected, the `onRoute` handler will be called, and then\r\n\t**\twhen the route exits `onUnroute` will be called.\r\n\t*/\r\n\taddRoute: function (route, onRoute, onUnroute=null)\r\n\t{\r\n\t\tif (!this.routes[route])\r\n\t\t{\r\n\t\t\tthis.routes[route] = new this.Route (route);\r\n\t\t\tthis.sortedRoutes.push (route);\r\n\r\n\t\t\tthis.sortedRoutes.sort ((a, b) => {\r\n\t\t\t\treturn this.routes[a].routeRegex.length - this.routes[b].routeRegex.length;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (onUnroute !== null)\r\n\t\t{\r\n\t\t\tthis.routes[route].addHandler (onRoute, false);\r\n\t\t\tthis.routes[route].addHandler (onUnroute, true);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.routes[route].addHandler (onRoute, false);\r\n\r\n\t\treturn this.routes[route];\r\n\t},\r\n\r\n\t/*\r\n\t**\tReturns the Route object for the specified route.\r\n\t*/\r\n\tgetRoute: function (route)\r\n\t{\r\n\t\tif (!this.routes[route])\r\n\t\t{\r\n\t\t\tthis.routes[route] = new this.Route (route);\r\n\t\t\tthis.sortedRoutes.push (route);\r\n\r\n\t\t\tthis.sortedRoutes.sort ((a, b) => {\r\n\t\t\t\treturn this.routes[a].routeRegex.length - this.routes[b].routeRegex.length;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.routes[route];\r\n\t},\r\n\r\n\t/*\r\n\t**\tAdds the specified routes to the routing map. The routes map should contain the route expression\r\n\t**\tin the key of the map and a handler function in the value.\r\n\t*/\r\n\taddRoutes: function (routes)\r\n\t{\r\n\t\tfor (var i in routes)\r\n\t\t{\r\n\t\t\tif (!this.routes[i])\r\n\t\t\t{\r\n\t\t\t\tthis.routes[i] = new this.Route (i);\r\n\t\t\t\tthis.sortedRoutes.push (i);\r\n\t\t\t}\r\n\r\n\t\t\tthis.routes[i].addHandler (routes[i], false);\r\n\t\t}\r\n\r\n\t\tthis.sortedRoutes.sort ((a, b) => {\r\n\t\t\treturn this.routes[a].routeRegex.length - this.routes[b].routeRegex.length;\r\n\t\t});\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified route from the routing map.\r\n\t*/\r\n\tremoveRoute: function (route, onRoute, onUnroute)\r\n\t{\r\n\t\tif (!this.routes[route]) return;\r\n\r\n\t\tif (onUnroute !== undefined)\r\n\t\t{\r\n\t\t\tthis.routes[route].removeHandler (onRoute, false);\r\n\t\t\tthis.routes[route].removeHandler (onUnroute, true);\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.routes[route].removeHandler (onRoute);\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves the specified routes from the routing map. The routes map should contain the route\r\n\t**\texpression in the key of the map and a handler function in the value.\r\n\t*/\r\n\tremoveRoutes: function (routes)\r\n\t{\r\n\t\tfor (var i in routes)\r\n\t\t{\r\n\t\t\tif (!this.routes[i]) continue;\r\n\r\n\t\t\tthis.routes[i].removeHandler (routes[i]);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t**\tGiven a formatted location and a previous one it will return the correct real location.\r\n\t*/\r\n\trealLocation: function (cLocation, pLocation)\r\n\t{\r\n\t\tif (!pLocation) pLocation = this.location;\r\n\t\tif (!pLocation) pLocation = ' ';\r\n\r\n\t\tvar state = 0, i = 0, j = 0, k;\r\n\t\tvar rLocation = '';\r\n\r\n\t\twhile (state != -1 && i < cLocation.length && j < pLocation.length)\r\n\t\t{\r\n\t\t\tswitch (state)\r\n\t\t\t{\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tif (cLocation.substr(i++, 1) == '*')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstate = 1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (cLocation.substr(i-1, 1) != pLocation.substr(j++, 1))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trLocation += cLocation.substr(i-1);\r\n\t\t\t\t\t\tstate = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trLocation += pLocation.substr(j-1, 1);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tif (cLocation.substr(i, 1) == '*')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstate = 3;\r\n\t\t\t\t\t\ti++;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tstate = 2;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tk = pLocation.indexOf(cLocation.substr(i, 1), j);\r\n\t\t\t\t\tif (k == -1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trLocation += pLocation.substr(j) + cLocation.substr(i);\r\n\t\t\t\t\t\tstate = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trLocation += pLocation.substr(j, k-j);\r\n\r\n\t\t\t\t\tstate = 0;\r\n\t\t\t\t\tj = k;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 3:\r\n\t\t\t\t\tk = pLocation.lastIndexOf(cLocation.substr(i, 1));\r\n\t\t\t\t\tif (k == -1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\trLocation += cLocation.substr(i);\r\n\t\t\t\t\t\tstate = -1;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\trLocation += pLocation.substr(j, k-j);\r\n\r\n\t\t\t\t\tstate = 0;\r\n\t\t\t\t\tj = k;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (state != -1)\r\n\t\t\trLocation += cLocation.substr(i);\r\n\r\n\t\treturn rLocation.trim();\r\n\t},\r\n\r\n\t/*\r\n\t**\tEvent handler called when the location hash changes.\r\n\t*/\r\n\tonLocationChanged: function ()\r\n\t{\r\n\t\tvar cLocation = location.hash.substr(1);\r\n\t\tvar rLocation = this.realLocation (cLocation);\r\n\r\n\t\tif (cLocation != rLocation)\r\n\t\t{\r\n\t\t\tglobalThis.location.replace('#' + rLocation);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.location = cLocation;\r\n\t\tthis.args = this.location.split ('/');\r\n\r\n\t\tif (this.ignoreHashChangeEvent > 0)\r\n\t\t{\r\n\t\t\tthis.ignoreHashChangeEvent--;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < this.sortedRoutes.length; i++)\r\n\t\t\tthis.routes[this.sortedRoutes[i]].dispatch (this.location);\r\n\t},\r\n\r\n\t/*\r\n\t**\tNavigates to the given hash-based URL.\r\n\t*/\r\n\tnavigate: function (location, replace=false)\r\n\t{\r\n\t\tlocation = this.realLocation(location);\r\n\r\n\t\tif (globalThis.location.hash == '#'+location)\r\n\t\t{\r\n\t\t\tthis.refresh();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (replace)\r\n\t\t\tglobalThis.location.replace('#'+location);\r\n\t\telse\r\n\t\t\tglobalThis.location.hash = location;\r\n\t}\r\n};\r\n\r\n_Router.init();\r\n\r\nexport default _Router;\r\n","\r\nimport { Rinn, Model, Template } from 'rinn';\r\nimport Router from './router.js';\r\n\r\n/**\r\n * Map containing the original prototypes for all registered elements.\r\n */\r\nconst elementPrototypes = { };\r\n\r\n/**\r\n * Map containing the final classes for all registered elements.\r\n */\r\nconst elementClasses = { };\r\n\r\n/**\r\n * Base class for custom elements. Provides support for model-triggered events, easy definition of handlers for events originated in\r\n * self or child-elements, and several utility methods.\r\n */\r\n\r\nconst Element = \r\n{\r\n\t/**\r\n\t * Internal element ID. Added as namespace to model events. Ensures that certain model events are run locally only, not affecting other event handlers.\r\n\t */\r\n\teid: null,\r\n\r\n\t/**\r\n\t * Indicates if the element is a root element, that is, the target element to attach child elements having `data-ref` attribute.\r\n\t */\r\n\tisRoot: true,\r\n\r\n\t/**\r\n\t * Root element to which this element is attached (when applicable).\r\n\t */\r\n\troot: null,\r\n\r\n\t/**\r\n\t * Indicates ready-state of the element. Possible values are: 0: \"Not ready\", 1: \"Children Initialized\", and 2: \"Parent Ready\".\r\n\t */\r\n\tisReady: 0,\r\n\treadyReenter: 0,\r\n\treadyLocked: 0,\r\n\r\n\t/**\r\n\t * Model type (class) for the element's model.\r\n\t */\r\n\tmodelt: Model,\r\n\r\n\t/**\r\n\t * Data model related to the element.\r\n\t */\r\n\tmodel: null,\r\n\r\n\t/**\r\n\t * Contents of the element. When set, the innerHTML will be set to this value.\r\n\t */\r\n\tcontents: null,\r\n\r\n\t/**\r\n\t * \tEvents map.\r\n\t */\r\n\tevents:\r\n\t{\r\n\t\t'mousedown [data-long-press]': function (evt)\r\n\t\t{\r\n\t\t\tevt.continuePropagation = true;\r\n\t\t\tif (evt.source._long_press) return;\r\n\r\n\t\t\tlet elem = evt.source;\r\n\r\n\t\t\telem._long_press = setTimeout(() =>\r\n\t\t\t{\r\n\t\t\t\tlet dx = elem._pos_fx - elem._pos_sx;\r\n\t\t\t\tlet dy = elem._pos_fy - elem._pos_sy;\r\n\r\n\t\t\t\telem._long_press = null;\r\n\r\n\t\t\t\tlet d = Math.sqrt(dx*dx + dy*dy);\r\n\t\t\t\tif (d < 5) {\r\n\t\t\t\t\telem._long_press = false;\r\n\t\t\t\t\tthis.dispatchOn (elem, 'long-press');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t500);\r\n\r\n\t\t\telem._pos_sx = evt.clientX;\r\n\t\t\telem._pos_sy = evt.clientY;\r\n\r\n\t\t\telem._pos_fx = evt.clientX;\r\n\t\t\telem._pos_fy = evt.clientY;\r\n\t\t},\r\n\r\n\t\t'mousemove [data-long-press]': function (evt)\r\n\t\t{\r\n\t\t\tevt.continuePropagation = true;\r\n\t\t\tif (!evt.source._long_press) return;\r\n\r\n\t\t\tevt.source._pos_fx = evt.clientX;\r\n\t\t\tevt.source._pos_fy = evt.clientY;\r\n\t\t},\r\n\r\n\t\t'touchstart [data-long-press]': function (evt)\r\n\t\t{\r\n\t\t\tevt.continuePropagation = true;\r\n\t\t\tif (evt.source._long_press) return;\r\n\r\n\t\t\tlet elem = evt.source;\r\n\r\n\t\t\telem._long_press = setTimeout(() => {\r\n\t\t\t\tlet dx = elem._pos_fx - elem._pos_sx;\r\n\t\t\t\tlet dy = elem._pos_fy - elem._pos_sy;\r\n\r\n\t\t\t\telem._long_press = null;\r\n\r\n\t\t\t\tlet d = Math.sqrt(dx*dx + dy*dy);\r\n\t\t\t\tif (d < 5) {\r\n\t\t\t\t\telem._long_press = false;\r\n\t\t\t\t\tthis.dispatchOn (elem, 'long-press');\r\n\t\t\t\t}\r\n\t\t\t}, 500);\r\n\r\n\t\t\telem._pos_sx = evt.touches[0].clientX;\r\n\t\t\telem._pos_sy = evt.touches[0].clientY;\r\n\r\n\t\t\telem._pos_fx = evt.touches[0].clientX;\r\n\t\t\telem._pos_fy = evt.touches[0].clientY;\r\n\t\t},\r\n\r\n\t\t'touchmove [data-long-press]': function (evt)\r\n\t\t{\r\n\t\t\tevt.continuePropagation = true;\r\n\t\t\tif (!evt.source._long_press) return;\r\n\r\n\t\t\tevt.source._pos_fx = evt.touches[0].clientX;\r\n\t\t\tevt.source._pos_fy = evt.touches[0].clientY;\r\n\t\t},\r\n\r\n\t\t'mouseup [data-long-press]': function (evt)\r\n\t\t{\r\n\t\t\tif (evt.source._long_press === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (evt.source._long_press) {\r\n\t\t\t\tclearTimeout(evt.source._long_press);\r\n\t\t\t\tevt.source._long_press = null;\r\n\t\t\t}\r\n\t\r\n\t\t\tevt.continuePropagation = true;\r\n\t\t},\r\n\t\r\n\t\t'touchend [data-long-press]': function (evt)\r\n\t\t{\r\n\t\t\tif (evt.source._long_press === false)\r\n\t\t\t\treturn;\r\n\t\r\n\t\t\tif (evt.source._long_press) {\r\n\t\t\t\tclearTimeout(evt.source._long_press);\r\n\t\t\t\tevt.source._long_press = null;\r\n\t\t\t}\r\n\t\r\n\t\t\tevt.continuePropagation = true;\r\n\t\t},\r\n\r\n\t\t'click [data-action]': function(evt)\r\n\t\t{\r\n\t\t\tif (evt.source._long_press === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tlet opts = evt.source.dataset.action.split(' ');\r\n\r\n\t\t\tif (opts[0] in this)\r\n\t\t\t\tthis[opts[0]] ({ ...evt.params, ...evt.source.dataset, ...opts, length: opts.length }, evt);\r\n\t\t\telse\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t},\r\n\r\n\t\t'long-press [data-long-press]': function(evt)\r\n\t\t{\r\n\t\t\tlet opts = evt.source.dataset.longPress.split(' ');\r\n\r\n\t\t\tif (opts[0] in this)\r\n\t\t\t\tthis[opts[0]] ({ ...evt.params, ...evt.source.dataset, ...opts, length: opts.length }, evt);\r\n\t\t\telse\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t},\r\n\r\n\t\t'keyup(13) input[data-enter]': function(evt)\r\n\t\t{\r\n\t\t\tlet opts = evt.source.dataset.enter.split(' ');\r\n\r\n\t\t\tif (opts[0] in this)\r\n\t\t\t\tthis[opts[0]] ({ ...evt.params, ...evt.source.dataset, ...opts, length: opts.length }, evt);\r\n\t\t\telse\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Internal routes map, set by `bindRoutes`.\r\n\t */\r\n\troutes: null,\r\n\r\n\t/**\r\n\t * \tElement constructor.\r\n\t */\r\n\t__ctor: function()\r\n\t{\r\n\t\tthis._list_watch = [];\r\n\t\tthis._list_visible = [];\r\n\t\tthis._list_property = [];\r\n\r\n\t\tif ('root' in this.dataset)\r\n\t\t{\r\n\t\t\tif (this.dataset.root == 'false')\r\n\t\t\t\tthis.isRoot = false;\r\n\t\t}\r\n\r\n\t\tthis.style.display = 'block';\r\n\r\n\t\tthis.eid = Math.random().toString().substr(2);\r\n\r\n\t\tif (this.model != null)\r\n\t\t{\r\n\t\t\tlet tmp = this.model;\r\n\t\t\tthis.model = null;\r\n\t\t\tthis.setModel (tmp, false);\r\n\t\t}\r\n\r\n\t\tObject.keys(this._super).reverse().forEach(i =>\r\n\t\t{\r\n\t\t\tif ('init' in this._super[i])\r\n\t\t\t\tthis._super[i].init();\r\n\t\t});\r\n\r\n\t\tif (Element.debug)\r\n\t\t\tconsole.log('>> ' + this.tagName + ' INIT ON ' + this.parentElement.tagName);\r\n\r\n\t\tthis.init();\r\n\r\n\t\tif (this.events)\r\n\t\t\tthis.bindEvents (this.events);\r\n\r\n\t\tif (this.contents)\r\n\t\t\tthis.setInnerHTML(this.contents);\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (this.tagName.toLowerCase() !== 'r-dom-probe')\r\n\t\t\t\tthis.appendChild(document.createElement('r-dom-probe'));\r\n\t\t\telse\r\n\t\t\t\tthis.markReady();\r\n\t\t}, 0);\r\n\t},\r\n\r\n\t/**\r\n\t * \tInitializes the element. Called after construction of the instance.\r\n\t */\r\n\tinit: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted when the children of the element are ready.\r\n\t */\r\n\tready: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * \tExecuted after ready and after the root is also ready.\r\n\t */\r\n\trready: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * \tMarks the element as ready.\r\n\t */\r\n\tmarkReady: function (list=null)\r\n\t{\r\n\t\tthis.readyLocked++;\r\n\r\n\t\tif (!this.isReady)\r\n\t\t{\r\n\t\t\tthis.isReady = 1;\r\n\r\n\t\t\t// Set model is `model` property was set in the element.\r\n\t\t\tif ('model' in this.dataset)\r\n\t\t\t{\r\n\t\t\t\tlet ref = this.getFieldByPath(this.dataset.model);\r\n\t\t\t\tif (ref) this.setModel(ref);\r\n\t\t\t}\r\n\r\n\t\t\t// Run ready methods in class hierarchy.\r\n\t\t\tObject.keys(this._super).reverse().forEach(i =>\r\n\t\t\t{\r\n\t\t\t\tif ('ready' in this._super[i])\r\n\t\t\t\t\tthis._super[i].ready();\r\n\t\t\t});\r\n\r\n\t\t\tif (Element.debug)\r\n\t\t\t\tconsole.log('>> ' + this.tagName + ' READY');\r\n\r\n\t\t\tthis.ready();\r\n\t\t\tthis.collectWatchers();\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis.collectWatchers();\r\n\r\n\t\tlet root = this.findCustomParent(this);\r\n\r\n\t\tif (Element.debug)\r\n\t\t\tconsole.log(this.tagName + ' ROOT IS ' + (root ? root.tagName : 'NULL'));\r\n\r\n\t\tif (root && root.isReady === 0 && this.isReady != 0)\r\n\t\t\troot.checkReady();\r\n\r\n\t\tlet rootReady = false;\r\n\r\n\t\tif (root && root.isReady === 2 && this.isReady !== 2)\r\n\t\t{\r\n\t\t\tthis.getRoot();\r\n\r\n\t\t\tif (this.root && this.dataset.ref)\r\n\t\t\t{\r\n\t\t\t\tif (Element.debug)\r\n\t\t\t\t\tconsole.log(this.tagName + ' REF AS `' + this.dataset.ref + '` ON ' + this.root.tagName);\r\n\r\n\t\t\t\tthis.root[this.dataset.ref] = this;\r\n\t\t\t\tthis.root.onRefAdded (this.dataset.ref, this);\r\n\t\t\t}\r\n\r\n\t\t\trootReady = true;\r\n\t\t}\r\n\r\n\t\tif (!root && this.isReady !== 2)\r\n\t\t{\r\n\t\t\trootReady = true;\r\n\t\t}\r\n\r\n\t\tif (rootReady)\r\n\t\t{\r\n\t\t\tthis.isReady = 2;\r\n\r\n\t\t\tif (list !== null) {\r\n\t\t\t\tfor (let elem of list)\r\n\t\t\t\t\telem.checkReady();\r\n\t\t\t}\r\n\r\n\t\t\tif (Element.debug)\r\n\t\t\t\tconsole.log('>> ' + this.tagName + ' RREADY');\r\n\r\n\t\t\tObject.keys(this._super).reverse().forEach(i =>\r\n\t\t\t{\r\n\t\t\t\tif ('rready' in this._super[i])\r\n\t\t\t\t\tthis._super[i].rready();\r\n\t\t\t});\r\n\t\t\r\n\t\t\tthis.rready();\r\n\t\t}\r\n\r\n\t\tthis.readyLocked--;\r\n\r\n\t\tif (this.readyReenter && !this.readyLocked)\r\n\t\t{\r\n\t\t\tthis.readyReenter = false;\r\n\t\t\tthis.checkReady();\r\n\t\t}\r\n\r\n\t\tif (this.tagName.toLowerCase() === 'r-dom-probe')\r\n\t\t\tthis.remove();\r\n\t},\r\n\r\n\t/**\r\n\t *\tChecks if all children are ready and fires the appropriate function (`ready` and/or `rready`).\r\n\t */\r\n\tcheckReady: function()\r\n\t{\r\n\t\tif (this.childNodes.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\tif (this.readyLocked)\r\n\t\t{\r\n\t\t\tthis.readyReenter = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet isReady = true;\r\n\t\tlet list = [];\r\n\r\n\t\tlet result = document.evaluate(\".//*[contains(name(),'-')]\", this, null, XPathResult.ANY_TYPE, null);\r\n\r\n\t\tif (Element.debug)\r\n\t\t\tconsole.log('# CHECKING ' + this.tagName);\r\n\r\n\t\twhile (true)\r\n\t\t{\r\n\t\t\tlet elem = result.iterateNext();\r\n\t\t\tif (!elem) break;\r\n\r\n\t\t\tif (elem === this)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tlet root = this.findCustomParent(elem);\r\n\t\t\tif (root !== this) continue;\r\n\r\n\t\t\tif (Element.debug)\r\n\t\t\t\tconsole.log('   ' + elem.tagName + ' = ' + elem.isReady);\r\n\r\n\t\t\tif (!elem.isReady)\r\n\t\t\t\tisReady = false;\r\n\r\n\t\t\tlist.push(elem);\r\n\t\t}\r\n\r\n\t\tif (!isReady) return;\r\n\r\n\t\tthis.markReady(list);\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the value of a field given its path. Starts from `global`, unless the first item in the path is `this`, in which case it will start from the element.\r\n\t */\r\n\tgetFieldByPath: function(path)\r\n\t{\r\n\t\tif (!path) return null;\r\n\r\n\t\tlet tmp = path.split('.');\r\n\t\tlet ref = global;\r\n\r\n\t\tif (tmp.length && tmp[0] == 'this')\r\n\t\t{\r\n\t\t\tref = this;\r\n\t\t\ttmp.shift();\r\n\t\t}\r\n\r\n\t\tif (tmp.length && tmp[0] == 'root')\r\n\t\t{\r\n\t\t\tref = this.getRoot();\r\n\t\t\ttmp.shift();\r\n\t\t}\r\n\r\n\t\twhile (ref != null && tmp.length != 0)\r\n\t\t\tref = ref[tmp.shift()];\r\n\r\n\t\treturn ref;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the root of the element (that is, the `root` property). If not set it will attempt to find the root first.\r\n\t */\r\n\tgetRoot: function()\r\n\t{\r\n\t\treturn this.root ? this.root : (this.root = this.findRoot());\r\n\t},\r\n\r\n\t/**\r\n\t * \tSets the model of the element and executes the `modelChanged` event handler (unless `update` is set to false).\r\n\t */\r\n\tsetModel: function (model, update=true)\r\n\t{\r\n\t\tif (!model) return this;\r\n\r\n\t\tmodel = Rinn.ensureTypeOf(this.modelt, model);\r\n\r\n\t\tif (this.model !== model)\r\n\t\t{\r\n\t\t\tif (this.model != null)\r\n\t\t\t{\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':modelChanged', this.onModelPreChanged, this);\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':propertyChanging', this.onModelPropertyChanging, this);\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':propertyChanged', this.onModelPropertyPreChanged, this);\r\n\t\t\t\tthis.model.removeEventListener (this.eid+':propertyRemoved', this.onModelPropertyRemoved, this);\r\n\t\t\t}\r\n\r\n\t\t\tthis.model = model;\r\n\r\n\t\t\tthis.model.addEventListener (this.eid+':modelChanged', this.onModelPreChanged, this);\r\n\t\t\tthis.model.addEventListener (this.eid+':propertyChanging', this.onModelPropertyChanging, this);\r\n\t\t\tthis.model.addEventListener (this.eid+':propertyChanged', this.onModelPropertyPreChanged, this);\r\n\t\t\tthis.model.addEventListener (this.eid+':propertyRemoved', this.onModelPropertyRemoved, this);\r\n\t\t}\r\n\r\n\t\tif (update !== false)\r\n\t\t\tthis.model.setNamespace(this.eid).update(true).setNamespace(null);\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the model of the element. Added for symmetry only, exactly the same as accesing public property `model` of this class.\r\n\t */\r\n\tgetModel: function ()\r\n\t{\r\n\t\treturn this.model;\r\n\t},\r\n\r\n\t/**\r\n\t * \tAdds one or more CSS classes (separated by space) to the element.\r\n\t */\r\n\taddClass: function (classString)\r\n\t{\r\n\t\tif (!classString) return this;\r\n\r\n\t\tclassString.split(' ').forEach(i =>\r\n\t\t{\r\n\t\t\ti = i.trim();\r\n\t\t\tif (!i) return;\r\n\r\n\t\t\tif (i[0] == '-' || i[0] == '+')\r\n\t\t\t\tthis.classList[i[0] == '-' ? 'remove' : 'add'](i.substr(1));\r\n\t\t\telse\r\n\t\t\t\tthis.classList.add(i);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tRemoves one or more CSS classes (separated by space) from the element.\r\n\t */\r\n\tremoveClass: function (classString)\r\n\t{\r\n\t\tif (!classString) return this;\r\n\r\n\t\tclassString.split(' ').forEach(i =>\r\n\t\t{\r\n\t\t\ti = i.trim();\r\n\t\t\tif (!i) return;\r\n\r\n\t\t\tif (i[0] == '-' || i[0] == '+')\r\n\t\t\t\tthis.classList[i[0] == '-' ? 'remove' : 'add'](i.substr(1));\r\n\t\t\telse\r\n\t\t\t\tthis.classList.remove(i);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tSets one or more style properties to the element (separated by semi-colon).\r\n\t */\r\n\tsetStyle: function (styleString)\r\n\t{\r\n\t\tif (!styleString) return this;\r\n\r\n\t\tstyleString.split(';').forEach(i => {\r\n\t\t\tlet j = (i = i.trim()).indexOf(':');\r\n\t\t\tif (j == -1) return;\r\n\r\n\t\t\tlet name = i.substr(0, j).trim();\r\n\t\t\tfor (let k = name.indexOf('-'); k != -1; k = name.indexOf('-')) {\r\n\t\t\t\tname = name.substr(0, k) + name.substr(k+1, 1).toUpperCase() + name.substr(k+2);\r\n\t\t\t}\r\n\r\n\t\t\tthis.style[name] = i.substr(j+1).trim();\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the width of the specified element (or of itself it none provided), uses `getBoundingClientRect`.\r\n\t */\r\n\tgetWidth: function (elem=null)\r\n\t{\r\n\t\treturn (elem || this).getBoundingClientRect().width;\r\n\t},\r\n\r\n\t/**\r\n\t * \tReturns the height of the specified element (or of itself it none provided), uses `getBoundingClientRect`.\r\n\t */\r\n\tgetHeight: function (elem=null)\r\n\t{\r\n\t\treturn (elem || this).getBoundingClientRect().height;\r\n\t},\r\n\r\n\t/**\r\n\t**\tBinds all events in the specified map to the element, the events map can have one of the following forms:\r\n\t**\r\n\t**\t\t\"click .button\": \"doSomething\",\t\t(Delegated Event)\r\n\t**\t\t\"click .button\": function() { },\t(Delegated Event)\r\n\t**\t\t\"myevt &this\": \"...\",\t\t\t\t(Self Event)\r\n\t**\t\t\"myevt\": \"...\",\t\t\t\t\t\t(Element Event)\r\n\t**\t\t\"myevt @objName\": \"...\",\t\t\t(EventDispatcher Event)\r\n\t**\t\t\"#propname\": \"...\",\t\t\t\t\t(Property Changed Event)\r\n\t**\t\t\"keyup(10) .input\": \"...\"\t\t\t(Delegated Event with Parameters)\r\n\t**\r\n\t**\t>> Element bindEvents (object events);\r\n\t*/\r\n\tbindEvents: function (events)\r\n\t{\r\n\t\tfor (let evtstr in events)\r\n\t\t{\r\n\t\t\tlet hdl = events[evtstr];\r\n\r\n\t\t\tif (Rinn.typeOf(hdl) == 'string')\r\n\t\t\t\thdl = this[hdl];\r\n\r\n\t\t\thdl = hdl.bind(this);\r\n\r\n\t\t\tvar i = evtstr.indexOf(' ');\r\n\r\n\t\t\tvar name = i == -1 ? evtstr : evtstr.substr(0, i);\r\n\t\t\tvar selector = i == -1 ? '' : evtstr.substr(i + 1);\r\n\r\n\t\t\tlet args = null;\r\n\r\n\t\t\tvar j = name.indexOf('(');\r\n\t\t\tif (j != -1)\r\n\t\t\t{\r\n\t\t\t\targs = name.substr(j+1, name.length-j-2).split(',');\r\n\t\t\t\tname = name.substr(0, j);\r\n\t\t\t}\r\n\r\n\t\t\tif (selector[0] == '@')\r\n\t\t\t{\r\n\t\t\t\tif (selector != '@this')\r\n\t\t\t\t{\r\n\t\t\t\t\tthis[selector.substr(1)].addEventListener(name, hdl);\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tselector = this;\r\n\t\t\t}\r\n\t\t\telse if (selector[0] == '&')\r\n\t\t\t{\r\n\t\t\t\tif (selector != '&this')\r\n\t\t\t\t\tselector = \"[data-ref='\"+selector.substr(1)+\"']\";\r\n\t\t\t\telse\r\n\t\t\t\t\tselector = this;\r\n\t\t\t}\r\n\r\n\t\t\tif (name.substr(0, 1) == '#')\r\n\t\t\t{\r\n\t\t\t\tthis.listen('propertyChanged.'+name.substr(1), this, hdl);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (args != null)\r\n\t\t\t{\r\n\t\t\t\tswitch (name)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'keyup': case 'keydown':\r\n\t\t\t\t\t\tthis.listen (name, selector, function (evt)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (Rinn.indexOf(args, evt.keyCode.toString()) != -1)\r\n\t\t\t\t\t\t\t\treturn hdl (evt, args);\r\n\r\n\t\t\t\t\t\t\tevt.continuePropagation = true;\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.listen (name, selector, hdl);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t**\tBinds all routes in the specified map to the Router object.\r\n\t**\r\n\t**\t\t\"route-path\": \"doSomething\"\t\t\t\t\t\tOn-Route\r\n\t**\t\t\"route-path\": function (evt, args) { }\t\t\tOn-Route\r\n\t**\t\t\"!route-path\": \"doSomething\"\t\t\t\t\tOn-UnRoute\r\n\t**\t\t\"!route-path\": function (evt, args) { }\t\t\tOn-UnRoute\r\n\t**\r\n\t**\t>> Element bindRoutes ();\r\n\t*/\r\n\tbindRoutes: function ()\r\n\t{\r\n\t\tif (!this.routes)\r\n\t\t\treturn;\r\n\r\n\t\tfor (let routeStr in this.routes)\r\n\t\t{\r\n\t\t\tlet route = routeStr[0] === '!' ? Router.getRoute(routeStr.substr(1)) : Router.getRoute(routeStr);\r\n\t\t\tlet handler = this.routes[routeStr];\r\n\r\n\t\t\tif (Rinn.typeOf(handler) === 'string')\r\n\t\t\t\thandler = this[handler];\r\n\r\n\t\t\tif (routeStr[0] === '!')\r\n\t\t\t\troute.addHandler(handler, true, this);\r\n\t\t\telse\r\n\t\t\t\troute.addHandler(handler, false, this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Unbinds all routes added by bindRoutes.\r\n\t */\r\n\tunbindRoutes: function ()\r\n\t{\r\n\t\tif (!this.routes)\r\n\t\t\treturn;\r\n\r\n\t\tfor (let routeStr in this.routes)\r\n\t\t{\r\n\t\t\tlet route = routeStr[0] === '!' ? Router.getRoute(routeStr.substr(1)) : Router.getRoute(routeStr);\r\n\t\t\tlet handler = this.routes[routeStr];\r\n\r\n\t\t\tif (Rinn.typeOf(handler) === 'string')\r\n\t\t\t\thandler = this[handler];\r\n\r\n\t\t\tif (routeStr[0] === '!')\r\n\t\t\t\troute.removeHandler(handler, true, this);\r\n\t\t\telse\r\n\t\t\t\troute.removeHandler(handler, false, this);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecutes the underlying event handler given an event and a selector. Called internally by listen().\r\n\t**\r\n\t**\t>> void _eventHandler (event evt, string selector, function handler);\r\n\t*/\r\n\t_eventHandler: function (evt, selector, handler)\r\n\t{\r\n\t\tif (evt.continuePropagation === false)\r\n\t\t\treturn;\r\n\r\n\t\tevt.continuePropagation = true;\r\n\t\tevt.source = evt.target;\r\n\r\n\t\tif (selector && selector instanceof HTMLElement)\r\n\t\t{\r\n\t\t\tif (evt.source === selector)\r\n\t\t\t{\r\n\t\t\t\tevt.continuePropagation = false;\r\n\r\n\t\t\t\tif (handler.call (this, evt, evt.detail) === true)\r\n\t\t\t\t\tevt.continuePropagation = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (selector && selector != '*')\r\n\t\t{\r\n\t\t\tlet elems = this.querySelectorAll(selector);\r\n\r\n\t\t\twhile (evt.source !== this)\r\n\t\t\t{\r\n\t\t\t\tlet i = Rinn.indexOf (elems, evt.source, true);\r\n\t\t\t\tif (i !== -1)\r\n\t\t\t\t{\r\n\t\t\t\t\tevt.continuePropagation = false;\r\n\r\n\t\t\t\t\tif (handler.call (this, evt, evt.detail) === true)\r\n\t\t\t\t\t\tevt.continuePropagation = true;\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tevt.source = evt.source.parentElement;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tevt.continuePropagation = false;\r\n\r\n\t\t\tif (handler.call (this, evt, evt.detail) === true)\r\n\t\t\t\tevt.continuePropagation = true;\r\n\t\t}\r\n\r\n\t\tif (evt.continuePropagation === false)\r\n\t\t{\r\n\t\t\tevt.preventDefault();\r\n\t\t\tevt.stopPropagation();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\tListens for an event on elements matching the specified selector, returns an object with a single method `remove` used\r\n\t**\tto remove the listener when it is no longer needed.\r\n\t**\r\n\t**\t>> object listen (string eventName, string selector, function handler);\r\n\t**\t>> object listen (string eventName, function handler);\r\n\t*/\r\n\tlisten: function (eventName, selector, handler)\r\n\t{\r\n\t\tlet eventCatcher = false;\r\n\t\tlet eventImmediate = false;\r\n\r\n\t\tif (Rinn.typeOf(selector) == 'function')\r\n\t\t{\r\n\t\t\thandler = selector;\r\n\t\t\tselector = null;\r\n\t\t}\r\n\r\n\t\tif (eventName[eventName.length-1] == '!')\r\n\t\t{\r\n\t\t\teventName = eventName.substr(0, eventName.length-1);\r\n\t\t\teventCatcher = true;\r\n\t\t}\r\n\r\n\t\tif (eventName[0] == '!')\r\n\t\t{\r\n\t\t\teventName = eventName.substr(1);\r\n\t\t\teventImmediate = true;\r\n\t\t}\r\n\r\n\t\tlet callback0 = null;\r\n\t\tlet callback1 = null;\r\n\t\tlet self = this;\r\n\r\n\t\tthis.addEventListener (eventName, callback0 = (evt) =>\r\n\t\t{\r\n\t\t\tif (evt.continuePropagation === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (!evt.firstCapture)\r\n\t\t\t{\r\n\t\t\t\tevt.firstCapture = this;\r\n\t\t\t\tevt.firstCaptureCount = 0;\r\n\t\t\t\tevt.queue = [];\r\n\t\t\t}\r\n\r\n\t\t\tif (evt.firstCapture === this)\r\n\t\t\t\tevt.firstCaptureCount++;\r\n\r\n\t\t\tif (eventCatcher == true)\r\n\t\t\t\tevt.queue.push([this, selector, handler]);\r\n\r\n\t\t\tif (eventImmediate == true)\r\n\t\t\t\tthis._eventHandler(evt, selector, handler);\r\n\t\t},\r\n\t\ttrue);\r\n\r\n\t\tthis.addEventListener (eventName, callback1 = (evt) =>\r\n\t\t{\r\n\t\t\tif (evt.continuePropagation === false)\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif (eventCatcher != true && eventImmediate != true)\r\n\t\t\t\tthis._eventHandler(evt, selector, handler);\r\n\r\n\t\t\tif (evt.firstCapture === this && evt.continuePropagation !== false)\r\n\t\t\t{\r\n\t\t\t\tif (--evt.firstCaptureCount == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\twhile (evt.queue.length)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tlet q = evt.queue.pop();\r\n\t\t\t\t\t\tq[0]._eventHandler(evt, q[1], q[2]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tevt.continuePropagation = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tfalse);\r\n\r\n\t\treturn {\r\n\t\t\tremoved: false,\r\n\t\t\tremove: function() {\r\n\t\t\t\tif (this.removed) return;\r\n\t\t\t\tthis.removed = true;\r\n\t\t\t\tself.removeEventListener(eventName, callback0, true);\r\n\t\t\t\tself.removeEventListener(eventName, callback1, false);\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t**\tCreates an event object for later dispatch.\r\n\t*/\r\n\tcreateEventObject: function(eventName, args, bubbles)\r\n\t{\r\n\t\tlet evt;\r\n\r\n\t\tif (eventName == 'click')\r\n\t\t\tevt = new MouseEvent(eventName, { bubbles: bubbles, detail: args });\r\n\t\telse\r\n\t\t\tevt = new CustomEvent (eventName, { bubbles: bubbles, detail: args });\r\n\r\n\t\treturn evt;\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches a new event with the specified name and the given arguments.\r\n\t*/\r\n\tdispatch: function (eventName, args=null, bubbles=true)\r\n\t{\r\n\t\tthis.dispatchEvent (this.createEventObject(eventName, args, bubbles));\r\n\t},\r\n\r\n\t/**\r\n\t**\tDispatches a new event on the specified element with the given name and arguments (uses `CustomEvent`).\r\n\t*/\r\n\tdispatchOn: function (elem, eventName, args=null, bubbles=true)\r\n\t{\r\n\t\telem.dispatchEvent (this.createEventObject(eventName, args, bubbles));\r\n\t},\r\n\r\n\t/**\r\n\t**\tSets the innerHTML property of the element and runs some post set-content tasks.\r\n\t**\r\n\t**\t>> void setInnerHTML (value);\r\n\t*/\r\n\tsetInnerHTML: function (value)\r\n\t{\r\n\t\tthis.readyLocked++;\r\n\t\tthis.innerHTML = value;\r\n\t\tthis.readyLocked--;\r\n\t},\r\n\r\n\t/**\r\n\t**\tCollects all watchers (data-watch, data-visible, data-property), that depend on the model, should be invoked when the structure\r\n\t**\tof the element changed (added/removed children). This is automatically called when the setInnerHTML method is called.\r\n\t**\r\n\t**\tNote that for 3rd party libs that add children to this element (which could probably have a watcher) will possibly result in\r\n\t**\tduplication of the added elements when compiling the innerHTML template. To prevent this add the 'pseudo' CSS class to any\r\n\t**\telement that should not be added to the HTML template.\r\n\t**\r\n\t**\t>> void collectWatchers ();\r\n\t*/\r\n\tcollectWatchers: function ()\r\n\t{\r\n\t\tlet self = this;\r\n\t\tlet modified = false;\r\n\t\tlet list;\r\n\r\n\t\tif (!this.isRoot) return;\r\n\r\n\t\tlet _list_watch_length = this._list_watch.length;\r\n\t\tlet _list_visible_length = this._list_visible.length;\r\n\t\tlet _list_property_length = this._list_property.length;\r\n\r\n\t\t/* *** */\r\n\t\tlist = this.querySelectorAll('[data-watch]');\r\n\t\tfor (let i = 0; i < list.length; i++)\r\n\t\t{\r\n\t\t\tfor (let j of list[i].querySelectorAll('.pseudo'))\r\n\t\t\t\tj.remove();\r\n\r\n\t\t\tlist[i]._template = Template.compile(list[i].innerHTML);\r\n\t\t\tlist[i]._watch = new RegExp('^(' + list[i].dataset.watch + ')$');\r\n\t\t\tlist[i].innerHTML = '';\r\n\r\n\t\t\tlist[i].removeAttribute('data-watch');\r\n\t\t\tthis._list_watch.push(list[i]);\r\n\t\t}\r\n\r\n\t\tif ('selfWatch' in this.dataset)\r\n\t\t{\r\n\t\t\tfor (let j of this.querySelectorAll('.pseudo'))\r\n\t\t\t\tj.remove();\r\n\r\n\t\t\tthis._template = Template.compile(this.innerHTML);\r\n\t\t\tthis._watch = new RegExp('^(' + this.dataset.selfWatch + ')$');\r\n\t\t\tthis.innerHTML = '';\r\n\r\n\t\t\tthis.removeAttribute('data-self-watch');\r\n\t\t\tthis._list_watch.push(this);\r\n\t\t}\r\n\r\n\t\t/* *** */\r\n\t\tlist = this.querySelectorAll('[data-visible]');\r\n\t\tfor (let i = 0; i < list.length; i++)\r\n\t\t{\r\n\t\t\tlist[i]._visible = Template.compile(list[i].dataset.visible);\r\n\r\n\t\t\tlist[i].removeAttribute('data-visible');\r\n\t\t\tthis._list_visible.push(list[i]);\r\n\t\t}\r\n\r\n\t\tif ('selfVisible' in this.dataset)\r\n\t\t{\r\n\t\t\tthis._visible = Template.compile(this.dataset.selfVisible);\r\n\r\n\t\t\tthis.removeAttribute('data-self-visible');\r\n\t\t\tthis._list_visible.push(this);\r\n\t\t}\r\n\r\n\t\t/* *** */\r\n\t\tlist = this.querySelectorAll('[data-property]');\r\n\t\tfor (let i = 0; i < list.length; i++)\r\n\t\t{\r\n\t\t\tlist[i].onchange = list[i].onblur = function()\r\n\t\t\t{\r\n\t\t\t\tswitch (this.type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (this.checked) self.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.checked ? '1' : '0');\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'field':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.getValue());\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (list[i].tagName == 'SELECT')\r\n\t\t\t{\r\n\t\t\t\tlist[i].onmouseup = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tlist[i].name = list[i].dataset.property;\r\n\r\n\t\t\tlist[i].removeAttribute('data-property');\r\n\t\t\tthis._list_property.push(list[i]);\r\n\t\t}\r\n\r\n\t\tif ('selfProperty' in this.dataset)\r\n\t\t{\r\n\t\t\tthis.onchange = this.onblur = function()\r\n\t\t\t{\r\n\t\t\t\tswitch (this.type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (this.checked) self.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.checked ? '1' : '0');\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'field':\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.getValue());\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tif (this.tagName == 'SELECT')\r\n\t\t\t{\r\n\t\t\t\tthis.onmouseup = function()\r\n\t\t\t\t{\r\n\t\t\t\t\tself.getModel().set(this.name, this.value);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tthis.name = this.dataset.selfProperty;\r\n\r\n\t\t\tthis.removeAttribute('data-self-property');\r\n\t\t\tthis._list_property.push(this);\r\n\t\t}\r\n\r\n\t\t/* *** */\r\n\t\tthis._list_watch = this._list_watch.filter(i => i.parentElement != null);\r\n\t\tif (_list_watch_length != this._list_watch.length) modified = true;\r\n\r\n\t\tthis._list_visible = this._list_visible.filter(i => i.parentElement != null);\r\n\t\tif (_list_visible_length != this._list_visible.length) modified = true;\r\n\r\n\t\tthis._list_property = this._list_property.filter(i => i.parentElement != null);\r\n\t\tif (_list_property_length != this._list_property.length) modified = true;\r\n\r\n\t\tif (this.model != null && modified)\r\n\t\t\tthis.model.setNamespace(this.eid).update(true).setNamespace(null);\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted when the element is created and yet not attached to the DOM tree.\r\n\t*/\r\n\tonCreated: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t * Executed when the element is attached to the DOM tree.\r\n\t */\r\n\telementConnected: function()\r\n\t{\r\n\t\tthis.bindRoutes();\r\n\t\tthis.onConnected();\r\n\t},\r\n\r\n\t/**\r\n\t * Executed when the element is no longer a part of the DOM tree.\r\n\t */\r\n\telementDisconnected: function()\r\n\t{\r\n\t\tthis.unbindRoutes();\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted when the element is attached to the DOM tree.\r\n\t*/\r\n\tonConnected: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted when the element is no longer a part of the DOM tree.\r\n\t*/\r\n\tonDisconnected: function()\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted on the root element when a child element has `data-ref` attribute and it was added to it.\r\n\t*/\r\n\tonRefAdded: function (name, element)\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tExecuted on the root element when a child element has `data-ref` attribute and it was removed from it.\r\n\t*/\r\n\tonRefRemoved: function (name, element)\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when the model has changed, executed before onModelChanged() to update internal dependencies,\r\n\t**\tshould not be overriden or elements watching the model will not be updated.\r\n\t**\r\n\t**\t>> void onModelPreChanged (evt, args);\r\n\t*/\r\n\tonModelPreChanged: function (evt, args)\r\n\t{\r\n\t\tlet data = this.getModel().get();\r\n\r\n\t\tfor (let i = 0; i < this._list_watch.length; i++)\r\n\t\t{\r\n\t\t\tfor (let j of args.fields)\r\n\t\t\t{\r\n\t\t\t\tif (!this._list_watch[i]._watch.test(j))\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tthis._list_watch[i].innerHTML = this._list_watch[i]._template(data);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this._list_visible.length; i++)\r\n\t\t{\r\n\t\t\tif (!!this._list_visible[i]._visible(data, 'arg'))\r\n\t\t\t\tthis._list_visible[i].style.removeProperty('display');\r\n\t\t\telse\r\n\t\t\t\tthis._list_visible[i].style.setProperty('display', 'none', 'important');\r\n\t\t}\r\n\r\n\t\tthis.onModelChanged(evt, args);\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when the model has changed.\r\n\t*/\r\n\tonModelChanged: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model is changing. Fields `name` and `value` can be found in the `args` object.\r\n\t*/\r\n\tonModelPropertyChanging: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model has changed, executed before onModelPropertyChanged() to update internal\r\n\t**\tdependencies. Automatically triggers internal events named `propertyChanged.<propertyName>` and `propertyChanged`.\r\n\t**\tShould not be overriden or elements depending on the property will not be updated.\r\n\t*/\r\n\tonModelPropertyPreChanged: function (evt, args)\r\n\t{\r\n\t\tfor (let i = 0; i < this._list_property.length; i++)\r\n\t\t{\r\n\t\t\tif (this._list_property[i].name == args.name)\r\n\t\t\t{\r\n\t\t\t\tlet trigger = true;\r\n\r\n\t\t\t\tswitch (this._list_property[i].type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase 'radio':\r\n\t\t\t\t\t\tif (this._list_property[i].value != args.value)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._list_property[i].parentElement.classList.remove('active');\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis._list_property[i].checked = true;\r\n\t\t\t\t\t\tthis._list_property[i].parentElement.classList.add('active');\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'checkbox':\r\n\t\t\t\t\t\tif (~~args.value)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._list_property[i].checked = true;\r\n\t\t\t\t\t\t\tthis._list_property[i].parentElement.classList.add('active');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis._list_property[i].checked = false;\r\n\t\t\t\t\t\t\tthis._list_property[i].parentElement.classList.remove('active');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'field':\r\n\t\t\t\t\t\tthis._list_property[i].val = this._list_property[i].dataset.value = args.value;\t\r\n\t\t\t\t\t\tthis._list_property[i].setValue (args.value);\r\n\t\t\t\t\t\ttrigger = false;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthis._list_property[i].value = args.value;\r\n\t\t\t\t\t\tthis._list_property[i].val = this._list_property[i].dataset.value = args.value;\t\r\n\r\n\t\t\t\t\t\tif (this._list_property[i].value != args.value)\r\n\t\t\t\t\t\t\ttrigger = false;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (trigger && this._list_property[i].onchange)\r\n\t\t\t\t\tthis._list_property[i].onchange();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.dispatch ('propertyChanged.' + args.name, args, false);\r\n\t\tthis.dispatch ('propertyChanged', args, false);\r\n\r\n\t\tthis.onModelPropertyChanged(evt, args);\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model has changed.\r\n\t*/\r\n\tonModelPropertyChanged: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/**\r\n\t**\tEvent handler invoked when a property of the model is removed. Field `name` can be found in the `args` object.\r\n\t*/\r\n\tonModelPropertyRemoved: function (evt, args) // @override\r\n\t{\r\n\t},\r\n\r\n\t/*\r\n\t**\tRuns the following preparation procedures on the specified prototype:\r\n\t**\t\t- All functions named 'event <event-name> [event-selector]' will be moved to the 'events' map.\r\n\t**\t\t- All functions named 'route <route-path>' will be moved to the 'routes' map.\r\n\t**\r\n\t**\t>> void preparePrototype (object proto);\r\n\t*/\r\n\tpreparePrototype: function (proto)\r\n\t{\r\n\t\tif (proto.__prototypePrepared === true)\r\n\t\t\treturn;\r\n\r\n\t\tproto.__prototypePrepared = true;\r\n\r\n\t\tif (!proto.hasOwnProperty('events') || !proto.events)\r\n\t\t\tproto.events = { };\r\n\r\n\t\tif (!proto.hasOwnProperty('routes') || !proto.routes)\r\n\t\t\tproto.routes = { };\r\n\r\n\t\tfor (let i in proto)\r\n\t\t{\r\n\t\t\tif (i.startsWith('event '))\r\n\t\t\t{\r\n\t\t\t\tproto.events[i.substr(6)] = proto[i];\r\n\t\t\t\tdelete proto[i];\r\n\t\t\t}\r\n\t\t\telse if (i.startsWith('route '))\r\n\t\t\t{\r\n\t\t\t\tproto.routes[i.substr(6)] = proto[i];\r\n\t\t\t\tdelete proto[i];\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t**\tRegisters a new custom element with the specified name. Extra functionality can be added with one or more prototypes, by default\r\n\t**\tall elements also get the `Element` prototype. Note that the final prototypes of all registered elements are stored, and if you want\r\n\t**\tto inherit another element's prototype just provide its name (string) in the protos argument list.\r\n\t**\r\n\t**\t>> class register (string name, ...(object|string) protos);\r\n\t*/\r\n\tregister: function (name, ...protos)\r\n\t{\r\n\t\tconst newElement = class extends HTMLElement\r\n\t\t{\r\n\t\t\tconstructor()\r\n\t\t\t{\r\n\t\t\t\tsuper();\r\n\t\t\t\tthis.invokeConstructor = true;\r\n\r\n\t\t\t\tif (Element.debug)\r\n\t\t\t\t\tconsole.log('CREATED ' + this.tagName);\r\n\r\n\t\t\t\tthis._super = { };\r\n\r\n\t\t\t\tfor (let i of Object.entries(this.constructor.prototype._super))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._super[i[0]] = { };\r\n\r\n\t\t\t\t\tfor (let j of Object.entries(i[1])) {\r\n\t\t\t\t\t\tthis._super[i[0]][j[0]] = j[1].bind(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.onCreated();\r\n\t\t\t}\r\n\r\n\t\t\tfindRoot (srcElement)\r\n\t\t\t{\r\n\t\t\t\tlet elem = srcElement ? srcElement : this.parentElement;\r\n\r\n\t\t\t\twhile (elem != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ('isRoot' in elem && elem.isRoot === true)\r\n\t\t\t\t\t\treturn elem;\r\n\r\n\t\t\t\t\telem = elem.parentElement;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tfindCustomParent (srcElement)\r\n\t\t\t{\r\n\t\t\t\tlet elem = srcElement ? srcElement.parentElement : this.parentElement;\r\n\r\n\t\t\t\twhile (elem != null)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (elem.tagName.indexOf('-') !== -1)\r\n\t\t\t\t\t\treturn elem;\r\n\r\n\t\t\t\t\telem = elem.parentElement;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconnectReference (root=null, flags=255)\r\n\t\t\t{\r\n\t\t\t\tif (!this.root && (flags & 1) == 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (root == null) root = this.findRoot();\r\n\t\t\t\t\tif (root != null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (this.dataset.ref)\r\n\t\t\t\t\t\t\troot[this.dataset.ref] = this;\r\n\r\n\t\t\t\t\t\tthis.root = root;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconnectedCallback ()\r\n\t\t\t{\r\n\t\t\t\tthis.connectReference(null, 1);\r\n\r\n\t\t\t\tif (this.invokeConstructor)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.invokeConstructor = false;\r\n\t\t\t\t\tthis.__ctor();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.connectReference(null, 2);\r\n\t\t\t\tthis.elementConnected();\r\n\r\n\t\t\t\tif (this.dataset.xref)\r\n\t\t\t\t\tglobalThis[this.dataset.xref] = this;\r\n\t\t\t}\r\n\r\n\t\t\tdisconnectedCallback()\r\n\t\t\t{\r\n\t\t\t\tif (this.root)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (this.dataset.ref)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.root.onRefRemoved (this.dataset.ref, this);\r\n\r\n\t\t\t\t\t\tdelete this.root[this.dataset.ref];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.root = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.elementDisconnected();\r\n\r\n\t\t\t\tif (this.dataset.xref)\r\n\t\t\t\t\tdelete globalThis[this.dataset.xref];\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tRinn.override (newElement.prototype, Element);\r\n\r\n\t\tconst proto = { };\r\n\t\tconst _super = { };\r\n\t\tconst events = Rinn.clone(Element.events);\r\n\r\n\t\tlet __init = true;\r\n\t\tlet __ready = true;\r\n\t\tlet __rready = true;\r\n\t\tlet __check;\r\n\r\n\t\tfor (let i = 0; i < protos.length; i++)\r\n\t\t{\r\n\t\t\tif (!protos[i]) continue;\r\n\r\n\t\t\tif (Rinn.typeOf(protos[i]) == 'string')\r\n\t\t\t{\r\n\t\t\t\tconst name = protos[i];\r\n\r\n\t\t\t\tprotos[i] = elementPrototypes[name];\r\n\t\t\t\tif (!protos[i]) continue;\r\n\r\n\t\t\t\t_super[name] = { };\r\n\r\n\t\t\t\tfor (let f in protos[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tif (Rinn.typeOf(protos[i][f]) != 'function')\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t_super[name][f] = protos[i][f];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t__init = false;\r\n\t\t\t\t__ready = false;\r\n\t\t\t\t__rready = false;\r\n\t\t\t\t__check = false;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tElement.preparePrototype(protos[i]);\r\n\t\t\t\t__check = true;\r\n\t\t\t}\r\n\r\n\t\t\tif ('_super' in protos[i])\r\n\t\t\t\tRinn.override (_super, protos[i]._super);\r\n\r\n\t\t\tif ('events' in protos[i])\r\n\t\t\t\tRinn.override (events, protos[i].events);\r\n\r\n\t\t\tRinn.override (newElement.prototype, protos[i]);\r\n\t\t\tRinn.override (proto, protos[i]);\r\n\r\n\t\t\tif (__check)\r\n\t\t\t{\r\n\t\t\t\tif (!__init && 'init' in protos[i]) __init = true;\r\n\t\t\t\tif (!__ready && 'ready' in protos[i]) __ready = true;\r\n\t\t\t\tif (!__rready && 'rready' in protos[i]) __rready = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet dummy = function(){};\r\n\r\n\t\tif (!__init)\r\n\t\t{\r\n\t\t\tnewElement.prototype.init = dummy;\r\n\t\t\tproto.init = dummy;\r\n\t\t}\r\n\r\n\t\tif (!__ready)\r\n\t\t{\r\n\t\t\tnewElement.prototype.ready = dummy;\r\n\t\t\tproto.ready = dummy;\r\n\t\t}\r\n\r\n\t\tif (!__rready)\r\n\t\t{\r\n\t\t\tnewElement.prototype.rready = dummy;\r\n\t\t\tproto.rready = dummy;\r\n\t\t}\r\n\r\n\t\tnewElement.prototype._super = _super;\r\n\t\tnewElement.prototype.events = events;\r\n\r\n\t\tproto._super = _super;\r\n\t\tproto.events = events;\r\n\r\n\t\tcustomElements.define (name, newElement);\r\n\r\n\t\telementPrototypes[name] = proto;\r\n\t\telementClasses[name] = newElement;\r\n\r\n\t\treturn newElement;\r\n\t},\r\n\r\n\t/*\r\n\t**\tExpands an already created custom element with the specified prototype(s).\r\n\t**\r\n\t**\t>> void expand (string elementName, ...object protos);\r\n\t*/\r\n\texpand: function (name, ...protos)\r\n\t{\r\n\t\tif (!(name in elementPrototypes))\r\n\t\t\treturn;\r\n\r\n\t\tconst self = elementPrototypes[name];\r\n\t\tconst elem = elementClasses[name];\r\n\r\n\t\tconst _super = self._super;\r\n\t\tconst events = self.events;\r\n\r\n\t\tfor (let proto of protos)\r\n\t\t{\r\n\t\t\tElement.preparePrototype(proto);\r\n\r\n\t\t\tif ('_super' in proto)\r\n\t\t\t\tRinn.override (_super, proto._super);\r\n\r\n\t\t\tif ('events' in proto)\r\n\t\t\t\tRinn.override (events, proto.events);\r\n\r\n\t\t\tRinn.override (elem.prototype, proto);\r\n\t\t\tRinn.override (self, proto);\r\n\t\t}\r\n\r\n\t\telem.prototype._super = _super;\r\n\t\telem.prototype.events = events;\r\n\r\n\t\tself._super = _super;\r\n\t\tself.events = events;\r\n\t},\r\n\r\n\t/*\r\n\t**\tAppends a hook to a function of a custom element.\r\n\t*/\r\n\thookAppend: function (name, functionName, newFunction)\r\n\t{\r\n\t\tif (!(name in elementPrototypes))\r\n\t\t\treturn;\r\n\r\n\t\tlet hook1 = Rinn.hookAppend(elementPrototypes[name], functionName, newFunction);\r\n\t\tlet hook2 = Rinn.hookAppend(elementClasses[name].prototype, functionName, newFunction);\r\n\r\n\t\treturn { \r\n\t\t\tunhook: function() {\r\n\t\t\t\thook1.unhook();\r\n\t\t\t\thook2.unhook();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/*\r\n\t**\tPrepends a hook to a function of a custom element.\r\n\t*/\r\n\thookPrepend: function (name, functionName, newFunction)\r\n\t{\r\n\t\tif (!(name in elementPrototypes))\r\n\t\t\treturn;\r\n\r\n\t\tlet hook1 = Rinn.hookPrepend(elementPrototypes[name], functionName, newFunction);\r\n\t\tlet hook2 = Rinn.hookPrepend(elementClasses[name].prototype, functionName, newFunction);\r\n\r\n\t\treturn { \r\n\t\t\tunhook: function() {\r\n\t\t\t\thook1.unhook();\r\n\t\t\t\thook2.unhook();\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t**\tBuilt-in action handlers.\r\n\t*/\r\n\r\n\t/**\r\n\t**\t:toggleClass <className> [<selector>]\r\n\t**\r\n\t**\tToggles a CSS class on the element.\r\n\t*/\r\n\t':toggleClass': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\r\n\t\tif ('2' in args)\r\n\t\t\telem = document.querySelector(args[2]);\r\n\r\n\t\tif (!elem) return;\r\n\r\n\t\tif (elem.classList.contains(args[1]))\r\n\t\t\telem.classList.remove(args[1]);\r\n\t\telse\r\n\t\t\telem.classList.add(args[1]);\r\n\t},\r\n\r\n\t/**\r\n\t**\t:setClass <className> [<selector>]\r\n\t**\r\n\t**\tSets a CSS class on the element.\r\n\t*/\r\n\t':setClass': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\r\n\t\tif ('2' in args)\r\n\t\t\telem = document.querySelector(args[2]);\r\n\r\n\t\tif (!elem) return;\r\n\r\n\t\telem.classList.add(args[1]);\r\n\t},\r\n\r\n\t/**\r\n\t**\t:volatileClass <className> [<selector>]\r\n\t**\r\n\t**\tAdds the CSS class to the element and any click outside will cause it to be removed.\r\n\t*/\r\n\t':volatileClass': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\r\n\t\tif ('2' in args)\r\n\t\t\telem = document.querySelector(args[2]);\r\n\r\n\t\tif (!elem) return;\r\n\r\n\t\telem.classList.add(args[1]);\r\n\r\n\t\tlet fn = () => {\r\n\t\t\twindow.removeEventListener('click', fn, true);\r\n\t\t\telem.classList.remove(args[1]);\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('click', fn, true);\r\n\t},\r\n\r\n\t/**\r\n\t**\t:toggleClassUnique <className> <parentSelector> <childSelector>\r\n\t**\r\n\t**\tToggles a CSS class on the element and only one element in the selected parent can have the class.\r\n\t*/\r\n\t':toggleClassUnique': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\t\tif (!elem) return;\r\n\r\n\t\tif (elem.classList.contains(args[1]))\r\n\t\t{\r\n\t\t\telem.classList.remove(args[1]);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\telem.querySelectorParent(args[2]).querySelectorAll(args[3]).forEach(elem => elem.classList.remove(args[1]));\r\n\t\t\telem.classList.add(args[1]);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t**\t:setClassUnique <className> <parentSelector> <childSelector>\r\n\t**\r\n\t**\tSets a CSS class on the element and only that element in the selected parent can have the class.\r\n\t*/\r\n\t':setClassUnique': function (args, evt)\r\n\t{\r\n\t\tlet elem = evt.source;\r\n\t\tif (!elem) return;\r\n\r\n\t\telem.querySelectorParent(args[2]).querySelectorAll(args[3]).forEach(elem => elem.classList.remove(args[1]));\r\n\t\telem.classList.add(args[1]);\r\n\t}\r\n};\r\n\r\nElement.debug = false;\r\n\r\nElement.register('r-elem', {\r\n});\r\n\r\nElement.register ('r-dom-probe', {\r\n});\r\n\r\n/* ****************************************** */\r\n\r\n/**\r\n * Finds the parent element given a selector.\r\n */\r\nHTMLElement.prototype.querySelectorParent = function (selector)\r\n{\r\n\tlet elem = this;\r\n\r\n\twhile (elem != null)\r\n\t{\r\n\t\tif (elem.matches(selector))\r\n\t\t\tbreak;\r\n\r\n\t\telem = elem.parentElement;\r\n\t}\r\n\r\n\treturn elem;\r\n};\r\n\r\nexport default Element;\r\n","\r\nimport base64 from 'base-64';\r\nimport _fetch from 'node-fetch';\r\n\r\nif (!('fetch' in global))\r\n\tglobal.fetch = _fetch;\r\n\r\n/**\r\n * API interface utility functions.\r\n */\r\n\r\nconst Api =\r\n{\r\n\t/**\r\n\t * Flags constants.\r\n\t */\r\n\tREQUEST_PACKAGE_SUPPORTED:\t0x01,\r\n\tREQ64_SUPPORTED: \t\t\t0x02,\r\n\tJSON_RESPONSE_SUPPORTED: \t0x04,\r\n\tXML_RESPONSE_SUPPORTED: \t0x08,\r\n\tINCLUDE_CREDENTIALS:\t\t0x10,\r\n\tUNIQUE_STAMP:\t\t\t\t0x20,\r\n\r\n\t/**\r\n\t * Target URL for all the API requests. Set by calling `setEndPoint`.\r\n\t */\r\n\tapiUrl: \"/api\",\r\n\r\n\t/**\r\n\t * Capabilities flag.\r\n\t */\r\n\tflags: 0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20,\r\n\r\n\t/**\r\n\t * Indicates if all request data will be packed into a req64 parameter instead of individual fields.\r\n\t */\r\n\tuseReq64: false,\r\n\r\n\t/**\r\n\t * Number of retries to execute each API call before giving up and invoking error handlers.\r\n\t */\r\n\tretries: 0,\r\n\r\n\t/**\r\n\t * Headers for the request.\r\n\t */\r\n\theaders: { },\r\n\r\n\t/**\r\n\t * Level of the current request. Used to detect nested requests.\r\n\t */\r\n\t_requestLevel: 0,\r\n\r\n\t/**\r\n\t * Indicates if all API calls should be bundled in a request package. Activated by calling the packageBegin() function and finished with packageEnd().\r\n\t */\r\n\t_requestPackage: 0,\r\n\r\n\t/**\r\n\t * When in package-mode, this contains the package data to be sent upon a call to packageEnd().\r\n\t */\r\n\t_packageData: [],\r\n\r\n\t/**\r\n\t * Sets the API end-point URL address.\r\n\t */\r\n\tsetEndPoint: function (apiUrl, flags=null)\r\n\t{\r\n\t\tthis.apiUrl = apiUrl;\r\n\t\tthis.flags = flags ?? this.flags;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Overridable filter that processes the response from the server and returns true if it was successful. The `res` parameter indicates the response data, and `req` the request data.\r\n\t */\r\n\tresponseFilter: function (res, req)\r\n\t{\r\n\t\treturn true;\r\n\t},\r\n\r\n\t/**\r\n\t * Starts \"package-mode\" (using the `rpkg` field). Any API calls after this will be bundled together.\r\n\t */\r\n\tpackageBegin: function ()\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t\treturn;\r\n\r\n\t\tthis._requestPackage++;\r\n\t},\r\n\r\n\t/**\r\n\t * Finishes \"package-mode\" and a single API request with the currently constructed package will be sent.\r\n\t */\r\n\tpackageEnd: function (callback)\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t\treturn;\r\n\r\n\t\tif (!this._requestPackage)\r\n\t\t\treturn;\r\n\r\n\t\tif (--this._requestPackage)\r\n\t\t\treturn;\r\n\r\n\t\tthis.packageSend(callback);\r\n\t},\r\n\r\n\t/**\r\n\t * Starts package-mode, executes the callback and finishes package-mode. Therefore any requests made by the callback will be packed together.\r\n\t */\r\n\tpackRequests: function (callback, responseCallback=null)\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.packageBegin();\r\n\t\tcallback();\r\n\t\tthis.packageEnd(responseCallback);\r\n\t},\r\n\r\n\t/**\r\n\t * Sends a single API request with the currently constructed package and maintains package-mode.\r\n\t */\r\n\tpackageSend: function (callback)\r\n\t{\r\n\t\tif (!(this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t\treturn;\r\n\r\n\t\tif (!this._packageData.length)\r\n\t\t\treturn;\r\n\r\n\t\tlet _packageData = this._packageData;\r\n\t\tthis._packageData = [];\r\n\r\n\t\tvar rpkg = \"\";\r\n\r\n\t\tfor (var i = 0; i < _packageData.length; i++)\r\n\t\t\trpkg += \"r\"+i+\",\"+base64.encode(this.encodeParams(_packageData[i][2]))+\";\";\r\n\r\n\t\tthis._showProgress();\r\n\r\n\t\tthis.apiCall (\r\n\t\t\t{ rpkg: rpkg },\r\n\r\n\t\t\t(res, req) =>\r\n\t\t\t{\r\n\t\t\t\tthis._hideProgress();\r\n\r\n\t\t\t\tfor (let i = 0; i < _packageData.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\ttry\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar response = res[\"r\"+i];\r\n\t\t\t\t\t\tif (!response)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (_packageData[i][1] != null) _packageData[i][1] (_packageData[i][2]);\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (_packageData[i][0] != null)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tif (this.responseFilter (response, _packageData[i][2]))\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t_packageData[i][0] (response, _packageData[i][2]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (e) {\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (callback) callback();\r\n\t\t\t},\r\n\r\n\t\t\t(req) =>\r\n\t\t\t{\r\n\t\t\t\tthis._hideProgress();\r\n\r\n\t\t\t\tfor (let i = 0; i < _packageData.length; i++)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (_packageData[i][1] != null) _packageData[i][1] (_packageData[i][2]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Adds CSS class 'busy' to the HTML root element, works only if running inside a browser.\r\n\t */\r\n\t_showProgress: function ()\r\n\t{\r\n\t\tif ('document' in global) {\r\n\t\t\tthis._requestLevel++;\r\n\t\t\tif (this._requestLevel > 0) global.document.documentElement.classList.add('busy');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Removes the 'busy' CSS class from the HTML element.\r\n\t */\r\n\t_hideProgress: function ()\r\n\t{\r\n\t\tif ('document' in global)\r\n\t\t{\r\n\t\t\tthis._requestLevel--;\r\n\t\t\tif (this._requestLevel) return;\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (this._requestLevel === 0)\r\n\t\t\t\t\tglobal.document.documentElement.classList.remove('busy');\r\n\t\t\t}, 250);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Sets an HTTP header.\r\n\t */\r\n\theader: function (name, value)\r\n\t{\r\n\t\tif (value === null)\r\n\t\t\tdelete this.headers[name];\r\n\t\telse\r\n\t\t\tthis.headers[name] = value;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Returns a parameter string for a GET request given an object with fields.\r\n\t */\r\n\tencodeParams: function (obj)\r\n\t{\r\n\t\tlet s = [];\r\n\r\n\t\tif (obj instanceof FormData)\r\n\t\t{\r\n\t\t\tfor (let i of obj.entries())\r\n\t\t\t\ts.push(encodeURIComponent(i[0]) + '=' + encodeURIComponent(i[1]));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tfor (let i in obj)\r\n\t\t\t\ts.push(encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]));\r\n\t\t}\r\n\r\n\t\treturn s.join('&');\r\n\t},\r\n\r\n\t/**\r\n\t * Returns a URL given a relative or absolute URL.\r\n\t */\r\n\tgetUrl: function (url)\r\n\t{\r\n\t\tif (url.indexOf('//') !== -1)\r\n\t\t\treturn url;\r\n\r\n\t\treturn this.apiUrl + url;\r\n\t},\r\n\r\n\t/**\r\n\t * Appends a parameter to the URL.\r\n\t */\r\n\tappendParam: function (url, param)\r\n\t{\r\n\t\treturn url + (url.indexOf('?') == -1 ? '?' : '&') + param;\r\n\t},\r\n\r\n\t/**\r\n\t * Executes an API call to the URL stored in the `apiUrl` property. By default `httpMethod` is \"auto\", which will determine the best depending on the data to\r\n\t * be sent. Any connection error will be reported to the `failure` callback, and similarly any success to the `success` callback. The `params` object can be\r\n\t * a FormData object or just a regular object.\r\n\t */\r\n\tapiCall: function (params, success, failure, httpMethod=null, retries=null, relativeUrl='')\r\n\t{\r\n\t\tlet url = this.getUrl(relativeUrl);\r\n\r\n\t\tif (this.flags & Api.UNIQUE_STAMP)\r\n\t\t\turl = this.appendParam(url, '_='+Date.now());\r\n\r\n\t\thttpMethod = httpMethod ? httpMethod.toUpperCase() : null;\r\n\t\tif (httpMethod != 'GET' && httpMethod != 'POST')\r\n\t\t\thttpMethod = 'auto';\r\n\r\n\t\tif (retries === null)\r\n\t\t\tretries = this.retries;\r\n\r\n\t\tif (this._requestPackage && (this.flags & Api.REQUEST_PACKAGE_SUPPORTED))\r\n\t\t{\r\n\t\t\tif (!(params instanceof FormData))\r\n\t\t\t\tparams = {...params};\r\n\r\n\t\t\tthis._packageData.push([success, failure, params]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._showProgress();\r\n\r\n\t\tlet data = params;\r\n\r\n\t\tlet options =\r\n\t\t{\r\n\t\t\tmode: 'cors',\r\n\t\t\theaders: {\r\n\t\t\t\t'Accept': 'text/html,application/xhtml+xml,application/xml,application/json;q=0.9',\r\n\t\t\t\t...this.headers\r\n\t\t\t},\r\n\t\t\tmethod: httpMethod,\r\n\t\t\tbody: null,\r\n\t\t\tmultipart: false\r\n\t\t};\r\n\r\n\t\tif (this.flags & Api.INCLUDE_CREDENTIALS)\r\n\t\t\toptions.credentials = 'include';\r\n\r\n\t\tif (typeof(data) !== 'string' && !(data instanceof Blob))\r\n\t\t{\r\n\t\t\tif (!(data instanceof FormData))\r\n\t\t\t{\r\n\t\t\t\tdata = new FormData();\r\n\r\n\t\t\t\tfor (let i in params)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ((params[i] instanceof File) || (params[i] instanceof Blob))\r\n\t\t\t\t\t\tdata.append(i, params[i], params[i].name);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tdata.append(i, params[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (let i of data.entries())\r\n\t\t\t{\r\n\t\t\t\tif ((i[1] instanceof File) || (i[1] instanceof Blob))\r\n\t\t\t\t{\r\n\t\t\t\t\toptions.method = 'POST';\r\n\t\t\t\t\toptions.multipart = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.useReq64 && (this.flags & Api.REQ64_SUPPORTED) && !options.multipart)\r\n\t\t\t{\r\n\t\t\t\tlet tmp = new FormData();\r\n\t\t\t\ttmp.append('req64', base64.encode(this.encodeParams(data)));\r\n\t\t\t\tdata = tmp;\r\n\t\t\t}\r\n\r\n\t\t\tif (options.method == 'auto')\r\n\t\t\t{\r\n\t\t\t\tlet l = 0;\r\n\r\n\t\t\t\toptions.method = 'GET';\r\n\r\n\t\t\t\tfor (let i of data.entries())\r\n\t\t\t\t{\r\n\t\t\t\t\tl += i[0].length + i[1].length + 2;\r\n\r\n\t\t\t\t\tif (l > 960)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\toptions.method = 'POST';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\r\n\t\t\t}\r\n\r\n\t\t\tif (options.method == 'GET')\r\n\t\t\t{\r\n\t\t\t\turl = this.appendParam(url, this.encodeParams(data));\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (!options.multipart)\r\n\t\t\t\t{\r\n\t\t\t\t\toptions.headers['Content-Type'] = 'application/x-www-form-urlencoded';\r\n\t\t\t\t\toptions.body = this.encodeParams(data);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\toptions.body = data;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif (typeof(data) === 'string')\r\n\t\t\t{\r\n\t\t\t\tif (data[0] === '<')\r\n\t\t\t\t{\r\n\t\t\t\t\tif (data.endsWith('</soap:Envelope>'))\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/soap+xml';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/xml';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif (data[0] === '{')\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/json';\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toptions.headers['Content-Type'] = 'application/octet-stream';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\toptions.headers['Content-Type'] = data.type;\r\n\r\n\t\t\toptions.method = 'POST';\r\n\t\t\toptions.body = data;\r\n\t\t}\r\n\r\n\t\tglobal.fetch(url, options)\r\n\t\t.then(result => this.decodeResult(result))\r\n\t\t.then(result =>\r\n\t\t{\r\n\t\t\tthis._hideProgress();\r\n\t\t\tif (!success) return\r\n\r\n\t\t\tif (this.responseFilter(result, params)) {\r\n\t\t\t\ttry { success(result, params); } catch(e) { }\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(err =>\r\n\t\t{\r\n\t\t\tthis._hideProgress();\r\n\r\n\t\t\tif (retries == 0) {\r\n\t\t\t\tif (failure) failure(params);\r\n\t\t\t} else {\r\n\t\t\t\tthis.apiCall (data, success, failure, httpMethod, retries-1, relativeUrl);\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Decodes a result obtained using fetch into a usable object.\r\n\t */\r\n\tdecodeResult: function (result)\r\n\t{\r\n\t\tlet type = result.headers.get('content-type').split(';')[0].toLowerCase();\r\n\r\n\t\tif ((this.flags & Api.JSON_RESPONSE_SUPPORTED) && type.indexOf('json') !== -1)\r\n\t\t\treturn result.json();\r\n\r\n\t\tif ((this.flags & Api.XML_RESPONSE_SUPPORTED) && type.indexOf('xml') !== -1)\r\n\t\t{\r\n\t\t\treturn new Promise((resolve, reject) =>\r\n\t\t\t{\r\n\t\t\t\tresult.text().then(data =>\r\n\t\t\t\t{\r\n\t\t\t\t\tdata = (new DOMParser).parseFromString(data, 'text/xml');\r\n\t\t\t\t\tresolve(data);\r\n\t\t\t\t})\r\n\t\t\t\t.catch(reject);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn result.blob();\r\n\t},\r\n\r\n\t/**\r\n\t * Makes a blob with the specified data and type.\r\n\t */\r\n\tgetBlob: function (data, type)\r\n\t{\r\n\t\treturn new Blob ([data], { type: type });\r\n\t},\r\n\r\n\t/**\r\n\t * Provided access to the base64 module to encode/decode data.\r\n\t */\r\n\tbase64:\r\n\t{\r\n\t\tencode: function (value)\r\n\t\t{\r\n\t\t\treturn base64.encode(value);\r\n\t\t},\r\n\r\n\t\tdecode: function (value)\r\n\t\t{\r\n\t\t\treturn base64.decode(value);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Executes a POST API call.\r\n\t */\r\n\tpost: function (params, success=null, failure=null)\r\n\t{\r\n\t\treturn this.apiCall(params, success, failure, 'POST');\r\n\t},\r\n\r\n\t/**\r\n\t * Executes a GET API call.\r\n\t */\r\n\tget: function (params, success=null, failure=null)\r\n\t{\r\n\t\treturn this.apiCall(params, success, failure, 'GET');\r\n\t},\r\n\r\n\t/**\r\n\t * Executes an automatic API call, returns a promise.\r\n\t */\r\n\tfetch: function (url, params=null)\r\n\t{\r\n\t\tif (params === null)\r\n\t\t{\r\n\t\t\tif (typeof(url) !== 'string')\r\n\t\t\t{\r\n\t\t\t\tparams = url;\r\n\t\t\t\turl = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.apiCall(params, resolve, reject, null, null, url);\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Builds a URL from the given data.\r\n\t */\r\n\tmakeUrl: function (url, params=null)\r\n\t{\r\n\t\tif (params === null)\r\n\t\t{\r\n\t\t\tif (typeof(url) !== 'string')\r\n\t\t\t{\r\n\t\t\t\tparams = url;\r\n\t\t\t\turl = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.appendParam(this.getUrl(url), this.encodeParams(params));\r\n\t}\r\n};\r\n\r\nexport default Api;\r\n","\r\nimport { Model, ModelList, EventDispatcher } from 'rinn';\r\nimport Api from './api.js';\r\n\r\n/*\r\n**\tProvides several methods to quickly interface with a remote data-source as defined by Wind.\r\n*/\r\n\r\nexport default EventDispatcher.extend\r\n({\r\n\tclassName: 'DataSource',\r\n\tdebounceDelay: 250,\r\n\r\n\trequest: null,\r\n\r\n\tincludeCount: false,\r\n\tincludeEnum: false,\r\n\tincludeList: true,\r\n\r\n\teid: null,\r\n\tcount: 0,\r\n\tlist: null,\r\n\tenum: null,\r\n\r\n\t/*\r\n\t**\tConstructs the data source with the specified optional `config` parameters, any of the properties of this object can be specified\r\n\t**\tin the config. Uses the given basePath as prefix for the `f` parameter for subsequent API operations, a basePath of `candies` will\r\n\t**\tresult in calls to `candies.list`, `candies.count`, etc.\r\n\t*/\r\n\t__ctor: function (basePath, config)\r\n\t{\r\n\t\tthis._super.EventDispatcher.__ctor();\r\n\r\n\t\tthis.basePath = basePath;\r\n\r\n\t\tif (config) Object.assign(this, config);\r\n\r\n\t\tthis.request = new Model(this.request);\r\n\r\n\t\tthis.eid = Math.random().toString().substr(2);\r\n\t\tthis.count = 0;\r\n\r\n\t\tthis.list = new ModelList();\r\n\t\tthis.list.dataSource = this;\r\n\r\n\t\tthis.enum = new ModelList();\r\n\t\tthis.enum.dataSource = this;\r\n\r\n\t\tthis.request.addEventListener (this.eid+':propertyChanged', this.forwardRequestEvent, this);\r\n\r\n\t\tthis.list.addEventListener (this.eid+':itemsCleared', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemsChanged', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemRemoved', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemChanged', this.forwardListEvent, this);\r\n\t\tthis.list.addEventListener (this.eid+':itemAdded', this.forwardListEvent, this);\r\n\r\n\t\tthis.enum.addEventListener (this.eid+':itemsCleared', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemsChanged', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemRemoved', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemChanged', this.forwardEnumEvent, this);\r\n\t\tthis.enum.addEventListener (this.eid+':itemAdded', this.forwardEnumEvent, this);\r\n\t},\r\n\r\n\tforwardRequestEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('request' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\tforwardListEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('list' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\tforwardEnumEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('enum' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes one or more API functions (depending on `includeCount`, `includeEnum` and `includeList` properties) to retrieve the\r\n\t**\trequired data (uses debounce to prevent too-quick refreshes).\r\n\t**\r\n\t**\tRefresh mode can be: order, filter, range or full. Setting `mode` to `true` will cause a full refresh without debouncing.\r\n\t*/\r\n\trefresh: function (mode='full', callback=null)\r\n\t{\r\n\t\tif (typeof(mode) == 'function')\r\n\t\t{\r\n\t\t\tcallback = mode;\r\n\t\t\tmode = 'full';\r\n\t\t}\r\n\r\n\t\tif (this._timeout)\r\n\t\t{\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = null;\r\n\t\t}\r\n\r\n\t\tconst fn = () =>\r\n\t\t{\r\n\t\t\tthis._timeout = null;\r\n\r\n\t\t\tApi.packageBegin();\r\n\r\n\t\t\tif (this.includeCount && (mode == 'full' || mode == 'filter')) this.fetchCount();\r\n\t\t\tif (this.includeEnum && (mode == 'full')) this.fetchEnum();\r\n\t\t\tif (this.includeList) this.fetchList();\r\n\r\n\t\t\tApi.packageEnd(callback);\r\n\t\t};\r\n\r\n\t\tif (mode === true)\r\n\t\t{\r\n\t\t\tmode = 'full';\r\n\t\t\tfn();\r\n\t\t}\r\n\t\telse\r\n\t\t\tthis._timeout = setTimeout(fn, this.debounceDelay);\r\n\t},\r\n\r\n\t/*\r\n\t**\tSearches for the item in `list` that matches the specified `fields` and sends it to the callback. If no item is found (or if `forced` is true),\r\n\t**\ta call to API function `.get` will be executed with the fields as request parameters. Returns a promise.\r\n\t*/\r\n\tfetch: function (fields, forced=false)\r\n\t{\r\n\t\treturn new Promise((resolve, reject) =>\r\n\t\t{\r\n\t\t\tlet item = forced == true ? null : this.list.find(fields, true);\r\n\t\t\tif (!item)\r\n\t\t\t{\r\n\t\t\t\tthis.fetchOne(fields, (r) =>\r\n\t\t\t\t{\r\n\t\t\t\t\tif (r && r.response == 200)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (r.data.length > 0)\r\n\t\t\t\t\t\t\tresolve(r.data[0]);\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\treject(r);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treject(r);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tresolve(item.get());\r\n\t\t});\r\n\t},\r\n\r\n\t/*\r\n\t**\tRemoves an item from the remote data source by executing the `.delete` API function, passes the given `fields` as request\r\n\t**\tparameters. Returns a promise.\r\n\t*/\r\n\tdelete: function (params)\r\n\t{\r\n\t\treturn new Promise((resolve, reject) =>\r\n\t\t{\r\n\t\t\tthis.fetchDelete(params, (r) =>\r\n\t\t\t{\r\n\t\t\t\tif (r.response == 200)\r\n\t\t\t\t\tresolve(r);\r\n\t\t\t\telse\r\n\t\t\t\t\treject(r.error);\r\n\t\t\t});\r\n\t\t});\r\n\t},\r\n\r\n\tfetchList: function ()\r\n\t{\r\n\t\tlet data = {...this.request.get()};\r\n\r\n\t\tdata.f = this.basePath + '.list';\r\n\r\n\t\tthis.dispatchEvent('listLoading');\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tthis.list.setData(r.response == 200 ? r.data : null);\r\n\t\t\tthis.dispatchEvent('listLoaded');\r\n\t\t\tthis.dispatchEvent('listChanged');\r\n\t\t});\r\n\t},\r\n\r\n\tfetchEnum: function ()\r\n\t{\r\n\t\tlet data = {...this.request.get()};\r\n\r\n\t\tdata.f = this.basePath + '.enum';\r\n\r\n\t\tthis.dispatchEvent('enumLoading');\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tthis.enum.setData(r.response == 200 ? r.data : null);\r\n\t\t\tthis.dispatchEvent('enumLoaded');\r\n\t\t\tthis.dispatchEvent('enumChanged');\r\n\t\t});\r\n\t},\r\n\r\n\tfetchCount: function ()\r\n\t{\r\n\t\tlet data = {...this.request.get()};\r\n\r\n\t\tdata.f = this.basePath + '.count';\r\n\r\n\t\tthis.dispatchEvent('countLoading');\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tthis.count = r.response == 200 ? r.count : 0;\r\n\t\t\tthis.dispatchEvent('countLoaded');\r\n\t\t\tthis.dispatchEvent('countChanged');\r\n\t\t});\r\n\t},\r\n\r\n\tfetchOne: function (params, callback)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tdata.f = this.basePath + '.get';\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tcallback(r);\r\n\t\t});\r\n\t},\r\n\r\n\tfetchDelete: function (params, callback)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tdata.f = this.basePath + '.delete';\r\n\r\n\t\tApi.fetch(data).then(r => {\r\n\t\t\tcallback(r);\r\n\t\t});\r\n\t},\r\n\r\n\tfetchData: function (params)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tif (data.f[0] == '.')\r\n\t\t\tdata.f = this.basePath + data.f;\r\n\r\n\t\treturn Api.fetch(data);\r\n\t},\r\n\r\n\tmakeUrl: function (params)\r\n\t{\r\n\t\tlet data = {...this.request.get(), ...params};\r\n\r\n\t\tif (data.f[0] == '.')\r\n\t\t\tdata.f = this.basePath + data.f;\r\n\r\n\t\treturn Api.makeUrl(data);\r\n\t}\r\n});\r\n","\r\nimport { Model, ModelList } from 'rinn';\r\nimport Api from './api.js';\r\n\r\n/*\r\n**\tProvides an interface to connect with a listing API function.\r\n*/\r\n\r\nexport default ModelList.extend\r\n({\r\n\tclassName: 'DataList',\r\n\tdebounceDelay: 250,\r\n\r\n\trequest: null,\r\n\r\n\teid: null,\r\n\r\n\t/*\r\n\t**\tConstructs the data list with the specified optional `config` parameters, any of the properties of this object can be specified\r\n\t**\tin the config. The given `f` parameter is passed directly as a request parameter to the API.\r\n\t*/\r\n\t__ctor: function (f, config=null)\r\n\t{\r\n\t\tthis._super.ModelList.__ctor();\r\n\r\n\t\tif (config !==  null)\r\n\t\t\tObject.assign(this, config);\r\n\r\n\t\tif (!this.request)\r\n\t\t\tthis.request = { };\r\n\r\n\t\tthis.request.f = f;\r\n\t\tthis.request = new Model(this.request);\r\n\r\n\t\tthis.eid = Math.random().toString().substr(2);\r\n\t\tthis.dataList = this;\r\n\r\n\t\tthis.request.addEventListener (this.eid+':propertyChanged', this.forwardRequestEvent, this);\r\n\t},\r\n\r\n\tforwardRequestEvent: function (evt, args)\r\n\t{\r\n\t\tthis.prepareEvent('request' + evt.name[0].toUpperCase() + evt.name.substr(1), args).setSource(evt.source).resume();\r\n\t},\r\n\r\n\t/*\r\n\t**\tExecutes a request to retrieve the data for the list (uses debounce to prevent too-quick refreshes).\r\n\t*/\r\n\trefresh: function (callback=null, _callback=null)\r\n\t{\r\n\t\tif (this._timeout)\r\n\t\t{\r\n\t\t\tclearTimeout(this._timeout);\r\n\t\t\tthis._timeout = null;\r\n\t\t}\r\n\r\n\t\tif (callback === true)\r\n\t\t{\r\n\t\t\tthis.dispatchEvent('listLoading');\r\n\r\n\t\t\tApi.fetch(this.request.get()).then(r =>\r\n\t\t\t{\r\n\t\t\t\tthis.setData(r.response == 200 ? r.data : null);\r\n\t\t\t\tthis.dispatchEvent('listLoaded');\r\n\t\t\t\tthis.dispatchEvent('listChanged');\r\n\r\n\t\t\t\tif (_callback !== null)\r\n\t\t\t\t\t_callback();\r\n\t\t\t});\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fn = () => {\r\n\t\t\tthis.refresh(true, callback);\r\n\t\t};\r\n\r\n\t\tthis._timeout = setTimeout(fn, this.debounceDelay);\r\n\t}\r\n});\r\n","\n/**\n**\tCollection of useful easing functions (imported from Cherry source code).\n*/\n\nconst Easing =\n{\n\t/**\n\t**\tInterpolates numeric values between two objects (`src` and `dst`) using the specified `duration` (in seconds) and `easing` function. Note that all four parameters\n\t**\t`src`, `dst`, `duration` and `easing` must be objects having the same number of values.\n\t*/\n\tinterpolate: function (src, dst, duration, easing, callback/* function(data, isFinished) */)\n\t{\n\t\tlet time = { };\n\t\tlet data = { };\n\t\tlet count = 0;\n\n\t\tfor (let x in src)\n\t\t{\n\t\t\ttime[x] = 0.0;\n\t\t\tdata[x] = src[x]\n\t\t\tcount++;\n\t\t}\n\n\t\tlet lastTime = Date.now()/1000;\n\t\tlet dt = 0;\n\n\t\tlet interpolator = function()\n\t\t{\n\t\t\tlet curTime = Date.now()/1000;\n\t\t\tdt = curTime - lastTime;\n\t\t\tlastTime = curTime;\n\n\t\t\tfor (let x in time)\n\t\t\t{\n\t\t\t\tif (time[x] == duration[x])\n\t\t\t\t\tcontinue;\n\n\t\t\t\ttime[x] += dt;\n\t\t\t\tif (time[x] >= duration[x])\n\t\t\t\t{\n\t\t\t\t\ttime[x] = duration[x];\n\t\t\t\t\tcount--;\n\t\t\t\t}\n\n\t\t\t\tlet t = easing[x] (time[x] / duration[x]);\n\t\t\t\tdata[x] = (1-t)*src[x] + t*dst[x];\n\t\t\t}\n\n\t\t\tcallback (data, count == 0);\n\n\t\t\tif (count != 0)\n\t\t\t\trequestAnimationFrame(interpolator);\n\t\t};\n\n\t\tinterpolator();\n\t},\n\n\t/* ******************************************** */\n\tLinear:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBack:\n\t{\n\t\tk: 1.70158,\n\n\t\tIN: function (t, k)\n\t\t{\n\t\t\tif (k === undefined) k = Easing.Back.k;\n\t\t\treturn t*t*((k+1)*t - k);\n\t\t},\n\n\t\tOUT: function (t, k)\n\t\t{\n\t\t\treturn 1 - Easing.Back.IN(1 - t, k);\n\t\t},\n\n\t\tIN_OUT: function (t, k)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Back.IN(t*2, k)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Back.OUT((t-0.5)*2, k)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tBounce:\n\t{\n\t\tgetConst: function (t)\n\t\t{\n\t\t\tif (t < 1.0/2.75)\n\t\t\t\treturn 7.5625 * t * t;\n\t\t\telse if (t < 2.0/2.75)\n\t\t\t\treturn 7.5625 * (t -= 1.5/2.75)*t + 0.75;\n\t\t\telse if (t < 2.5/2.75)\n\t\t\t\treturn 7.5625 * (t -= 2.250/2.75) * t + 0.9375;\n\n\t\t\treturn 7.5625 * (t -= 2.625/2.75) * t + 0.984375;\n\t\t},\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Bounce.getConst(1-t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Easing.Bounce.getConst(t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn (1 - Easing.Bounce.getConst(1-2*t))/2;\n\t\t\telse\n\t\t\t\treturn (Easing.Bounce.getConst((t-0.5)*2)/2)+0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCirc:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sqrt(1 - t*t);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Circ.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Circ.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Circ.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tCubic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Cubic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Cubic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Cubic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tExpo:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(2, 12*(t-1));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn -Math.pow(2, -12*t) + 1;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif ((t *= 2) < 1)\n\t\t\t\treturn Math.pow (2, 12 * (t - 1)) / 2;\n\t\t\telse\n\t\t\t\treturn (-Math.pow (2, -12 * (t - 1)) + 2) / 2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tPower:\n\t{\n\t\tp: 12,\n\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn Math.pow(t, Easing.Power.p);\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Power.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Power.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Power.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuad:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quad.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quad.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quad.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuartic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quartic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\treturn Easing.Quartic.IN(t*2)/2;\n\t\t\telse\n\t\t\t\treturn Easing.Quartic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tQuintic:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t*t*t*t*t;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn 1 - Easing.Quintic.IN(1 - t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\tif (t < 0.5)\n\t\t\t\t\treturn Easing.Quintic.IN(t*2)/2;\n\t\t\t\telse\n\t\t\t\t\treturn Easing.Quintic.OUT((t-0.5)*2)/2 + 0.5;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tSine:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn 1 - Math.sin (1.5708 * (1 - t));\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn Math.sin (1.5708 * t);\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn (Math.cos (3.1416*t) - 1) / -2;\n\t\t}\n\t},\n\n\t/* ******************************************** */\n\tStep:\n\t{\n\t\tIN: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tOUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t},\n\n\t\tIN_OUT: function (t)\n\t\t{\n\t\t\treturn t != 1.0 ? 0 : 1.0;\n\t\t}\n\t}\n};\n\nexport default Easing;\n","\nimport { Rinn, Class } from 'rinn';\n\n/**\n**\tClass to animate properties using rules (imported from Cherry source code).\n*/\n\nconst Anim = Class.extend\n({\n\tlist: null,\n\n\tinitialData: null,\n\tdata: null,\n\n\tstack: null,\n\tblock: null,\n\n\ttimeScale: 1, time: 0, blockTime: 0,\n\tindex: 0,\n\n\tpaused: false,\n\tfinished: false,\n\n\tonFinishedCallback: null,\n\tonUpdatedCallback: null,\n\n\t__ctor: function ()\n\t{\n\t\tthis.list = [ ];\n\n\t\tthis.initialData = { };\n\t\tthis.data = { };\n\n\t\tthis.stack = [ ];\n\t\tthis.block = this.list;\n\n\t\tthis.reset();\n\t},\n\n\t__dtor: function ()\n\t{\n\t},\n\n\tclone: function ()\n\t{\n\t\tlet a = new Anim();\n\n\t\ta.list = this.list;\n\t\ta.initialData = this.initialData;\n\n\t\treturn a.reset();\n\t},\n\n\tonFinished: function (callback)\n\t{\n\t\tthis.onFinishedCallback = callback;\n\t\treturn this;\n\t},\n\n\tonUpdated: function (callback)\n\t{\n\t\tthis.onUpdatedCallback = callback;\n\t\treturn this;\n\t},\n\n\t// Resets the animation to its initial state.\n\treset: function ()\n\t{\n\t\tthis.stack.length = 0;\n\t\tthis.blockTime = 0;\n\n\t\tthis.time = 0;\n\t\tthis.index = 0;\n\n\t\tthis.block = this.list;\n\n\t\tthis.paused = true;\n\t\tthis.finished = false;\n\t\tthis.handle = null;\n\n\t\tfor (let i in this.initialData)\n\t\t\tthis.data[i] = this.initialData[i];\n\n\t\treturn this;\n\t},\n\n\t// Sets the initial data.\n\tinitial: function (data)\n\t{\n\t\tthis.initialData = data;\n\t\treturn this.reset();\n\t},\n\n\t// Sets the time scale (animation speed).\n\tspeed: function (value)\n\t{\n\t\tthis.timeScale = value > 0.0 ? value : 1.0;\n\t\treturn this;\n\t},\n\n\t// Sets the output data object.\n\tsetOutput: function (data)\n\t{\n\t\tthis.data = data;\n\t\treturn this;\n\t},\n\n\t// Pauses the animation.\n\tpause: function ()\n\t{\n\t\tif (this.paused) return;\n\n\t\tclearInterval(this.handle);\n\t\tthis.paused = true;\n\t},\n\n\t// Resumes the animation.\n\tresume: function ()\n\t{\n\t\tif (!this.paused) return;\n\n\t\tlet lastTime = Date.now()/1000;\n\n\t\tthis.handle = setInterval(() =>\n\t\t{\n\t\t\tlet curTime = Date.now()/1000;\n\t\t\tlet dt = curTime - lastTime;\n\t\t\tlastTime = curTime;\n\n\t\t\tthis.update(dt);\n\n\t\t\tif (this.onUpdatedCallback)\n\t\t\t\tthis.onUpdatedCallback (this.data, this);\n\t\t},\n\t\t16);\n\n\t\tif (this.onUpdatedCallback)\n\t\t\tthis.onUpdatedCallback (this.data, this);\n\n\t\tthis.paused = false;\n\t},\n\n\t// Updates the animation by the specified delta time (seconds).\n\tupdate: function (dt)\n\t{\n\t\tif (this.paused) return false;\n\n\t\tif (this.index >= this.block.length)\n\t\t\treturn true;\n\n\t\tlet i = 0;\n\n\t\tlet _block;\n\t\tlet _index;\n\t\tlet _blockTime;\n\n\t\tthis.time += dt*this.timeScale;\n\n\t\twhile (this.index < this.block.length)\n\t\t{\n\t\t\tlet cmd = this.block[this.index];\n\t\t\tlet duration;\n\n\t\t\tswitch (cmd.op)\n\t\t\t{\n\t\t\t\tcase \"parallel\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.blocks.length = 0;\n\t\t\t\t\t\tcmd.started = true;\n\n\t\t\t\t\t\tfor (i = 0; i < cmd.block.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcmd.blocks.push([cmd.block[i]]);\n\t\t\t\t\t\t\tcmd.indices[i] = 0;\n\t\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tlet n = 0;\n\t\t\t\t\tlet blockTime = _blockTime;\n\n\t\t\t\t\tfor (i = 0; i < cmd.blocks.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block = cmd.blocks[i];\n\t\t\t\t\t\tthis.index = cmd.indices[i];\n\t\t\t\t\t\tthis.blockTime = cmd.blockTimes[i];\n\n\t\t\t\t\t\tif (this.update(0) === true)\n\t\t\t\t\t\t\tn++;\n\n\t\t\t\t\t\tif (this.blockTime > blockTime)\n\t\t\t\t\t\t\tblockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.blockTimes[i] = this.blockTime;\n\t\t\t\t\t\tcmd.blocks[i] = this.block;\n\t\t\t\t\t\tcmd.indices[i] = this.index;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (n != cmd.blocks.length)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"serial\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"repeat\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._block = cmd.block;\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._blockTime = this.blockTime;\n\t\t\t\t\t\tcmd._count = cmd.count;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t_block = this.block;\n\t\t\t\t\t_index = this.index;\n\t\t\t\t\t_blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = cmd._block;\n\t\t\t\t\tthis.index = cmd._index;\n\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\n\t\t\t\t\ti = this.update(0);\n\n\t\t\t\t\tcmd._block = this.block;\n\t\t\t\t\tcmd._index = this.index;\n\t\t\t\t\tcmd._blockTime = this.blockTime;\n\n\t\t\t\t\tthis.block = _block;\n\t\t\t\t\tthis.index = _index;\n\t\t\t\t\tthis.blockTime = _blockTime;\n\n\t\t\t\t\tif (cmd.fn) cmd.fn.call(this);\n\n\t\t\t\t\tif (i !== true) return false;\n\n\t\t\t\t\tif (cmd._count <= 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\t\tthis.blockTime = cmd._blockTime;\n\t\t\t\t\t\tthis.index++;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd._index = 0;\n\t\t\t\t\t\tcmd._count--;\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"set\":\n\t\t\t\t\tthis.data[cmd.field] = cmd.value;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"restart\":\n\t\t\t\t\tthis.index = 0;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"wait\":\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"range\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (cmd.startValue === null)\n\t\t\t\t\t\t\tcmd._startValue = this.data[cmd.field];\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tcmd._startValue = cmd.startValue;\n\n\t\t\t\t\t\tcmd._endValue = cmd.endValue;\n\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1.0)\n\t\t\t\t\t\tthis.data[cmd.field] = cmd.easing(dt)*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\t\t\t\t\telse\n\t\t\t\t\t\tthis.data[cmd.field] = dt*(cmd._endValue - cmd._startValue) + cmd._startValue;\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"rand\":\n\t\t\t\t\tif (cmd.started == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tcmd.started = true;\n\t\t\t\t\t\tcmd.last = null;\n\t\t\t\t\t}\n\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\tcmd.cur = ~~(cmd.easing(dt)*cmd.count);\n\t\t\t\t\telse\n\t\t\t\t\t\tcmd.cur = ~~(dt*cmd.count);\n\n\t\t\t\t\tif (cmd.cur != cmd.last)\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\ti = ~~(Math.random()*(cmd.endValue - cmd.startValue + 1)) + cmd.startValue;\n\t\t\t\t\t\t\tif (i != this.data[cmd.field]) break;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.data[cmd.field] = i;\n\t\t\t\t\t\tcmd.last = cmd.cur;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tcmd.started = false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"randt\":\n\t\t\t\t\tduration = Rinn.typeOf(cmd.duration) == \"string\" ? this.data[cmd.duration] : cmd.duration;\n\n\t\t\t\t\tif (this.time < this.blockTime + duration)\n\t\t\t\t\t\tdt = (this.time - this.blockTime) / duration;\n\t\t\t\t\telse\n\t\t\t\t\t\tdt = 1;\n\n\t\t\t\t\tif (cmd.easing && dt != 1)\n\t\t\t\t\t\ti = cmd.easing(dt)*(cmd.count-1);\n\t\t\t\t\telse\n\t\t\t\t\t\ti = dt*(cmd.count-1);\n\n\t\t\t\t\tthis.data[cmd.field] = cmd.table[~~((i + cmd.count) % cmd.count)];\n\n\t\t\t\t\tif (dt != 1) return false;\n\n\t\t\t\t\tthis.blockTime += duration;\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"play\":\n\t\t\t\t\tcmd.snd.play();\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase \"exec\":\n\t\t\t\t\tcmd.fn.call(this, this);\n\t\t\t\t\tthis.index++;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (this.block == this.list)\n\t\t{\n\t\t\tif (!this.finished && this.onFinishedCallback != null)\n\t\t\t\tthis.onFinishedCallback();\n\n\t\t\tthis.pause();\n\t\t\tthis.finished = true;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t// Runs the subsequent commands in parallel. Should end the parallel block by calling end().\n\tparallel: function ()\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"parallel\", started: false, block: block, blocks: [ ], indices: [ ], blockTimes: [ ] });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Runs the subsequent commands in series. Should end the serial block by calling end().\n\tserial: function ()\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"serial\", started: false, block: block });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Repeats a block the specified number of times.\n\trepeat: function (count)\n\t{\n\t\tlet block = [ ];\n\n\t\tthis.block.push({ op: \"repeat\", started: false, block: block, count: count });\n\n\t\tthis.stack.push (this.block);\n\t\tthis.block = block;\n\n\t\treturn this;\n\t},\n\n\t// Sets the callback of the current block.\n\tcallback: function (fn)\n\t{\n\t\tlet block = this.stack[this.stack.length-1];\n\t\tblock[block.length-1].fn = fn;\n\n\t\treturn this;\n\t},\n\n\t// Ends a parallel(), serial() or repeat() block.\n\tend: function ()\n\t{\n\t\tthis.block = this.stack.pop();\n\t\treturn this;\n\t},\n\n\t// Sets the value of a variable.\n\tset: function (field, value)\n\t{\n\t\tthis.block.push({ op: \"set\", field: field, value: value });\n\t\treturn this;\n\t},\n\n\t// Restarts the current block.\n\trestart: function (duration)\n\t{\n\t\tthis.block.push({ op: \"restart\" });\n\t\treturn this;\n\t},\n\n\t// Waits for the specified duration.\n\twait: function (duration)\n\t{\n\t\tthis.block.push({ op: \"wait\", duration: duration });\n\t\treturn this;\n\t},\n\n\t// Sets the range of a variable.\n\trange: function (field, duration, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"range\", started: false, field: field, duration: duration, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive).\n\trand: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tthis.block.push({ op: \"rand\", started: false, field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Generates a certain amount of random numbers in the given range (inclusive). This uses a static random table to determine the next values.\n\trandt: function (field, duration, count, startValue, endValue, easing)\n\t{\n\t\tlet table = [ ];\n\n\t\tfor (let i = 0; i < count; i++)\n\t\t\ttable.push ((i % (endValue - startValue + 1)) + startValue);\n\n\t\tfor (let i = count >> 2; i > 0; i--)\n\t\t{\n\t\t\tlet a = ~~(Math.random() * count);\n\t\t\tlet b = ~~(Math.random() * count);\n\n\t\t\tlet c = table[b];\n\t\t\ttable[b] = table[a];\n\t\t\ttable[a] = c;\n\t\t}\n\n\t\tthis.block.push({ op: \"randt\", field: field, duration: duration, count: count, startValue: startValue, endValue: endValue, table: table, easing: easing ? easing : null });\n\t\treturn this;\n\t},\n\n\t// Plays a sound.\n\tplay: function (snd)\n\t{\n\t\tthis.block.push({ op: \"play\", snd: snd });\n\t\treturn this;\n\t},\n\n\t// Executes a function.\n\texec: function (fn)\n\t{\n\t\tthis.block.push({ op: \"exec\", fn: fn });\n\t\treturn this;\n\t}\n});\n\nexport default Anim;\n","/*\n**\telems/r-tabs\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-tabs data-container=\"div.tab-container\" data-base-route=\"@\" data-initial=\"tab1\">\n\t\t<a data-name=\"tab1\">Tab-1</a>\n\t\t<a data-name=\"tab2\">Tab-2</a>\n\t\t<a data-name=\"tab3\">Tab-3</a>\n\t</r-tabs>\n\n\t<div class=\"tab-container\">\n\t\t<div data-name=\"tab1\">\n\t\t\tThis is tab-1.\n\t\t</div>\n\n\t\t<div data-name=\"tab2\">\n\t\t\tThis is tab-2.\n\t\t</div>\n\n\t\t<div data-name=\"tab3\">\n\t\t\tThis is tab-3.\n\t\t</div>\n\t</div>\n\n\t.x-hidden {\n\t\tdisplay: none;\n\t}\n\n\tr-tabs [data-name].active {\n\t\tfont-weight: bold;\n\t}\n*/\n\nimport Element from '../element.js';\nimport Router from '../router.js';\n\nexport default Element.register ('r-tabs',\n{\n\t/**\n\t * Container element for tab content.\n\t */\n\tcontainer: null,\n\n\t/**\n\t * Active tab name.\n\t */\n\tactiveTab: null,\n\n\t/**\n\t**\tElement events.\n\t*/\n\t'event click [data-name]': function (evt)\n\t{\n\t\tevt.continuePropagation = true;\n\n\t\tif (this.dataset.baseRoute)\n\t\t{\n\t\t\tlocation = \"#\" + Router.realLocation(this.dataset.baseRoute.replace('@', evt.source.dataset.name));\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectTab (evt.source.dataset.name);\n\t},\n\n\t/**\n\t**\tInitializes the Tabs element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis._routeHandler = (evt, args) =>\n\t\t{\n\t\t\tif (Router.location != '')\n\t\t\t{\n\t\t\t\tthis.querySelectorAll(\"[href]\").forEach(link =>\n\t\t\t\t{\n\t\t\t\t\tif (!link.href) return;\n\n\t\t\t\t\tif (Router.location.startsWith(link.href.substr(link.href.indexOf('#')+1)))\n\t\t\t\t\t\tlink.classList.add('active');\n\t\t\t\t\telse\n\t\t\t\t\t\tlink.classList.remove('active');\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!args.route.changed)\n\t\t\t\treturn;\n\n\t\t\tthis.showTab (args.tabName);\n\t\t};\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tif (\"container\" in this.dataset)\n\t\t{\n\t\t\tif (this.dataset.container == ':previousElement')\n\t\t\t\tthis.container = this.previousElementSibling;\n\t\t\telse if (this.dataset.container == ':nextElement')\n\t\t\t\tthis.container = this.nextElementSibling;\n\t\t\telse if (this.dataset.container == ':none')\n\t\t\t\tthis.container = null;\n\t\t\telse\n\t\t\t\tthis.container = document.querySelector(this.dataset.container);\n\t\t}\n\t\telse\n\t\t\tthis.container = this.nextElementSibling;\n\n\t\tthis._hideTabsExcept(this.dataset.initial);\n\t},\n\n\t/**\n\t**\tAdds a handler to Router if the data-base-route attribute was set.\n\t*/\n\tonConnected: function()\n\t{\n\t\tif (this.dataset.baseRoute)\n\t\t\tRouter.addRoute (this.dataset.baseRoute.replace('@', ':tabName'), this._routeHandler);\n\t},\n\n\t/**\n\t**\tRemoves a handler previously added to Router if the data-base-route attribute was set.\n\t*/\n\tonDisconnected: function()\n\t{\n\t\tif (this.dataset.baseRoute)\n\t\t\tRouter.removeRoute(this.dataset.baseRoute.replace('@', ':tabName'), this._routeHandler);\n\t},\n\n\t/**\n\t**\tHides all tabs except the one with the specified exceptName, if none specified then all tabs will be hidden (adds `.x-hidden` CSS class),\n\t**\tadditionally the respective link item in the tab definition will have class `.active`.\n\t*/\n\t_hideTabsExcept: function (exceptName)\n\t{\n\t\tif (!exceptName) exceptName = '';\n\n\t\tif (this.container != null)\n\t\t{\n\t\t\tthis.container.querySelectorAll(':scope > [data-name]').forEach(i =>\n\t\t\t{\n\t\t\t\tif (i.dataset.name == exceptName)\n\t\t\t\t{\n\t\t\t\t\ti.classList.remove('x-hidden');\n\t\t\t\t\tthis.dispatch('tabShown', { name: i.dataset.name, el: i });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ti.classList.add('x-hidden');\n\t\t\t\t\tthis.dispatch('tabHidden', { name: i.dataset.name, el: i });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.querySelectorAll(\"[data-name]\").forEach(link =>\n\t\t{\n\t\t\tif (link.dataset.name == exceptName)\n\t\t\t\tlink.classList.add('active');\n\t\t\telse\n\t\t\t\tlink.classList.remove('active');\n\t\t});\n\n\t\tthis.activeTab = exceptName;\n\t\tthis.dispatch('tabChanged', { name: exceptName });\n\t},\n\n\t/**\n\t**\tShows the tab with the specified name, ignores `data-base-route` and current route as well.\n\t*/\n\tshowTab: function (name)\n\t{\n\t\treturn this._hideTabsExcept (name);\n\t},\n\n\t/**\n\t**\tShows a tab given its name. The route will be changed automatically if `data-base-route` is enabled.\n\t*/\n\tselectTab: function (name)\n\t{\n\t\tif (this.dataset.baseRoute)\n\t\t{\n\t\t\tconst hash = \"#\" + Router.realLocation(this.dataset.baseRoute.replace('@', name));\n\n\t\t\tif (location.hash != hash)\n\t\t\t{\n\t\t\t\tlocation = hash;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.showTab (name);\n\t}\n});\n","/*\n**\telems/r-form\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n<r-form data-form-action=\"api-function-name\" [data-strict=\"true|false\"] [data-errors-at=\"\"] [data-method=\"post\"]>\n\t<input type=\"text\" data-field=\"username\"/>\n</r-form>\n\nr-form .message.x-hidden {\n    display: none;\n}\n\nr-form span.field-error {\n    display: block;\n    color: red;\n}\n*/\n\nimport { Template } from 'rinn';\nimport Element from '../element.js';\nimport Api from '../api.js';\n\nexport default Element.register ('r-form',\n{\n\t/**\n\t**\tElement events.\n\t*/\n\tevents:\n\t{\n\t\t'change [data-field]': '_fieldChanged',\n\n\t\t'click input[type=reset]': 'reset',\n\t\t'click .reset': 'reset',\n\n\t\t'click input[type=submit]': 'submit',\n\t\t'click button[type=submit]': 'submit',\n\t\t'click .submit': 'submit',\n\t\t'submit form': 'submit'\n\t},\n\n\t/*\n\t**\tInitial form model.\n\t*/\n\tmodel: { },\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tlet formElement = document.createElement('form');\n\t\tformElement.append(...this.childNodes);\n\t\tthis.append(formElement);\n\n\t\tlet def = { };\n\t\tlet names = this.model.get();\n\n\t\tthis.querySelectorAll('[data-field]').forEach((i) =>\n\t\t{\n\t\t\ti.name = i.dataset.field;\n\t\t\tnames[i.name] = i.type;\n\n\t\t\tlet val = i.dataset.default;\n\t\t\tif (val == undefined)\n\t\t\t{\n\t\t\t\tswitch (i.type)\n\t\t\t\t{\n\t\t\t\t\tcase 'radio':\n\t\t\t\t\t\tif (!i.checked) return;\n\t\t\t\t\t\tval = i.value;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'checkbox':\n\t\t\t\t\t\tval = i.checked ? '1' : '0';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'field':\n\t\t\t\t\t\tval = i.getValue();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'file':\n\t\t\t\t\t\tval = '';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tval = '';\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdef[i.dataset.field] = val;\n\t\t});\n\n\t\tfor (let name in names)\n\t\t{\n\t\t\tif (name in def)\n\t\t\t\tnames[name] = def[name];\n\t\t\telse\n\t\t\t\tnames[name] = '';\n\t\t}\n\n\t\tdef = names;\n\n\t\tthis.model.defaults = def;\n\t\tthis.model.reset();\n\n\t\tthis.clearMarkers();\n\t},\n\n\t/*\n\t**\tTransforms an string returned by the server to a local representation.\n\t*/\n\tfilterString: function (str, r)\n\t{\n\t\tif (!str || !('messages' in global))\n\t\t\treturn str;\n\n\t\tif (str.startsWith('@messages.'))\n\t\t{\n\t\t\tif (str.substr(10) in global.messages)\n\t\t\t\tstr = Template.eval(global.messages[str.substr(10)], r);\n\t\t}\n\n\t\treturn str;\n\t},\n\n\t_change: function(elem)\n\t{\n\t\tif ('createEvent' in document)\n\t\t{\n\t\t\tlet evt = document.createEvent('HTMLEvents');\n\t\t\tevt.initEvent('change', false, true);\n\t\t\telem.dispatchEvent(evt);\n\t\t}\n\t\telse\n\t\t\telem.fireEvent('onchange');\n\t},\n\n\t_setField: function (f, value, silent)\n\t{\n\t\tif (!f) return;\n\n\t\tfor (f of this.querySelectorAll('[data-field=\"'+f+'\"]'))\n\t\t{\n\t\t\tswitch (f.type || f.tagName.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'select':\n\t\t\t\t\tf.val = f.dataset.value = f.multiple ? (value ? value.split(',') : value) : value;\n\t\t\t\t\tf.value = f.val = f.dataset.value;\n\n\t\t\t\t\tif (silent !== true) this._change(f);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'checkbox':\n\t\t\t\t\tf.checked = parseInt(value) ? true : false;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'radio':\n\t\t\t\t\tf.checked = value == f.value;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'field':\n\t\t\t\t\tf.val = f.dataset.value = value;\n\t\t\t\t\tf.setValue(value);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'file':\n\t\t\t\t\tif ((value instanceof File) || (value instanceof Blob))\n\t\t\t\t\t{\n\t\t\t\t\t\tf.val = value;\n\t\t\t\t\t\tf.dataset.value = value;\n\t\t\t\t\t}\n\t\t\t\t\telse if (value instanceof FileList)\n\t\t\t\t\t{\n\t\t\t\t\t\tf.val = value;\n\t\t\t\t\t\tf.dataset.value = value;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tf.val = f.dataset.value = '';\n\t\t\t\t\t\tf.value = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tf.val = f.dataset.value = value;\n\t\t\t\t\tf.value = value;\n\n\t\t\t\t\tif (silent !== true) this._change(f);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t},\n\n\t_getField: function (f, _value=null, fromFileFields=false)\n\t{\n\t\tif (!f) return null;\n\n\t\tif (typeof(f) != 'string')\n\t\t{\n\t\t\tlet value = f.value == null ? f.val : f.value;\n\t\t\tif (value === null) value = _value;\n\n\t\t\tswitch (f.type || f.tagName.toLowerCase())\n\t\t\t{\n\t\t\t\tcase 'select':\n\t\t\t\t\t_value = f.multiple ? (value ? value.join(',') : value) : value;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'checkbox':\n\t\t\t\t\t_value = f.checked ? '1' : '0';\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'radio':\n\t\t\t\t\tif (f.checked) _value = f.value;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'field':\n\t\t\t\t\t_value = f.getValue();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'file':\n\t\t\t\t\t_value = fromFileFields ? (f.files && f.files.length ? (f.multiple ? f.files : f.files[0]) : null) : f.val;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t_value = value;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn _value === null ? '' : _value;\n\t\t}\n\n\t\t_value = null;\n\n\t\tfor (f of this.querySelectorAll('[data-field=\"'+f+'\"]'))\n\t\t\t_value = this._getField(f, _value);\n\n\t\treturn _value === null ? '' : _value;\n\t},\n\n\tgetField: function (name)\n\t{\n\t\treturn this._getField(name);\n\t},\n\n\tclearMarkers: function ()\n\t{\n\t\tthis.classList.remove('busy');\n\n\t\tthis.querySelectorAll('.message').forEach(i => i.classList.add('x-hidden') );\n\t\tthis.querySelectorAll('span.field-error').forEach(i => i.remove());\n\n\t\tthis.querySelectorAll('.field-error').forEach(i => { i.classList.remove('field-error'); i.classList.remove('is-invalid'); });\n\t\tthis.querySelectorAll('.field-passed').forEach(i => i.classList.remove('field-passed'));\n\t},\n\n\t_fieldChanged: function (evt)\n\t{\n\t\tlet f = evt.source;\n\n\t\tif (f.type == 'file')\n\t\t\tthis.model.set (f.dataset.field, this._getField(f, null, true), true);\n\t\telse\n\t\t\tthis.model.set (f.dataset.field, this._getField(f));\n\n\t\tevt.continuePropagation = true;\n\t},\n\n\tonModelPropertyChanged: function (evt, args)\n\t{\n\t\tthis._setField (args.name, args.value);\n\t},\n\n\t_onSuccess: function(r)\n\t{\n\t\tthis.classList.remove('busy');\n\t\tlet tmp;\n\n\t\tthis.dispatch ('formSuccess', r);\n\n\t\tif (r.message && (tmp = this.querySelector('.message.success')) != null)\n\t\t{\n\t\t\ttmp.innerHTML = this.filterString(r.message, r).replace(/\\n/g, '<br/>');\n\t\t\ttmp.classList.remove('x-hidden');\n\t\t\ttmp.onanimationend = () => tmp.classList.add('x-hidden');\n\t\t}\n\t},\n\n\t_onFailure: function(r)\n\t{\n\t\tthis.classList.remove('busy');\n\t\tlet tmp;\n\n\t\tthis.dispatch ('formError', r);\n\n\t\tif (r.fields)\n\t\t{\n\t\t\tfor (let i in r.fields)\n\t\t\t{\n\t\t\t\tlet f = this.querySelector('[data-field-container=\"'+i+'\"]');\n\t\t\t\tif (!f)\n\t\t\t\t{\n\t\t\t\t\tf = this.querySelector('[data-field=\"'+i+'\"]');\n\t\t\t\t\tif (!f) continue;\n\t\t\t\t}\n\n\t\t\t\tlet tmp = document.createElement('span');\n\t\t\t\ttmp.classList.add('field-error');\n\t\t\t\ttmp.innerHTML = this.filterString(r.fields[i], r).replace(/\\n/g, '<br/>');\n\n\t\t\t\tf.classList.add('field-error');\n\t\t\t\tf.classList.add('is-invalid');\n\n\t\t\t\tif (this.dataset.errorsAt == 'bottom')\n\t\t\t\t\tf.parentElement.append(tmp);\n\t\t\t\telse if (this.dataset.errorsAt == 'top')\n\t\t\t\t\tf.parentElement.prepend(tmp);\n\t\t\t\telse\n\t\t\t\t\tf.parentElement.insertBefore(tmp, f.nextElementSibling);\n\n\t\t\t\tsetTimeout((function (tmp) { return function() { tmp.classList.add('active'); } })(tmp), 25);\n\t\t\t}\n\n\t\t\tif (r.error && (tmp = this.querySelector('.message.error')) != null)\n\t\t\t{\n\t\t\t\ttmp.innerHTML = this.filterString(r.error, r).replace(/\\n/g, '<br/>');\n\t\t\t\ttmp.classList.remove('x-hidden');\n\t\t\t\ttmp.onanimationend = () => tmp.classList.add('x-hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif ((tmp = this.querySelector('.message.error')) != null)\n\t\t\t{\n\t\t\t\ttmp.innerHTML = this.filterString(r.error, r).replace(/\\n/g, '<br/>') || ('Error: ' + r.response);\n\t\t\t\ttmp.classList.remove('x-hidden');\n\t\t\t\ttmp.onanimationend = () => tmp.classList.add('x-hidden');\n\t\t\t}\n\t\t}\n\t},\n\n\treset: function (nsilent)\n\t{\n\t\tthis.model.reset (nsilent);\n\t\tthis.clearMarkers();\n\n\t\tif (nsilent === false)\n\t\t{\n\t\t\tfor (var i in this.model.data)\n\t\t\t\tthis._setField (i, this.model.data[i], true);\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tsubmit: function ()\n\t{\n\t\tif (this.classList.contains('busy'))\n\t\t\treturn;\n\n\t\tlet data = { };\n\n\t\tif (this.dataset.strict == 'false')\n\t\t\tObject.assign(data, this.model.get());\n\n\t\tlet list = { };\n\t\tthis.querySelectorAll('[data-field]').forEach(e => list[e.dataset.field] = true);\n\t\tObject.keys(list).forEach(f => data[f] = this._getField(f));\n\n\t\tthis.model.set(data);\n\n\t\tlet f = this.dataset.formAction || this.formAction;\n\t\tif (!f) return;\n\n\t\tthis.clearMarkers();\n\n\t\tthis.classList.add('busy');\n\n\t\tif (typeof(f) != 'function')\n\t\t{\n\t\t\tdata.f = f;\n\t\t\tApi.apiCall(data, (r) => this[r.response == 200 ? '_onSuccess' : '_onFailure'](r), (r) => this._onFailure({ error: 'Unable to execute request.' }), this.dataset.method ?? 'POST');\n\t\t}\n\t\telse\n\t\t\tf(data, (r) => this[r.response == 200 ? '_onSuccess' : '_onFailure'](r));\n\t}\n});\n","/*\n**\telems/r-panel\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-panel data-route=\"name\">\n\t</r-panel>\n\n\tr-panel {\n\t\tdisplay: block;\n\t}\n\n\tr-panel:not(.active) {\n\t\tdisplay: none;\n\t}\n\n*/\n\nimport Element from '../element.js';\nimport Router from '../router.js';\n\nexport default Element.register ('r-panel',\n{\n\t/**\n\t**\tRoute object used by this element.\n\t*/\n\troute: null,\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.style.display = '';\n\n\t\t// Executed then the panel route is activated.\n\t\tthis._onActivate = (evt, args) =>\n\t\t{\n\t\t\tif (!args.route.changed)\n\t\t\t\treturn;\n\n\t\t\tthis.show(true);\n\t\t};\n\n\t\t// Executed then the panel route is deactivated.\n\t\tthis._onDeactivate = (evt, args) =>\n\t\t{\n\t\t\tthis.hide();\n\t\t};\n\n\t\tthis.hide();\n\t},\n\n\t/**\n\t**\tAdds a handler to Router if the data-route attribute was set.\n\t*/\n\tonConnected: function()\n\t{\n\t\tif (this.dataset.route)\n\t\t{\n\t\t\tthis.route = Router.addRoute (this.dataset.route, this._onActivate, this._onDeactivate);\n\t\t\tthis.classList.remove('active');\n\t\t}\n\t\telse\n\t\t\tthis.classList.add('active');\n\t},\n\n\t/**\n\t**\tRemoves a handler previously added to Router if the data-route attribute was set.\n\t*/\n\tonDisconnected: function()\n\t{\n\t\tif (this.dataset.route)\n\t\t\tRouter.removeRoute(this.dataset.route, this._onActivate, this._onDeactivate);\n\t},\n\n\t/**\n\t**\tHides the panel by removing the `active` class from the element. Fires `panelHidden` event.\n\t*/\n\thide: function ()\n\t{\n\t\tthis.classList.remove('active');\n\t\tthis.dispatch('panelHidden', this.route ? this.route.args : { });\n\t},\n\n\t/**\n\t**\tShows the panel visible by adding `active` class to the element. If `silent` is true and `data-route` enabled, the current route\n\t**\twill not be updated. Fires `panelShown` event.\n\t*/\n\tshow: function (silent=false)\n\t{\n\t\tif (this.dataset.route && !silent)\n\t\t{\n\t\t\tlet hash = \"#\" + this.dataset.route;\n\n\t\t\tif (window.location.hash.substr(0, hash.length) != hash)\n\t\t\t{\n\t\t\t\twindow.location = hash;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.classList.add('active');\n\t\tthis.dispatch('panelShown', this.route ? this.route.args : { });\n\t}\n});\n","/*\n**\telems/r-list\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-list data-list=\"window.dataList1\" data-container=\".x-data\" data-wrap=\"true|false\">\n\n\t\t<template data-mode=\"static|dynamic\">\n\t\t</template>\n\n\t\t<div class=\"x-empty\">\n\t\t\tNothing to show.\n\t\t</div>\n\n\t\t<div class=\"x-data\">\n\t\t</div>\n\n\t</r-list>\n\n\tCSS:\n\t\t.x-hidden {\n\t\t\tdisplay: none;\n\t\t}\n\n\tModifiers:\n\t\t.x-empty-null\t\tVisible when the list is in undefined state (before first load).\n\t\t.x-empty\t\t\tVisible when there is no data in the list.\n\t\t.x-not-empty \t\tVisible when there is data in the list.\n\t\t.x-loading \t\t\tVisible when the list is loading.\n*/\n\nimport { Rinn, ModelList, Template } from 'rinn';\nimport Element from '../element.js';\n\n/*\n**\tConnects to a ModelList and renders its contents using a template. When using \"dynamic\" template, the contents can be other custom elements, and\n**\tthe model of each item can be accessed by using data-model=\":list-item\", which will cause the item model to be added to the element.\n**\n**\tAdditionally root attribute data-wrap can be set to 'true' to wrap the template contents inside a div with a data-iid representing the ID of the\n**\titem, this will cause any changes to items to affect only the specific item in question.\n*/\n\nexport default Element.register ('r-list',\n{\n\tlist: null,\n\n\tcontainer: null,\n\ttemplate: null,\n\tisEmpty: false,\n\tisDynamicTemplate: false,\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tthis.container = this.querySelector(this.dataset.container || '.x-data');\n\t\tif (!this.container)\n\t\t{\n\t\t\tthis.container = document.createElement('div');\n\t\t\tthis.container.className = 'x-data';\n\t\t\tthis.appendChild(this.container);\n\t\t}\n\n\t\tlet tmp = this.template_elem = this.querySelector('template');\n\t\tif (tmp)\n\t\t{\n\t\t\tif (tmp.dataset.mode != 'dynamic')\n\t\t\t{\n\t\t\t\tthis.template = Template.compile(tmp.innerHTML);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.template = () => tmp.innerHTML;\n\t\t\t\tthis.isDynamicTemplate = true;\n\t\t\t}\n\n\t\t\ttmp.remove();\n\t\t}\n\t\telse\n\t\t\tthis.template = () => '';\n\n\t\tthis.container.textContent = ' ';\n\n\t\tthis.setEmpty(null);\n\t\tthis.setLoading(null);\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet list = this.getFieldByPath(this.dataset.list);\n\t\tif (!list)\n\t\t{\n\t\t\tconsole.error('List not found: ' + this.dataset.list);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setList (list);\n\t},\n\n\t/*\n\t**\tIndicates if the list is empty. Elements having x-empty, x-not-empty and x-empty-null will be updated.\n\t*/\n\tsetEmpty: function (value)\n\t{\n\t\tif (this.isEmpty === value)\n\t\t\treturn;\n\n\t\tif (value === true)\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-empty-null').forEach(i => i.classList.add('x-hidden'));\n\t\t}\n\t\telse if (value === false)\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-empty-null').forEach(i => i.classList.add('x-hidden'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-empty-null').forEach(i => i.classList.remove('x-hidden'));\n\t\t}\n\n\t\tthis.isEmpty = value;\n\t},\n\n\t/*\n\t**\tIndicates if the list is loading. Elements having x-loading will be updated.\n\t*/\n\tsetLoading: function (value)\n\t{\n\t\tif (value === true)\n\t\t\tthis.querySelectorAll('.x-loading').forEach(i => i.classList.remove('x-hidden'));\n\t\telse\n\t\t\tthis.querySelectorAll('.x-loading').forEach(i => i.classList.add('x-hidden'));\n\t},\n\n\t/**\n\t**\tSets the list model-list of the element.\n\t*/\n\tsetList: function (list)\n\t{\n\t\tif (!list || !Rinn.isInstanceOf(list, ModelList) || this.list === list)\n\t\t\treturn;\n\n\t\tif (this.list != null)\n\t\t{\n\t\t\tif (this.list.dataSource)\n\t\t\t\tthis.list.dataSource.removeEventListener (this.eid+':*');\n\n\t\t\tif (this.list.dataList)\n\t\t\t\tthis.list.dataList.removeEventListener (this.eid+':*');\n\n\t\t\tthis.list.removeEventListener (this.eid+':*');\n\t\t}\n\n\t\tthis.list = list;\n\n\t\tif (this.list.dataSource)\n\t\t{\n\t\t\tthis.list.dataSource.addEventListener (this.eid+':listLoading', this.onLoading, this);\n\t\t\tthis.list.dataSource.addEventListener (this.eid+':listLoaded', this.onLoaded, this);\n\t\t}\n\n\t\tif (this.list.dataList)\n\t\t{\n\t\t\tthis.list.dataList.addEventListener (this.eid+':listLoading', this.onLoading, this);\n\t\t\tthis.list.dataList.addEventListener (this.eid+':listLoaded', this.onLoaded, this);\n\t\t}\n\n\t\tthis.list.addEventListener (this.eid+':itemsCleared', this.onItemsCleared, this);\n\t\tthis.list.addEventListener (this.eid+':itemsChanged', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemRemoved', this.onItemRemoved, this);\n\t\tthis.list.addEventListener (this.eid+':itemChanged', this.onItemChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemAdded', this.onItemAdded, this);\n\t},\n\n\t/*\n\t**\tBuilds an item (inside a div) to be added to the container.\n\t*/\n\tbuildItem: function (iid, data, asHtml=false)\n\t{\n\t\tlet html = this.template(data.get());\n\t\tif (asHtml) return html;\n\n\t\tlet elem = document.createElement('div');\n\t\t\n\t\telem.dataset.iid = iid;\n\t\telem.innerHTML = html;\n\n\t\telem.querySelectorAll('[data-model=\":list-item\"]').forEach(i => {\n\t\t\ti.model = data;\n\t\t\ti.dataset.model = \"this.model\";\n\t\t});\n\n\t\tfor (let attr of this.template_elem.attributes)\n\t\t{\n\t\t\tif (attr.nodeName.startsWith('data-_') || attr.nodeName == 'data-mode')\n\t\t\t\tcontinue;\n\n\t\t\telem.setAttribute(attr.nodeName, attr.nodeValue);\n\t\t}\n\n\t\treturn elem;\n\t},\n\n\t/*\n\t**\tExecuted when the list is loading.\n\t*/\n\tonLoading: function()\n\t{\n\t\tthis.setLoading(true);\n\t},\n\n\t/*\n\t**\tExecuted when the list finished loading.\n\t*/\n\tonLoaded: function()\n\t{\n\t\tthis.setLoading(false);\n\t},\n\n\t/*\n\t**\tExecuted when the list is cleared.\n\t*/\n\tonItemsCleared: function()\n\t{\n\t\tthis.container._timeout = setTimeout(() => {\n\t\t\tthis.setEmpty(true);\n\t\t\tthis.container._timeout = null;\n\t\t\tthis.container.textContent = '';\n\t\t}, 300);\n\t},\n\n\t/*\n\t**\tExecuted when the items of the list changed.\n\t*/\n\tonItemsChanged: function()\n\t{\n\t\tif (this.list.length() == 0)\n\t\t\treturn;\n\n\t\tif (this.container._timeout)\n\t\t\tclearTimeout(this.container._timeout);\n\n\t\tthis.container._timeout = null;\n\t\tthis.container.textContent = '';\n\n\t\tlet i = 0;\n\n\t\tfor (let data of this.list.getData())\n\t\t{\n\t\t\tif (this.dataset.wrap != 'false')\n\t\t\t\tthis.container.append(this.buildItem(this.list.itemId[i++], data));\n\t\t\telse\n\t\t\t\tthis.container.innerHTML += this.buildItem(this.list.itemId[i++], data, true);\n\t\t}\n\n\t\tthis.setEmpty(i == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item is removed from the list.\n\t*/\n\tonItemRemoved: function(evt, args)\n\t{\n\t\tif (this.dataset.wrap == 'false')\n\t\t{\n\t\t\tthis.onItemsChanged();\n\t\t\treturn;\n\t\t}\n\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\telem.remove();\n\t\tthis.setEmpty(this.list.length() == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item changes.\n\t*/\n\tonItemChanged: function(evt, args)\n\t{\n\t\tif (this.isDynamicTemplate) return;\n\n\t\tif (this.dataset.wrap == 'false')\n\t\t{\n\t\t\tthis.onItemsChanged();\n\t\t\treturn;\n\t\t}\n\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\telem.innerHTML = this.template(args.item);\n\t},\n\n\t/*\n\t**\tExecuted when an item is added to the list.\n\t*/\n\tonItemAdded: function(evt, args)\n\t{\n\t\tif (args.position == 'head')\n\t\t{\n\t\t\tif (this.dataset.wrap != 'false')\n\t\t\t\tthis.container.prepend(this.buildItem(args.id, args.item));\n\t\t\telse\n\t\t\t\tthis.container.innerHTML = this.buildItem(args.id, args.item, true) + this.container.innerHTML;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.dataset.wrap != 'false')\n\t\t\t\tthis.container.append(this.buildItem(args.id, args.item));\n\t\t\telse\n\t\t\t\tthis.container.innerHTML += this.buildItem(args.id, args.item, true);\n\t\t}\n\n\t\tthis.setEmpty(false);\n\t},\n\n\t/**\n\t * \tForces re-rendering of the element.\n\t */\n\trefresh: function()\n\t{\n\t\tthis.onItemsChanged();\n\t}\n});\n","/*\n**\telems/r-item\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-item data-model=\"window.model1\">\n\t</r-item>\n*/\n\nimport Element from '../element.js';\n\nexport default Element.register ('r-item',\n{\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t},\n\n\t/**\n\t**\tExecuted when the children and root are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet model = this.getFieldByPath(this.dataset.model);\n\t\tif (!model) model = { };\n\n\t\tthis.setModel (model);\n\t}\n});\n","/*\n**\telems/r-paginator\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-paginator data-source=\"window.dataSource1\" data-page-size=\"25\">\n\t\t<span data-watch=\"count\">Showing [offsetStart] to [offsetEnd] out of [count]</span>\n\n\t\t<button data-action=\"firstPage\">First</button>\n\t\t<button data-action=\"prevPage\">&laquo;</button>\n\t\t<button data-action=\"nextPage\">&raquo;</button>\n\t\t<button data-action=\"lastPage\">Last</button>\n\t\t<button data-action=\"refresh\">Refresh</button>\n\n\t\t<input type=\"text\" data-property=\"pageSize\" />\n\t</r-paginator>\n*/\n\nimport { Rinn } from 'rinn';\nimport Element from '../element.js';\nimport DataSource from '../data-source.js';\n\n/*\n**\tConnects to a data source to provide pagination features.\n*/\n\nexport default Element.register ('r-paginator',\n{\n\tsource: null,\n\ttemplate: null,\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.setModel({\n\t\t\toffsetStart: 0,\n\t\t\toffsetEnd: 0,\n\t\t\tcount: 0, offset: 0,\n\t\t\tcurrentPageSize: this.dataset.pageSize || 25,\n\t\t\tpageSize: this.dataset.pageSize || 25\n\t\t});\n\n\t\tthis.listen('propertyChanged.pageSize', (evt, args) =>\n\t\t{\n\t\t\tif (this.model.get('currentPageSize') == args.value)\n\t\t\t\treturn;\n\n\t\t\tthis.model.set('currentPageSize', args.value);\n\t\t\tthis.updateOffset('range');\n\t\t});\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet source = this.getFieldByPath(this.dataset.source);\n\t\tif (!source)\n\t\t{\n\t\t\tconsole.error('data-source not found: ' + this.dataset.source);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setSource(source);\n\t},\n\n\t/**\n\t**\tSets the source model-list of the paginator.\n\t*/\n\tsetSource: function (source)\n\t{\n\t\tif (!source || !Rinn.isInstanceOf(source, DataSource) || this.source === source)\n\t\t\treturn;\n\n\t\tif (this.source != null)\n\t\t{\n\t\t\tthis.source.removeEventListener (this.eid+':*');\n\t\t\tthis.source.includeCount = false;\n\t\t}\n\n\t\tthis.source = source;\n\n\t\tthis.source.includeCount = true;\n\t\tthis.updateOffset();\n\n\t\tthis.source.addEventListener (this.eid+':requestPropertyChanged', this.onRequestPropertyChanged, this);\n\t\tthis.source.addEventListener (this.eid+':countChanged', this.onCountChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemRemoved', this.onItemRemoved, this);\n\t\tthis.source.addEventListener (this.eid+':listItemAdded', this.onItemAdded, this);\n\n\t\tthis.source.setNamespace(this.eid);\n\t\tthis.source.request.update(true);\n\t\tthis.source.setNamespace(null);\n\t},\n\n\t/*\n\t**\tUpdates several offset related fields in the paginator model. Optionally refreshes the data source with the specified mode.\n\t*/\n\tupdateOffset: function(mode=null)\n\t{\n\t\tthis.model.set('offsetStart', this.model.get('count') != 0 ? this.model.get('offset') + 1 : 0);\n\t\tthis.model.set('offsetEnd', Math.min(this.model.get('count'), this.model.get('offsetStart') + this.model.getInt('pageSize') - 1));\n\t\tthis.model.update('count');\n\n\t\tlet _count = this.source.request.get('count');\n\t\tlet _offset = this.source.request.get('offset');\n\n\t\tthis.source.request.set('count', this.model.getInt('pageSize'));\n\t\tthis.source.request.set('offset', this.model.get('offset'));\n\n\t\tif (mode && (_count != this.source.request.get('count') || _offset != this.source.request.get('offset')))\n\t\t\tthis.source.refresh(mode);\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the source request changes. The property is copied to the local model.\n\t*/\n\tonRequestPropertyChanged: function(evt, args)\n\t{\n\t\tif (args.name == 'count' || args.name == 'offset')\n\t\t\treturn;\n\n\t\tthis.model.set(args.name, args.value);\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the model has changed. The property is copied to the data source request model.\n\t*/\n\tonModelPropertyChanged: function (evt, args)\n\t{\n\t\tlet ignored = [\n\t\t\t'offsetStart',\n\t\t\t'offsetEnd',\n\t\t\t'count',\n\t\t\t'offset',\n\t\t\t'currentPageSize',\n\t\t\t'pageSize'\n\t\t];\n\n\t\tif (ignored.indexOf(args.name) != -1)\n\t\t\treturn;\n\n\t\tif (this.source.request.get(args.name) == args.value)\n\t\t\treturn;\n\n\t\tthis.source.request.set(args.name, args.value);\n\t\tthis.source.refresh('filter');\n\t},\n\n\t/*\n\t**\tExecuted when the remote count changes.\n\t*/\n\tonCountChanged: function(evt, args)\n\t{\n\t\tthis.model.set('count', evt.source.count, false);\n\t\tthis.updateOffset();\n\t},\n\n\t/*\n\t**\tExecuted when an item is removed from the list.\n\t*/\n\tonItemRemoved: function(evt, args)\n\t{\n\t\tthis.model.set('count', this.model.getInt('count') - 1, false);\n\t\tthis.updateOffset();\n\t},\n\n\t/*\n\t**\tExecuted when an item is added to the list.\n\t*/\n\tonItemAdded: function(evt, args)\n\t{\n\t\tthis.model.set('count', this.model.getInt('count') + 1, false);\n\t\tthis.updateOffset();\n\t},\n\n\t/*\n\t**\tMoves to the previous page.\n\t*/\n\tprevPage: function()\n\t{\n\t\tif (this.model.get('offset') <= 0)\n\t\t\treturn;\n\n\t\tlet offs = this.model.get('offset') - this.model.getInt('pageSize');\n\t\tif (offs < 0) offs = 0;\n\n\t\tthis.model.set('offset', offs);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tMoves to the next page.\n\t*/\n\tnextPage: function()\n\t{\n\t\tlet offs = this.model.get('offset') + this.model.getInt('pageSize');\n\t\tif (offs >= this.model.get('count')) return;\n\n\t\tthis.model.set('offset', offs);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tMoves to the first page.\n\t*/\n\tfirstPage: function()\n\t{\n\t\tthis.model.set('offset', 0);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tMoves to the last page.\n\t*/\n\tlastPage: function()\n\t{\n\t\tlet offs = this.model.get('count') - this.model.getInt('pageSize');\n\t\tif (offs < 0) offs = 0;\n\n\t\tthis.model.set('offset', offs);\n\t\tthis.updateOffset('range');\n\t},\n\n\t/*\n\t**\tRefreshes the data source.\n\t*/\n\trefresh: function()\n\t{\n\t\tthis.source.refresh('full');\n\t},\n\n\t/*\n\t**\tClears (set to empty) the specified fields from the data source's request parameters.\n\t*/\n\tclear: function(args)\n\t{\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t\tthis.model.set(args[i], '');\n\t}\n});\n","/*\n**\telems/r-table\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-table data-source=\"window.dataSource1\">\n\t\t<table>\n\t\t\t<thead>\n\t\t\t\t<tr>\n\t\t\t\t\t<th>A</th>\n\t\t\t\t\t<th>B</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\n\t\t\t<tbody class=\"x-data\">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>[a]</td>\n\t\t\t\t\t<td>[b]</td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</r-table>\n\n\tCSS:\n\t\t.x-hidden {\n\t\t\tdisplay: none;\n\t\t}\n\n\t\tth[data-sort] {\n\t\t\tcursor: pointer; text-decoration: underline;\n\t\t}\n\n\t\tth[data-sort][data-order=\"asc\"]:before {\n\t\t\tcontent: \"\\25B2\";\n\t\t}\n\n\t\tth[data-sort][data-order=\"desc\"]:before {\n\t\t\tcontent: \"\\25BC\";\n\t\t}\n\n\tModifiers:\n\t\t.x-empty\t\t\tAdd to elements that should be shown only when there is no data in the data source.\n\t\t.x-not-empty \t\tAdd to elements that should be shown only when there is data in the data source.\n\t\t[data-sort]\t\t\tAdded to th/td elements in thead, marks the column as sortable.\n*/\n\nimport { Rinn, Template } from 'rinn';\nimport Element from '../element.js';\nimport DataSource from '../data-source.js';\n\n/*\n**\tConnects to a DataSource and renders its contents as a table.\n*/\n\nexport default Element.register ('r-table',\n{\n\tsource: null,\n\ttemplate: null,\n\tcontainer: null,\n\tisEmpty: null,\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.setModel({ });\n\t},\n\n\t/**\n\t**\tExecuted when the children of the element are ready.\n\t*/\n\tready: function()\n\t{\n\t\tthis.container = this.querySelector(this.dataset.container || 'tbody.x-data');\n\t\tif (!this.container) throw new Error ('r-table requires a container');\n\n\t\tif (this.container.dataset.mode != 'dynamic')\n\t\t\tthis.template = Template.compile(this.container.innerHTML);\n\t\telse\n\t\t\tthis.template = () => this.container.innerHTML;\n\n\t\tthis.temporalBody = document.createElement('tbody');\n\t\tthis.container.textContent = ' ';\n\n\t\tthis.setEmpty(true);\n\t},\n\n\t/**\n\t**\tExecuted when the children and root elements are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet source = this.getFieldByPath(this.dataset.source);\n\t\tif (!source)\n\t\t{\n\t\t\tconsole.error('data-source not found: ' + this.dataset.source);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setSource (source);\n\t},\n\n\t/*\n\t**\tIndicates if the table is empty. Elements having .x-not-empty will be hidden.\n\t*/\n\tsetEmpty: function (value)\n\t{\n\t\tif (this.isEmpty === value)\n\t\t\treturn;\n\n\t\tif (value)\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.querySelectorAll('.x-empty').forEach(i => i.classList.add('x-hidden'));\n\t\t\tthis.querySelectorAll('.x-not-empty').forEach(i => i.classList.remove('x-hidden'));\n\t\t}\n\n\t\tthis.isEmpty = value;\n\t},\n\n\t/**\n\t**\tSets the data source of the element.\n\t*/\n\tsetSource: function (source)\n\t{\n\t\tif (!source || !Rinn.isInstanceOf(source, DataSource) || this.source === source)\n\t\t\treturn;\n\n\t\tif (this.source != null)\n\t\t\tthis.source.removeEventListener (this.eid+':*');\n\n\t\tthis.source = source;\n\n\t\tthis.source.addEventListener (this.eid+':requestPropertyChanged', this.onRequestPropertyChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemsCleared', this.onItemsCleared, this);\n\t\tthis.source.addEventListener (this.eid+':listItemsChanged', this.onItemsChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemRemoved', this.onItemRemoved, this);\n\t\tthis.source.addEventListener (this.eid+':listItemChanged', this.onItemChanged, this);\n\t\tthis.source.addEventListener (this.eid+':listItemAdded', this.onItemAdded, this);\n\n\t\tthis.source.setNamespace(this.eid);\n\t\tthis.source.request.update(true);\n\t\tthis.source.setNamespace(null);\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the source request changes. The property is copied to the local model.\n\t*/\n\tonRequestPropertyChanged: function(evt, args)\n\t{\n\t\tthis.model.set(args.name, args.value);\n\n\t\tif (args.name == 'sort')\n\t\t{\n\t\t\tthis.querySelectorAll('thead [data-sort]').forEach(i => i.dataset.order = '');\n\t\t}\n\t\telse if (args.name == 'order')\n\t\t{\n\t\t\tlet elem = this.querySelector('thead [data-sort=\"'+evt.source.get('sort')+'\"]');\n\t\t\tif (elem) elem.dataset.order = args.value;\n\t\t}\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the model has changed. The property is copied to the data source request model.\n\t*/\n\tonModelPropertyChanged: function (evt, args)\n\t{\n\t\tif (this.source.request.get(args.name) == args.value)\n\t\t\treturn;\n\n\t\tthis.source.request.set(args.name, args.value);\n\n\t\tlet ignored = [\n\t\t\t'count',\n\t\t\t'offset'\n\t\t];\n\n\t\tif (ignored.indexOf(args.name) != -1)\n\t\t\treturn;\n\n\t\tthis.source.refresh('filter');\n\t},\n\n\t/*\n\t**\tEvent handler invoked when a property of the model is removed.\n\t*/\n\tonModelPropertyRemoved: function (evt, args)\n\t{\n\t\tif (typeof(args.fields) == 'string')\n\t\t\tthis.source.request.remove(i);\n\t\telse\n\t\t\targs.fields.forEach(i => this.source.request.remove(i));\n\n\t\tthis.source.refresh('filter');\n\t},\n\n\t/*\n\t**\tBuilds an item to be added to the container.\n\t*/\n\tbuildItem: function (iid, data)\n\t{\n\t\tlet elem = this.temporalBody;\n\n\t\telem.innerHTML = this.template(data.get());\n\n\t\telem.querySelectorAll('[data-model=\":list-item\"]').forEach(i => {\n\t\t\ti.model = data;\n\t\t\ti.dataset.model = \"this.model\";\n\t\t});\n\n\t\telem = elem.firstElementChild;\n\t\telem.dataset.iid = iid;\n\n\t\treturn elem;\n\t},\n\n\t/*\n\t**\tExecuted when the list is cleared.\n\t*/\n\tonItemsCleared: function(evt, args)\n\t{\n\t\tthis.container._timeout = setTimeout(() => {\n\t\t\tthis.setEmpty(true);\n\t\t\tthis.container._timeout = null;\n\t\t\tthis.container.textContent = '';\n\t\t}, 300);\n\t},\n\n\t/*\n\t**\tExecuted when the items of the list changed.\n\t*/\n\tonItemsChanged: function(evt, args)\n\t{\n\t\tif (this.source.list.length() == 0)\n\t\t\treturn;\n\n\t\tif (this.container._timeout)\n\t\t\tclearTimeout(this.container._timeout);\n\n\t\tthis.container._timeout = null;\n\t\tthis.container.textContent = '';\n\n\t\tlet i = 0;\n\n\t\tfor (let data of this.source.list.getData())\n\t\t\tthis.container.append(this.buildItem(this.source.list.itemId[i++], data));\n\n\t\tthis.setEmpty(i == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item is removed from the list.\n\t*/\n\tonItemRemoved: function(evt, args)\n\t{\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\telem.remove();\n\t\tthis.setEmpty(this.source.list.length() == 0);\n\t},\n\n\t/*\n\t**\tExecuted when an item changes.\n\t*/\n\tonItemChanged: function(evt, args)\n\t{\n\t\tlet elem = this.container.querySelector('[data-iid=\"'+args.id+'\"]');\n\t\tif (!elem) return;\n\n\t\tlet _elem = this.buildItem(args.id, args.item);\n\t\tthis.container.replaceChild(_elem, elem);\n\t},\n\n\t/*\n\t**\tExecuted when an item is added to the list.\n\t*/\n\tonItemAdded: function(evt, args)\n\t{\n\t\tif (args.position == 'head')\n\t\t\tthis.container.prepend(this.buildItem(args.id, args.item));\n\t\telse\n\t\t\tthis.container.append(this.buildItem(args.id, args.item));\n\n\t\tthis.setEmpty(false);\n\t},\n\n\t/*\n\t**\tHandles clicks to data-sort elements.\n\t*/\n\t\"event click thead [data-sort]\": function(evt, args)\n\t{\n\t\tif (this.source.request.get('sort') == evt.source.dataset.sort)\n\t\t{\n\t\t\tthis.source.request.set('order', this.source.request.get('order') == 'asc' ? 'desc' : 'asc');\n\t\t\tthis.source.refresh('order');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.source.request.set('sort', evt.source.dataset.sort);\n\t\t\tthis.source.request.set('order', 'asc', true);\n\t\t\tthis.source.refresh('order');\n\t\t}\n\t},\n\n\t/*\n\t**\tRefreshes the data source.\n\t*/\n\trefresh: function()\n\t{\n\t\tthis.source.refresh('full');\n\t},\n\n\t/*\n\t**\tClears (set to empty) the specified fields from the data source's request parameters.\n\t*/\n\tclear: function(args)\n\t{\n\t\tfor (let i = 0; i < args.length; i++)\n\t\t\tthis.model.set(args[i], '');\n\t}\n});\n","/*\n**\telems/r-select\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-select data-list=\"window.dataList1\" data-blank=\"\"></r-select>\n*/\n\nimport { Rinn, ModelList } from 'rinn';\nimport Element from '../element.js';\n\n/*\n**\tConnects to a ModelList and renders its contents as a <select> element.\n*/\n\nexport default Element.register ('r-select',\n{\n\tlist: null,\n\tcontainer: null,\n\n\tvalue: '',\n\n\t/**\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.container = document.createElement('select');\n\t\tthis.parentElement.insertBefore(this.container, this);\n\n\t\tlet list = [];\n\n\t\tfor (let attr of this.attributes)\n\t\t{\n\t\t\tif (attr.nodeName.startsWith('data-_') || attr.nodeName == 'data-list' || attr.nodeName == 'data-blank')\n\t\t\t\tcontinue;\n\n\t\t\tthis.container.setAttribute(attr.nodeName, attr.nodeValue);\n\t\t\tlist.push(attr.nodeName);\n\t\t}\n\n\t\tlist.forEach(i => this.removeAttribute(i));\n\n\t\tthis.textContent = ' ';\n\t\tthis.style.display = 'none';\n\t},\n\n\t/**\n\t**\tExecuted when the children and parent of the element are ready.\n\t*/\n\trready: function()\n\t{\n\t\tlet list = this.getFieldByPath(this.dataset.list);\n\t\tif (!list)\n\t\t{\n\t\t\tconsole.error('List not found: ' + this.dataset.list);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setList(list);\n\n\t\tif (this.parentElement.lastElementChild !== this)\n\t\t\tthis.parentElement.append(this);\n\t},\n\n\t/**\n\t**\tSets the list model-list of the element.\n\t*/\n\tsetList: function (list)\n\t{\n\t\tif (!list || !Rinn.isInstanceOf(list, ModelList) || this.list === list)\n\t\t\treturn;\n\n\t\tif (this.list != null)\n\t\t\tthis.list.removeEventListener (this.eid+':*');\n\n\t\tthis.list = list;\n\n\t\tif (this.list.dataSource)\n\t\t\tthis.list.dataSource.includeEnum = true;\n\n\t\tthis.list.addEventListener (this.eid+':itemsCleared', this.onItemsCleared, this);\n\t\tthis.list.addEventListener (this.eid+':itemsChanged', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemRemoved', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemChanged', this.onItemsChanged, this);\n\t\tthis.list.addEventListener (this.eid+':itemAdded', this.onItemsChanged, this);\n\n\t\tthis.onItemsChanged();\n\t},\n\n\t/*\n\t**\tExecuted when the list is cleared.\n\t*/\n\tonItemsCleared: function(evt, args)\n\t{\n\t\tthis.container.textContent = '';\n\t},\n\n\t/*\n\t**\tExecuted when the items of the list changed.\n\t*/\n\tonItemsChanged: function(evt, args)\n\t{\n\t\tif (this.list.length() == 0)\n\t\t\treturn;\n\n\t\tlet list = this.list.getData();\n\t\tlet value, label, s = '';\n\n\t\tif (list[0].has('value')) value = 'value';\n\t\telse if (list[0].has('id')) value = 'id';\n\n\t\tif (list[0].has('label')) label = 'label';\n\t\telse if (list[0].has('name')) label = 'name';\n\n\t\tif ('blank' in this.dataset)\n\t\t\ts += '<option value=\"\">'+this.dataset.blank+'</option>';\n\n\t\tif (list[0].has('group'))\n\t\t{\n\t\t\tlet groups = { };\n\t\t\tlist.forEach(i => groups[i.get('group')] = null);\n\n\t\t\tfor (let i in groups)\n\t\t\t\tgroups[i] = { name: i, list: [] };\n\n\t\t\tlist.forEach(i => groups[i.get('group')].list.push(i));\n\n\t\t\tgroups = Object.values(groups);\n\t\t\tgroups.forEach(g => {\n\t\t\t\ts += '<optgroup label=\"'+g.name+'\">';\n\t\t\t\tg.list.forEach(i => s += '<option value=\"'+i.get(value)+'\">'+i.get(label)+'</option>');\n\t\t\t\ts += '</optgroup>';\n\t\t\t});\n\t\t}\n\t\telse\n\t\t\tlist.forEach(i => s += '<option value=\"'+i.get(value)+'\">'+i.get(label)+'</option>');\n\n\t\tthis.container.innerHTML = s;\n\t\tthis.container.value = this.container.dataset.value;\n\t},\n\n\t/**\n\t * \tForces re-rendering of the element.\n\t */\n\trefresh: function()\n\t{\n\t\tthis.onItemsChanged();\n\t}\n});\n","\nconst Utils =\n{\n\t/**\n\t**\tForces the browser to show a download dialog.\n\t*/\n\tshowDownload: function (filename, dataUrl)\n\t{\n\t\tvar link = document.createElement(\"a\");\n\t\tlink.href = dataUrl;\n\n\t\tlink.style.display = 'none';\n\t\tlink.download = filename;\n\t\tlink.target = \"_blank\";\n\n\t\tdocument.body.appendChild(link);\n\t\tlink.click();\n\t\tdocument.body.removeChild(link);\n\t},\n\n\t/**\n\t**\tForces the browser to show a file selection dialog.\n\t*/\n\tshowFilePicker: function (allowMultiple, accept, callback)\n\t{\n\t\tvar input = document.createElement(\"input\");\n\n\t\tinput.type = \"file\";\n\t\tinput.accept = accept;\n\t\tinput.style.display = 'none';\n\t\tinput.multiple = allowMultiple;\n\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.onchange = function () {\n\t\t\tcallback(input.files);\n\t\t};\n\n\t\tdocument.body.onfocus = function ()\n\t\t{\n\t\t\tdocument.body.onfocus = null;\n\t\t\tdocument.body.removeChild(input);\n\t\t};\n\n\t\tinput.click();\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as a dataURL.\n\t*/\n\tloadAsDataUrl: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result, null);\n\t\t};\n\n\t\treader.onerror = function(e) {\n\t\t\tcallback (null, e);\n\t\t};\n\n\t\treader.readAsDataURL(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as text.\n\t*/\n\tloadAsText: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsText(file);\n\t},\n\n\t/**\n\t**\tLoads a URL using FileReader and returns as an array buffer.\n\t*/\n\tloadAsArrayBuffer: function (file, callback)\n\t{\n\t\tvar reader = new FileReader();\n\n\t\treader.onload = function(e) {\n\t\t\tcallback (e.target.result);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file);\n\t},\n\n\t/**\n\t**\tLoads an array of URLs using FileReader and returns them as data url.\n\t*/\n\tloadAllAsDataUrl: function (fileList, callback)\n\t{\n\t\tvar result = [];\n\n\t\tif (!fileList || !fileList.length)\n\t\t{\n\t\t\tcallback(result);\n\t\t\treturn;\n\t\t}\n\n\t\tvar loadNext = function (i)\n\t\t{\n\t\t\tif (i == fileList.length)\n\t\t\t{\n\t\t\t\tcallback(result);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tUtils.loadAsDataUrl (fileList[i], function(url, err) {\n\t\t\t\tif (!err) {\n\t\t\t\t\tresult.push({ name: fileList[i].name, size: fileList[i].size, url: url });\n\t\t\t\t}\n\t\t\t\tloadNext(i+1);\n\t\t\t});\n\t\t};\n\n\t\tloadNext(0);\n\t},\n\n\t/*\n\t**\tLoads a URL as an image.\n\t*/\n\tloadImageFromUrl: function (url, callback)\n\t{\n\t\tlet image = new Image();\n\t\timage.onload = () => callback(image);\n\t\timage.onerror = () => callback(null);\n\t\timage.src = url;\n\t}\n};\n\nexport default Utils;\n","/*\n**\telems/r-image-cropper\n**\n**\tCopyright (c) 2019-2021, RedStar Technologies, All rights reserved.\n**\thttps://www.rsthn.com/\n**\n**\tTHIS LIBRARY IS PROVIDED BY REDSTAR TECHNOLOGIES \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n**\tINCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A \n**\tPARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL REDSTAR TECHNOLOGIES BE LIABLE FOR ANY\n**\tDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT \n**\tNOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; \n**\tOR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, \n**\tSTRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE\n**\tUSE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/*\n\t<r-image-cropper>\n\t</r-image-cropper>\n*/\n\nimport Element from '../element.js';\nimport Utils from '../utils.js';\n\nexport default Element.register ('r-image-cropper',\n{\n\t/*\n\t**\tDefault aspect ratio.\n\t*/\n\taspectRatio: 1,\n\n\t/*\n\t**\tCurrent image scale.\n\t*/\n\timageScale0: 0, imageScale: 1,\n\n\t/*\n\t**\tImage translation offsets.\n\t*/\n\timageOffsX: 0, imageOffsY: 0,\n\n\t/*\n\t**\tPointer contexts.\n\t*/\n\tpointerA: null, pointerB: null,\n\n\t/*\n\t**\tClient bounding box.\n\t*/\n\tbounds: null,\n\n\t/*\n\t**\tInitializes the element.\n\t*/\n\tinit: function()\n\t{\n\t\tthis.canvas = document.createElement('canvas');\n\t\tthis.appendChild(this.canvas);\n\n\t\tthis.g = this.canvas.getContext('2d');\n\n\t\tthis.pointerA = { id: null, active: false, sx: 0, sy: 0, cx: 0, cy: 0, ix: 0, iy: 0 };\n\t\tthis.pointerB = { id: null, active: false, sx: 0, sy: 0, cx: 0, cy: 0, ix: 0, iy: 0 };\n\n\t\tthis.log = document.createElement('div');\n\t\tthis.appendChild(this.log);\n\t},\n\n\t/*\n\t**\tSets the image for the cropper from an image URL.\n\t*/\n\tsetImageUrl: function(url)\n\t{\n\t\tUtils.loadImageFromUrl(url, (image) => {\n\t\t\tthis.setImage(image);\n\t\t});\n\t},\n\n\t/*\n\t**\tSets the image for the cropper from an HTML File object.\n\t*/\n\tsetImageFile: function(file)\n\t{\n\t\tUtils.loadAsDataUrl(file, (url) => {\n\t\t\tUtils.loadImageFromUrl(url, (image) => {\n\t\t\t\tthis.setImage(image);\n\t\t\t});\n\t\t});\n\t},\n\n\t/*\n\t**\tSets the cropper image from an HTML Image element.\n\t*/\n\tsetImage: function(image)\n\t{\n\t\tthis.image = image;\n\n\t\tthis.reset();\n\n\t\tthis.imageScale = Math.max(this.canvas.width / this.image.width, this.canvas.height / this.image.height);\n\n\t\tthis.imageOffsX = (this.canvas.width - this.imageScale*this.image.width)*0.5;\n\t\tthis.imageOffsY = (this.canvas.height - this.imageScale*this.image.height)*0.5;\n\n\t\tthis.render();\n\t},\n\n\t/*\n\t**\tReturns the blob and URL representing the current canvas state.\n\t*/\n\tgetBlobAndUrl: function(callback, type='image/png', quality=0.9)\n\t{\n\t\tthis.canvas.toBlob((blob) => {\n\t\t\tcallback(blob, URL.createObjectURL(blob));\n\t\t},\n\t\ttype, quality);\n\t},\n\n\t/*\n\t**\tAuto-resizes the canvas to ensure the aspect ratio is maintained.\n\t*/\n\treset: function()\n\t{\n\t\tthis.bounds = this.getBoundingClientRect();\n\n\t\tthis.canvas.width = this.bounds.width;\n\t\tthis.canvas.height = this.bounds.width/this.aspectRatio;\n\t},\n\n\t/*\n\t**\tAuto-resizes the canvas to ensure the aspect ratio is maintained and renders the image.\n\t*/\n\trender: function()\n\t{\n\t\tthis.canvas.width = this.canvas.width;\n\n\t\tthis.g.fillStyle = '#000';\n\t\tthis.g.beginPath();\n\t\tthis.g.rect(0, 0, this.canvas.width, this.canvas.height);\n\t\tthis.g.fill();\n\n\t\tthis.g.translate(this.imageOffsX, this.imageOffsY);\n\t\tthis.g.scale(this.imageScale, this.imageScale);\n\t\tthis.g.drawImage(this.image, 0, 0);\n\t},\n\n\t/*\n\t**\tTranslates the image by the given offsets.\n\t*/\n\ttranslateImage: function(offsX, offsY)\n\t{\n\t\tthis.imageOffsX += offsX;\n\t\tthis.imageOffsY += offsY;\n\n\t\tthis.render(true);\n\t},\n\n\t/*\n\t**\tHandle mouse events on the canvas.\n\t*/\n\t\"event mousemove canvas\": function(evt)\n\t{\n\t\tif (this.pointerA.active)\n\t\t{\n\t\t\tthis.pointerA.cx = evt.clientX;\n\t\t\tthis.pointerA.cy = evt.clientY;\n\n\t\t\tthis.translateImage(this.pointerA.cx - this.pointerA.sx, this.pointerA.cy - this.pointerA.sy);\n\n\t\t\tthis.pointerA.sx = this.pointerA.cx;\n\t\t\tthis.pointerA.sy = this.pointerA.cy;\n\t\t}\n\n\t\tthis.pointerA.ix = ((evt.clientX-this.bounds.left) - this.imageOffsX) / this.imageScale;\n\t\tthis.pointerA.iy = ((evt.clientY-this.bounds.top) - this.imageOffsY) / this.imageScale;\n\t},\n\n\t\"event mousedown canvas\": function(evt)\n\t{\n\t\tthis.pointerA.active = true;\n\t\tthis.pointerA.sx = evt.clientX;\n\t\tthis.pointerA.sy = evt.clientY;\n\t},\n\n\t\"event mouseup canvas\": function(evt)\n\t{\n\t\tthis.pointerA.active = false;\n\t},\n\n\t\"event wheel canvas\": function(evt)\n\t{\n\t\tif (evt.deltaY > 0)\n\t\t\tthis.imageScale -= 0.045;\n\t\telse\n\t\t\tthis.imageScale += 0.045;\n\n\t\tif (this.imageScale < 0.1) this.imageScale = 0.1;\n\n\t\tthis.imageOffsX += -this.pointerA.ix*this.imageScale + (evt.clientX-this.bounds.left) - this.imageOffsX;\n\t\tthis.imageOffsY += -this.pointerA.iy*this.imageScale + (evt.clientY-this.bounds.top) - this.imageOffsY;\n\n\t\tthis.render();\n\t},\n\n\t/*\n\t**\tHandle touch events on the canvas.\n\t*/\n\t\"event touchmove canvas\": function(evt)\n\t{\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerA.cx = i.clientX;\n\t\t\t\tthis.pointerA.cy = i.clientY;\n\t\t\t}\n\t\t\telse if (this.pointerB.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerB.cx = i.clientX;\n\t\t\t\tthis.pointerB.cy = i.clientY;\n\t\t\t}\n\t\t}\n\n\t\tif (this.pointerA.active && this.pointerB.active)\n\t\t{\n\t\t\tlet d0 = Math.sqrt(Math.pow(this.pointerA.sx-this.pointerB.sx, 2) + Math.pow(this.pointerA.sy-this.pointerB.sy, 2));\n\t\t\tlet d1 = Math.sqrt(Math.pow(this.pointerA.cx-this.pointerB.cx, 2) + Math.pow(this.pointerA.cy-this.pointerB.cy, 2));\n\n\t\t\tlet d = d1 - d0;\n\t\t\tthis.imageScale += (d/10)*0.025;\n\t\t\tif (this.imageScale < 0.1) this.imageScale = 0.1;\n\n\t\t\tthis.imageOffsX += -this.pointerA.ix*this.imageScale + (this.pointerA.cx-this.bounds.left) - this.imageOffsX;\n\t\t\tthis.imageOffsY += -this.pointerA.iy*this.imageScale + (this.pointerA.cy-this.bounds.top) - this.imageOffsY;\n\n\t\t\tthis.pointerA.sx = this.pointerA.cx;\n\t\t\tthis.pointerA.sy = this.pointerA.cy;\n\n\t\t\tthis.pointerB.sx = this.pointerB.cx;\n\t\t\tthis.pointerB.sy = this.pointerB.cy;\n\n\t\t\tthis.render();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet p = this.pointerA.active ? this.pointerA : (this.pointerB.active ? this.pointerB : null);\n\t\t\tif (!p) return;\n\n\t\t\tthis.translateImage(p.cx - p.sx, p.cy - p.sy);\n\n\t\t\tp.sx = p.cx;\n\t\t\tp.sy = p.cy;\n\t\t}\n\t},\n\n\t\"event touchstart canvas\": function(evt)\n\t{\n\t\tthis.imageScale0 = this.imageScale;\n\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id === null)\n\t\t\t{\n\t\t\t\tthis.pointerA.id = i.identifier;\n\t\t\t\tthis.pointerA.active = true;\n\t\t\t\tthis.pointerA.sx = i.clientX;\n\t\t\t\tthis.pointerA.sy = i.clientY;\n\t\t\t\tthis.pointerA.ix = ((i.clientX-this.bounds.left) - this.imageOffsX) / this.imageScale;\n\t\t\t\tthis.pointerA.iy = ((i.clientY-this.bounds.top) - this.imageOffsY) / this.imageScale;\n\t\t\t}\n\t\t\telse if (this.pointerB.id === null)\n\t\t\t{\n\t\t\t\tthis.pointerB.id = i.identifier;\n\t\t\t\tthis.pointerB.active = true;\n\t\t\t\tthis.pointerB.sx = i.clientX;\n\t\t\t\tthis.pointerB.sy = i.clientY;\n\t\t\t\tthis.pointerB.ix = ((i.clientX-this.bounds.left) - this.imageOffsX) / this.imageScale;\n\t\t\t\tthis.pointerB.iy = ((i.clientY-this.bounds.top) - this.imageOffsY) / this.imageScale;\n\t\t\t}\n\t\t}\n\t},\n\n\t\"event touchend canvas\": function(evt)\n\t{\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerA.id = null;\n\t\t\t\tthis.pointerA.active = false;\n\t\t\t}\n\t\t\telse if (this.pointerB.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerB.id = null;\n\t\t\t\tthis.pointerB.active = false;\n\t\t\t}\n\t\t}\n\t},\n\n\t\"event touchcancel canvas\": function(evt)\n\t{\n\t\tfor (let i of evt.changedTouches)\n\t\t{\n\t\t\tif (this.pointerA.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerA.id = null;\n\t\t\t\tthis.pointerA.active = false;\n\t\t\t}\n\t\t\telse if (this.pointerB.id == i.identifier)\n\t\t\t{\n\t\t\t\tthis.pointerB.id = null;\n\t\t\t\tthis.pointerB.active = false;\n\t\t\t}\n\t\t}\n\t}\n});\n","\r\nimport _Tabs from './elems/r-tabs.js';\r\nimport _Form from './elems/r-form.js';\r\nimport _Panel from './elems/r-panel.js';\r\nimport _List from './elems/r-list.js';\r\nimport _Item from './elems/r-item.js';\r\nimport _Paginator from './elems/r-paginator.js';\r\nimport _Table from './elems/r-table.js';\r\nimport _Select from './elems/r-select.js';\r\nimport _ImageCropper from './elems/r-image-cropper.js';\r\n\r\nexport default {\r\n\tTabs: _Tabs,\r\n\tForm: _Form,\r\n\tPanel: _Panel,\r\n\tList: _List,\r\n\tItem: _Item,\r\n\tPaginator: _Paginator,\r\n\tTable: _Table,\r\n\tSelect: _Select,\r\n\tImageCropper: _ImageCropper\r\n};\r\n","\nimport { Rinn } from 'rinn';\n\n//!class db\n\nexport default\n{\n\t/**\n\t * Database connection.\n\t */\n\tdb: null,\n\n\t/**\n\t * Initializes the database connection.\n\t * @param {string} dbName\n\t * @param {number} version\n\t * @param {(db: IDBDatabase, txn: IDBTransaction, oldVersion: number) => void} upgradeCallback\n\t * @returns {Promise<void>}\n\t * !static init (dbName: string, version: number, upgradeCallback: (db: IDBDatabase, txn: IDBTransaction, oldVersion: number) => void) : Promise<void>;\n\t */\n\tinit: function (dbName, version, upgradeCallback)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!global.indexedDB)\n\t\t\t{\n\t\t\t\treject ('IndexedDB is not available in your system.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet req = indexedDB.open(dbName, version);\n\t\t\treq.onerror = (evt) =>\n\t\t\t{\n\t\t\t\tlet err = evt.target.error + '';\n\n\t\t\t\tif (err.indexOf('AbortError') !== -1)\n\t\t\t\t\terr = \"\\n\" + req.message;\n\n\t\t\t\treject('Unable to open database: ' + err);\n\t\t\t\treturn;\n\t\t\t};\n\n\t\t\treq.onupgradeneeded = async (evt) =>\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tconst db = evt.target.result;\n\t\t\t\t\tconst txn = evt.target.transaction;\n\n\t\t\t\t\tif (evt.oldVersion < 1)\n\t\t\t\t\t\tdb.createObjectStore('system', { keyPath: ['name'] });\n\n\t\t\t\t\tawait upgradeCallback(db, txn, evt.oldVersion);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\treq.message = e.message;\n\t\t\t\t\treq.transaction.abort();\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treq.onsuccess = async (evt) =>\n\t\t\t{\n\t\t\t\tthis.db = evt.target.result;\n\t\t\t\tresolve();\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Ensures the database is ready to be used, or throws an exception.\n\t */\n\tensureConnected: function()\n\t{\n\t\tif (!this.db)\n\t\t\talert('Error: Database not initialized.');\n\t},\n \n\t/**\n\t * Returns an index object for later use with methods that accept an IDBIndex in the `storeName` parameter.\n\t * @param {string} storeName\n\t * @param {string} indexName\n\t * @returns {IDBIndex}\n\t * !static index (storeName: string, indexName: string) : IDBIndex;\n\t */\n\tindex: function (storeName, indexName)\n\t{\n\t\tthis.ensureConnected();\n\n\t\tlet store = this.db.transaction(storeName, 'readwrite').objectStore(storeName);\n\n\t\tlet index = store.index(indexName);\n\t\tif (!index) throw new Error ('Unable to find index `' + indexName + '` in store ' + storeName);\n\n\t\treturn index;\n\t},\n\n\t/**\n\t * Runs a callback for each record in a data store.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {string} id\n\t * @param { (value:object, cursor:IDBCursor) => Promise<boolean> } callback\n\t * @returns {Promise<void>}\n\t * !static forEach (storeName: string|IDBIndex|IDBObjectStore, id: string, callback: (value:object, cursor:IDBCursor) => Promise<boolean>) : Promise<void>;\n\t */\n\tforEach: function (storeName, id, callback)\n\t{\n\t\tthis.ensureConnected();\n\n\t\tif (typeof(id) === 'function')\n\t\t{\n\t\t\tcallback = id;\n\t\t\tid = null;\n\t\t}\n\n\t\treturn new Promise(async (resolve, reject) =>\n\t\t{\n\t\t\tlet request, store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readwrite').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tif (id === null)\n\t\t\t\trequest = store.openCursor();\n\t\t\telse\n\t\t\t\trequest = store.openCursor(id);\n\n\t\t\trequest.onsuccess = async (event) =>\n\t\t\t{\n\t\t\t\tlet cursor = event.target.result;\n\t\t\t\tif (!cursor)\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet result = await callback (cursor.value, cursor);\n\t\t\t\tif (result === false)\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcursor.continue();\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Returns the count of all records from the specified data store.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @returns {Promise<number>}\n\t * !static count (storeName: string|IDBIndex|IDBObjectStore) : Promise<number>;\n\t */\n\tcount: function (storeName)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readonly').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tlet request = store.count();\n\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve(evt.target.result);\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Returns all records from the specified data store.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {string|number|Array<string|number>} filter\n\t * @returns {Promise<Array<object>>}\n\t * !static getAll (storeName: string|IDBIndex|IDBObjectStore, filter?: string|number|Array<string|number>) : Promise<Array<object>>;\n\t */\n\tgetAll: function (storeName, filter=null)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readonly').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tlet request = store.getAll(filter);\n\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve(evt.target.result);\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Returns all keys from the specified data store.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {string|number|Array<string|number>} filter\n\t * @returns {Promise<Array<string|number|Array<string|number>>>}\n\t * !static getAllKeys (storeName: string|IDBIndex|IDBObjectStore, filter?: string|number|Array<string|number>) : Promise<Array<object>>;\n\t */\n\tgetAllKeys: function (storeName, filter=null)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readonly').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tlet request = store.getAllKeys(filter);\n\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve(evt.target.result);\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Loads a list of records having unique values from the specified data store and returns the entire object or just the specified field.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {string} [field]\n\t * @returns {Promise<Array<number|string|object>>}\n\t * !static getAllUnique (storeName: string|IDBIndex|IDBObjectStore) : Promise<Array<number|string|object>>;\n\t */\n\tgetAllUnique: function (storeName, fieldName=null)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readonly').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tlet request = store.openCursor(null, 'nextunique');\n\t\t\tlet list = [];\n\n\t\t\trequest.onsuccess = (event) =>\n\t\t\t{\n\t\t\t\tlet cursor = event.target.result;\n\t\t\t\tif (!cursor)\n\t\t\t\t{\n\t\t\t\t\tresolve(list);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlist.push(fieldName ? cursor.value[fieldName] : cursor.value);\n\t\t\t\tcursor.continue();\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Returns a single record from the specified data store.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {string|number|Array<string|number>} id\n\t * @returns {Promise<object>}\n\t * !static get (storeName: string|IDBIndex|IDBObjectStore, id: string|number|Array<string|number>) : Promise<object>;\n\t */\n\tget: function (storeName, id)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readonly').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tlet request = store.get(id);\n\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve(evt.target.result || null);\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\n\t/**\n\t * Adds or overwrites a record in the specified data store (data must include the primary key).\n\t * @param {string} storeName\n\t * @param {object} data\n\t * @returns {Promise<void>}\n\t * !static put (storeName: string, data: object) : Promise<void>;\n\t */\n\tput: function (storeName, data)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store = this.db.transaction(storeName, 'readwrite').objectStore(storeName);\n\t\t\tlet request = store.put(data);\n\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Returns a variable from the system table.\n\t * @param {string} name - Name of the property to read.\n\t * @param {boolean} full - When `true` the entire object will be returned.\n\t * @returns {any}\n\t * !static sysGet (name: string, full?: boolean) : any;\n\t */\n\tsysGet: async function (name, full=false)\n\t{\n\t\tlet data = await this.get('system', [name]);\n\t\treturn data ? (full ? data : data.value) : null;\n\t},\n\n\t/**\n\t * Writes a variable to the system table.\n\t * @param {string} name - Name of the property to write.\n\t * @param {any} value - Value to write.\n\t * @param {boolean} full - When `true` the entire value will be written as-is.\n\t * @returns {void}\n\t * !static sysPut (name: string, value: any, full?: boolean) : void;\n\t */\n\tsysPut: async function (name, value, full=false)\n\t{\n\t\tif (full)\n\t\t{\n\t\t\tvalue.name = name;\n\t\t\tawait this.put('system', value);\n\t\t}\n\t\telse\n\t\t\tawait this.put('system', { name: name, value: value });\n\t},\n\n\t/**\n\t * Returns a single record from the specified data store that matches the `partial` object and does NOT match the `notPartial` object.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {object} [partial]\n\t * @param {object} [notPartial]\n\t * @returns {Promise<object>}\n\t * !static findOne (storeName: string|IDBIndex|IDBObjectStore, partial?: object, notPartial?: object) : Promise<object>;\n\t */\n\tfindOne: function (storeName, partial=null, notPartial=null)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store;\n\n\t\t\tif (typeof(storeName) === 'string')\n\t\t\t\tstore = this.db.transaction(storeName, 'readonly').objectStore(storeName);\n\t\t\telse\n\t\t\t\tstore = storeName;\n\n\t\t\tlet request = store.openCursor();\n\n\t\t\trequest.onsuccess = (event) =>\n\t\t\t{\n\t\t\t\tlet cursor = event.target.result;\n\t\t\t\tif (!cursor)\n\t\t\t\t{\n\t\t\t\t\tresolve(null);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (partial === null || Rinn.partialCompare(cursor.value, partial))\n\t\t\t\t{\n\t\t\t\t\tif (notPartial !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Rinn.partialCompare(cursor.value, notPartial))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcursor.continue();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(cursor.value);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcursor.continue();\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Deletes a record from the specified data store.\n\t * @param {string} storeName\n\t * @param {string|number|Array<string|number>} id\n\t * @returns {Promise<void>}\n\t * !static delete (storeName: string, id: string|number|Array<string|number>) : Promise<void>;\n\t */\n\tdelete: function (storeName, id)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store = this.db.transaction(storeName, 'readwrite').objectStore(storeName);\n\n\t\t\tlet request = store.delete(id);\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t},\n\n\t/**\n\t * Deletes all items in the specified store.\n\t * @param {string|IDBIndex|IDBObjectStore} storeName\n\t * @param {string|number|Array<string|number>} id\n\t * @returns {Promise<void>}\n\t * !static deleteAll (storeName: string|IDBIndex|IDBObjectStore, id: string|number|Array<string|number>) : Promise<void>;\n\t */\n\tdeleteAll: function (storeName, id=null)\n\t{\n\t\treturn this.forEach(storeName, id, async (value, cursor) => {\n\t\t\tawait cursor.delete();\n\t\t});\n\t},\n\n\t/**\n\t * Inserts a new record in the specified data store.\n\t * @param {string} storeName\n\t * @param {object} data\n\t * @returns {Promise<void>}\n\t * !static insert (storeName: string, data: object) : Promise<void>;\n\t */\n\tinsert: function (storeName, data)\n\t{\n\t\tthis.ensureConnected();\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet store = this.db.transaction(storeName, 'readwrite').objectStore(storeName);\n\t\t\tlet request = store.add(data);\n\n\t\t\trequest.onsuccess = (evt) => {\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\trequest.onerror = (evt) => {\n\t\t\t\treject(evt.target.error);\n\t\t\t};\n\t\t});\n\t}\n};\n\n//!/class\n","\nimport _Router from './router.js';\t\t\texport const Router = _Router;\nimport _Element from './element.js';\t\texport const Element = _Element;\n\t\t\t\t\t\t\t\t\t\t\texport const CElement = _Element;\nimport _Api from './api.js';\t\t\t\texport const Api = _Api;\nimport _DataSource from './data-source.js';\texport const DataSource = _DataSource;\nimport _DataList from './data-list.js';\t\texport const DataList = _DataList;\nimport _Easing from './easing.js';\t\t\texport const Easing = _Easing;\nimport _Anim from './anim.js';\t\t\t\texport const Anim = _Anim;\nimport _Elements from './elements.js';\t\texport const Elements = _Elements;\nimport _Utils from './utils.js';\t\t\texport const Utils = _Utils;\nimport _db from './db.js';\t\t\t\t\texport const db = _db;\n\nimport * as _Rinn from 'rinn';\nexport const Rinn = _Rinn.Rinn;\nexport const Class = _Rinn.Class;\nexport const Event = _Rinn.Event;\nexport const EventDispatcher = _Rinn.EventDispatcher;\nexport const Model = _Rinn.Model;\nexport const ModelList = _Rinn.ModelList;\nexport const Schema = _Rinn.Schema;\nexport const Flattenable = _Rinn.Flattenable;\nexport const Collection = _Rinn.Collection;\nexport const Template = _Rinn.Template;\n\nglobal.riza =\n{\n\tRouter: Router,\n\tElement: Element,\n\tCElement: CElement,\n\tApi: Api,\n\tDataSource: DataSource,\n\tDataList: DataList,\n\tEasing: Easing,\n\tAnim: Anim,\n\tElements: Elements,\n\tUtils: Utils,\n\tDb: Db,\n\n\tRinn: Rinn,\n\tClass: Class,\n\tEvent: Event,\n\tEventDispatcher: EventDispatcher,\n\tModel: Model,\n\tModelList: ModelList,\n\tSchema: Schema,\n\tFlattenable: Flattenable,\n\tCollection: Collection,\n\tTemplate: Template,\n};\n"],"names":["$parcel$export","e","t","r","n","Object","defineProperty","get","set","enumerable","configurable","$parcel$global","globalThis","self","window","$parcel$modules","$parcel$inits","parcelRequire","parcelRequire25d2","exports","id","call","Error","code","register","module","$39761b0dd175036e$export$2e2bcd8739ae039","$fMUO1","_getref","value","obj","substr","eval","type","model","ctval","name","parseInt","isNaN","parseFloat","toString","default","typeOf","mclass","this","ensure","cls","ensureTypeOf","arrayof","i","length","arraynull","remove","splice","arraycompliant","isCompliant","required","minlen","maxlen","minval","maxval","mincount","maxcount","pattern","$cAEYe","test","inset","RegExp","indexOf","join","upper","toUpperCase","lower","toLowerCase","$b7e7672d417be9d7$var$Rinn","$b7e7672d417be9d7$export$2e2bcd8739ae039","invokeLater","fn","setTimeout","wait","millis","Promise","resolve","reject","o","Array","isArrayOrObject","clone","elem","push","merge","output","objs","arr","j","i1","field","override","partialCompare","full","partial","arrayFind","getObject","isInstanceOf","_class","container","forceArray","$92a8a0aff23e2e33$export$2e2bcd8739ae039","email","url","urlNoProt","uname","text","utext","$2394d727dfd6a212$var$Class","_super","prototype","className","__ctor","__dtor","__proto__","hasOwnProperty","instanceOf","object","_initSuperRefs","constructor","_newSuper","_prot","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","a10","inherit","proto","_extend","base","protos","args","apply","$2394d727dfd6a212$export$2e2bcd8739ae039","extend","source","ret","list","eventName","eventArgs","cbHandler","cbContext","next","_async","listeners","namespace","handler","context","data","split","ns","k","$4dfa0622e14576ea$var$_Model","$c43adaf9cb6d6dd3$export$2e2bcd8739ae039","defaults","constraints","changedList","_silent","_level","EventDispatcher","reset","def","init","update","ready","nsilent","silent","_validate","nvalue","ctname","Constraints","message","_set","dispatchEvent","constraint","_propertyEvent","prev","direct","temp","old","level","evt","arguments","force","fields","has","flatten","getInt","getFloat","getBool","getReference","m","safe","rsafe","class","classPath","keys","ct","validate","observe","property","addEventListener","unobserve","removeEventListener","watch","unwatch","trigger","serialize","$4VREF","$4dfa0622e14576ea$export$2e2bcd8739ae039","$0890bed8a163f087$export$2e2bcd8739ae039","itemt","contents","itemId","nextId","Model","_eventGroup","Date","now","_bind","iid","item","_onItemEvent","_unbind","prepareEvent","from","enqueue","resume","clear","setData","getData","getAt","index","removeAt","setAt","updateAt","position","pop","unshift","shift","find","retObject","unflatten","tmp","$2710795e2347ba2a$var$Schema","Type","precision","_precision","Math","pow","compact","_compact","strings","type1","itemType","v","_debug","callback","_filter","async","defvalue","properties","symbolic","classConstructor1","classConstructor","_constructor","name1","type2","conditions","val","$32651d5f38a8a64c$export$2e2bcd8739ae039","itemTypeSchema","typeSchema","$2710795e2347ba2a$export$2e2bcd8739ae039","Property","is","of","items","add","itemsReferenceChanged","onItemRemoved","desc","sort","a","b","inc","exc","isEmpty","relative","onBeforeItemAdded","concat","onItemAdded","addAt","$d261ccdafdfe12a9$var$Template","strict","parseTemplate","template","sym_open","sym_close","is_tpl","root","nflush","flush","state","count","str","parts","mparts","nparts","emit","trim","map","i2","match","unescape","parse","clean","expand","mode","s","escape","quote","last","first","functions","failed","replace","f","compile","getNamedValues","expanded","key","startsWith","endsWith","global","null","true","false","len","int","float","chr","String","fromCharCode","ord","charCodeAt","not","neg","abs","and","or","eq","ne","lt","le","gt","ge","isnotnull","isnull","iszero","typeof","x","mul","div","sum","sub","mod","dump","JSON","stringify","ref","_unset","start","nl2br","attr","values","_each","var_name","_foreach","_if","_switch","case_value","_break","_continue","_repeat","to","step","tpl","_for","_loop","_echo","console","log","contains","err","_map","arrayMode","_call","i3","$d261ccdafdfe12a9$export$2e2bcd8739ae039","$9ffb7151b8b2d038$export$eefcfe56efaaa57d","$9ffb7151b8b2d038$export$4c85e640eb41c31b","$9ffb7151b8b2d038$export$d61e24a684f9e51","$13eda5a5dec8010f$export$2e2bcd8739ae039","$9ffb7151b8b2d038$export$ec8b666c5fe2c75a","$9ffb7151b8b2d038$export$a1edc412be3e1841","$9ffb7151b8b2d038$export$59eced47f477f85a","$9ffb7151b8b2d038$export$19342e026b58ebb7","$9ffb7151b8b2d038$export$3a9581c9ade29768","$9ffb7151b8b2d038$export$fb8073518f34e6ec","$2bcce06113365814$export$2e2bcd8739ae039","$9ffb7151b8b2d038$export$14416b8d99d47caa","freeExports","freeModule","freeGlobal","InvalidCharacterError","error","TABLE","REGEX_SPACE_CHARACTERS","base64","encode","input","c","buffer","padding","charAt","decode","bitStorage","bitCounter","version","define","amd","nodeType","getGlobal","fetch","bind","Headers","Request","Response","$3CL91","$fc7674a67a1dded1$var$_Router","route","_compileRoute","params","exec","routeRegex","addHandler","unrouted","removeHandler","dispatch","matches","s_args","active","changed","alreadyAttached","onhashchange","onLocationChanged","location1","realLocation","location","ignoreHashChangeEvent","hash","onRoute","onUnroute","routes","Route","sortedRoutes","undefined","cLocation","pLocation","rLocation","$f8355b3b0f8a1063$var$elementPrototypes","$f8355b3b0f8a1063$var$elementClasses","$f8355b3b0f8a1063$var$Element","eid","continuePropagation","_long_press","dx","_pos_fx","_pos_sx","dy","_pos_fy","_pos_sy","sqrt","dispatchOn","clientX","clientY","touches","clearTimeout","opts","dataset","action","longPress","enter","_list_watch","_list_visible","_list_property","isRoot","style","display","random","setModel","reverse","forEach","debug","tagName","parentElement","events","bindEvents","setInnerHTML","appendChild","document","createElement","markReady","isReady","collectWatchers","getFieldByPath","findCustomParent","checkReady","rootReady","getRoot","onRefAdded","rready","readyLocked","readyReenter","childNodes","result","evaluate","XPathResult","ANY_TYPE","iterateNext","path","findRoot","Rinn","modelt","onModelPreChanged","onModelPropertyChanging","onModelPropertyPreChanged","onModelPropertyRemoved","setNamespace","classString","classList","styleString","getBoundingClientRect","width","height","evtstr","hdl","selector","listen","keyCode","routeStr","$fc7674a67a1dded1$export$2e2bcd8739ae039","getRoute","target","HTMLElement","detail","elems","querySelectorAll","preventDefault","stopPropagation","eventCatcher","eventImmediate","callback0","callback1","firstCapture","firstCaptureCount","queue","_eventHandler","q","removed","bubbles","MouseEvent","CustomEvent","createEventObject","innerHTML","modified","_list_watch_length","_list_property_length","_template","Template","_watch","removeAttribute","j1","selfWatch","_visible","visible","selfVisible","onchange","onblur","checked","getModel","getValue","onmouseup","selfProperty","filter","element","removeProperty","setProperty","onModelChanged","setValue","onModelPropertyChanged","__prototypePrepared","newElement","super","invokeConstructor","entries","onCreated","srcElement","connectReference","flags","connectedCallback","elementConnected","xref","disconnectedCallback","onRefRemoved","elementDisconnected","$cTaps","$parcel$interopDefault","$cTigm","$96e14f2a7c3555e4$var$Api","REQUEST_PACKAGE_SUPPORTED","REQ64_SUPPORTED","JSON_RESPONSE_SUPPORTED","XML_RESPONSE_SUPPORTED","INCLUDE_CREDENTIALS","UNIQUE_STAMP","apiUrl","useReq64","retries","res","req","_requestPackage","responseCallback","packageBegin","packageEnd","_packageData","rpkg","encodeParams","apiCall","_hideProgress","response","responseFilter","_requestLevel","documentElement","headers","FormData","encodeURIComponent","param","success","failure","httpMethod","relativeUrl","getUrl","appendParam","Accept","method","body","multipart","options","credentials","Blob","File","append","l","then","decodeResult","catch","json","debounceDelay","request","includeCount","includeEnum","includeList","basePath","config","assign","ModelList","dataSource","enum","forwardRequestEvent","forwardListEvent","forwardEnumEvent","setSource","_timeout","$96e14f2a7c3555e4$export$2e2bcd8739ae039","fetchCount","fetchEnum","fetchList","forced","fetchOne","fetchDelete","dataList","_callback","$6df1de91f37cc48b$var$Easing","interpolate","src","dst","duration","easing","time","lastTime","dt","interpolator","curTime","requestAnimationFrame","Linear","IN","OUT","IN_OUT","Back","Bounce","getConst","Circ","Cubic","Expo","Power","p","Quad","Quartic","Quintic","Sine","sin","cos","Step","$6df1de91f37cc48b$export$2e2bcd8739ae039","$8ba9a43ec98b7fe0$var$Anim","Class","initialData","stack","block","timeScale","blockTime","paused","finished","onFinishedCallback","onUpdatedCallback","onFinished","onUpdated","handle","initial","speed","setOutput","pause","clearInterval","setInterval","_block","_index","_blockTime","cmd","op","started","blocks","indices","blockTimes","_count","startValue","_startValue","_endValue","endValue","cur","table","snd","play","parallel","serial","repeat","end","restart","range","rand","randt","$8ba9a43ec98b7fe0$export$2e2bcd8739ae039","$fc8bfc46d677b942$export$2e2bcd8739ae039","$f8355b3b0f8a1063$export$2e2bcd8739ae039","activeTab","baseRoute","selectTab","_routeHandler","link","href","showTab","tabName","previousElementSibling","nextElementSibling","querySelector","_hideTabsExcept","onConnected","addRoute","onDisconnected","removeRoute","exceptName","el","$b3d0b0a2a554958b$export$2e2bcd8739ae039","formElement","names","clearMarkers","filterString","messages","_change","createEvent","initEvent","fireEvent","_setField","multiple","FileList","_getField","_value","fromFileFields","files","getField","_fieldChanged","_onSuccess","onanimationend","_onFailure","tmp1","errorsAt","prepend","insertBefore","submit","formAction","$86d048fcc607bed6$export$2e2bcd8739ae039","_onActivate","show","_onDeactivate","hide","$46efeecbb011b3ef$export$2e2bcd8739ae039","isDynamicTemplate","template_elem","textContent","setEmpty","setLoading","setList","onLoading","onLoaded","onItemsCleared","onItemsChanged","onItemChanged","buildItem","asHtml","html","attributes","nodeName","setAttribute","nodeValue","wrap","refresh","$4cb4c5b0f59231a0$export$2e2bcd8739ae039","$580e904729d690c2$export$2e2bcd8739ae039","offsetStart","offsetEnd","offset","currentPageSize","pageSize","updateOffset","$d48698206a6c48ec$export$2e2bcd8739ae039","onRequestPropertyChanged","onCountChanged","min","_offset","prevPage","offs","nextPage","firstPage","lastPage","$7f87b159897345d4$export$2e2bcd8739ae039","temporalBody","order","firstElementChild","_elem","replaceChild","$364fd3578df07631$export$2e2bcd8739ae039","lastElementChild","label","blank","groups","g","$820877bea407f5fe$var$Utils","showDownload","filename","dataUrl","download","click","removeChild","showFilePicker","allowMultiple","accept","onfocus","loadAsDataUrl","file","reader","FileReader","onload","onerror","readAsDataURL","loadAsText","readAsText","loadAsArrayBuffer","readAsArrayBuffer","loadAllAsDataUrl","fileList","loadNext","size","loadImageFromUrl","image","Image","$820877bea407f5fe$export$2e2bcd8739ae039","$9f0bb26a0631dfe5$export$2e2bcd8739ae039","aspectRatio","imageScale0","imageScale","imageOffsX","imageOffsY","pointerA","pointerB","bounds","canvas","getContext","sx","sy","cx","cy","ix","iy","setImageUrl","setImage","setImageFile","max","render","getBlobAndUrl","quality","toBlob","blob","URL","createObjectURL","fillStyle","beginPath","rect","fill","translate","scale","drawImage","translateImage","offsX","offsY","left","top","deltaY","changedTouches","identifier","d0","d","$c5e2b71302627218$export$2e2bcd8739ae039","Tabs","Form","Panel","List","Item","Paginator","Table","Select","ImageCropper","$961577053109551e$export$2e2bcd8739ae039","db","dbName","upgradeCallback","indexedDB","open","onupgradeneeded","txn","transaction","oldVersion","createObjectStore","keyPath","abort","onsuccess","ensureConnected","alert","storeName","indexName","objectStore","store","openCursor","event","cursor","continue","getAll","getAllKeys","getAllUnique","fieldName","put","sysGet","sysPut","findOne","notPartial","delete","deleteAll","insert","$5eaf60761b941187$export$55185c17a0fcbe46","$5eaf60761b941187$export$db77ccec0bb4ccac","$5eaf60761b941187$export$9864de54bd63ed8a","$5eaf60761b941187$export$bf71da7aebe9ddc1","$5eaf60761b941187$export$accd73d198d77d2f","$5eaf60761b941187$export$d3568da47c78d35c","$03fe6abf6b6507d5$export$2e2bcd8739ae039","$5eaf60761b941187$export$cea96571ebbff9dd","$5eaf60761b941187$export$deefd61317ad2797","$5eaf60761b941187$export$3abb4be70fa2c84e","$5eaf60761b941187$export$d2ca453b913dcdea","$5eaf60761b941187$export$f932f06c7eb6abeb","$5eaf60761b941187$export$eefcfe56efaaa57d","$5eaf60761b941187$export$4c85e640eb41c31b","$5eaf60761b941187$export$d61e24a684f9e51","Event","$5eaf60761b941187$export$ec8b666c5fe2c75a","$5eaf60761b941187$export$a1edc412be3e1841","$5eaf60761b941187$export$59eced47f477f85a","$5eaf60761b941187$export$19342e026b58ebb7","Schema","$5eaf60761b941187$export$3a9581c9ade29768","Flattenable","$5eaf60761b941187$export$fb8073518f34e6ec","Collection","$5eaf60761b941187$export$14416b8d99d47caa","riza","Router","Element","CElement","Api","DataSource","DataList","Easing","Anim","Elements","Utils","Db"],"version":3,"file":"riza.js.map"}