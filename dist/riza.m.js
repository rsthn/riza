import{Rinn as t,Class as e,Event as s,EventDispatcher as n,Model as a,ModelList as o,Schema as r,Flattenable as l,Collection as h,Template as c}from"rinn";import u from"base-64";import{signal as d,expr as f,watch as p,validator as m}from"riza-signal";var g=globalThis;let b={Route:n.extend({routeRegex:null,value:null,params:null,args:null,s_args:null,active:!1,changed:!1,__ctor:function(t){this._super.EventDispatcher.__ctor(),this._compileRoute(this.value=t)},_compileRoute:function(t){for(this.params=[],t=t.replace(/\/\*\//g,"/.+/");;){let e=/:([!@A-Za-z0-9_-]+)/.exec(t);if(!e)break;t=t.replace(e[0],"([^/]+)"),this.params.push(e[1])}this.routeRegex="^"+t.replace(/##/g,"")},addHandler:function(t,e=!1,s=null){this.addEventListener((!0===e?"un":"")+"routed",t,s)},removeHandler:function(t,e=!1,s=null){this.removeEventListener((!0===e?"un":"")+"routed",t,s)},dispatch:function(t){let e=t.match(this.routeRegex);if(!e){this.s_args=null,this.active&&this.dispatchEvent("unrouted",{route:this}),this.active=!1;return}let s={route:this},n="";for(let t=0;t<this.params.length;t++)s[this.params[t]]=e[t+1],n+="_"+e[t+1];this.changed=n!=this.s_args,this.s_args=n,this.dispatchEvent("routed",this.args=s),this.active=!0}}),routes:{},sortedRoutes:[],ignoreHashChangeEvent:0,location:"",args:[],init:function(){!this.alreadyAttached&&(this.alreadyAttached=!0,"onhashchange"in globalThis&&(globalThis.onhashchange=this.onLocationChanged.bind(this),this.location=globalThis.location.hash.substring(1),this.args=this.location.split("/")))},refresh:function(){this.onLocationChanged()},setRoute:function(t,e){let s=this.realLocation(t);s!=this.location&&(e&&this.ignoreHashChangeEvent++,globalThis.location.hash=s)},addRoute:function(t,e,s=null){return this.routes[t]||(this.routes[t]=new this.Route(t),this.sortedRoutes.push(t),this.sortedRoutes.sort((t,e)=>this.routes[t].routeRegex.length-this.routes[e].routeRegex.length)),null!==s?(this.routes[t].addHandler(e,!1),this.routes[t].addHandler(s,!0)):this.routes[t].addHandler(e,!1),this.routes[t]},getRoute:function(t){return this.routes[t]||(this.routes[t]=new this.Route(t),this.sortedRoutes.push(t),this.sortedRoutes.sort((t,e)=>this.routes[t].routeRegex.length-this.routes[e].routeRegex.length)),this.routes[t]},addRoutes:function(t){for(let e in t)this.routes[e]||(this.routes[e]=new this.Route(e),this.sortedRoutes.push(e)),this.routes[e].addHandler(t[e],!1);this.sortedRoutes.sort((t,e)=>this.routes[t].routeRegex.length-this.routes[e].routeRegex.length)},removeRoute:function(t,e,s){this.routes[t]&&(void 0!==s?(this.routes[t].removeHandler(e,!1),this.routes[t].removeHandler(s,!0)):this.routes[t].removeHandler(e))},removeRoutes:function(t){for(let e in t)this.routes[e]&&this.routes[e].removeHandler(t[e])},realLocation:function(t,e){e||(e=this.location),e||(e=" ");let s=0,n=0,a=0,o,r="";for(;-1!=s&&n<t.length&&a<e.length;)switch(s){case 0:if("*"==t.substr(n++,1)){s=1;break}if(t.substr(n-1,1)!=e.substr(a++,1)){r+=t.substr(n-1),s=-1;break}r+=e.substr(a-1,1);break;case 1:if("*"==t.substr(n,1)){s=3,n++;break}s=2;break;case 2:if(-1==(o=e.indexOf(t.substr(n,1),a))){r+=e.substr(a)+t.substr(n),s=-1;break}r+=e.substr(a,o-a),s=0,a=o;break;case 3:if(-1==(o=e.lastIndexOf(t.substr(n,1)))){r+=t.substr(n),s=-1;break}r+=e.substr(a,o-a),s=0,a=o}return -1!=s&&(r+=t.substr(n)),r.trim()},onLocationChanged:function(){this.prevLocation!==this.location&&(this.prevLocation=this.location);let t=globalThis.location.hash.substring(1),e=this.realLocation(t);if(t!==e){globalThis.location.replace("#"+e);return}if(this.location=t,this.args=this.location.split("/"),this.ignoreHashChangeEvent>0){this.ignoreHashChangeEvent--;return}for(let t=0;t<this.sortedRoutes.length;t++)this.routes[this.sortedRoutes[t]].dispatch(this.location)},navigate:function(t,e=!1){if(t=this.realLocation(t),globalThis.location.hash=="#"+t){this.refresh();return}e?globalThis.location.replace("#"+t):globalThis.location.hash=t}};b.init();let v={},y={},_={elem:null,state:null},E={eid:null,isRoot:!1,root:null,isReady:0,readyReenter:0,readyLocked:0,modelt:a,model:null,contents:null,events:{"mousedown [data-long-press]":function(t){if(t.continuePropagation=!0,_.state)return;t.continuePropagation=!1;let e=t.source;_.elem=e,_.state=setTimeout(()=>{let t=e._pos_fx-e._pos_sx,s=e._pos_fy-e._pos_sy;_.state=null,5>Math.sqrt(t*t+s*s)&&_.elem===e&&(_.state=!1,this.dispatchOn(e,"long-press"))},500),e._pos_sx=t.clientX,e._pos_sy=t.clientY,e._pos_fx=t.clientX,e._pos_fy=t.clientY},"mousemove [data-long-press]":function(t){t.continuePropagation=!0,_.state&&(t.continuePropagation=!1,t.source._pos_fx=t.clientX,t.source._pos_fy=t.clientY)},"mouseup [data-long-press]":function(t){!1!==_.state&&(_.state&&(clearTimeout(_.state),_.state=null),_.elem===t.source&&this.dispatchOn(t.source,"short-press",[],!1))},"touchstart [data-long-press]":function(t){if(t.continuePropagation=!0,_.state)return;let e=t.source;_.elem=e,_.state=setTimeout(()=>{let t=e._pos_fx-e._pos_sx,s=e._pos_fy-e._pos_sy;_.state=null,5>Math.sqrt(t*t+s*s)&&_.elem===e&&(_.state=!1,this.dispatchOn(e,"long-press"))},500),e._pos_sx=t.touches[0].clientX,e._pos_sy=t.touches[0].clientY,e._pos_fx=t.touches[0].clientX,e._pos_fy=t.touches[0].clientY},"touchmove [data-long-press]":function(t){t.continuePropagation=!0,_.state&&(t.source._pos_fx=t.touches[0].clientX,t.source._pos_fy=t.touches[0].clientY)},"touchend [data-long-press]":function(t){!1!==_.state&&(_.state&&(clearTimeout(_.state),_.state=null),_.elem===t.source&&this.dispatchOn(t.source,"short-press",null,!1))},"click [data-action]":function(t){if(!1===_.state)return;let e=t.source.dataset.action.split(" ");e[0]in this?this[e[0]]({...t.params,...t.source.dataset,...e,length:e.length},t):t.continuePropagation=!0},"long-press [data-long-press]":function(t){let e=t.source.dataset.longPress.split(" ");e[0]in this?this[e[0]]({...t.params,...t.source.dataset,...e,length:e.length},t):t.continuePropagation=!0},"keyup(13) input[data-enter]":function(t){let e=t.source.dataset.enter.split(" ");e[0]in this?this[e[0]]({...t.params,...t.source.dataset,...e,length:e.length},t):t.continuePropagation=!0}},routes:null,__ctor:function(){if(this._list_watch=[],this._list_visible=[],this._list_attr=[],this._list_property=[],"root"in this.dataset&&(this.isRoot="true"===this.dataset.root),this.style.display="block",this.eid=Math.random().toString().substr(2),null!=this.model){let t=this.model;this.model=null,this.setModel(t,!1)}Object.keys(this._super).reverse().forEach(t=>{"init"in this._super[t]&&this._super[t].init()}),E.debug&&console.log(">> "+this.tagName+" INIT ON "+this.parentElement.tagName),this.init(),this.events&&this.bindEvents(this.events),this.contents&&this.setInnerHTML(this.contents),setTimeout(()=>{"r-dom-probe"!==this.tagName.toLowerCase()?this.appendChild(document.createElement("r-dom-probe")):this.markReady()},0)},init:function(){},ready:function(){},rready:function(){},markReady:function(t=null){if(this.readyLocked++,this.isReady)this.collectWatchers();else{if(this.isReady=1,"model"in this.dataset){let t=this.getFieldByPath(this.dataset.model);t&&this.setModel(t)}Object.keys(this._super).reverse().forEach(t=>{"ready"in this._super[t]&&this._super[t].ready()}),E.debug&&console.log(">> "+this.tagName+" READY"),this.ready(),this.trigger("ready").dispatch("_ready",null,!1),this.collectWatchers()}let e=this.findCustomParent(this);E.debug&&console.log(this.tagName+" ROOT IS "+(e?e.tagName:"NULL")),e&&0===e.isReady&&0!=this.isReady&&e.checkReady();let s=!1;if(e&&2===e.isReady&&2!==this.isReady&&(this.getRoot(),this.root&&this.dataset.ref&&(E.debug&&console.log(this.tagName+" REF AS `"+this.dataset.ref+"` ON "+this.root.tagName),this.root[this.dataset.ref]=this,this.root.onRefAdded(this.dataset.ref,this)),s=!0),e||2===this.isReady||(s=!0),s){if(this.isReady=2,null!==t)for(let e of t)e.checkReady();E.debug&&console.log(">> "+this.tagName+" RREADY"),Object.keys(this._super).reverse().forEach(t=>{"rready"in this._super[t]&&this._super[t].rready()}),this.rready(),this.trigger("rootready")}this.readyLocked--,this.readyReenter&&!this.readyLocked&&(this.readyReenter=!1,this.checkReady()),"r-dom-probe"===this.tagName.toLowerCase()&&this.remove()},checkReady:function(){if(0==this.childNodes.length)return;if(this.readyLocked){this.readyReenter=!0;return}let t=!0,e=[],s=document.evaluate(".//*[contains(name(),'-')]",this,null,XPathResult.ANY_TYPE,null);for(E.debug&&console.log("# CHECKING "+this.tagName);;){let n=s.iterateNext();if(!n)break;n!==this&&this.findCustomParent(n)===this&&(E.debug&&console.log("   "+n.tagName+" = "+n.isReady),n.isReady||(t=!1),e.push(n))}t&&this.markReady(e)},getFieldByPath:function(t){if(!t)return null;if("string"!=typeof t)return t;let e=t.split("."),s=g;for(e.length&&"this"==e[0]&&(s=this,e.shift()),e.length&&"root"==e[0]&&(s=this.getRoot(),e.shift());null!=s&&0!=e.length;)s=s[e.shift()];return s},getRoot:function(){return this.root?this.root:this.root=this.findRoot()},setModel:function(e,s=!0){return e&&(e=t.ensureTypeOf(this.modelt,e),this.model!==e&&(null!=this.model&&(this.model.removeEventListener(this.eid+":modelChanged",this.onModelPreChanged,this),this.model.removeEventListener(this.eid+":propertyChanging",this.onModelPropertyChanging,this),this.model.removeEventListener(this.eid+":propertyChanged",this.onModelPropertyPreChanged,this),this.model.removeEventListener(this.eid+":propertyRemoved",this.onModelPropertyRemoved,this)),this.model=e,this.model.addEventListener(this.eid+":modelChanged",this.onModelPreChanged,this),this.model.addEventListener(this.eid+":propertyChanging",this.onModelPropertyChanging,this),this.model.addEventListener(this.eid+":propertyChanged",this.onModelPropertyPreChanged,this),this.model.addEventListener(this.eid+":propertyRemoved",this.onModelPropertyRemoved,this)),!1!==s&&this.model.setNamespace(this.eid).update(!0).setNamespace(null)),this},getModel:function(){return this.model},addClass:function(t){return t&&t.split(" ").forEach(t=>{(t=t.trim())&&("-"==t[0]||"+"==t[0]?this.classList["-"==t[0]?"remove":"add"](t.substr(1)):this.classList.add(t))}),this},removeClass:function(t){return t&&t.split(" ").forEach(t=>{(t=t.trim())&&("-"==t[0]||"+"==t[0]?this.classList["-"==t[0]?"remove":"add"](t.substr(1)):this.classList.remove(t))}),this},setStyle:function(t){return t&&t.split(";").forEach(t=>{let e=(t=t.trim()).indexOf(":");if(-1==e)return;let s=t.substr(0,e).trim();for(let t=s.indexOf("-");-1!=t;t=s.indexOf("-"))s=s.substr(0,t)+s.substr(t+1,1).toUpperCase()+s.substr(t+2);this.style[s]=t.substr(e+1).trim()}),this},getWidth:function(t=null){return(t||this).getBoundingClientRect().width},getHeight:function(t=null){return(t||this).getBoundingClientRect().height},bindEvents:function(e){for(let r in e){let l=e[r];"string"==t.typeOf(l)&&(l=this[l]),l=l.bind(this);var s=r.indexOf(" "),n=-1==s?r:r.substr(0,s),a=-1==s?"":r.substr(s+1);let h=null;var o=n.indexOf("(");if(-1!=o&&(h=n.substr(o+1,n.length-o-2).split(","),n=n.substr(0,o)),"@"==a[0]){if("@this"!=a){this[a.substr(1)].addEventListener(n,l);continue}a=this}else"&"==a[0]&&(a="&this"!=a?"[data-ref='"+a.substr(1)+"']":this);if("#"==n.substr(0,1)){this.listen("propertyChanged."+n.substr(1),this,l);continue}if(null!=h)switch(n){case"keyup":case"keydown":this.listen(n,a,function(e){if(-1!=t.indexOf(h,e.keyCode.toString()))return l(e,h);e.continuePropagation=!0});continue}this.listen(n,a,l)}return this},bindRoutes:function(){if(this.routes)for(let e in this.routes){let s="!"===e[0]?b.getRoute(e.substr(1)):b.getRoute(e),n=this.routes[e];"string"===t.typeOf(n)&&(n=this[n]),"!"===e[0]?s.addHandler(n,!0,this):s.addHandler(n,!1,this)}},unbindRoutes:function(){if(this.routes)for(let e in this.routes){let s="!"===e[0]?b.getRoute(e.substr(1)):b.getRoute(e),n=this.routes[e];"string"===t.typeOf(n)&&(n=this[n]),"!"===e[0]?s.removeHandler(n,!0,this):s.removeHandler(n,!1,this)}},_eventHandler:function(e,s,n){if(!1!==e.continuePropagation){if(e.continuePropagation=!0,e.source=e.target,s&&s instanceof HTMLElement)e.source===s&&(e.continuePropagation=!1,!0===n.call(this,e,e.detail)&&(e.continuePropagation=!0));else if(s&&"*"!=s){let a=this.querySelectorAll(s);for(;e.source!==this;){if(-1!==t.indexOf(a,e.source,!0)){e.continuePropagation=!1,!0===n.call(this,e,e.detail)&&(e.continuePropagation=!0);break}e.source=e.source.parentElement}}else e.continuePropagation=!1,!0===n.call(this,e,e.detail)&&(e.continuePropagation=!0);!1===e.continuePropagation&&(e.preventDefault(),e.stopPropagation())}},listen:function(e,s,n){let a=!1,o=!1;"function"==t.typeOf(s)&&(n=s,s=null),"!"==e[e.length-1]&&(e=e.substr(0,e.length-1),a=!0),"!"==e[0]&&(e=e.substr(1),o=!0);let r=null,l=null,h=this;return this.addEventListener(e,r=t=>{!1!==t.continuePropagation&&(t.firstCapture||(t.firstCapture=this,t.firstCaptureCount=0,t.queue=[]),t.firstCapture===this&&t.firstCaptureCount++,!0==a&&t.queue.push([this,s,n]),!0==o&&this._eventHandler(t,s,n))},!0),this.addEventListener(e,l=t=>{if(!1!==t.continuePropagation&&(!0!==a&&!0!==o&&this._eventHandler(t,s,n),t.firstCapture===this&&!1!==t.continuePropagation&&0==--t.firstCaptureCount)){for(;t.queue.length;){let e=t.queue.pop();e[0]._eventHandler(t,e[1],e[2])}t.continuePropagation=!1}},!1),{removed:!1,remove:function(){this.removed||(this.removed=!0,h.removeEventListener(e,r,!0),h.removeEventListener(e,l,!1))}}},createEventObject:function(t,e,s){return"click"==t?new MouseEvent(t,{bubbles:s,detail:e}):new CustomEvent(t,{bubbles:s,detail:e})},dispatch:function(t,e=null,s=!0){let n="on"+t.toLowerCase();return n in this?this[n](e,this):this.dispatchEvent(this.createEventObject(t,e,s)),this},trigger:function(t,e=null){let s="on"+t.replace(/-/g,"").toLowerCase();return s in this&&this[s](e,this),this},dispatchOn:function(t,e,s=null,n=!0){let a="on"+e.replace(/-/g,"").toLowerCase();return a in t?t[a](s,t):t.dispatchEvent(this.createEventObject(e,s,n)),this},setInnerHTML:function(t){return this.readyLocked++,this.innerHTML=t,this.readyLocked--,this},collectWatchers:function(){let t,e=this,s=!1;if(!this.isRoot)return;let n=this._list_watch.length,a=this._list_visible.length,o=this._list_attr.length,r=this._list_property.length;t=this.querySelectorAll("[data-watch]");for(let e=0;e<t.length;e++){for(let s of t[e].querySelectorAll(".pseudo"))s.remove();t[e]._template=c.compile(t[e].innerHTML),t[e]._watch=RegExp("^("+t[e].dataset.watch+")$"),t[e].innerHTML="",t[e].removeAttribute("data-watch"),this._list_watch.push(t[e])}if("selfWatch"in this.dataset){for(let t of this.querySelectorAll(".pseudo"))t.remove();this._template=c.compile(this.innerHTML),this._watch=RegExp("^("+this.dataset.selfWatch+")$"),this.innerHTML="",this.removeAttribute("data-self-watch"),this._list_watch.push(this)}t=this.querySelectorAll("[data-visible]");for(let e=0;e<t.length;e++)t[e]._visible=c.compile(t[e].dataset.visible),t[e].removeAttribute("data-visible"),this._list_visible.push(t[e]);"selfVisible"in this.dataset&&(this._visible=c.compile(this.dataset.selfVisible),this.removeAttribute("data-self-visible"),this._list_visible.push(this)),t=this.querySelectorAll("[data-attr]");for(let e=0;e<t.length;e++){for(let s of(t[e]._attr=[],t[e].dataset.attr.split(";")))2==(s=s.split(":")).length&&t[e]._attr.push({name:s[0].trim(),value:c.compile(s[1].trim())});t[e].removeAttribute("data-attr"),this._list_attr.push(t[e])}if("selfAttr"in this.dataset){for(let t of(this._attr=[],this.dataset.selfAttr.split(";")))2==(t=t.split(":")).length&&this._attr.push({name:t[0].trim(),value:c.compile(t[1].trim())});this.removeAttribute("data-self-attr"),this._list_attr.push(this)}t=this.querySelectorAll("[data-property]");for(let s=0;s<t.length;s++)t[s].onchange=t[s].onblur=function(){switch(this.type){case"radio":this.checked&&e.getModel().set(this.name,this.value);break;case"checkbox":e.getModel().set(this.name,this.checked?"1":"0");break;case"field":e.getModel().set(this.name,this.getValue());break;default:e.getModel().set(this.name,this.value)}},"SELECT"==t[s].tagName&&(t[s].onmouseup=function(){e.getModel().set(this.name,this.value)}),t[s].name=t[s].dataset.property,t[s].removeAttribute("data-property"),this._list_property.push(t[s]);"selfProperty"in this.dataset&&(this.onchange=this.onblur=function(){switch(this.type){case"radio":this.checked&&e.getModel().set(this.name,this.value);break;case"checkbox":e.getModel().set(this.name,this.checked?"1":"0");break;case"field":e.getModel().set(this.name,this.getValue());break;default:e.getModel().set(this.name,this.value)}},"SELECT"==this.tagName&&(this.onmouseup=function(){e.getModel().set(this.name,this.value)}),this.name=this.dataset.selfProperty,this.removeAttribute("data-self-property"),this._list_property.push(this)),this._list_watch=this._list_watch.filter(t=>null!=t.parentElement),n!=this._list_watch.length&&(s=!0),this._list_visible=this._list_visible.filter(t=>null!=t.parentElement),a!=this._list_visible.length&&(s=!0),this._list_attr=this._list_attr.filter(t=>null!=t.parentElement),o!=this._list_attr.length&&(s=!0),this._list_property=this._list_property.filter(t=>null!=t.parentElement),r!=this._list_property.length&&(s=!0),null!=this.model&&s&&this.model.setNamespace(this.eid).update(!0).setNamespace(null)},onCreated:function(){},whenReady:function(t){if(this.isReady)return t(),this;let e=this.listen("_ready",this,()=>{e.remove(),t()});return this},elementConnected:function(){this.bindRoutes(),this.onConnected(),this.trigger("connected")},elementDisconnected:function(){this.unbindRoutes(),this.onDisconnected(),this.trigger("disconnected")},onConnected:function(){},onDisconnected:function(){},onRefAdded:function(t,e){},onRefRemoved:function(t,e){},onModelPreChanged:function(t,e){let s=this.getModel().get();for(let t=0;t<this._list_watch.length;t++)for(let n of e.fields)if(this._list_watch[t]._watch.test(n)){this._list_watch[t].innerHTML=this._list_watch[t]._template(s);break}for(let t=0;t<this._list_visible.length;t++)this._list_visible[t]._visible(s,"arg")?this._list_visible[t].style.removeProperty("display"):this._list_visible[t].style.setProperty("display","none","important");for(let t=0;t<this._list_attr.length;t++)for(let e of this._list_attr[t]._attr)this._list_attr[t][e.name]=e.value(s,"arg");this.onModelChanged(t,e)},onModelChanged:function(t,e){},onModelPropertyChanging:function(t,e){},onModelPropertyPreChanged:function(t,e){for(let t=0;t<this._list_property.length;t++)if(this._list_property[t].name==e.name){let s=!0;switch(this._list_property[t].type){case"radio":if(this._list_property[t].value!=e.value){this._list_property[t].parentElement.classList.remove("active");continue}this._list_property[t].checked=!0,this._list_property[t].parentElement.classList.add("active");break;case"checkbox":~~e.value?(this._list_property[t].checked=!0,this._list_property[t].parentElement.classList.add("active")):(this._list_property[t].checked=!1,this._list_property[t].parentElement.classList.remove("active"));break;case"field":this._list_property[t].val=this._list_property[t].dataset.value=e.value,this._list_property[t].setValue(e.value),s=!1;break;default:this._list_property[t].value=e.value,this._list_property[t].val=this._list_property[t].dataset.value=e.value,this._list_property[t].value!=e.value&&(s=!1)}s&&this._list_property[t].onchange&&this._list_property[t].onchange()}this.dispatch("propertyChanged."+e.name,e,!1),this.dispatch("propertyChanged",e,!1),this.onModelPropertyChanged(t,e)},onModelPropertyChanged:function(t,e){},onModelPropertyRemoved:function(t,e){},preparePrototype:function(t){if(!0!==t.__prototypePrepared)for(let e in t.__prototypePrepared=!0,t.hasOwnProperty("events")&&t.events||(t.events={}),t.hasOwnProperty("routes")&&t.routes||(t.routes={}),t)e.startsWith("event ")?(t.events[e.substr(6)]=t[e],delete t[e]):e.startsWith("route ")&&(t.routes[e.substr(6)]=t[e],delete t[e])},register:function(e,...s){let n;"riza_element_prefix"in globalThis&&(e=e.replace("r-",globalThis.riza_element_prefix+"-"));let a=class extends HTMLElement{constructor(){for(let t of(super(),this.invokeConstructor=!0,E.debug&&console.log("CREATED "+this.tagName),this._super={},Object.entries(this.constructor.prototype._super)))for(let e of(this._super[t[0]]={},Object.entries(t[1])))this._super[t[0]][e[0]]=e[1].bind(this);this.onCreated()}findRoot(t=null){let e=t||this.parentElement;for(;null!=e;){if("isRoot"in e&&!0===e.isRoot)return e;e=e.parentElement}return null}findCustomParent(t=null){let e=t?t.parentElement:this.parentElement;for(;null!=e;){if(-1!==e.tagName.indexOf("-"))return e;e=e.parentElement}return null}connectReference(t=null,e=255){this.root||(1&e)!=1||(null==t&&(t=this.findRoot()),null==t||(this.dataset.ref&&(t[this.dataset.ref]=this),this.root=t))}connectedCallback(){this.connectReference(null,1),this.invokeConstructor&&(this.invokeConstructor=!1,this.__ctor()),this.connectReference(null,2),this.elementConnected(),this.dataset.xref&&(globalThis[this.dataset.xref]=this)}disconnectedCallback(){this.root&&(this.dataset.ref&&(this.root.onRefRemoved(this.dataset.ref,this),delete this.root[this.dataset.ref]),this.root=null),this.elementDisconnected(),this.dataset.xref&&delete globalThis[this.dataset.xref]}};t.override(a.prototype,E);let o={},r={},l=t.clone(E.events),h=!0,c=!0,u=!0;for(let e=0;e<s.length;e++)if(s[e]){if("string"==t.typeOf(s[e])){let a=s[e];if(s[e]=v[a],!s[e])continue;for(let n in r[a]={},s[e])"function"==t.typeOf(s[e][n])&&(r[a][n]=s[e][n]);h=!1,c=!1,u=!1,n=!1}else E.preparePrototype(s[e]),n=!0;"_super"in s[e]&&t.override(r,s[e]._super),"events"in s[e]&&t.override(l,s[e].events),t.override(a.prototype,s[e]),t.override(o,s[e]),n&&(!h&&"init"in s[e]&&(h=!0),!c&&"ready"in s[e]&&(c=!0),!u&&"rready"in s[e]&&(u=!0))}let d=function(){};return h||(a.prototype.init=d,o.init=d),c||(a.prototype.ready=d,o.ready=d),u||(a.prototype.rready=d,o.rready=d),a.prototype._super=r,a.prototype.events=l,o._super=r,o.events=l,customElements.define(e,a),v[e]=o,y[e]=a,a},expand:function(e,...s){if(!(e in v))return;let n=v[e],a=y[e],o=n._super,r=n.events;for(let e of s)E.preparePrototype(e),"_super"in e&&t.override(o,e._super),"events"in e&&t.override(r,e.events),t.override(a.prototype,e),t.override(n,e);a.prototype._super=o,a.prototype.events=r,n._super=o,n.events=r},hookAppend:function(e,s,n){if(!(e in v))return;let a=t.hookAppend(v[e],s,n),o=t.hookAppend(y[e].prototype,s,n);return{unhook:function(){a.unhook(),o.unhook()}}},hookPrepend:function(e,s,n){if(!(e in v))return;let a=t.hookPrepend(v[e],s,n),o=t.hookPrepend(y[e].prototype,s,n);return{unhook:function(){a.unhook(),o.unhook()}}},":toggleClass":function(t,e){let s=e.source;"2"in t&&(s=document.querySelector(t[2])),s&&(s.classList.contains(t[1])?s.classList.remove(t[1]):s.classList.add(t[1]))},":setClass":function(t,e){let s=e.source;"2"in t&&(s=document.querySelector(t[2])),s&&s.classList.add(t[1])},":volatileClass":function(t,e){let s=e.source;if("2"in t&&(s=document.querySelector(t[2])),!s)return;s.classList.add(t[1]);let n=()=>{window.removeEventListener("click",n,!0),s.classList.remove(t[1])};window.addEventListener("click",n,!0)},":toggleClassUnique":function(t,e){let s=e.source;s&&(s.classList.contains(t[1])?s.classList.remove(t[1]):(s.querySelectorParent(t[2]).querySelectorAll(t[3]).forEach(e=>e.classList.remove(t[1])),s.classList.add(t[1])))},":setClassUnique":function(t,e){let s=e.source;s&&(s.querySelectorParent(t[2]).querySelectorAll(t[3]).forEach(e=>e.classList.remove(t[1])),s.classList.add(t[1]))}};E.debug=!1,E.register("r-elem",{}),E.register("r-dom-probe",{}),HTMLElement.prototype.querySelectorParent=function(t){let e=this;for(;null!=e&&!e.matches(t);)e=e.parentElement;return e},HTMLElement.prototype.getRoot=function(){return this.parentElement.querySelectorParent("[data-root]")};let L={REQUEST_PACKAGE_SUPPORTED:1,REQ64_SUPPORTED:2,JSON_RESPONSE_SUPPORTED:4,XML_RESPONSE_SUPPORTED:8,INCLUDE_CREDENTIALS:16,UNIQUE_STAMP:32,DISABLE_CORS:64,WIND_V3:128,apiUrl:"/api",flags:63,useReq64:!1,retries:0,headers:{},_requestLevel:0,_requestPackage:0,_packageData:[],setEndPoint:function(t,e=null){return this.apiUrl=t,this.flags=e??this.flags,this},responseFilter:function(t,e){return!0},packageBegin:function(){this.flags&L.REQUEST_PACKAGE_SUPPORTED&&this._requestPackage++},packageEnd:function(t){this.flags&L.REQUEST_PACKAGE_SUPPORTED&&this._requestPackage&&(--this._requestPackage||this.packageSend(t))},batch:function(t,e=null){if(!(this.flags&L.REQUEST_PACKAGE_SUPPORTED)){t(),e&&e();return}this.packageBegin(),t(),this.packageEnd(e)},packageSend:function(t){if(!(this.flags&L.REQUEST_PACKAGE_SUPPORTED)||!this._packageData.length)return;let e=this._packageData;this._packageData=[];for(var s="",n=0;n<e.length;n++)s+="r"+n+","+u.encode(this.encodeParams(e[n][2]))+";";this._showProgress(),this.apiCall({rpkg:s},(s,n)=>{this._hideProgress();for(let t=0;t<e.length;t++)try{var a=s["r"+t];if(!a){null!=e[t][1]&&e[t][1](e[t][2]);continue}null!=e[t][0]&&this.responseFilter(a,e[t][2])&&e[t][0](a,e[t][2])}catch(t){}t&&t()},t=>{this._hideProgress();for(let t=0;t<e.length;t++)null!=e[t][1]&&e[t][1](e[t][2])})},_showProgress:function(){"document"in g&&(this._requestLevel++,this._requestLevel>0&&g.document.documentElement.classList.add("busy"))},_hideProgress:function(){"document"in g&&(this._requestLevel--,this._requestLevel||setTimeout(()=>{0===this._requestLevel&&g.document.documentElement.classList.remove("busy")},250))},header:function(t,e){return null===e?delete this.headers[t]:this.headers[t]=e,this},encodeParams:function(t){let e=[];if(t instanceof FormData)for(let s of t.entries())e.push(encodeURIComponent(s[0])+"="+encodeURIComponent(s[1]));else for(let s in t)e.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e.join("&")},getUrl:function(t){return -1!==t.indexOf("//")?t:this.apiUrl+t},appendParam:function(t,e){return t+(-1==t.indexOf("?")?"?":"&")+e},apiCall:function(t,e,s,n=null,a=null,o=""){let r=this.getUrl(o??"");if(this.flags&L.UNIQUE_STAMP&&(r=this.appendParam(r,"_="+Date.now())),null===(n=n?n.toUpperCase():null)&&(n="auto"),null===a&&(a=this.retries),this._requestPackage&&this.flags&L.REQUEST_PACKAGE_SUPPORTED){t instanceof FormData||(t={...t}),this._packageData.push([e,s,t]);return}this._showProgress();let l=t,h={mode:this.flags&L.DISABLE_CORS?"no-cors":"cors",headers:{Accept:"text/html,application/xhtml+xml,application/xml,application/json;q=0.9",...this.headers},method:n,body:null,multipart:!1};if(this.flags&L.INCLUDE_CREDENTIALS&&(h.credentials="include"),"string"==typeof l||l instanceof Blob)"string"==typeof l?"<"===l[0]?l.endsWith("</soap:Envelope>")?h.headers["Content-Type"]="application/soap+xml":h.headers["Content-Type"]="application/xml":"{"===l[0]||"["===l[0]?h.headers["Content-Type"]="application/json":h.headers["Content-Type"]="application/octet-stream":h.headers["Content-Type"]=l.type,"auto"===h.method&&(h.method="POST"),h.body=l;else{if(!(l instanceof FormData))for(let e in l=new FormData,t)t[e]instanceof File||t[e]instanceof Blob?l.append(e,t[e],t[e].name):l.append(e,t[e]);for(let t of l.entries())if(t[1]instanceof File||t[1]instanceof Blob){"auto"===h.method&&(h.method="POST"),h.multipart=!0;break}if(this.useReq64&&this.flags&L.REQ64_SUPPORTED&&!h.multipart){let t=new FormData;t.append("req64",u.encode(this.encodeParams(l))),l=t}if("auto"===h.method){let t=0;for(let e of(h.method="GET",l.entries()))if((t+=e[0].length+e[1].length+2)>960){h.method="POST";break}}"GET"===h.method||"DELETE"===h.method||"TRACE"===h.method||"OPTIONS"===h.method||"HEAD"===h.method?r=this.appendParam(r,this.encodeParams(l)):h.multipart?h.body=l:(h.headers["Content-Type"]="application/x-www-form-urlencoded",h.body=this.encodeParams(l))}g.fetch(r,h).then(t=>this.decodeResult(t)).then(s=>{if(this._hideProgress(),e&&this.responseFilter(s,t))try{e(s,t)}catch(t){}}).catch(r=>{this._hideProgress(),0==a?s&&s(r,t):this.apiCall(l,e,s,n,a-1,o)})},decodeResult:function(t){let e=t.headers.get("content-type").split(";")[0].toLowerCase();return this.flags&L.JSON_RESPONSE_SUPPORTED&&-1!==e.indexOf("json")?this.flags&L.WIND_V3?async function(){let e=await t.json();return e.response=t.status,e}():t.json():this.flags&L.XML_RESPONSE_SUPPORTED&&-1!==e.indexOf("xml")?new Promise((e,s)=>{t.text().then(t=>{e(t=(new DOMParser).parseFromString(t,"text/xml"))}).catch(s)}):t.blob()},getBlob:function(t,e){return new Blob([t],{type:e})},base64:{encode:function(t){return u.encode(t)},decode:function(t){return u.decode(t)}},request:function(t,e,s=null){return null===s&&"string"!=typeof e&&(s=e,e=""),new Promise((n,a)=>{this.apiCall(s,n,a,null,t,e)})},post:function(t=null,e=null){return this.fetch("POST",t,e)},get:function(t=null,e=null){return this.fetch("GET",t,e)},put:function(t=null,e=null){return this.fetch("PUT",t,e)},patch:function(t=null,e=null){return this.fetch("PATCH",t,e)},delete:function(t=null,e=null){return this.fetch("DELETE",t,e)},fetch:function(t,e=null,s=null){let n=!0;if("string"==typeof t){let e=t.toUpperCase();("GET"===e||"POST"===e||"PUT"===e||"DELETE"===e||"PATCH"===e||"HEAD"===e||"OPTIONS"===e)&&(n=!1)}return n&&(s=e,e=t,t=null),null===s&&"string"!=typeof e&&(s=e,e=""),new Promise((n,a)=>{this.apiCall(s,n,a,t,null,e)})},makeUrl:function(t,e=null){return null===e&&"string"!=typeof t&&(e=t,t=""),this.appendParam(this.getUrl(t),this.encodeParams(e))}},k=n.extend({className:"DataSource",debounceDelay:250,request:null,includeCount:!1,includeEnum:!1,includeList:!0,eid:null,count:0,list:null,enum:null,__ctor:function(t,e){this._super.EventDispatcher.__ctor(),this.basePath=t,e&&Object.assign(this,e),this.request=new a(this.request),this.eid=Math.random().toString().substr(2),this.count=0,this.list=new o,this.list.dataSource=this,this.enum=new o,this.enum.dataSource=this,this.request.addEventListener(this.eid+":propertyChanged",this.forwardRequestEvent,this),this.list.addEventListener(this.eid+":itemsCleared",this.forwardListEvent,this),this.list.addEventListener(this.eid+":itemsChanged",this.forwardListEvent,this),this.list.addEventListener(this.eid+":itemRemoved",this.forwardListEvent,this),this.list.addEventListener(this.eid+":itemChanged",this.forwardListEvent,this),this.list.addEventListener(this.eid+":itemAdded",this.forwardListEvent,this),this.enum.addEventListener(this.eid+":itemsCleared",this.forwardEnumEvent,this),this.enum.addEventListener(this.eid+":itemsChanged",this.forwardEnumEvent,this),this.enum.addEventListener(this.eid+":itemRemoved",this.forwardEnumEvent,this),this.enum.addEventListener(this.eid+":itemChanged",this.forwardEnumEvent,this),this.enum.addEventListener(this.eid+":itemAdded",this.forwardEnumEvent,this)},forwardRequestEvent:function(t,e){this.prepareEvent("request"+t.name[0].toUpperCase()+t.name.substr(1),e).setSource(t.source).resume()},forwardListEvent:function(t,e){this.prepareEvent("list"+t.name[0].toUpperCase()+t.name.substr(1),e).setSource(t.source).resume()},forwardEnumEvent:function(t,e){this.prepareEvent("enum"+t.name[0].toUpperCase()+t.name.substr(1),e).setSource(t.source).resume()},refresh:function(t="full",e=null){"function"==typeof t&&(e=t,t="full"),this._timeout&&(clearTimeout(this._timeout),this._timeout=null);let s=()=>{this._timeout=null,L.packageBegin(),this.includeCount&&("full"===t||"filter"===t)&&this.fetchCount(),this.includeEnum&&("full"===t||"enum"===t)&&this.fetchEnum(),this.includeList&&"enum"!==t&&this.fetchList(),L.packageEnd(e)};!0===t?(t="full",s()):this._timeout=setTimeout(s,this.debounceDelay)},fetch:function(t,e=!1){return new Promise((s,n)=>{let a=!0==e?null:this.list.find(t,!0);a?s(a.get()):this.fetchOne(t,t=>{t&&200==t.response&&t.data.length>0?s(t.data[0]):n(t)})})},delete:function(t){return new Promise((e,s)=>{this.fetchDelete(t,t=>{200==t.response?e(t):s(t.error)})})},fetchList:function(){let t={...this.request.get()};t.f=this.basePath+".list",this.dispatchEvent("listLoading"),L.fetch(t).then(t=>{this.list.setData(200==t.response?t.data:null),this.dispatchEvent("listLoaded"),this.dispatchEvent("listChanged")})},fetchEnum:function(){let t={...this.request.get()};t.f=this.basePath+".enum",this.dispatchEvent("enumLoading"),L.fetch(t).then(t=>{this.enum.setData(200==t.response?t.data:null),this.dispatchEvent("enumLoaded"),this.dispatchEvent("enumChanged")})},fetchCount:function(){let t={...this.request.get()};t.f=this.basePath+".count",this.dispatchEvent("countLoading"),L.fetch(t).then(t=>{this.count=200==t.response?t.count:0,this.dispatchEvent("countLoaded"),this.dispatchEvent("countChanged")})},fetchOne:function(t,e){let s={...this.request.get(),...t};s.f=this.basePath+".get",L.fetch(s).then(t=>{e(t)})},fetchDelete:function(t,e){let s={...this.request.get(),...t};s.f=this.basePath+".delete",L.fetch(s).then(t=>{e(t)})},fetchData:function(t){let e={...this.request.get(),...t};return"."==e.f[0]&&(e.f=this.basePath+e.f),L.fetch(e)},makeUrl:function(t){let e={...this.request.get(),...t};return"."==e.f[0]&&(e.f=this.basePath+e.f),L.makeUrl(e)}});k.globals={},k.get=function(t,e=!1){if(!(t in k.globals)){if(!e)return null;k.globals[t]=new k(t.split(":").at(-1))}return k.globals[t]};let C=o.extend({className:"DataList",debounceDelay:250,request:null,eid:null,__ctor:function(t,e=null){this._super.ModelList.__ctor(),null!==e&&Object.assign(this,e),this.request||(this.request={}),this.request.f=t,this.request=new a(this.request),this.eid=Math.random().toString().substr(2),this.dataList=this,this.request.addEventListener(this.eid+":propertyChanged",this.forwardRequestEvent,this)},forwardRequestEvent:function(t,e){this.prepareEvent("request"+t.name[0].toUpperCase()+t.name.substr(1),e).setSource(t.source).resume()},refresh:function(t=null,e=null){if(this._timeout&&(clearTimeout(this._timeout),this._timeout=null),!0===t){this.dispatchEvent("listLoading"),L.fetch(this.request.get()).then(t=>{this.setData(200==t.response?t.data:null),this.dispatchEvent("listLoaded"),this.dispatchEvent("listChanged"),null!==e&&e()});return}this._timeout=setTimeout(()=>{this.refresh(!0,t)},this.debounceDelay)}});C.globals={},C.get=function(t,e=!1){if(!(t in C.globals)){if(!e)return null;C.globals[t]=new C(t.split(":").at(-1))}return C.globals[t]};let S={interpolate:function(t,e,s,n,a){let o={},r={},l=0;for(let e in t)o[e]=0,r[e]=t[e],l++;let h=Date.now()/1e3,c=0,u=function(){let d=Date.now()/1e3;for(let a in c=d-h,h=d,o){if(o[a]==s[a])continue;o[a]+=c,o[a]>=s[a]&&(o[a]=s[a],l--);let h=n[a](o[a]/s[a]);r[a]=(1-h)*t[a]+h*e[a]}a(r,0==l),0!=l&&requestAnimationFrame(u)};u()},Linear:{IN:function(t){return t},OUT:function(t){return t},IN_OUT:function(t){return t}},Back:{k:1.70158,IN:function(t,e){return void 0===e&&(e=S.Back.k),t*t*((e+1)*t-e)},OUT:function(t,e){return 1-S.Back.IN(1-t,e)},IN_OUT:function(t,e){return t<.5?S.Back.IN(2*t,e)/2:S.Back.OUT((t-.5)*2,e)/2+.5}},Bounce:{getConst:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},IN:function(t){return 1-S.Bounce.getConst(1-t)},OUT:function(t){return S.Bounce.getConst(t)},IN_OUT:function(t){return t<.5?(1-S.Bounce.getConst(1-2*t))/2:S.Bounce.getConst((t-.5)*2)/2+.5}},Circ:{IN:function(t){return 1-Math.sqrt(1-t*t)},OUT:function(t){return 1-S.Circ.IN(1-t)},IN_OUT:function(t){return t<.5?S.Circ.IN(2*t)/2:S.Circ.OUT((t-.5)*2)/2+.5}},Cubic:{IN:function(t){return t*t*t},OUT:function(t){return 1-S.Cubic.IN(1-t)},IN_OUT:function(t){return t<.5?S.Cubic.IN(2*t)/2:S.Cubic.OUT((t-.5)*2)/2+.5}},Expo:{IN:function(t){return Math.pow(2,12*(t-1))},OUT:function(t){return-Math.pow(2,-12*t)+1},IN_OUT:function(t){return(t*=2)<1?Math.pow(2,12*(t-1))/2:(-Math.pow(2,-12*(t-1))+2)/2}},Power:{p:12,IN:function(t){return Math.pow(t,S.Power.p)},OUT:function(t){return 1-S.Power.IN(1-t)},IN_OUT:function(t){return t<.5?S.Power.IN(2*t)/2:S.Power.OUT((t-.5)*2)/2+.5}},Quad:{IN:function(t){return t*t},OUT:function(t){return 1-S.Quad.IN(1-t)},IN_OUT:function(t){return t<.5?S.Quad.IN(2*t)/2:S.Quad.OUT((t-.5)*2)/2+.5}},Quartic:{IN:function(t){return t*t*t*t},OUT:function(t){return 1-S.Quartic.IN(1-t)},IN_OUT:function(t){return t<.5?S.Quartic.IN(2*t)/2:S.Quartic.OUT((t-.5)*2)/2+.5}},Quintic:{IN:function(t){return t*t*t*t*t},OUT:function(t){return 1-S.Quintic.IN(1-t)},IN_OUT:function(t){return t<.5?S.Quintic.IN(2*t)/2:S.Quintic.OUT((t-.5)*2)/2+.5}},Sine:{IN:function(t){return 1-Math.sin(1.5708*(1-t))},OUT:function(t){return Math.sin(1.5708*t)},IN_OUT:function(t){return-((Math.cos(3.1416*t)-1)/2)}},Step:{IN:function(t){return 1!=t?0:1},OUT:function(t){return 1!=t?0:1},IN_OUT:function(t){return 1!=t?0:1}}},T=e.extend({list:null,initialData:null,data:null,stack:null,block:null,timeScale:1,time:0,blockTime:0,index:0,paused:!1,finished:!1,onFinishedCallback:null,onUpdatedCallback:null,__ctor:function(){this.list=[],this.initialData={},this.data={},this.stack=[],this.block=this.list,this.reset()},__dtor:function(){},clone:function(){let t=new T;return t.list=this.list,t.initialData=this.initialData,t.reset()},onFinished:function(t){return this.onFinishedCallback=t,this},onUpdated:function(t){return this.onUpdatedCallback=t,this},reset:function(){for(let t in this.stack.length=0,this.blockTime=0,this.time=0,this.index=0,this.block=this.list,this.paused=!0,this.finished=!1,this.handle=null,this.initialData)this.data[t]=this.initialData[t];return this},initial:function(t){return this.initialData=t,this.reset()},speed:function(t){return this.timeScale=t>0?t:1,this},setOutput:function(t){return this.data=t,this},pause:function(){this.paused||(clearInterval(this.handle),this.paused=!0)},resume:function(){if(!this.paused)return;let t=Date.now()/1e3;this.handle=setInterval(()=>{let e=Date.now()/1e3,s=e-t;t=e,this.update(s),this.onUpdatedCallback&&this.onUpdatedCallback(this.data,this)},16),this.onUpdatedCallback&&this.onUpdatedCallback(this.data,this),this.paused=!1},update:function(e){let s,n,a;if(this.paused)return!1;if(this.index>=this.block.length)return!0;let o=0;for(this.time+=e*this.timeScale;this.index<this.block.length;){let r,l=this.block[this.index];switch(l.op){case"parallel":if(!1==l.started)for(o=0,l.blocks.length=0,l.started=!0;o<l.block.length;o++)l.blocks.push([l.block[o]]),l.indices[o]=0,l.blockTimes[o]=this.blockTime;s=this.block,n=this.index;let h=0,c=a=this.blockTime;for(o=0;o<l.blocks.length;o++)this.block=l.blocks[o],this.index=l.indices[o],this.blockTime=l.blockTimes[o],!0===this.update(0)&&h++,this.blockTime>c&&(c=this.blockTime),l.blockTimes[o]=this.blockTime,l.blocks[o]=this.block,l.indices[o]=this.index;if(this.block=s,this.index=n,this.blockTime=a,l.fn&&l.fn.call(this),h!=l.blocks.length)return!1;l.started=!1,this.blockTime=c,this.index++;break;case"serial":if(!1==l.started&&(l._block=l.block,l._index=0,l._blockTime=this.blockTime,l.started=!0),s=this.block,n=this.index,a=this.blockTime,this.block=l._block,this.index=l._index,this.blockTime=l._blockTime,o=this.update(0),l._block=this.block,l._index=this.index,l._blockTime=this.blockTime,this.block=s,this.index=n,this.blockTime=a,l.fn&&l.fn.call(this),!0!==o)return!1;l.started=!1,this.blockTime=l._blockTime,this.index++;break;case"repeat":if(!1==l.started&&(l._block=l.block,l._index=0,l._blockTime=this.blockTime,l._count=l.count,l.started=!0),s=this.block,n=this.index,a=this.blockTime,this.block=l._block,this.index=l._index,this.blockTime=l._blockTime,o=this.update(0),l._block=this.block,l._index=this.index,l._blockTime=this.blockTime,this.block=s,this.index=n,this.blockTime=a,l.fn&&l.fn.call(this),!0!==o)return!1;if(l._count<=1)return l.started=!1,this.blockTime=l._blockTime,this.index++,!1;return l._index=0,l._count--,!1;case"set":this.data[l.field]=l.value,this.index++;break;case"restart":this.index=0;break;case"wait":if(r="string"==t.typeOf(l.duration)?this.data[l.duration]:l.duration,this.time<this.blockTime+r)return!1;this.blockTime+=r,this.index++;break;case"range":if(!1==l.started&&(null===l.startValue?l._startValue=this.data[l.field]:l._startValue=l.startValue,l._endValue=l.endValue,l.started=!0),r="string"==t.typeOf(l.duration)?this.data[l.duration]:l.duration,e=this.time<this.blockTime+r?(this.time-this.blockTime)/r:1,l.easing&&1!=e?this.data[l.field]=l.easing(e)*(l._endValue-l._startValue)+l._startValue:this.data[l.field]=e*(l._endValue-l._startValue)+l._startValue,1!=e)return!1;l.started=!1,this.blockTime+=r,this.index++;break;case"rand":if(!1==l.started&&(l.started=!0,l.last=null),r="string"==t.typeOf(l.duration)?this.data[l.duration]:l.duration,e=this.time<this.blockTime+r?(this.time-this.blockTime)/r:1,l.easing&&1!=e?l.cur=~~(l.easing(e)*l.count):l.cur=~~(e*l.count),l.cur!=l.last){for(;(o=~~(Math.random()*(l.endValue-l.startValue+1))+l.startValue)==this.data[l.field];);this.data[l.field]=o,l.last=l.cur}if(1!=e)return!1;l.started=!1,this.blockTime+=r,this.index++;break;case"randt":if(r="string"==t.typeOf(l.duration)?this.data[l.duration]:l.duration,e=this.time<this.blockTime+r?(this.time-this.blockTime)/r:1,o=l.easing&&1!=e?l.easing(e)*(l.count-1):e*(l.count-1),this.data[l.field]=l.table[~~((o+l.count)%l.count)],1!=e)return!1;this.blockTime+=r,this.index++;break;case"play":l.snd.play(),this.index++;break;case"exec":l.fn.call(this,this),this.index++}}return this.block==this.list&&(this.finished||null==this.onFinishedCallback||this.onFinishedCallback(),this.pause(),this.finished=!0),!0},parallel:function(){let t=[];return this.block.push({op:"parallel",started:!1,block:t,blocks:[],indices:[],blockTimes:[]}),this.stack.push(this.block),this.block=t,this},serial:function(){let t=[];return this.block.push({op:"serial",started:!1,block:t}),this.stack.push(this.block),this.block=t,this},repeat:function(t){let e=[];return this.block.push({op:"repeat",started:!1,block:e,count:t}),this.stack.push(this.block),this.block=e,this},callback:function(t){let e=this.stack[this.stack.length-1];return e[e.length-1].fn=t,this},end:function(){return this.block=this.stack.pop(),this},set:function(t,e){return this.block.push({op:"set",field:t,value:e}),this},restart:function(t){return this.block.push({op:"restart"}),this},wait:function(t){return this.block.push({op:"wait",duration:t}),this},range:function(t,e,s,n,a){return this.block.push({op:"range",started:!1,field:t,duration:e,startValue:s,endValue:n,easing:a||null}),this},rand:function(t,e,s,n,a,o){return this.block.push({op:"rand",started:!1,field:t,duration:e,count:s,startValue:n,endValue:a,easing:o||null}),this},randt:function(t,e,s,n,a,o){let r=[];for(let t=0;t<s;t++)r.push(t%(a-n+1)+n);for(let t=s>>2;t>0;t--){let t=~~(Math.random()*s),e=~~(Math.random()*s),n=r[e];r[e]=r[t],r[t]=n}return this.block.push({op:"randt",field:t,duration:e,count:s,startValue:n,endValue:a,table:r,easing:o||null}),this},play:function(t){return this.block.push({op:"play",snd:t}),this},exec:function(t){return this.block.push({op:"exec",fn:t}),this}});var x=E.register("r-tabs",{container:null,activeTab:null,"event click [data-name]":function(t){if(t.continuePropagation=!0,this.dataset.baseRoute){location="#"+b.realLocation(this.dataset.baseRoute.replace("@",t.source.dataset.name));return}this.selectTab(t.source.dataset.name)},init:function(){this._routeHandler=(t,e)=>{""!=b.location&&this.querySelectorAll("[href]").forEach(t=>{t.href&&(b.location.startsWith(t.href.substr(t.href.indexOf("#")+1))?(t.classList.add("is-active"),t.classList.remove("is-inactive")):(t.classList.add("is-inactive"),t.classList.remove("is-active")),t.classList.remove("anim-ended"),t.onanimationend=()=>{t.onanimationend=null,t.classList.add("anim-ended")})}),e.route.changed&&this.showTab(e.tabName)}},ready:function(){"container"in this.dataset?":previousElement"==this.dataset.container?this.container=this.previousElementSibling:":nextElement"==this.dataset.container?this.container=this.nextElementSibling:":none"==this.dataset.container?this.container=null:this.container=document.querySelector(this.dataset.container):this.container=this.nextElementSibling,this._hideTabsExcept(this.dataset.initial)},onConnected:function(){this.dataset.baseRoute&&b.addRoute(this.dataset.baseRoute.replace("@",":tabName"),this._routeHandler)},onDisconnected:function(){this.dataset.baseRoute&&b.removeRoute(this.dataset.baseRoute.replace("@",":tabName"),this._routeHandler)},_hideTabsExcept:function(t){t||(t=""),null!=this.container&&this.container.querySelectorAll(":scope > [data-name]").forEach(e=>{e.dataset.name===t?(e.classList.remove("is-hidden"),this.dispatch("tabShown",{name:e.dataset.name,el:e})):(e.classList.add("is-hidden"),this.dispatch("tabHidden",{name:e.dataset.name,el:e}))}),this.querySelectorAll("[data-name]").forEach(e=>{e.dataset.name===t?(e.classList.add("is-active"),e.classList.remove("is-inactive")):(e.classList.add("is-inactive"),e.classList.remove("is-active")),e.classList.remove("anim-ended"),e.onanimationend=()=>{e.onanimationend=null,e.classList.add("anim-ended")}}),this.activeTab=t,this.dispatch("tabChanged",{name:t,el:this})},showTab:function(t){return this._hideTabsExcept(t)},selectTab:function(t){if(this.dataset.baseRoute){let e="#"+b.realLocation(this.dataset.baseRoute.replace("@",t));if(location.hash!=e){location=e;return}}this.showTab(t)}}),P=E.register("r-form",{isRoot:!0,model:{},events:{"change [data-field]":"_fieldChanged","click input[type=reset]":"reset","click .reset":"reset","click input[type=submit]":"submit","click button[type=submit]":"submit","click .submit":"submit","submit form":"submit"},ready:function(){let t=document.createElement("form");t.append(...this.childNodes),this.append(t);let e={},s=this.model.get();for(let t in this.querySelectorAll("[data-field]").forEach(t=>{t.name=t.dataset.field,s[t.name]=t.type;let n=t.dataset.default;if(void 0==n)switch(t.type){case"radio":if(!t.checked)return;n=t.value;break;case"checkbox":n=t.checked?"1":"0";break;case"field":n=t.getValue();break;default:n=""}e[t.dataset.field]=n}),s)t in e?s[t]=e[t]:s[t]="";e=s,this.model.defaults=e,this.model.reset(),this.clearMarkers()},filterString:function(t,e){return t&&"messages"in g&&t.startsWith("@messages.")&&t.substr(10)in g.messages&&(t=c.eval(g.messages[t.substr(10)],e)),t},_change:function(t){if("createEvent"in document){let e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),t.dispatchEvent(e)}else t.fireEvent("onchange")},_setField:function(t,e,s){if(t)for(t of this.querySelectorAll('[data-field="'+t+'"]'))switch(t.type||t.tagName.toLowerCase()){case"select":t.val=t.dataset.value=t.multiple&&e?e.split(","):e,t.value=t.val=t.dataset.value,!0!==s&&this._change(t);break;case"checkbox":t.checked=!!parseInt(e);break;case"radio":t.checked=e==t.value;break;case"field":t.val=t.dataset.value=e,t.setValue(e);break;case"file":e instanceof File||e instanceof Blob?(t.val=e,t.dataset.value=e):e instanceof FileList?(t.val=e,t.dataset.value=e):(t.val=t.dataset.value="",t.value="");break;default:t.val=t.dataset.value=e,t.value=e,!0!==s&&this._change(t)}},_getField:function(t,e=null,s=!1){if(!t)return null;if("string"!=typeof t){let n=null==t.value?t.val:t.value;switch(null===n&&(n=e),t.type||t.tagName.toLowerCase()){case"select":e=t.multiple&&n?n.join(","):n;break;case"checkbox":e=t.checked?"1":"0";break;case"radio":t.checked&&(e=t.value);break;case"field":e=t.getValue();break;case"file":e=s?t.files&&t.files.length?t.multiple?t.files:t.files[0]:null:t.val;break;default:e=n}return null===e?"":e}for(t of(e=null,this.querySelectorAll('[data-field="'+t+'"]')))e=this._getField(t,e);return null===e?"":e},getField:function(t){return this._getField(t)},clearMarkers:function(){this.classList.remove("busy"),this.querySelectorAll(".message").forEach(t=>t.classList.add("is-hidden")),this.querySelectorAll("span.field-error").forEach(t=>t.remove()),this.querySelectorAll(".field-error").forEach(t=>{t.classList.remove("field-error"),t.classList.remove("is-invalid")}),this.querySelectorAll(".field-passed").forEach(t=>t.classList.remove("field-passed"))},_fieldChanged:function(t){let e=t.source;"file"==e.type?this.model.set(e.dataset.field,this._getField(e,null,!0),!0):this.model.set(e.dataset.field,this._getField(e)),t.continuePropagation=!0},onModelPropertyChanged:function(t,e){this._setField(e.name,e.value)},_onSuccess:function(t){let e;this.classList.remove("busy"),this.clearMarkers(),this.dispatch("formSuccess",t),t.message&&null!=(e=this.querySelector(".message.success"))&&(e.innerHTML=this.filterString(t.message,t).replace(/\n/g,"<br/>"),e.classList.remove("is-hidden"),e.onanimationend=()=>e.classList.add("is-hidden"))},_onFailure:function(t){let e;if(this.classList.remove("busy"),this.clearMarkers(),this.dispatch("formError",t),t.fields){for(let e in t.fields){let s=this.querySelector('[data-field-container="'+e+'"]');if(!s&&!(s=this.querySelector('[data-field="'+e+'"]')))continue;s.classList.add("field-error"),s.classList.add("is-invalid");let n=this.filterString(t.fields[e],t).replace(/\n/g,"<br/>");if(!n)continue;let a=document.createElement("span");a.classList.add("field-error"),a.innerHTML=n,"bottom"==this.dataset.errorsAt?s.parentElement.append(a):"top"==this.dataset.errorsAt?s.parentElement.prepend(a):s.parentElement.insertBefore(a,s.nextElementSibling),setTimeout(function(t){return function(){t.classList.add("active")}}(a),25)}t.error&&null!=(e=this.querySelector(".message.error"))&&(e.innerHTML=this.filterString(t.error,t).replace(/\n/g,"<br/>"),e.classList.remove("is-hidden"),e.onanimationend=()=>e.classList.add("is-hidden"))}else null!=(e=this.querySelector(".message.error"))&&(e.innerHTML=this.filterString(t.error,t).replace(/\n/g,"<br/>")||"Error: "+t.response,e.classList.remove("is-hidden"),e.onanimationend=()=>e.classList.add("is-hidden"))},reset:function(t){if(this.model.reset(t),this.clearMarkers(),!1===t)for(var e in this.model.data)this._setField(e,this.model.data[e],!0);return!1},submit:async function(){if(this.classList.contains("busy"))return;let t={};"false"===this.dataset.strict&&Object.assign(t,this.model.get());let e={};this.querySelectorAll("[data-field]").forEach(t=>e[t.dataset.field]=!0),Object.keys(e).forEach(e=>t[e]=this._getField(e)),this.constraints&&(t=new a(t,null,this.constraints).get()),this.dispatch("beforeSubmit",t),this.model.set(t),this.preprocess&&await this.preprocess(t);let s=this.dataset.formAction||this.formAction;if(s){if(this.classList.add("busy"),"function"!=typeof s){let e=-1!==s.indexOf("/");e||(t.f=s),L.apiCall(e?JSON.stringify(t):t,t=>this[200==t.response?"_onSuccess":"_onFailure"](t),t=>this._onFailure({error:"Unable to execute request."}),this.dataset.method??"POST",null,e?s:null)}else s(t,t=>this[200==t.response?"_onSuccess":"_onFailure"](t))}}}),A=E.register("r-panel",{route:null,init:function(){this.style.display="",this._onActivate=(t,e)=>{e.route.changed&&this.show(!0)},this._onDeactivate=(t,e)=>{this.hide()},this.hide()},onConnected:function(){this.dataset.route?(this.route=b.addRoute(this.dataset.route,this._onActivate,this._onDeactivate),this.classList.remove("is-active"),this.classList.add("is-inactive")):this.classList.contains("is-inactive")||(this.classList.add("is-active"),this.classList.remove("is-inactive")),this.classList.add("anim-ended")},onDisconnected:function(){this.dataset.route&&b.removeRoute(this.dataset.route,this._onActivate,this._onDeactivate)},hide:function(){this.dispatch("panelHidden",this.route?this.route.args:{}),this.classList.remove("anim-ended"),this.classList.remove("is-active"),this.classList.add("is-inactive"),this.classList.add("anim-out"),this.onanimationend=()=>{this.classList.add("anim-ended"),this.onanimationend=null}},show:function(t=!1){if(this.dataset.route&&!t){let t="#"+this.dataset.route;if(window.location.hash.substr(0,t.length)!=t){window.location=t;return}}this.dispatch("panelShown",this.route?this.route.args:{}),this.classList.remove("anim-ended"),this.classList.remove("is-inactive"),this.classList.add("is-active"),this.onanimationend=()=>{this.classList.add("anim-ended"),this.onanimationend=null}},toggleVisibility:function(t=!1){this.classList.contains("is-active")?this.hide():this.show(t)}}),R=E.register("r-list",{list:null,container:null,template:null,isEmpty:!1,isDynamicTemplate:!1,ready:function(){this.container=this.querySelector(this.dataset.container||".x-data"),this.container||(this.container=document.createElement("div"),this.container.className="x-data",this.appendChild(this.container));let t=this.template_elem=this.querySelector("template");t?("dynamic"!=t.dataset.mode?this.template=c.compile(t.innerHTML):(this.template=()=>t.innerHTML,this.isDynamicTemplate=!0),t.remove()):this.template=()=>"",this.container.textContent=" ",this.setEmpty(null),this.setLoading(null)},rready:function(){let t=this.dataList;if(t?"string"==typeof t&&(t=C.get(t,!0)):t=this.getFieldByPath(this.dataset.list),!t){this.dataset.list&&console.error("data-list not found: "+this.dataset.list);return}this.setList(t)},setEmpty:function(t){this.isEmpty!==t&&(!0===t?(this.querySelectorAll(".x-empty").forEach(t=>t.classList.remove("is-hidden")),this.querySelectorAll(".x-not-empty").forEach(t=>t.classList.add("is-hidden")),this.querySelectorAll(".x-empty-null").forEach(t=>t.classList.add("is-hidden"))):!1===t?(this.querySelectorAll(".x-empty").forEach(t=>t.classList.add("is-hidden")),this.querySelectorAll(".x-not-empty").forEach(t=>t.classList.remove("is-hidden")),this.querySelectorAll(".x-empty-null").forEach(t=>t.classList.add("is-hidden"))):(this.querySelectorAll(".x-empty").forEach(t=>t.classList.add("is-hidden")),this.querySelectorAll(".x-not-empty").forEach(t=>t.classList.add("is-hidden")),this.querySelectorAll(".x-empty-null").forEach(t=>t.classList.remove("is-hidden"))),this.isEmpty=t)},setLoading:function(t){!0===t?this.querySelectorAll(".is-loading").forEach(t=>t.classList.remove("is-hidden")):this.querySelectorAll(".is-loading").forEach(t=>t.classList.add("is-hidden"))},setList:function(e){e&&t.isInstanceOf(e,o)&&this.list!==e&&(null!=this.list&&(this.list.dataSource&&this.list.dataSource.removeEventListener(this.eid+":*"),this.list.dataList&&this.list.dataList.removeEventListener(this.eid+":*"),this.list.removeEventListener(this.eid+":*")),this.list=e,this.list.dataSource&&(this.list.dataSource.addEventListener(this.eid+":listLoading",this.onLoading,this),this.list.dataSource.addEventListener(this.eid+":listLoaded",this.onLoaded,this)),this.list.dataList&&(this.list.dataList.addEventListener(this.eid+":listLoading",this.onLoading,this),this.list.dataList.addEventListener(this.eid+":listLoaded",this.onLoaded,this)),this.list.addEventListener(this.eid+":itemsCleared",this.onItemsCleared,this),this.list.addEventListener(this.eid+":itemsChanged",this.onItemsChanged,this),this.list.addEventListener(this.eid+":itemRemoved",this.onItemRemoved,this),this.list.addEventListener(this.eid+":itemChanged",this.onItemChanged,this),this.list.addEventListener(this.eid+":itemAdded",this.onItemAdded,this))},buildItem:function(t,e,s=!1){if(this.content){let s=this.content(e.get(),e);return s.dataset.iid=t,s}if(this.container.content){let s=this.container.content(e.get(),e);return s.dataset.iid=t,s}let n=this.template(e.get());if(s)return n;let a=document.createElement("div");for(let s of(a.dataset.iid=t,a.innerHTML=n,a.querySelectorAll('[data-model=":list-item"]').forEach(t=>{t.model=e,t.dataset.model="this.model"}),this.template_elem.attributes))s.nodeName.startsWith("data-_")||"data-mode"==s.nodeName||a.setAttribute(s.nodeName,s.nodeValue);return a},onLoading:function(){this.setLoading(!0)},onLoaded:function(){this.setLoading(!1)},onItemsCleared:function(){this.container._timeout=setTimeout(()=>{this.setEmpty(!0),this.container._timeout=null,this.container.textContent=""},300)},onItemsChanged:function(){if(0==this.list.length())return;this.container._timeout&&clearTimeout(this.container._timeout),this.container._timeout=null,this.container.textContent="";let t=0;for(let e of this.list.getData())"false"!=this.dataset.wrap?this.container.append(this.buildItem(this.list.itemId[t++],e)):this.container.innerHTML+=this.buildItem(this.list.itemId[t++],e,!0);this.setEmpty(0==t)},onItemRemoved:function(t,e){if("false"==this.dataset.wrap){this.onItemsChanged();return}let s=this.container.querySelector('[data-iid="'+e.id+'"]');s&&(s.remove(),this.setEmpty(0==this.list.length()))},onItemChanged:function(t,e){if(this.isDynamicTemplate)return;if("false"==this.dataset.wrap){this.onItemsChanged();return}let s=this.container.querySelector('[data-iid="'+e.id+'"]');s&&(s.innerHTML=this.template(e.item))},onItemAdded:function(t,e){"head"==e.position?"false"!=this.dataset.wrap?this.container.prepend(this.buildItem(e.id,e.item)):this.container.innerHTML=this.buildItem(e.id,e.item,!0)+this.container.innerHTML:"false"!=this.dataset.wrap?this.container.append(this.buildItem(e.id,e.item)):this.container.innerHTML+=this.buildItem(e.id,e.item,!0),this.setEmpty(!1)},refresh:function(){this.onItemsChanged()}}),w=E.register("r-item",{isRoot:!0,init:function(){},rready:function(){let t=this.dataModel??this.getFieldByPath(this.dataset.model);t||(t={}),this.setModel(t)}}),O=E.register("r-paginator",{isRoot:!0,source:null,template:null,init:function(){this.setModel({offsetStart:0,offsetEnd:0,count:0,offset:0,currentPageSize:this.dataset.pageSize||25,pageSize:this.dataset.pageSize||25}),this.listen("propertyChanged.pageSize",(t,e)=>{this.model.get("currentPageSize")!=e.value&&(this.model.set("currentPageSize",e.value),this.updateOffset("range"))})},rready:function(){let t=this.dataSource;if(t?"string"==typeof t&&(t=k.get(t,!0)):t=this.getFieldByPath(this.dataset.source),!t){this.dataset.source&&console.error("data-source not found: "+this.dataset.source);return}this.setSource(t)},setSource:function(e){e&&t.isInstanceOf(e,k)&&this.source!==e&&(null!=this.source&&(this.source.removeEventListener(this.eid+":*"),this.source.includeCount=!1),this.source=e,this.source.includeCount=!0,this.updateOffset(),this.source.addEventListener(this.eid+":requestPropertyChanged",this.onRequestPropertyChanged,this),this.source.addEventListener(this.eid+":countChanged",this.onCountChanged,this),this.source.addEventListener(this.eid+":listItemRemoved",this.onItemRemoved,this),this.source.addEventListener(this.eid+":listItemAdded",this.onItemAdded,this),this.source.setNamespace(this.eid),this.source.request.update(!0),this.source.setNamespace(null))},updateOffset:function(t=null){this.model.set("offsetStart",0!=this.model.get("count")?this.model.get("offset")+1:0),this.model.set("offsetEnd",Math.min(this.model.get("count"),this.model.get("offsetStart")+this.model.getInt("pageSize")-1)),this.model.update("count");let e=this.source.request.get("count"),s=this.source.request.get("offset");this.source.request.set("count",this.model.getInt("pageSize")),this.source.request.set("offset",this.model.get("offset")),t&&(e!=this.source.request.get("count")||s!=this.source.request.get("offset"))&&this.source.refresh(t)},onRequestPropertyChanged:function(t,e){"count"!=e.name&&"offset"!=e.name&&this.model.set(e.name,e.value)},onModelPropertyChanged:function(t,e){-1==["offsetStart","offsetEnd","count","offset","currentPageSize","pageSize"].indexOf(e.name)&&this.source.request.get(e.name)!=e.value&&(this.source.request.set(e.name,e.value),this.source.refresh("filter"))},onCountChanged:function(t,e){this.model.set("count",t.source.count,!1),this.updateOffset()},onItemRemoved:function(t,e){this.model.set("count",this.model.getInt("count")-1,!1),this.updateOffset()},onItemAdded:function(t,e){this.model.set("count",this.model.getInt("count")+1,!1),this.updateOffset()},prevPage:function(){if(0>=this.model.get("offset"))return;let t=this.model.get("offset")-this.model.getInt("pageSize");t<0&&(t=0),this.model.set("offset",t),this.updateOffset("range")},nextPage:function(){let t=this.model.get("offset")+this.model.getInt("pageSize");t>=this.model.get("count")||(this.model.set("offset",t),this.updateOffset("range"))},firstPage:function(){this.model.set("offset",0),this.updateOffset("range")},lastPage:function(){let t=this.model.get("count")-this.model.getInt("pageSize");t<0&&(t=0),this.model.set("offset",t),this.updateOffset("range")},refresh:function(){this.source.refresh("full")},clear:function(t){for(let e=0;e<t.length;e++)this.model.set(t[e],"")}}),I=E.register("r-table",{isRoot:!0,source:null,template:null,container:null,isEmpty:null,init:function(){this.setModel({})},ready:function(){if(this.container=this.querySelector(this.dataset.container||"tbody.x-data"),!this.container)throw Error("r-table requires a container");"dynamic"!=this.container.dataset.mode?this.template=c.compile(this.container.innerHTML):this.template=()=>this.container.innerHTML,this.temporalBody=document.createElement("tbody"),this.container.textContent=" ",this.setEmpty(!0)},rready:function(){let t=this.dataSource;if(t?"string"==typeof t&&(t=k.get(t,!0)):t=this.getFieldByPath(this.dataset.source),!t){this.dataset.source&&console.error("data-source not found: "+this.dataset.source);return}this.setSource(t)},setEmpty:function(t){this.isEmpty!==t&&(t?(this.querySelectorAll(".x-empty").forEach(t=>t.classList.remove("is-hidden")),this.querySelectorAll(".x-not-empty").forEach(t=>t.classList.add("is-hidden"))):(this.querySelectorAll(".x-empty").forEach(t=>t.classList.add("is-hidden")),this.querySelectorAll(".x-not-empty").forEach(t=>t.classList.remove("is-hidden"))),this.isEmpty=t)},setSource:function(e){e&&t.isInstanceOf(e,k)&&this.source!==e&&(null!=this.source&&this.source.removeEventListener(this.eid+":*"),this.source=e,this.source.addEventListener(this.eid+":requestPropertyChanged",this.onRequestPropertyChanged,this),this.source.addEventListener(this.eid+":listItemsCleared",this.onItemsCleared,this),this.source.addEventListener(this.eid+":listItemsChanged",this.onItemsChanged,this),this.source.addEventListener(this.eid+":listItemRemoved",this.onItemRemoved,this),this.source.addEventListener(this.eid+":listItemChanged",this.onItemChanged,this),this.source.addEventListener(this.eid+":listItemAdded",this.onItemAdded,this),this.source.setNamespace(this.eid),this.source.request.update(!0),this.source.setNamespace(null))},onRequestPropertyChanged:function(t,e){if(this.model.set(e.name,e.value),"sort"==e.name)this.querySelectorAll("thead [data-sort]").forEach(t=>t.dataset.order="");else if("order"==e.name){let s=this.querySelector('thead [data-sort="'+t.source.get("sort")+'"]');s&&(s.dataset.order=e.value)}},onModelPropertyChanged:function(t,e){this.source.request.get(e.name)!=e.value&&(this.source.request.set(e.name,e.value),-1==["count","offset"].indexOf(e.name)&&this.source.refresh("filter"))},onModelPropertyRemoved:function(t,e){"string"==typeof e.fields?this.source.request.remove(i):e.fields.forEach(t=>this.source.request.remove(t)),this.source.refresh("filter")},buildItem:function(t,e){if(this.container.content){let s=this.container.content(e.get(),e);return s.dataset.iid=t,s}let s=this.temporalBody;return s.innerHTML=this.template(e.get()),s.querySelectorAll('[data-model=":list-item"]').forEach(t=>{t.model=e,t.dataset.model="this.model"}),(s=s.firstElementChild).dataset.iid=t,s},onItemsCleared:function(t,e){this.container._timeout=setTimeout(()=>{this.setEmpty(!0),this.container._timeout=null,this.container.textContent=""},300)},onItemsChanged:function(t,e){if(0==this.source.list.length())return;this.container._timeout&&clearTimeout(this.container._timeout),this.container._timeout=null,this.container.textContent="";let s=0;for(let t of this.source.list.getData())this.container.append(this.buildItem(this.source.list.itemId[s++],t));this.setEmpty(0==s)},onItemRemoved:function(t,e){let s=this.container.querySelector('[data-iid="'+e.id+'"]');s&&(s.remove(),this.setEmpty(0==this.source.list.length()))},onItemChanged:function(t,e){let s=this.container.querySelector('[data-iid="'+e.id+'"]');if(!s)return;let n=this.buildItem(e.id,e.item);this.container.replaceChild(n,s)},onItemAdded:function(t,e){"head"==e.position?this.container.prepend(this.buildItem(e.id,e.item)):this.container.append(this.buildItem(e.id,e.item)),this.setEmpty(!1)},"event click thead [data-sort]":function(t,e){this.source.request.get("sort")==t.source.dataset.sort?this.source.request.set("order","asc"==this.source.request.get("order")?"desc":"asc"):(this.source.request.set("sort",t.source.dataset.sort),this.source.request.set("order","asc",!0)),this.source.refresh("order")},refresh:function(){this.source.refresh("full")},clear:function(t){for(let e=0;e<t.length;e++)this.model.set(t[e],"")}}),N=E.register("r-select",{list:null,container:null,value:"",init:function(){this.container=document.createElement("select"),this.parentElement.insertBefore(this.container,this);let t=[];for(let e of this.attributes)e.nodeName.startsWith("data-_")||"data-list"==e.nodeName||"data-blank"==e.nodeName||"data-option-value"==e.nodeName||"data-option-label"==e.nodeName||(this.container.setAttribute(e.nodeName,e.nodeValue),t.push(e.nodeName));this.disabled&&(this.container.disabled=this.disabled),t.forEach(t=>this.removeAttribute(t)),this.textContent=" ",this.style.display="none"},rready:function(){let t=this.dataList;if(t?"string"==typeof t&&(t=DataList.get(t,!0)):t=this.getFieldByPath(this.dataset.list),!t){this.dataset.list&&console.error("data-list not found: "+this.dataset.list);return}this.setList(t),this.parentElement.lastElementChild!==this&&this.parentElement.append(this)},setList:function(e){e&&t.isInstanceOf(e,o)&&this.list!==e&&(null!=this.list&&this.list.removeEventListener(this.eid+":*"),this.list=e,this.list.dataSource&&(this.list.dataSource.includeEnum=!0),this.list.addEventListener(this.eid+":itemsCleared",this.onItemsCleared,this),this.list.addEventListener(this.eid+":itemsChanged",this.onItemsChanged,this),this.list.addEventListener(this.eid+":itemRemoved",this.onItemsChanged,this),this.list.addEventListener(this.eid+":itemChanged",this.onItemsChanged,this),this.list.addEventListener(this.eid+":itemAdded",this.onItemsChanged,this),this.onItemsChanged())},onItemsCleared:function(t,e){this.container.textContent=""},onItemsChanged:function(t,e){if(0==this.list.length())return;let s=this.list.getData(),n,a,o="";if(s[0].has("value")?n="value":s[0].has("id")&&(n="id"),s[0].has("label")?a="label":s[0].has("name")&&(a="name"),this.dataset.optionValue&&(n=this.dataset.optionValue),this.dataset.optionLabel&&(a=this.dataset.optionLabel),"blank"in this.dataset&&(o+='<option value="">'+this.dataset.blank+"</option>"),s[0].has("group")){let t={};for(let e in s.forEach(e=>t[e.get("group")]=null),t)t[e]={name:e,list:[]};s.forEach(e=>t[e.get("group")].list.push(e)),(t=Object.values(t)).forEach(t=>{o+='<optgroup label="'+t.name+'">',t.list.forEach(t=>o+='<option value="'+t.get(n)+'">'+t.get(a)+"</option>"),o+="</optgroup>"})}else s.forEach(t=>o+='<option value="'+t.get(n)+'">'+t.get(a)+"</option>");this.container.innerHTML=o,this.container.value=this.container.dataset.value},refresh:function(){this.onItemsChanged()}});let q={showDownload:function(t,e){let s=document.createElement("a");s.href=e,s.style.display="none",s.download=t,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s)},showFilePicker:function(t,e,s){let n=document.createElement("input");n.type="file",n.accept=e,n.style.display="none",n.multiple=t,document.body.appendChild(n),n.onchange=function(){s(n.files)},document.body.onfocus=function(){document.body.onfocus=null,document.body.removeChild(n)},n.click()},loadAsDataUrl:function(t,e){let s=new FileReader;s.onload=function(t){e(t.target.result,null)},s.onerror=function(t){e(null,t)},s.readAsDataURL(t)},loadAsBase64:async function(t){return new Promise((e,s)=>{let n=new FileReader;n.onload=function(t){e(t.target.result.split(",")[1])},n.onerror=function(t){s(t)},n.readAsDataURL(t)})},loadAsText:function(t,e){let s=new FileReader;s.onload=function(t){e(t.target.result)},s.readAsText(t)},loadAsArrayBuffer:function(t,e){let s=new FileReader;s.onload=function(t){e(t.target.result)},s.readAsArrayBuffer(t)},loadAllAsDataUrl:function(t,e){let s=[];if(!t||!t.length){e(s);return}let n=function(a){if(a==t.length){e(s);return}q.loadAsDataUrl(t[a],function(e,o){o||s.push({name:t[a].name,size:t[a].size,url:e}),n(a+1)})};n(0)},loadImageFromUrl:function(t,e){let s=new Image;s.onload=()=>e(s),s.onerror=()=>e(null),s.src=t}};var U=E.register("r-image-cropper",{aspectRatio:1,imageScale0:0,imageScale:1,imageOffsX:0,imageOffsY:0,pointerA:null,pointerB:null,bounds:null,init:function(){this.canvas=document.createElement("canvas"),this.appendChild(this.canvas),this.g=this.canvas.getContext("2d"),this.pointerA={id:null,active:!1,sx:0,sy:0,cx:0,cy:0,ix:0,iy:0},this.pointerB={id:null,active:!1,sx:0,sy:0,cx:0,cy:0,ix:0,iy:0},this.log=document.createElement("div"),this.appendChild(this.log)},setImageUrl:function(t){q.loadImageFromUrl(t,t=>{this.setImage(t)})},setImageFile:function(t){q.loadAsDataUrl(t,t=>{q.loadImageFromUrl(t,t=>{this.setImage(t)})})},setImage:function(t){this.image=t,this.reset(),this.imageScale=Math.max(this.canvas.width/this.image.width,this.canvas.height/this.image.height),this.imageOffsX=(this.canvas.width-this.imageScale*this.image.width)*.5,this.imageOffsY=(this.canvas.height-this.imageScale*this.image.height)*.5,this.render()},getBlobAndUrl:function(t,e="image/png",s=.9){this.canvas.toBlob(e=>{t(e,URL.createObjectURL(e))},e,s)},reset:function(){this.bounds=this.getBoundingClientRect(),this.canvas.width=this.bounds.width,this.canvas.height=this.bounds.width/this.aspectRatio},render:function(){this.canvas.width=this.canvas.width,this.g.fillStyle="#000",this.g.beginPath(),this.g.rect(0,0,this.canvas.width,this.canvas.height),this.g.fill(),this.g.translate(this.imageOffsX,this.imageOffsY),this.g.scale(this.imageScale,this.imageScale),this.g.drawImage(this.image,0,0)},translateImage:function(t,e){this.imageOffsX+=t,this.imageOffsY+=e,this.render(!0)},"event mousemove canvas":function(t){this.pointerA.active&&(this.pointerA.cx=t.clientX,this.pointerA.cy=t.clientY,this.translateImage(this.pointerA.cx-this.pointerA.sx,this.pointerA.cy-this.pointerA.sy),this.pointerA.sx=this.pointerA.cx,this.pointerA.sy=this.pointerA.cy),this.pointerA.ix=(t.clientX-this.bounds.left-this.imageOffsX)/this.imageScale,this.pointerA.iy=(t.clientY-this.bounds.top-this.imageOffsY)/this.imageScale},"event mousedown canvas":function(t){this.pointerA.active=!0,this.pointerA.sx=t.clientX,this.pointerA.sy=t.clientY},"event mouseup canvas":function(t){this.pointerA.active=!1},"event wheel canvas":function(t){t.deltaY>0?this.imageScale-=.045:this.imageScale+=.045,this.imageScale<.1&&(this.imageScale=.1),this.imageOffsX+=-this.pointerA.ix*this.imageScale+(t.clientX-this.bounds.left)-this.imageOffsX,this.imageOffsY+=-this.pointerA.iy*this.imageScale+(t.clientY-this.bounds.top)-this.imageOffsY,this.render()},"event touchmove canvas":function(t){for(let e of t.changedTouches)this.pointerA.id==e.identifier?(this.pointerA.cx=e.clientX,this.pointerA.cy=e.clientY):this.pointerB.id==e.identifier&&(this.pointerB.cx=e.clientX,this.pointerB.cy=e.clientY);if(this.pointerA.active&&this.pointerB.active){let t=Math.sqrt(Math.pow(this.pointerA.sx-this.pointerB.sx,2)+Math.pow(this.pointerA.sy-this.pointerB.sy,2)),e=Math.sqrt(Math.pow(this.pointerA.cx-this.pointerB.cx,2)+Math.pow(this.pointerA.cy-this.pointerB.cy,2));this.imageScale+=(e-t)/10*.025,this.imageScale<.1&&(this.imageScale=.1),this.imageOffsX+=-this.pointerA.ix*this.imageScale+(this.pointerA.cx-this.bounds.left)-this.imageOffsX,this.imageOffsY+=-this.pointerA.iy*this.imageScale+(this.pointerA.cy-this.bounds.top)-this.imageOffsY,this.pointerA.sx=this.pointerA.cx,this.pointerA.sy=this.pointerA.cy,this.pointerB.sx=this.pointerB.cx,this.pointerB.sy=this.pointerB.cy,this.render()}else{let t=this.pointerA.active?this.pointerA:this.pointerB.active?this.pointerB:null;if(!t)return;this.translateImage(t.cx-t.sx,t.cy-t.sy),t.sx=t.cx,t.sy=t.cy}},"event touchstart canvas":function(t){for(let e of(this.imageScale0=this.imageScale,t.changedTouches))null===this.pointerA.id?(this.pointerA.id=e.identifier,this.pointerA.active=!0,this.pointerA.sx=e.clientX,this.pointerA.sy=e.clientY,this.pointerA.ix=(e.clientX-this.bounds.left-this.imageOffsX)/this.imageScale,this.pointerA.iy=(e.clientY-this.bounds.top-this.imageOffsY)/this.imageScale):null===this.pointerB.id&&(this.pointerB.id=e.identifier,this.pointerB.active=!0,this.pointerB.sx=e.clientX,this.pointerB.sy=e.clientY,this.pointerB.ix=(e.clientX-this.bounds.left-this.imageOffsX)/this.imageScale,this.pointerB.iy=(e.clientY-this.bounds.top-this.imageOffsY)/this.imageScale)},"event touchend canvas":function(t){for(let e of t.changedTouches)this.pointerA.id==e.identifier?(this.pointerA.id=null,this.pointerA.active=!1):this.pointerB.id==e.identifier&&(this.pointerB.id=null,this.pointerB.active=!1)},"event touchcancel canvas":function(t){for(let e of t.changedTouches)this.pointerA.id==e.identifier?(this.pointerA.id=null,this.pointerA.active=!1):this.pointerB.id==e.identifier&&(this.pointerB.id=null,this.pointerB.active=!1)}});let M={E_NONE:0,E_PERMISSION_DENIED:32769,E_POSITION_UNAVAILABLE:32770,E_TIMEOUT:32771,E_UNSUPPORTED:32772,E_UNKNOWN:32777,supported:null,status:null,indicatorOn:function(){g.document.documentElement.classList.add("busy-geo")},indicatorOff:function(){g.document.documentElement.classList.remove("busy-geo")},init:function(){return this.supported=!!navigator.geolocation,this.supported},getCurrentPosition:function(){null===this.supported&&this.init();let t=this.status={cancelled:!1};return new Promise(async(e,s)=>{if(this.indicatorOn(),!this.supported){this.status===t&&(this.status=null),t.cancelled||this.indicatorOff(),s({status:t,code:M.E_UNSUPPORTED,message:"Geolocation is not supported on this device."});return}navigator.geolocation.getCurrentPosition(s=>{this.status===t&&(this.status=null),t.cancelled||this.indicatorOff(),s.status=t,e(s)},e=>{let n;switch(this.status===t&&(this.status=null),t.cancelled||this.indicatorOff(),e.code){case 1:n=M.E_PERMISSION_DENIED;break;case 2:n=M.E_POSITION_UNAVAILABLE;break;case 3:n=M.E_TIMEOUT;break;default:n=M.E_UNKNOWN,e.message="Unable to get the current location."}s({status:t,code:n,message:e.message})},{enableHighAccuracy:!0})})},cancel:function(){null!==this.status&&(this.status.cancelled||this.indicatorOff(),this.status.cancelled=!0,this.status=null)}},D=d,$=f,B=p,H=m,F={DYNAMIC:{},setValue:function(t,e,s,n){if(("class"===e[0]||"classList"===e[0])&&(e[0]="className"),e.length>1&&"trait"===e[0]){switch(e[1]){case"value":t.onchange=t=>n.set(t.currentTarget.value),B([n],e=>t.value=e);break;case"input":t.oninput=t=>n.set(t.currentTarget.value),B([n],e=>t.value=e);break;case"checked":t.onchange=t=>n.set(t.currentTarget.checked),B([n],e=>t.checked=e);break;case"selected":t.onchange=t=>n.set(t.currentTarget.selected),B([n],e=>t.selected=e);break;default:console.error("Unknown trait: "+e[1])}return}if(1===e.length&&"object"==typeof n)switch(e[0]){case"style":for(let e in n)B([e,n[e]],(e,s)=>t.style[e]=s);return;case"className":if(n instanceof Array)B([n],e=>{for(let s in t.className="",e)t.classList.add(e[s])});else for(let e in n)B([e,n[e]],(e,s)=>t.classList[!0==s?"add":"remove"](e));return}if(2===e.length&&"className"===e[0]){B([e[1],n],(e,s)=>t.classList[!0==s?"add":"remove"](e));return}for(let n=0;n<s&&t;n++)t=t[e[n]];if(!t)return;let a=e[s];a.startsWith("on")&&(a=a.toLowerCase()),B([a,n],(e,s)=>t[e]=s)},createSetter:function(t){let e=t.length-1;return function(s,n){F.setValue(s,t,e,n)}},copyProps:function(t,e){for(let s in t)!(!s.startsWith("on")||s.startsWith("onmoz"))&&t[s]&&(e[s]=t[s]);for(let s of Object.getOwnPropertyNames(t))~~s!=s&&(e[s]=t[s]);return e},cloneNode:function(t,e=!1){if(!e&&!0===t.isCustom)throw Error("cloneNode only available as deep clone for custom elements.");if(e&&!0===t.isCustom)return t.cloneNodeCustom();let s=t.cloneNode();if(e)for(let e of t.childNodes)s.appendChild(F.cloneNode(e,!0));return F.copyProps(t,s),"oncreated"in s&&s.oncreated(s),s},ensureNode:function(t,e=!1){if(t instanceof Array){for(let s=0;s<t.length;s++)t[s]=F.ensureNode(t[s],e);return t}return t instanceof Node?e?F.cloneNode(t,!0):t:document.createTextNode(t)},replaceNode:function(t,e,s,n=!1){if(e instanceof Array){for(;e.length>1;){let s=e.shift();s.parentElement===t&&s.remove()}e=e.shift()}let a=s,o=s;if(s instanceof Array){let t=document.createDocumentFragment();a=[],0==s.length&&(s=[document.createTextNode("")]);for(let e=0;e<s.length;e++)a.push(s[e]),t.appendChild(s[e]);o=s[0],s=t}if(!1===n){e.replaceWith(s);let t=document.createComment("");o.parentElement.insertBefore(t,o),a instanceof Array||(a=[a]),a.push(t)}else e.appendChild(s);return a},createReplacer:function(t){return function(e,s){t=F.replaceNode(e,t,F.ensureNode(s))}},create:function(t,e,s){let n=document.createElement(t),a=[];for(let t=0;t<e.length;t+=2){let s=null;if(s=-1!==e[t].indexOf(":")?e[t].split(":"):[e[t]],e[t+1]!==F.DYNAMIC){F.setValue(n,s,s.length-1,e[t+1]);continue}a.push(F.createSetter(s))}let o=[],r=!1,l=!0;for(let t in s)!0===s[t].isCustom&&(r=!0),s[t]===F.DYNAMIC&&o.push(t);let h=a.length,c=o.length;return function(t,e,u=null){let d=(e,f=null)=>{let p=null;if(l||r){let t=r?F.cloneNode(n):n;for(let e in s){if(s[e]instanceof Array)throw Error("Document fragments not fully supported!");F.replaceNode(t,t,F.ensureNode(s[e],!0),!0)}r&&(p=t),l=!1}null===p&&(p=F.cloneNode(n,!0));let m="oncreated"in p,g=o.map(t=>F.createReplacer(p.childNodes[t]));for(let e=0;e<h;e++)a[e](p,t[e]);for(let t=0;t<c;t++)B([e[t],t],(t,e)=>g[e](p,t));if(null!==u)for(let t of u)for(let e in t){let s=null;s=-1!==e.indexOf(":")?e.split(":"):[e],F.setValue(p,s,s.length-1,t[e])}return null!==f&&F.copyProps(f,p),!m&&"oncreated"in p&&p.oncreated(p),"onlongpress"in p&&(p.dataset.longPress="true"),p.isCustom=!0,p.cloneNode=()=>{throw Error("Use of cloneNode is forbidden in custom elements, use cloneNodeCustom instead.")},p.cloneNodeCustom=()=>d(e.map(t=>t instanceof Node&&!0===t.isCustom?t.cloneNodeCustom():t),p),p};return d(e)}}},V=b,j=E,Y=E,X=L,z=k,Q=C,W=S,G=T,K={Tabs:x,Form:P,Panel:A,List:R,Item:w,Paginator:O,Table:I,Select:N,ImageCropper:U},J=q,Z={db:null,init:function(t,e,s){return new Promise((n,a)=>{if(!g.indexedDB){a("IndexedDB is not available in your system.");return}let o=indexedDB.open(t,e);o.onerror=t=>{let e=t.target.error+"";-1!==e.indexOf("AbortError")&&(e="\n"+o.message),a("Unable to open database: "+e)},o.onupgradeneeded=async t=>{try{let e=t.target.result,n=t.target.transaction;t.oldVersion<1&&e.createObjectStore("system",{keyPath:["name"]}),await s(e,n,t.oldVersion)}catch(t){o.message=t.message,o.transaction.abort()}},o.onsuccess=async t=>{this.db=t.target.result,n()}})},ensureConnected:function(){this.db||alert("Error: Database not initialized.")},index:function(t,e){this.ensureConnected();let s=this.db.transaction(t,"readwrite").objectStore(t).index(e);if(!s)throw Error("Unable to find index `"+e+"` in store "+t);return s},forEach:function(t,e,s){return this.ensureConnected(),"function"==typeof e&&(s=e,e=null),new Promise(async(n,a)=>{let o,r;r="string"==typeof t?this.db.transaction(t,"readwrite").objectStore(t):t,(o=null===e?r.openCursor():r.openCursor(e)).onsuccess=async t=>{let e=t.target.result;if(!e||!1===await s(e.value,e)){n();return}e.continue()},o.onerror=t=>{a(t.target.error)}})},count:function(t){return this.ensureConnected(),new Promise((e,s)=>{let n=("string"==typeof t?this.db.transaction(t,"readonly").objectStore(t):t).count();n.onsuccess=t=>{e(t.target.result)},n.onerror=t=>{s(t.target.error)}})},getAll:function(t,e=null){return this.ensureConnected(),new Promise((s,n)=>{let a=("string"==typeof t?this.db.transaction(t,"readonly").objectStore(t):t).getAll(e);a.onsuccess=t=>{s(t.target.result)},a.onerror=t=>{n(t.target.error)}})},getAllKeys:function(t,e=null){return this.ensureConnected(),new Promise((s,n)=>{let a=("string"==typeof t?this.db.transaction(t,"readonly").objectStore(t):t).getAllKeys(e);a.onsuccess=t=>{s(t.target.result)},a.onerror=t=>{n(t.target.error)}})},getAllUnique:function(t,e=null){return this.ensureConnected(),new Promise((s,n)=>{let a=("string"==typeof t?this.db.transaction(t,"readonly").objectStore(t):t).openCursor(null,"nextunique"),o=[];a.onsuccess=t=>{let n=t.target.result;if(!n){s(o);return}o.push(e?n.value[e]:n.value),n.continue()},a.onerror=t=>{n(t.target.error)}})},get:function(t,e){return this.ensureConnected(),new Promise((s,n)=>{let a=("string"==typeof t?this.db.transaction(t,"readonly").objectStore(t):t).get(e);a.onsuccess=t=>{s(t.target.result||null)},a.onerror=t=>{n(t.target.error)}})},put:function(t,e){return this.ensureConnected(),new Promise((s,n)=>{let a=this.db.transaction(t,"readwrite").objectStore(t).put(e);a.onsuccess=t=>{s()},a.onerror=t=>{n(t.target.error)}})},sysGet:async function(t,e=!1){let s=await this.get("system",[t]);return s?e?s:s.value:null},sysPut:async function(t,e,s=!1){s?(e.name=t,await this.put("system",e)):await this.put("system",{name:t,value:e})},findOne:function(e,s=null,n=null){return this.ensureConnected(),new Promise((a,o)=>{let r=("string"==typeof e?this.db.transaction(e,"readonly").objectStore(e):e).openCursor();r.onsuccess=e=>{let o=e.target.result;if(!o){a(null);return}if(null===s||t.partialCompare(o.value,s)){if(null!==n&&t.partialCompare(o.value,n)){o.continue();return}a(o.value);return}o.continue()},r.onerror=t=>{o(t.target.error)}})},delete:function(t,e){return this.ensureConnected(),new Promise((s,n)=>{let a=this.db.transaction(t,"readwrite").objectStore(t).delete(e);a.onsuccess=t=>{s()},a.onerror=t=>{n(t.target.error)}})},deleteAll:function(t,e=null){return this.forEach(t,e,async(t,e)=>{await e.delete()})},insert:function(t,e){return this.ensureConnected(),new Promise((s,n)=>{let a=this.db.transaction(t,"readwrite").objectStore(t).add(e);a.onsuccess=t=>{s()},a.onerror=t=>{n(t.target.error)}})}},tt=M,te=t,ti=e,ts=s,tn=n,ta=a,to=o,tr=r,tl=l,th=h,tc=c;export{V as Router,j as Element,Y as CElement,X as Api,z as DataSource,Q as DataList,W as Easing,G as Anim,K as Elements,J as Utils,Z as db,tt as geo,te as Rinn,ti as Class,ts as Event,tn as EventDispatcher,ta as Model,to as ModelList,tr as Schema,tl as Flattenable,th as Collection,tc as Template,D as signal,$ as expr,B as watch,H as validator,F as helpers};
//# sourceMappingURL=riza.m.js.map
